var TAG_GLOBAL=function(tagInput){function json2xml(e,t){var n=function(e,t,r){var i="";if(e instanceof Array){for(var s=0,o=e.length;s<o;s++)i+=r+n(e[s],t,r+"	")+"\n"}else if(typeof e=="object"){var u=false;i+=r+"<"+t;for(var a in e){if(a.charAt(0)=="@")i+=" "+a.substr(1)+'="'+e[a].toString()+'"';else u=true}i+=u?">":"/>";if(u){for(var a in e){if(a=="#text")i+=e[a];else if(a=="#cdata")i+="<![CDATA["+e[a]+"]]>";else if(a.charAt(0)!="@")i+=n(e[a],a,r+"	")}i+=(i.charAt(i.length-1)=="\n"?r:"")+"</"+t+">"}}else{i+=r+"<"+t+">"+e.toString()+"</"+t+">"}return i},r="";for(var i in e)r+=n(e[i],i,"");return t?r.replace(/\t/g,t):r.replace(/\t|\n/g,"")}function AVLTree(e,t){"use strict";this._comparator=e;this._root=null;this._intermediates=[];this._current=null;this._valuation=t}function AVLNode(e,t){"use strict";this._comparator=t;this._left=null;this._right=null;this._value=e;this._height=1}function binaryHeap(e){"use strict";this.content=[];this.scoreFunction=e||function(e){return e}}function DataHolder(){"use strict";this._trackArray=[];this._scoreFunctionMin=function(e){return e.bound};this._selectedTrack;this._leftExternal=new binaryHeap(this._scoreFunctionMin);this._leftInternal=new binaryHeap(this._scoreFunctionMin);this._rightExternal=new binaryHeap(this._scoreFunctionMin);this._rightInternal=new binaryHeap(this._scoreFunctionMin);this._dispComparator=function(e,t){if(e.display.getStart()<t.display.getStart()){return-1}else if(e.display.getStart()>t.display.getStart()){return 1}else{return 0}};this._kfComparator=function(e,t){if(e.getTime()<t.getTime()){return-1}else if(e.getTime()>t.getTime()){return 1}else{return 0}};this._dispValuation=function(e,t){if(!t){return false}else if(e<t.display.getStart()){return-1}else if(e>t.display.getStart()){return 1}else{return 0}};this._kfValuation=function(e,t){if(!t){return false}else if(e<t.getTime()){return-1}else if(e>t.getTime()){return 1}else{return 0}}}function DoublyLinkedList(){"use strict";this._head=null;this._tail=null;this._length=0}function HashTable(){this._length=0;this._items={}}var tagPath=tagInput.path||"",containerId=tagInput.containerId||"tagContainer",ip=tagInput.serverIp||"browntagserver.com",allowServerChange=tagInput.allowServerChange,allowAuthoringMode=tagInput.allowAuthoringMode,idleDuration=tagInput.idleDuration,currentPage={},urlToLoad=tagInput.urlToLoad,urlToParse=tagInput.urlToParse,pageToLoad={},TELEMETRY_SESSION_ID=null,TELEMETRY_SWITCH=localStorage.tagTelemetry?localStorage.tagTelemetry:"off",IS_WINDOWS=typeof Windows!=="undefined",IS_WEBAPP=!IS_WINDOWS,idleTimer,Worktop={},TAG={};(function(e,t){function u(e){var t=o[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++){t[e[n]]=true}return t}function c(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(l,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r==="string"){try{r=r==="true"?true:r==="false"?false:r==="null"?null:s.isNumeric(r)?parseFloat(r):f.test(r)?s.parseJSON(r):r}catch(o){}s.data(e,n,r)}else{r=t}}return r}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t])){continue}if(t!=="toJSON"){return false}}return true}function p(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",u=s._data(e,r);if(u&&(n==="queue"||!s._data(e,i))&&(n==="mark"||!s._data(e,o))){setTimeout(function(){if(!s._data(e,i)&&!s._data(e,o)){s.removeData(e,r,true);u.fire()}},0)}}function H(){return false}function B(){return true}function W(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function X(e,t,n){t=t||0;if(s.isFunction(t)){return s.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n})}else if(t.nodeType){return s.grep(e,function(e,r){return e===t===n})}else if(typeof t==="string"){var r=s.grep(e,function(e){return e.nodeType===1});if(q.test(t)){return s.filter(t,r,!n)}else{t=s.filter(t,r)}}return s.grep(e,function(e,r){return s.inArray(e,t)>=0===n})}function V(e){var t=$.split("|"),n=e.createDocumentFragment();if(n.createElement){while(t.length){n.createElement(t.pop())}}return n}function at(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e,t){if(t.nodeType!==1||!s.hasData(e)){return}var n,r,i,o=s._data(e),u=s._data(t,o),a=o.events;if(a){delete u.handle;u.events={};for(n in a){for(r=0,i=a[n].length;r<i;r++){s.event.add(t,n+(a[n][r].namespace?".":"")+a[n][r].namespace,a[n][r],a[n][r].data)}}}if(u.data){u.data=s.extend({},u.data)}}function lt(e,t){var n;if(t.nodeType!==1){return}if(t.clearAttributes){t.clearAttributes()}if(t.mergeAttributes){t.mergeAttributes(e)}n=t.nodeName.toLowerCase();if(n==="object"){t.outerHTML=e.outerHTML}else if(n==="input"&&(e.type==="checkbox"||e.type==="radio")){if(e.checked){t.defaultChecked=t.checked=e.checked}if(t.value!==e.value){t.value=e.value}}else if(n==="option"){t.selected=e.defaultSelected}else if(n==="input"||n==="textarea"){t.defaultValue=e.defaultValue}t.removeAttribute(s.expando)}function ct(e){if(typeof e.getElementsByTagName!=="undefined"){return e.getElementsByTagName("*")}else if(typeof e.querySelectorAll!=="undefined"){return e.querySelectorAll("*")}else{return[]}}function ht(e){if(e.type==="checkbox"||e.type==="radio"){e.defaultChecked=e.checked}}function pt(e){var t=(e.nodeName||"").toLowerCase();if(t==="input"){ht(e)}else if(t!=="script"&&typeof e.getElementsByTagName!=="undefined"){s.grep(e.getElementsByTagName("input"),ht)}}function dt(e){var t=n.createElement("div");ut.appendChild(t);t.innerHTML=e.outerHTML;return t.firstChild}function vt(e,t){if(t.src){s.ajax({url:t.src,async:false,dataType:"script"})}else{s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(st,"/*$0*/"))}if(t.parentNode){t.parentNode.removeChild(t)}}function Lt(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?xt:Tt,o=0,u=i.length;if(r>0){if(n!=="border"){for(;o<u;o++){if(!n){r-=parseFloat(s.css(e,"padding"+i[o]))||0}if(n==="margin"){r+=parseFloat(s.css(e,n+i[o]))||0}else{r-=parseFloat(s.css(e,"border"+i[o]+"Width"))||0}}}return r+"px"}r=Nt(e,t,t);if(r<0||r==null){r=e.style[t]||0}r=parseFloat(r)||0;if(n){for(;o<u;o++){r+=parseFloat(s.css(e,"padding"+i[o]))||0;if(n!=="padding"){r+=parseFloat(s.css(e,"border"+i[o]+"Width"))||0}if(n==="margin"){r+=parseFloat(s.css(e,n+i[o]))||0}}}return r+"px"}function Gt(e){return function(t,n){if(typeof t!=="string"){n=t;t="*"}if(s.isFunction(n)){var r=t.toLowerCase().split(Rt),i=0,o=r.length,u,a,f;for(;i<o;i++){u=r[i];f=/^\+/.test(u);if(f){u=u.substr(1)||"*"}a=e[u]=e[u]||[];a[f?"unshift":"push"](n)}}}}function Yt(e,n,r,i,s,o){s=s||n.dataTypes[0];o=o||{};o[s]=true;var u=e[s],a=0,f=u?u.length:0,l=e===Xt,c;for(;a<f&&(l||!c);a++){c=u[a](n,r,i);if(typeof c==="string"){if(!l||o[c]){c=t}else{n.dataTypes.unshift(c);c=Yt(e,n,r,i,c,o)}}}if((l||!c)&&!o["*"]){c=Yt(e,n,r,i,"*",o)}return c}function Zt(e,n){var r,i,o=s.ajaxSettings.flatOptions||{};for(r in n){if(n[r]!==t){(o[r]?e:i||(i={}))[r]=n[r]}}if(i){s.extend(true,e,i)}}function en(e,t,n,r){if(s.isArray(t)){s.each(t,function(t,i){if(n||Ot.test(e)){r(e,i)}else{en(e+"["+(typeof i==="object"||s.isArray(i)?t:"")+"]",i,n,r)}})}else if(!n&&t!=null&&typeof t==="object"){for(var i in t){en(e+"["+i+"]",t[i],n,r)}}else{r(e,t)}}function tn(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o){if(a in r){n[o[a]]=r[a]}}while(s[0]==="*"){s.shift();if(u===t){u=e.mimeType||n.getResponseHeader("content-type")}}if(u){for(a in i){if(i[a]&&i[a].test(u)){s.unshift(a);break}}}if(s[0]in r){f=s[0]}else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}if(!l){l=a}}f=f||l}if(f){if(f!==s[0]){s.unshift(f)}return r[f]}}function nn(e,n){if(e.dataFilter){n=e.dataFilter(n,e.dataType)}var r=e.dataTypes,i={},o,u,a=r.length,f,l=r[0],c,h,p,d,v;for(o=1;o<a;o++){if(o===1){for(u in e.converters){if(typeof u==="string"){i[u.toLowerCase()]=e.converters[u]}}}c=l;l=r[o];if(l==="*"){l=c}else if(c!=="*"&&c!==l){h=c+" "+l;p=i[h]||i["* "+l];if(!p){v=t;for(d in i){f=d.split(" ");if(f[0]===c||f[0]==="*"){v=i[f[1]+" "+l];if(v){d=i[d];if(d===true){p=v}else if(v===true){p=d}break}}}}if(!(p||v)){s.error("No conversion from "+h.replace(" "," to "))}if(p!==true){n=p?p(n):v(d(n))}}}return n}function fn(){try{return new e.XMLHttpRequest}catch(t){}}function ln(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function bn(){setTimeout(wn,0);return yn=s.now()}function wn(){yn=t}function En(e,t){var n={};s.each(gn.concat.apply([],gn.slice(0,t)),function(){n[this]=e});return n}function Sn(e){if(!cn[e]){var t=n.body,r=s("<"+e+">").appendTo(t),i=r.css("display");r.remove();if(i==="none"||i===""){if(!hn){hn=n.createElement("iframe");hn.frameBorder=hn.width=hn.height=0}t.appendChild(hn);if(!pn||!hn.createElement){pn=(hn.contentWindow||hn.contentDocument).document;pn.write((n.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");pn.close()}r=pn.createElement(e);pn.body.appendChild(r);i=s.css(r,"display");t.removeChild(hn)}cn[e]=i}return cn[e]}function Nn(e){return s.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:false}var n=e.document,r=e.navigator,i=e.location;var s=function(){function H(){if(i.isReady){return}try{n.documentElement.doScroll("left")}catch(e){setTimeout(H,1);return}i.ready()}var i=function(e,t){return new i.fn.init(e,t,u)},s=e.jQuery,o=e.$,u,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,E=/-([a-z]|[0-9])/ig,S=/^-ms-/,x=function(e,t){return(t+"").toUpperCase()},T=r.userAgent,N,C,k,L=Object.prototype.toString,A=Object.prototype.hasOwnProperty,O=Array.prototype.push,M=Array.prototype.slice,_=String.prototype.trim,D=Array.prototype.indexOf,P={};i.fn=i.prototype={constructor:i,init:function(e,r,s){var o,u,f,l;if(!e){return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(e==="body"&&!r&&n.body){this.context=n;this[0]=n.body;this.selector=e;this.length=1;return this}if(typeof e==="string"){if(e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3){o=[null,e,null]}else{o=a.exec(e)}if(o&&(o[1]||!r)){if(o[1]){r=r instanceof i?r[0]:r;l=r?r.ownerDocument||r:n;f=h.exec(e);if(f){if(i.isPlainObject(r)){e=[n.createElement(f[1])];i.fn.attr.call(e,r,true)}else{e=[l.createElement(f[1])]}}else{f=i.buildFragment([o[1]],[l]);e=(f.cacheable?i.clone(f.fragment):f.fragment).childNodes}return i.merge(this,e)}else{u=n.getElementById(o[2]);if(u&&u.parentNode){if(u.id!==o[2]){return s.find(e)}this.length=1;this[0]=u}this.context=n;this.selector=e;return this}}else if(!r||r.jquery){return(r||s).find(e)}else{return this.constructor(r).find(e)}}else if(i.isFunction(e)){return s.ready(e)}if(e.selector!==t){this.selector=e.selector;this.context=e.context}return i.makeArray(e,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return M.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();if(i.isArray(e)){O.apply(r,e)}else{i.merge(r,e)}r.prevObject=this;r.context=this.context;if(t==="find"){r.selector=this.selector+(this.selector?" ":"")+n}else if(t){r.selector=this.selector+"."+t+"("+n+")"}return r},each:function(e,t){return i.each(this,e,t)},ready:function(e){i.bindReady();C.add(e);return this},eq:function(e){e=+e;return e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(M.apply(this,arguments),"slice",M.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:O,sort:[].sort,splice:[].splice};i.fn.init.prototype=i.fn;i.extend=i.fn.extend=function(){var e,n,r,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=false;if(typeof a==="boolean"){c=a;a=arguments[1]||{};f=2}if(typeof a!=="object"&&!i.isFunction(a)){a={}}if(l===f){a=this;--f}for(;f<l;f++){if((e=arguments[f])!=null){for(n in e){r=a[n];s=e[n];if(a===s){continue}if(c&&s&&(i.isPlainObject(s)||(o=i.isArray(s)))){if(o){o=false;u=r&&i.isArray(r)?r:[]}else{u=r&&i.isPlainObject(r)?r:{}}a[n]=i.extend(c,u,s)}else if(s!==t){a[n]=s}}}}return a};i.extend({noConflict:function(t){if(e.$===i){e.$=o}if(t&&e.jQuery===i){e.jQuery=s}return i},isReady:false,readyWait:1,holdReady:function(e){if(e){i.readyWait++}else{i.ready(true)}},ready:function(e){if(e===true&&!--i.readyWait||e!==true&&!i.isReady){if(!n.body){return setTimeout(i.ready,1)}i.isReady=true;if(e!==true&&--i.readyWait>0){return}C.fireWith(n,[i]);if(i.fn.trigger){i(n).trigger("ready").off("ready")}}},bindReady:function(){if(C){return}C=i.Callbacks("once memory");if(n.readyState==="complete"){return setTimeout(i.ready,1)}if(n.addEventListener){n.addEventListener("DOMContentLoaded",k,false);e.addEventListener("load",i.ready,false)}else if(n.attachEvent){n.attachEvent("onreadystatechange",k);e.attachEvent("onload",i.ready);var t=false;try{t=e.frameElement==null}catch(r){}if(n.documentElement.doScroll&&t){H()}}},isFunction:function(e){return i.type(e)==="function"},isArray:Array.isArray||function(e){return i.type(e)==="array"},isWindow:function(e){return e&&typeof e==="object"&&"setInterval"in e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):P[L.call(e)]||"object"},isPlainObject:function(e){if(!e||i.type(e)!=="object"||e.nodeType||i.isWindow(e)){return false}try{if(e.constructor&&!A.call(e,"constructor")&&!A.call(e.constructor.prototype,"isPrototypeOf")){return false}}catch(n){return false}var r;for(r in e){}return r===t||A.call(e,r)},isEmptyObject:function(e){for(var t in e){return false}return true},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!=="string"||!t){return null}t=i.trim(t);if(e.JSON&&e.JSON.parse){return e.JSON.parse(t)}if(p.test(t.replace(d,"@").replace(v,"]").replace(m,""))){return(new Function("return "+t))()}i.error("Invalid JSON: "+t)},parseXML:function(n){var r,s;try{if(e.DOMParser){s=new DOMParser;r=s.parseFromString(n,"text/xml")}else{r=new ActiveXObject("Microsoft.XMLDOM");r.async="false";r.loadXML(n)}}catch(o){r=t}if(!r||!r.documentElement||r.getElementsByTagName("parsererror").length){i.error("Invalid XML: "+n)}return r},noop:function(){},globalEval:function(t){if(t&&f.test(t)){(e.execScript||function(t){e["eval"].call(e,t)})(t)}},camelCase:function(e){return e.replace(S,"ms-").replace(E,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var s,o=0,u=e.length,a=u===t||i.isFunction(e);if(r){if(a){for(s in e){if(n.apply(e[s],r)===false){break}}}else{for(;o<u;){if(n.apply(e[o++],r)===false){break}}}}else{if(a){for(s in e){if(n.call(e[s],s,e[s])===false){break}}}else{for(;o<u;){if(n.call(e[o],o,e[o++])===false){break}}}}return e},trim:_?function(e){return e==null?"":_.call(e)}:function(e){return e==null?"":e.toString().replace(l,"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var r=i.type(e);if(e.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(e)){O.call(n,e)}else{i.merge(n,e)}}return n},inArray:function(e,t,n){var r;if(t){if(D){return D.call(t,e,n)}r=t.length;n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++){if(n in t&&t[n]===e){return n}}}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length==="number"){for(var s=n.length;i<s;i++){e[r++]=n[i]}}else{while(n[i]!==t){e[r++]=n[i++]}}e.length=r;return e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++){i=!!t(e[s],s);if(n!==i){r.push(e[s])}}return r},map:function(e,n,r){var s,o,u=[],a=0,f=e.length,l=e instanceof i||f!==t&&typeof f==="number"&&(f>0&&e[0]&&e[f-1]||f===0||i.isArray(e));if(l){for(;a<f;a++){s=n(e[a],a,r);if(s!=null){u[u.length]=s}}}else{for(o in e){s=n(e[o],o,r);if(s!=null){u[u.length]=s}}}return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n==="string"){var r=e[n];n=e;e=r}if(!i.isFunction(e)){return t}var s=M.call(arguments,2),o=function(){return e.apply(n,s.concat(M.call(arguments)))};o.guid=e.guid=e.guid||o.guid||i.guid++;return o},access:function(e,n,r,s,o,u){var a=e.length;if(typeof n==="object"){for(var f in n){i.access(e,f,n[f],s,o,r)}return e}if(r!==t){s=!u&&s&&i.isFunction(r);for(var l=0;l<a;l++){o(e[l],n,s?r.call(e[l],l,o(e[l],n)):r,u)}return e}return a?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=g.exec(e)||y.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&w.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}i.extend(true,e,this);e.superclass=this;e.fn=e.prototype=this();e.fn.constructor=e;e.sub=this.sub;e.fn.init=function(r,s){if(s&&s instanceof i&&!(s instanceof e)){s=e(s)}return i.fn.init.call(this,r,s,t)};e.fn.init.prototype=e.fn;var t=e(n);return e},browser:{}});i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){P["[object "+t+"]"]=t.toLowerCase()});N=i.uaMatch(T);if(N.browser){i.browser[N.browser]=true;i.browser.version=N.version}if(i.browser.webkit){i.browser.safari=true}if(f.test(" ")){l=/^[\s\xA0]+/;c=/[\s\xA0]+$/}u=i(n);if(n.addEventListener){k=function(){n.removeEventListener("DOMContentLoaded",k,false);i.ready()}}else if(n.attachEvent){k=function(){if(n.readyState==="complete"){n.detachEvent("onreadystatechange",k);i.ready()}}}return i}();var o={};s.Callbacks=function(e){e=e?o[e]||u(e):{};var n=[],r=[],i,a,f,l,c,h=function(t){var r,i,o,u,a;for(r=0,i=t.length;r<i;r++){o=t[r];u=s.type(o);if(u==="array"){h(o)}else if(u==="function"){if(!e.unique||!d.has(o)){n.push(o)}}}},p=function(t,s){s=s||[];i=!e.memory||[t,s];a=true;c=f||0;f=0;l=n.length;for(;n&&c<l;c++){if(n[c].apply(t,s)===false&&e.stopOnFalse){i=true;break}}a=false;if(n){if(!e.once){if(r&&r.length){i=r.shift();d.fireWith(i[0],i[1])}}else if(i===true){d.disable()}else{n=[]}}},d={add:function(){if(n){var e=n.length;h(arguments);if(a){l=n.length}else if(i&&i!==true){f=e;p(i[0],i[1])}}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++){for(var s=0;s<n.length;s++){if(t[r]===n[s]){if(a){if(s<=l){l--;if(s<=c){c--}}}n.splice(s--,1);if(e.unique){break}}}}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++){if(e===n[t]){return true}}}return false},empty:function(){n=[];return this},disable:function(){n=r=i=t;return this},disabled:function(){return!n},lock:function(){r=t;if(!i||i===true){d.disable()}return this},locked:function(){return!r},fireWith:function(t,n){if(r){if(a){if(!e.once){r.push([t,n])}}else if(!(e.once&&i)){p(t,n)}}return this},fire:function(){d.fireWith(this,arguments);return this},fired:function(){return!!i}};return d};var a=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),n=s.Callbacks("once memory"),r=s.Callbacks("memory"),i="pending",o={resolve:t,reject:n,notify:r},u={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){a.done(e).fail(t).progress(n);return this},always:function(){a.done.apply(a,arguments).fail.apply(a,arguments);return this},pipe:function(e,t,n){return s.Deferred(function(r){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],o;if(s.isFunction(n)){a[e](function(){o=n.apply(this,arguments);if(o&&s.isFunction(o.promise)){o.promise().then(r.resolve,r.reject,r.notify)}else{r[i+"With"](this===a?r:this,[o])}})}else{a[e](r[i])}})}).promise()},promise:function(e){if(e==null){e=u}else{for(var t in u){e[t]=u[t]}}return e}},a=u.promise({}),f;for(f in o){a[f]=o[f].fire;a[f+"With"]=o[f].fireWith}a.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock);if(e){e.call(a,a)}return a},when:function(e){function c(e){return function(n){t[e]=arguments.length>1?a.call(arguments,0):n;if(!--o){f.resolveWith(f,t)}}}function h(e){return function(t){i[e]=arguments.length>1?a.call(arguments,0):t;f.notifyWith(l,i)}}var t=a.call(arguments,0),n=0,r=t.length,i=new Array(r),o=r,u=r,f=r<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),l=f.promise();if(r>1){for(;n<r;n++){if(t[n]&&t[n].promise&&s.isFunction(t[n].promise)){t[n].promise().then(c(n),f.reject,h(n))}else{--o}}if(!o){f.resolveWith(f,t)}}else if(f!==e){f.resolveWith(f,r?[e]:[])}return l}});s.support=function(){var t,r,i,o,u,a,f,l,c,h,p,d,v,m=n.createElement("div"),g=n.documentElement;m.setAttribute("className","t");m.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";r=m.getElementsByTagName("*");i=m.getElementsByTagName("a")[0];if(!r||!r.length||!i){return{}}o=n.createElement("select");u=o.appendChild(n.createElement("option"));a=m.getElementsByTagName("input")[0];t={leadingWhitespace:m.firstChild.nodeType===3,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:i.getAttribute("href")==="/a",opacity:/^0.55/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:a.value==="on",optSelected:u.selected,getSetAttribute:m.className!=="t",enctype:!!n.createElement("form").enctype,html5Clone:n.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};a.checked=true;t.noCloneChecked=a.cloneNode(true).checked;o.disabled=true;t.optDisabled=!u.disabled;try{delete m.test}catch(y){t.deleteExpando=false}if(!m.addEventListener&&m.attachEvent&&m.fireEvent){m.attachEvent("onclick",function(){t.noCloneEvent=false});m.cloneNode(true).fireEvent("onclick")}a=n.createElement("input");a.value="t";a.setAttribute("type","radio");t.radioValue=a.value==="t";a.setAttribute("checked","checked");m.appendChild(a);l=n.createDocumentFragment();l.appendChild(m.lastChild);t.checkClone=l.cloneNode(true).cloneNode(true).lastChild.checked;t.appendChecked=a.checked;l.removeChild(a);l.appendChild(m);m.innerHTML="";if(e.getComputedStyle){f=n.createElement("div");f.style.width="0";f.style.marginRight="0";m.style.width="2px";m.appendChild(f);t.reliableMarginRight=(parseInt((e.getComputedStyle(f,null)||{marginRight:0}).marginRight,10)||0)===0}if(m.attachEvent){for(d in{submit:1,change:1,focusin:1}){p="on"+d;v=p in m;if(!v){m.setAttribute(p,"return;");v=typeof m[p]==="function"}t[d+"Bubbles"]=v}}l.removeChild(m);l=o=u=f=m=a=null;s(function(){var e,r,i,o,u,a,f,l,h,p,d,g=n.getElementsByTagName("body")[0];if(!g){return}f=1;l="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;";h="visibility:hidden;border:0;";p="style='"+l+"border:5px solid #000;padding:0;'";d="<div "+p+"><div></div></div>"+"<table "+p+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";e=n.createElement("div");e.style.cssText=h+"width:0;height:0;position:static;top:0;margin-top:"+f+"px";g.insertBefore(e,g.firstChild);m=n.createElement("div");e.appendChild(m);m.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";c=m.getElementsByTagName("td");v=c[0].offsetHeight===0;c[0].style.display="";c[1].style.display="none";t.reliableHiddenOffsets=v&&c[0].offsetHeight===0;m.innerHTML="";m.style.width=m.style.paddingLeft="1px";s.boxModel=t.boxModel=m.offsetWidth===2;if(typeof m.style.zoom!=="undefined"){m.style.display="inline";m.style.zoom=1;t.inlineBlockNeedsLayout=m.offsetWidth===2;m.style.display="";m.innerHTML="<div style='width:4px;'></div>";t.shrinkWrapBlocks=m.offsetWidth!==2}m.style.cssText=l+h;m.innerHTML=d;r=m.firstChild;i=r.firstChild;u=r.nextSibling.firstChild.firstChild;a={doesNotAddBorder:i.offsetTop!==5,doesAddBorderForTableAndCells:u.offsetTop===5};i.style.position="fixed";i.style.top="20px";a.fixedPosition=i.offsetTop===20||i.offsetTop===15;i.style.position=i.style.top="";r.style.overflow="hidden";r.style.position="relative";a.subtractsBorderForOverflowNotVisible=i.offsetTop===-5;a.doesNotIncludeMarginInBodyOffset=g.offsetTop!==f;g.removeChild(e);m=e=null;s.extend(t,a)});return t}();var f=/^(?:\{.*\}|\[.*\])$/,l=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(e){e=e.nodeType?s.cache[e[s.expando]]:e[s.expando];return!!e&&!h(e)},data:function(e,n,r,i){if(!s.acceptData(e)){return}var o,u,a,f=s.expando,l=typeof n==="string",c=e.nodeType,h=c?s.cache:e,p=c?e[f]:e[f]&&f,d=n==="events";if((!p||!h[p]||!d&&!i&&!h[p].data)&&l&&r===t){return}if(!p){if(c){e[f]=p=++s.uuid}else{p=f}}if(!h[p]){h[p]={};if(!c){h[p].toJSON=s.noop}}if(typeof n==="object"||typeof n==="function"){if(i){h[p]=s.extend(h[p],n)}else{h[p].data=s.extend(h[p].data,n)}}o=u=h[p];if(!i){if(!u.data){u.data={}}u=u.data}if(r!==t){u[s.camelCase(n)]=r}if(d&&!u[n]){return o.events}if(l){a=u[n];if(a==null){a=u[s.camelCase(n)]}}else{a=u}return a},removeData:function(e,t,n){if(!s.acceptData(e)){return}var r,i,o,u=s.expando,a=e.nodeType,f=a?s.cache:e,l=a?e[u]:u;if(!f[l]){return}if(t){r=n?f[l]:f[l].data;if(r){if(!s.isArray(t)){if(t in r){t=[t]}else{t=s.camelCase(t);if(t in r){t=[t]}else{t=t.split(" ")}}}for(i=0,o=t.length;i<o;i++){delete r[t[i]]}if(!(n?h:s.isEmptyObject)(r)){return}}}if(!n){delete f[l].data;if(!h(f[l])){return}}if(s.support.deleteExpando||!f.setInterval){delete f[l]}else{f[l]=null}if(a){if(s.support.deleteExpando){delete e[u]}else if(e.removeAttribute){e.removeAttribute(u)}else{e[u]=null}}},_data:function(e,t,n){return s.data(e,t,n,true)},acceptData:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t){return!(t===true||e.getAttribute("classid")!==t)}}return true}});s.fn.extend({data:function(e,n){var r,i,o,u=null;if(typeof e==="undefined"){if(this.length){u=s.data(this[0]);if(this[0].nodeType===1&&!s._data(this[0],"parsedAttrs")){i=this[0].attributes;for(var a=0,f=i.length;a<f;a++){o=i[a].name;if(o.indexOf("data-")===0){o=s.camelCase(o.substring(5));c(this[0],o,u[o])}}s._data(this[0],"parsedAttrs",true)}}return u}else if(typeof e==="object"){return this.each(function(){s.data(this,e)})}r=e.split(".");r[1]=r[1]?"."+r[1]:"";if(n===t){u=this.triggerHandler("getData"+r[1]+"!",[r[0]]);if(u===t&&this.length){u=s.data(this[0],e);u=c(this[0],e,u)}return u===t&&r[1]?this.data(r[0]):u}else{return this.each(function(){var t=s(this),i=[r[0],n];t.triggerHandler("setData"+r[1]+"!",i);s.data(this,e,n);t.triggerHandler("changeData"+r[1]+"!",i)})}},removeData:function(e){return this.each(function(){s.removeData(this,e)})}});s.extend({_mark:function(e,t){if(e){t=(t||"fx")+"mark";s._data(e,t,(s._data(e,t)||0)+1)}},_unmark:function(e,t,n){if(e!==true){n=t;t=e;e=false}if(t){n=n||"fx";var r=n+"mark",i=e?0:(s._data(t,r)||1)-1;if(i){s._data(t,r,i)}else{s.removeData(t,r,true);p(t,n,"mark")}}},queue:function(e,t,n){var r;if(e){t=(t||"fx")+"queue";r=s._data(e,t);if(n){if(!r||s.isArray(n)){r=s._data(e,t,s.makeArray(n))}else{r.push(n)}}return r||[]}},dequeue:function(e,t){t=t||"fx";var n=s.queue(e,t),r=n.shift(),i={};if(r==="inprogress"){r=n.shift()}if(r){if(t==="fx"){n.unshift("inprogress")}s._data(e,t+".run",i);r.call(e,function(){s.dequeue(e,t)},i)}if(!n.length){s.removeData(e,t+"queue "+t+".run",true);p(e,t,"queue")}}});s.fn.extend({queue:function(e,n){if(typeof e!=="string"){n=e;e="fx"}if(n===t){return s.queue(this[0],e)}return this.each(function(){var t=s.queue(this,e,n);if(e==="fx"&&t[0]!=="inprogress"){s.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){e=s.fx?s.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function h(){if(!--u){r.resolveWith(i,[i])}}if(typeof e!=="string"){n=e;e=t}e=e||"fx";var r=s.Deferred(),i=this,o=i.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--){if(c=s.data(i[o],a,t,true)||(s.data(i[o],f,t,true)||s.data(i[o],l,t,true))&&s.data(i[o],a,s.Callbacks("once memory"),true)){u++;c.add(h)}}h();return r.promise()}});var d=/[\n\t\r]/g,v=/\s+/,m=/\r/g,g=/^(?:button|input)$/i,y=/^(?:button|input|object|select|textarea)$/i,b=/^a(?:rea)?$/i,w=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,E=s.support.getSetAttribute,S,x,T;s.fn.extend({attr:function(e,t){return s.access(this,e,t,true,s.attr)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,e,t,true,s.prop)},removeProp:function(e){e=s.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,u,a;if(s.isFunction(e)){return this.each(function(t){s(this).addClass(e.call(this,t,this.className))})}if(e&&typeof e==="string"){t=e.split(v);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1){if(!i.className&&t.length===1){i.className=e}else{o=" "+i.className+" ";for(u=0,a=t.length;u<a;u++){if(!~o.indexOf(" "+t[u]+" ")){o+=t[u]+" "}}i.className=s.trim(o)}}}}return this},removeClass:function(e){var n,r,i,o,u,a,f;if(s.isFunction(e)){return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))})}if(e&&typeof e==="string"||e===t){n=(e||"").split(v);for(r=0,i=this.length;r<i;r++){o=this[r];if(o.nodeType===1&&o.className){if(e){u=(" "+o.className+" ").replace(d," ");for(a=0,f=n.length;a<f;a++){u=u.replace(" "+n[a]+" "," ")}o.className=s.trim(u)}else{o.className=""}}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t==="boolean";if(s.isFunction(e)){return this.each(function(n){s(this).toggleClass(e.call(this,n,this.className,t),t)})}return this.each(function(){if(n==="string"){var i,o=0,u=s(this),a=t,f=e.split(v);while(i=f[o++]){a=r?a:!u.hasClass(i);u[a?"addClass":"removeClass"](i)}}else if(n==="undefined"||n==="boolean"){if(this.className){s._data(this,"__className__",this.className)}this.className=this.className||e===false?"":s._data(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++){if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(d," ").indexOf(t)>-1){return true}}return false},val:function(e){var n,r,i,o=this[0];if(!arguments.length){if(o){n=s.valHooks[o.nodeName.toLowerCase()]||s.valHooks[o.type];if(n&&"get"in n&&(r=n.get(o,"value"))!==t){return r}r=o.value;return typeof r==="string"?r.replace(m,""):r==null?"":r}return}i=s.isFunction(e);return this.each(function(r){var o=s(this),u;if(this.nodeType!==1){return}if(i){u=e.call(this,r,o.val())}else{u=e}if(u==null){u=""}else if(typeof u==="number"){u+=""}else if(s.isArray(u)){u=s.map(u,function(e){return e==null?"":e+""})}n=s.valHooks[this.nodeName.toLowerCase()]||s.valHooks[this.type];if(!n||!("set"in n)||n.set(this,u,"value")===t){this.value=u}})}});s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,u=[],a=e.options,f=e.type==="select-one";if(o<0){return null}n=f?o:0;r=f?o+1:a.length;for(;n<r;n++){i=a[n];if(i.selected&&(s.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!s.nodeName(i.parentNode,"optgroup"))){t=s(i).val();if(f){return t}u.push(t)}}if(f&&!u.length&&a.length){return s(a[o]).val()}return u},set:function(e,t){var n=s.makeArray(t);s(e).find("option").each(function(){this.selected=s.inArray(s(this).val(),n)>=0});if(!n.length){e.selectedIndex=-1}return n}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(e,n,r,i){var o,u,a,f=e.nodeType;if(!e||f===3||f===8||f===2){return}if(i&&n in s.attrFn){return s(e)[n](r)}if(typeof e.getAttribute==="undefined"){return s.prop(e,n,r)}a=f!==1||!s.isXMLDoc(e);if(a){n=n.toLowerCase();u=s.attrHooks[n]||(w.test(n)?x:S)}if(r!==t){if(r===null){s.removeAttr(e,n);return}else if(u&&"set"in u&&a&&(o=u.set(e,r,n))!==t){return o}else{e.setAttribute(n,""+r);return r}}else if(u&&"get"in u&&a&&(o=u.get(e,n))!==null){return o}else{o=e.getAttribute(n);return o===null?t:o}},removeAttr:function(e,t){var n,r,i,o,u=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(v);o=r.length;for(;u<o;u++){i=r[u];if(i){n=s.propFix[i]||i;s.attr(e,i,"");e.removeAttribute(E?i:n);if(w.test(i)&&n in e){e[n]=false}}}}},attrHooks:{type:{set:function(e,t){if(g.test(e.nodeName)&&e.parentNode){s.error("type property can't be changed")}else if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var n=e.value;e.setAttribute("type",t);if(n){e.value=n}return t}}},value:{get:function(e,t){if(S&&s.nodeName(e,"button")){return S.get(e,t)}return t in e?e.value:null},set:function(e,t,n){if(S&&s.nodeName(e,"button")){return S.set(e,t,n)}e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2){return}u=a!==1||!s.isXMLDoc(e);if(u){n=s.propFix[n]||n;o=s.propHooks[n]}if(r!==t){if(o&&"set"in o&&(i=o.set(e,r,n))!==t){return i}else{return e[n]=r}}else{if(o&&"get"in o&&(i=o.get(e,n))!==null){return i}else{return e[n]}}},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):y.test(e.nodeName)||b.test(e.nodeName)&&e.href?0:t}}}});s.attrHooks.tabindex=s.propHooks.tabIndex;x={get:function(e,n){var r,i=s.prop(e,n);return i===true||typeof i!=="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==false?n.toLowerCase():t},set:function(e,t,n){var r;if(t===false){s.removeAttr(e,n)}else{r=s.propFix[n]||n;if(r in e){e[r]=true}e.setAttribute(n,n.toLowerCase())}return n}};if(!E){T={name:true,id:true};S=s.valHooks.button={get:function(e,n){var r;r=e.getAttributeNode(n);return r&&(T[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,r){var i=e.getAttributeNode(r);if(!i){i=n.createAttribute(r);e.setAttributeNode(i)}return i.nodeValue=t+""}};s.attrHooks.tabindex.set=S.set;s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,n){if(n===""){e.setAttribute(t,"auto");return n}}})});s.attrHooks.contenteditable={get:S.get,set:function(e,t,n){if(t===""){t="false"}S.set(e,t,n)}}}if(!s.support.hrefNormalized){s.each(["href","src","width","height"],function(e,n){s.attrHooks[n]=s.extend(s.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})})}if(!s.support.style){s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}}if(!s.support.optSelected){s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(e){var t=e.parentNode;if(t){t.selectedIndex;if(t.parentNode){t.parentNode.selectedIndex}}return null}})}if(!s.support.enctype){s.propFix.enctype="encoding"}if(!s.support.checkOn){s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}})}s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t)){return e.checked=s.inArray(s(e).val(),t)>=0}}})});var N=/^(?:textarea|input|select)$/i,C=/^([^\.]*)?(?:\.(.+))?$/,k=/\bhover(\.\S+)?\b/,L=/^key/,A=/^(?:mouse|contextmenu)|click/,O=/^(?:focusinfocus|focusoutblur)$/,M=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,_=function(e){var t=M.exec(e);if(t){t[1]=(t[1]||"").toLowerCase();t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")}return t},D=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},P=function(e){return s.event.special.hover?e:e.replace(k,"mouseenter$1 mouseleave$1")};s.event={add:function(e,n,r,i,o){var u,a,f,l,c,h,p,d,v,m,g,y;if(e.nodeType===3||e.nodeType===8||!n||!r||!(u=s._data(e))){return}if(r.handler){v=r;r=v.handler}if(!r.guid){r.guid=s.guid++}f=u.events;if(!f){u.events=f={}}a=u.handle;if(!a){u.handle=a=function(e){return typeof s!=="undefined"&&(!e||s.event.triggered!==e.type)?s.event.dispatch.apply(a.elem,arguments):t};a.elem=e}n=s.trim(P(n)).split(" ");for(l=0;l<n.length;l++){c=C.exec(n[l])||[];h=c[1];p=(c[2]||"").split(".").sort();y=s.event.special[h]||{};h=(o?y.delegateType:y.bindType)||h;y=s.event.special[h]||{};d=s.extend({type:h,origType:c[1],data:i,handler:r,guid:r.guid,selector:o,quick:_(o),namespace:p.join(".")},v);g=f[h];if(!g){g=f[h]=[];g.delegateCount=0;if(!y.setup||y.setup.call(e,i,p,a)===false){if(e.addEventListener){e.addEventListener(h,a,false)}else if(e.attachEvent){e.attachEvent("on"+h,a)}}}if(y.add){y.add.call(e,d);if(!d.handler.guid){d.handler.guid=r.guid}}if(o){g.splice(g.delegateCount++,0,d)}else{g.push(d)}s.event.global[h]=true}e=null},global:{},remove:function(e,t,n,r,i){var o=s.hasData(e)&&s._data(e),u,a,f,l,c,h,p,d,v,m,g,y;if(!o||!(d=o.events)){return}t=s.trim(P(t||"")).split(" ");for(u=0;u<t.length;u++){a=C.exec(t[u])||[];f=l=a[1];c=a[2];if(!f){for(f in d){s.event.remove(e,f+t[u],n,r,true)}continue}v=s.event.special[f]||{};f=(r?v.delegateType:v.bindType)||f;g=d[f]||[];h=g.length;c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<g.length;p++){y=g[p];if((i||l===y.origType)&&(!n||n.guid===y.guid)&&(!c||c.test(y.namespace))&&(!r||r===y.selector||r==="**"&&y.selector)){g.splice(p--,1);if(y.selector){g.delegateCount--}if(v.remove){v.remove.call(e,y)}}}if(g.length===0&&h!==g.length){if(!v.teardown||v.teardown.call(e,c)===false){s.removeEvent(e,f,o.handle)}delete d[f]}}if(s.isEmptyObject(d)){m=o.handle;if(m){m.elem=null}s.removeData(e,["events","handle"],true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(n,r,i,o){if(i&&(i.nodeType===3||i.nodeType===8)){return}var u=n.type||n,a=[],f,l,c,h,p,d,v,m,g,y;if(O.test(u+s.event.triggered)){return}if(u.indexOf("!")>=0){u=u.slice(0,-1);l=true}if(u.indexOf(".")>=0){a=u.split(".");u=a.shift();a.sort()}if((!i||s.event.customEvent[u])&&!s.event.global[u]){return}n=typeof n==="object"?n[s.expando]?n:new s.Event(u,n):new s.Event(u);n.type=u;n.isTrigger=true;n.exclusive=l;n.namespace=a.join(".");n.namespace_re=n.namespace?new RegExp("(^|\\.)"+a.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;d=u.indexOf(":")<0?"on"+u:"";if(!i){f=s.cache;for(c in f){if(f[c].events&&f[c].events[u]){s.event.trigger(n,r,f[c].handle.elem,true)}}return}n.result=t;if(!n.target){n.target=i}r=r!=null?s.makeArray(r):[];r.unshift(n);v=s.event.special[u]||{};if(v.trigger&&v.trigger.apply(i,r)===false){return}g=[[i,v.bindType||u]];if(!o&&!v.noBubble&&!s.isWindow(i)){y=v.delegateType||u;h=O.test(y+u)?i:i.parentNode;p=null;for(;h;h=h.parentNode){g.push([h,y]);p=h}if(p&&p===i.ownerDocument){g.push([p.defaultView||p.parentWindow||e,y])}}for(c=0;c<g.length&&!n.isPropagationStopped();c++){h=g[c][0];n.type=g[c][1];m=(s._data(h,"events")||{})[n.type]&&s._data(h,"handle");if(m){m.apply(h,r)}m=d&&h[d];if(m&&s.acceptData(h)&&m.apply(h,r)===false){n.preventDefault()}}n.type=u;if(!o&&!n.isDefaultPrevented()){if((!v._default||v._default.apply(i.ownerDocument,r)===false)&&!(u==="click"&&s.nodeName(i,"a"))&&s.acceptData(i)){if(d&&i[u]&&(u!=="focus"&&u!=="blur"||n.target.offsetWidth!==0)&&!s.isWindow(i)){p=i[d];if(p){i[d]=null}s.event.triggered=u;i[u]();s.event.triggered=t;if(p){i[d]=p}}}}return n.result},dispatch:function(n){n=s.event.fix(n||e.event);var r=(s._data(this,"events")||{})[n.type]||[],i=r.delegateCount,o=[].slice.call(arguments,0),u=!n.exclusive&&!n.namespace,a=[],f,l,c,h,p,d,v,m,g,y,b;o[0]=n;n.delegateTarget=this;if(i&&!n.target.disabled&&!(n.button&&n.type==="click")){h=s(this);h.context=this.ownerDocument||this;for(c=n.target;c!=this;c=c.parentNode||this){d={};m=[];h[0]=c;for(f=0;f<i;f++){g=r[f];y=g.selector;if(d[y]===t){d[y]=g.quick?D(c,g.quick):h.is(y)}if(d[y]){m.push(g)}}if(m.length){a.push({elem:c,matches:m})}}}if(r.length>i){a.push({elem:this,matches:r.slice(i)})}for(f=0;f<a.length&&!n.isPropagationStopped();f++){v=a[f];n.currentTarget=v.elem;for(l=0;l<v.matches.length&&!n.isImmediatePropagationStopped();l++){g=v.matches[l];if(u||!n.namespace&&!g.namespace||n.namespace_re&&n.namespace_re.test(g.namespace)){n.data=g.data;n.handleObj=g;p=((s.event.special[g.origType]||{}).handle||g.handler).apply(v.elem,o);if(p!==t){n.result=p;if(p===false){n.preventDefault();n.stopPropagation()}}}}}return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){if(e.which==null){e.which=t.charCode!=null?t.charCode:t.keyCode}return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var i,s,o,u=r.button,a=r.fromElement;if(e.pageX==null&&r.clientX!=null){i=e.target.ownerDocument||n;s=i.documentElement;o=i.body;e.pageX=r.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0);e.pageY=r.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)}if(!e.relatedTarget&&a){e.relatedTarget=a===e.target?r.toElement:a}if(!e.which&&u!==t){e.which=u&1?1:u&2?3:u&4?2:0}return e}},fix:function(e){if(e[s.expando]){return e}var r,i,o=e,u=s.event.fixHooks[e.type]||{},a=u.props?this.props.concat(u.props):this.props;e=s.Event(o);for(r=a.length;r;){i=a[--r];e[i]=o[i]}if(!e.target){e.target=o.srcElement||n}if(e.target.nodeType===3){e.target=e.target.parentNode}if(e.metaKey===t){e.metaKey=e.ctrlKey}return u.filter?u.filter(e,o):e},special:{ready:{setup:s.bindReady},load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){if(s.isWindow(this)){this.onbeforeunload=n}},teardown:function(e,t){if(this.onbeforeunload===t){this.onbeforeunload=null}}}},simulate:function(e,t,n,r){var i=s.extend(new s.Event,n,{type:e,isSimulated:true,originalEvent:{}});if(r){s.event.trigger(i,null,t)}else{s.event.dispatch.call(t,i)}if(i.isDefaultPrevented()){n.preventDefault()}}};s.event.handle=s.event.dispatch;s.removeEvent=n.removeEventListener?function(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}}:function(e,t,n){if(e.detachEvent){e.detachEvent("on"+t,n)}};s.Event=function(e,t){if(!(this instanceof s.Event)){return new s.Event(e,t)}if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||e.returnValue===false||e.getPreventDefault&&e.getPreventDefault()?B:H}else{this.type=e}if(t){s.extend(this,t)}this.timeStamp=e&&e.timeStamp||s.now();this[s.expando]=true};s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B;this.stopPropagation()},isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H};s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){s.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,o=i.selector,u;if(!r||r!==n&&!s.contains(n,r)){e.type=i.origType;u=i.handler.apply(this,arguments);e.type=t}return u}}});if(!s.support.submitBubbles){s.event.special.submit={setup:function(){if(s.nodeName(this,"form")){return false}s.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=s.nodeName(n,"input")||s.nodeName(n,"button")?n.form:t;if(r&&!r._submit_attached){s.event.add(r,"submit._submit",function(e){if(this.parentNode&&!e.isTrigger){s.event.simulate("submit",this.parentNode,e,true)}});r._submit_attached=true}})},teardown:function(){if(s.nodeName(this,"form")){return false}s.event.remove(this,"._submit")}}}if(!s.support.changeBubbles){s.event.special.change={setup:function(){if(N.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){s.event.add(this,"propertychange._change",function(e){if(e.originalEvent.propertyName==="checked"){this._just_changed=true}});s.event.add(this,"click._change",function(e){if(this._just_changed&&!e.isTrigger){this._just_changed=false;s.event.simulate("change",this,e,true)}})}return false}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(N.test(t.nodeName)&&!t._change_attached){s.event.add(t,"change._change",function(e){if(this.parentNode&&!e.isSimulated&&!e.isTrigger){s.event.simulate("change",this.parentNode,e,true)}});t._change_attached=true}})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox"){return e.handleObj.handler.apply(this,arguments)}},teardown:function(){s.event.remove(this,"._change");return N.test(this.nodeName)}}}if(!s.support.focusinBubbles){s.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,i=function(e){s.event.simulate(t,e.target,s.event.fix(e),true)};s.event.special[t]={setup:function(){if(r++===0){n.addEventListener(e,i,true)}},teardown:function(){if(--r===0){n.removeEventListener(e,i,true)}}}})}s.fn.extend({on:function(e,n,r,i,o){var u,a;if(typeof e==="object"){if(typeof n!=="string"){r=n;n=t}for(a in e){this.on(a,n,r,e[a],o)}return this}if(r==null&&i==null){i=n;r=n=t}else if(i==null){if(typeof n==="string"){i=r;r=t}else{i=r;r=n;n=t}}if(i===false){i=H}else if(!i){return this}if(o===1){u=i;i=function(e){s().off(e);return u.apply(this,arguments)};i.guid=u.guid||(u.guid=s.guid++)}return this.each(function(){s.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on.call(this,e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;s(e.delegateTarget).off(i.namespace?i.type+"."+i.namespace:i.type,i.selector,i.handler);return this}if(typeof e==="object"){for(var o in e){this.off(o,n,e[o])}return this}if(n===false||typeof n==="function"){r=n;n=t}if(r===false){r=H}return this.each(function(){s.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){s(this.context).on(e,this.selector,t,n);return this},die:function(e,t){s(this.context).off(e,this.selector||"**",t);return this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){return s.event.trigger(e,t,this[0],true)}},toggle:function(e){var t=arguments,n=e.guid||s.guid++,r=0,i=function(n){var i=(s._data(this,"lastToggle"+e.guid)||0)%r;s._data(this,"lastToggle"+e.guid,i+1);n.preventDefault();return t[i].apply(this,arguments)||false};i.guid=n;while(r<t.length){t[r++].guid=n}return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});s.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(e,t){s.fn[t]=function(e,n){if(n==null){n=e;e=null}return arguments.length>0?this.on(t,null,e,n):this.trigger(t)};if(s.attrFn){s.attrFn[t]=true}if(L.test(t)){s.event.fixHooks[t]=s.event.keyHooks}if(A.test(t)){s.event.fixHooks[t]=s.event.mouseHooks}});(function(){function S(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=false;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1&&!o){f[r]=n;f.sizset=u}if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}i[u]=l}}}function x(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=false;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1){if(!o){f[r]=n;f.sizset=u}if(typeof t!=="string"){if(f===t){l=true;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}i[u]=l}}}var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,u=false,a=true,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){a=false;return 0});var h=function(t,r,i,s){i=i||[];r=r||n;var u=r;if(r.nodeType!==1&&r.nodeType!==9){return[]}if(!t||typeof t!=="string"){return i}var a,f,l,c,p,m,g,b,w=true,E=h.isXML(r),S=[],x=t;do{e.exec("");a=e.exec(x);if(a){x=a[3];S.push(a[1]);if(a[2]){c=a[3];break}}}while(a);if(S.length>1&&v.exec(t)){if(S.length===2&&d.relative[S[0]]){f=T(S[0]+S[1],r,s)}else{f=d.relative[S[0]]?[r]:h(S.shift(),r);while(S.length){t=S.shift();if(d.relative[t]){t+=S.shift()}f=T(t,f,s)}}}else{if(!s&&S.length>1&&r.nodeType===9&&!E&&d.match.ID.test(S[0])&&!d.match.ID.test(S[S.length-1])){p=h.find(S.shift(),r,E);r=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]}if(r){p=s?{expr:S.pop(),set:y(s)}:h.find(S.pop(),S.length===1&&(S[0]==="~"||S[0]==="+")&&r.parentNode?r.parentNode:r,E);f=p.expr?h.filter(p.expr,p.set):p.set;if(S.length>0){l=y(f)}else{w=false}while(S.length){m=S.pop();g=m;if(!d.relative[m]){m=""}else{g=S.pop()}if(g==null){g=r}d.relative[m](l,g,E)}}else{l=S=[]}}if(!l){l=f}if(!l){h.error(m||t)}if(o.call(l)==="[object Array]"){if(!w){i.push.apply(i,l)}else if(r&&r.nodeType===1){for(b=0;l[b]!=null;b++){if(l[b]&&(l[b]===true||l[b].nodeType===1&&h.contains(r,l[b]))){i.push(f[b])}}}else{for(b=0;l[b]!=null;b++){if(l[b]&&l[b].nodeType===1){i.push(f[b])}}}}else{y(l,i)}if(c){h(c,u,i,s);h.uniqueSort(i)}return i};h.uniqueSort=function(e){if(w){u=a;e.sort(w);if(u){for(var t=1;t<e.length;t++){if(e[t]===e[t-1]){e.splice(t--,1)}}}}return e};h.matches=function(e,t){return h(e,null,null,t)};h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0};h.find=function(e,t,n){var r,i,s,o,u,a;if(!e){return[]}for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1];o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,"");r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}if(!r){r=typeof t.getElementsByTagName!=="undefined"?t.getElementsByTagName("*"):[]}return{set:r,expr:e}};h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter){if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u];c=s[1];o=false;s.splice(1,1);if(c.substr(c.length-1)==="\\"){continue}if(y===g){g=[]}if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s){o=a=true}else if(s===true){continue}}if(s){for(p=0;(f=y[p])!=null;p++){if(f){a=l(f,s,p,y);v=i^a;if(r&&a!=null){if(v){o=true}else{y[p]=false}}else if(v){g.push(f);o=true}}}}if(a!==t){if(!r){y=g}e=e.replace(d.match[u],"");if(!o){return[]}break}}}if(e===m){if(o==null){h.error(e)}else{break}}m=e}return y};h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9){if(typeof e.textContent==="string"){return e.textContent}else if(typeof e.innerText==="string"){return e.innerText.replace(l,"")}else{for(e=e.firstChild;e;e=e.nextSibling){i+=p(e)}}}else if(r===3||r===4){return e.nodeValue}}else{for(t=0;n=e[t];t++){if(n.nodeType!==8){i+=p(n)}}}return i};var d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t==="string",r=n&&!c.test(t),i=n&&!r;if(r){t=t.toLowerCase()}for(var s=0,o=e.length,u;s<o;s++){if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1){}e[s]=i||u&&u.nodeName.toLowerCase()===t?u||false:u===t}}if(i){h.filter(t,e,true)}},">":function(e,t){var n,r=typeof t==="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:false}}}else{for(;i<s;i++){n=e[i];if(n){e[i]=r?n.parentNode:n.parentNode===t}}if(r){h.filter(t,e,true)}}},"":function(e,t,n){var r,s=i++,o=x;if(typeof t==="string"&&!c.test(t)){t=t.toLowerCase();r=t;o=S}o("parentNode",t,s,e,r,n)},"~":function(e,t,n){var r,s=i++,o=x;if(typeof t==="string"&&!c.test(t)){t=t.toLowerCase();r=t;o=S}o("previousSibling",t,s,e,r,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!=="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!=="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++){if(r[i].getAttribute("name")===e[1]){n.push(r[i])}}return n.length===0?null:n}},TAG:function(e,t){var n=t.Methods;var r=t.getElementsByTagName;if(typeof t.getElementsByTagName=="function"){return t.getElementsByTagName(e[1])}}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s){return e}for(var o=0,u;(u=t[o])!=null;o++){if(u){if(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)){if(!n){r.push(u)}}else if(n){t[o]=false}}}return false},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){if(!e[2]){h.error(e[0])}e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0;e[3]=t[3]-0}else if(e[2]){h.error(e[0])}e[0]=i++;return e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");if(!s&&d.attrMap[o]){e[1]=d.attrMap[o]}e[4]=(e[4]||e[5]||"").replace(f,"");if(e[2]==="~="){e[4]=" "+e[4]+" "}return e},PSEUDO:function(t,n,r,i,s){if(t[1]==="not"){if((e.exec(t[3])||"").length>1||/^\w/.test(t[3])){t[3]=h(t[3],null,null,n)}else{var o=h.filter(t[3],n,r,true^s);if(!r){i.push.apply(i,o)}return false}}else if(d.match.POS.test(t[0])||d.match.CHILD.test(t[0])){return true}return t},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s){return s(e,n,t,r)}else if(i==="contains"){return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0}else if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++){if(o[u]===e){return false}}return true}else{h.error(i)}},CHILD:function(e,t){var n,i,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling){if(c.nodeType===1){return false}}if(l==="first"){return true}c=e;case"last":while(c=c.nextSibling){if(c.nodeType===1){return false}}return true;case"nth":n=t[2];i=t[3];if(n===1&&i===0){return true}s=t[0];o=e.parentNode;if(o&&(o[r]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling){if(c.nodeType===1){c.nodeIndex=++a}}o[r]=s}f=e.nodeIndex-i;if(n===0){return f===0}else{return f%n===0&&f/n>=0}}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:!o?i&&r!==false:s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":false},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s){return s(e,n,t,r)}}}};var v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match){d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source);d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m))}var y=function(e,t){e=Array.prototype.slice.call(e,0);if(t){t.push.apply(t,e);return t}return e};try{Array.prototype.slice.call(n.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]"){Array.prototype.push.apply(r,e)}else{if(typeof e.length==="number"){for(var i=e.length;n<i;n++){r.push(e[n])}}else{for(;e[n];n++){r.push(e[n])}}}return r}}var w,E;if(n.documentElement.compareDocumentPosition){w=function(e,t){if(e===t){u=true;return 0}if(!e.compareDocumentPosition||!t.compareDocumentPosition){return e.compareDocumentPosition?-1:1}return e.compareDocumentPosition(t)&4?-1:1}}else{w=function(e,t){if(e===t){u=true;return 0}else if(e.sourceIndex&&t.sourceIndex){return e.sourceIndex-t.sourceIndex}var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a){return E(e,t)}else if(!o){return-1}else if(!a){return 1}while(f){i.unshift(f);f=f.parentNode}f=a;while(f){s.unshift(f);f=f.parentNode}n=i.length;r=s.length;for(var l=0;l<n&&l<r;l++){if(i[l]!==s[l]){return E(i[l],s[l])}}return l===n?E(e,s[l],-1):E(i[l],t,1)};E=function(e,t,n){if(e===t){return n}var r=e.nextSibling;while(r){if(r===t){return-1}r=r.nextSibling}return 1}}(function(){var e=n.createElement("div"),r="script"+(new Date).getTime(),i=n.documentElement;e.innerHTML="<a name='"+r+"'/>";i.insertBefore(e,i.firstChild);if(n.getElementById(r)){d.find.ID=function(e,n,r){if(typeof n.getElementById!=="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!=="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}};d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!=="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}}i.removeChild(e);i=e=null})();(function(){var e=n.createElement("div");e.appendChild(n.createComment(""));if(e.getElementsByTagName("*").length>0){d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++){if(n[i].nodeType===1){r.push(n[i])}}n=r}return n}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){d.attrHandle.href=function(e){return e.getAttribute("href",2)}}e=null})();if(n.querySelectorAll){(function(){var e=h,t=n.createElement("div"),r="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}h=function(t,i,s,o){i=i||n;if(!o&&!h.isXML(i)){var u=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(u&&(i.nodeType===1||i.nodeType===9)){if(u[1]){return y(i.getElementsByTagName(t),s)}else if(u[2]&&d.find.CLASS&&i.getElementsByClassName){return y(i.getElementsByClassName(u[2]),s)}}if(i.nodeType===9){if(t==="body"&&i.body){return y([i.body],s)}else if(u&&u[3]){var a=i.getElementById(u[3]);if(a&&a.parentNode){if(a.id===u[3]){return y([a],s)}}else{return y([],s)}}try{return y(i.querySelectorAll(t),s)}catch(f){}}else if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var l=i,c=i.getAttribute("id"),p=c||r,v=i.parentNode,m=/^\s*[+~]/.test(t);if(!c){i.setAttribute("id",p)}else{p=p.replace(/'/g,"\\$&")}if(m&&v){i=i.parentNode}try{if(!m||v){return y(i.querySelectorAll("[id='"+p+"'] "+t),s)}}catch(g){}finally{if(!c){l.removeAttribute("id")}}}}return e(t,i,s,o)};for(var i in e){h[i]=e[i]}t=null})()}(function(){var e=n.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(n.createElement("div"),"div"),i=false;try{t.call(n.documentElement,"[test!='']:sizzle")}catch(s){i=true}h.matchesSelector=function(e,n){n=n.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e)){try{if(i||!d.match.PSEUDO.test(n)&&!/!=/.test(n)){var s=t.call(e,n);if(s||!r||e.document&&e.document.nodeType!==11){return s}}}catch(o){}}return h(n,null,null,[e]).length>0}}})();(function(){var e=n.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}d.order.splice(1,0,"CLASS");d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!=="undefined"&&!n){return t.getElementsByClassName(e[1])}};e=null})();if(n.documentElement.contains){h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):true)}}else if(n.documentElement.compareDocumentPosition){h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}}else{h.contains=function(){return false}}h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":false};var T=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e)){s+=r[0];e=e.replace(d.match.PSEUDO,"")}e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++){h(e,o[u],i,n)}return h.filter(s,i)};h.attr=s.attr;h.selectors.attrMap={};s.find=h;s.expr=h.selectors;s.expr[":"]=s.expr.filters;s.unique=h.uniqueSort;s.text=h.getText;s.isXMLDoc=h.isXML;s.contains=h.contains})();var j=/Until$/,F=/^(?:parents|prevUntil|prevAll)/,I=/,/,q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,U=s.expr.match.POS,z={children:true,contents:true,next:true,prev:true};s.fn.extend({find:function(e){var t=this,n,r;if(typeof e!=="string"){return s(e).filter(function(){for(n=0,r=t.length;n<r;n++){if(s.contains(t[n],this)){return true}}})}var i=this.pushStack("","find",e),o,u,a;for(n=0,r=this.length;n<r;n++){o=i.length;s.find(e,this[n],i);if(n>0){for(u=o;u<i.length;u++){for(a=0;a<o;a++){if(i[a]===i[u]){i.splice(u--,1);break}}}}}return i},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++){if(s.contains(this,t[e])){return true}}})},not:function(e){return this.pushStack(X(this,e,false),"not",e)},filter:function(e){return this.pushStack(X(this,e,true),"filter",e)},is:function(e){return!!e&&(typeof e==="string"?U.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,o=this[0];if(s.isArray(e)){var u=1;while(o&&o.ownerDocument&&o!==t){for(r=0;r<e.length;r++){if(s(o).is(e[r])){n.push({selector:e[r],elem:o,level:u})}}o=o.parentNode;u++}return n}var a=U.test(e)||typeof e!=="string"?s(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){o=this[r];while(o){if(a?a.index(o)>-1:s.find.matchesSelector(o,e)){n.push(o);break}else{o=o.parentNode;if(!o||!o.ownerDocument||o===t||o.nodeType===11){break}}}}n=n.length>1?s.unique(n):n;return this.pushStack(n,"closest",e)},index:function(e){if(!e){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof e==="string"){return s.inArray(this[0],s(e))}return s.inArray(e.jquery?e[0]:e,this)},add:function(e,t){var n=typeof e==="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),r=s.merge(this.get(),n);return this.pushStack(W(n[0])||W(r[0])?r:s.unique(r))},andSelf:function(){return this.add(this.prevObject)}});s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,n){return s.dir(e,"parentNode",n)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,n){return s.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return s.dir(e,"previousSibling",n)},siblings:function(e){return s.sibling(e.parentNode.firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(n,r){var i=s.map(this,t,n);if(!j.test(e)){r=n}if(r&&typeof r==="string"){i=s.filter(r,i)}i=this.length>1&&!z[e]?s.unique(i):i;if((this.length>1||I.test(r))&&F.test(e)){i=i.reverse()}return this.pushStack(i,e,R.call(arguments).join(","))}});s.extend({filter:function(e,t,n){if(n){e=":not("+e+")"}return t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&o.nodeType!==9&&(r===t||o.nodeType!==1||!s(o).is(r))){if(o.nodeType===1){i.push(o)}o=o[n]}return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n]){if(e.nodeType===1&&++i===t){break}}return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){if(e.nodeType===1&&e!==t){n.push(e)}}return n}});var $="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",J=/ jQuery\d+="(?:\d+|null)"/g,K=/^\s+/,Q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,Y=/<tbody/i,Z=/<|&#?\w+;/,et=/<(?:script|style)/i,tt=/<(?:script|object|embed|option|style)/i,nt=new RegExp("<(?:"+$+")","i"),rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/\/(java|ecma)script/i,st=/^\s*<!(?:\[CDATA\[|\-\-)/,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ut=V(n);ot.optgroup=ot.option;ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead;ot.th=ot.td;if(!s.support.htmlSerialize){ot._default=[1,"div<div>","</div>"]}s.fn.extend({text:function(e){if(s.isFunction(e)){return this.each(function(t){var n=s(this);n.text(e.call(this,t,n.text()))})}if(typeof e!=="object"&&e!==t){return this.empty().append((this[0]&&this[0].ownerDocument||n).createTextNode(e))}return s.text(this)},wrapAll:function(e){if(s.isFunction(e)){return this.each(function(t){s(this).wrapAll(e.call(this,t))})}if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){if(s.isFunction(e)){return this.each(function(t){s(this).wrapInner(e.call(this,t))})}return this.each(function(){var t=s(this),n=t.contents();if(n.length){n.wrapAll(e)}else{t.append(e)}})},wrap:function(e){var t=s.isFunction(e);return this.each(function(n){s(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){if(!s.nodeName(this,"body")){s(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.insertBefore(e,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this)})}else if(arguments.length){var e=s.clean(arguments);e.push.apply(e,this.toArray());return this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this.nextSibling)})}else if(arguments.length){var e=this.pushStack(this,"after",arguments);e.push.apply(e,s.clean(arguments));return e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++){if(!e||s.filter(e,[r]).length){if(!t&&r.nodeType===1){s.cleanData(r.getElementsByTagName("*"));s.cleanData([r])}if(r.parentNode){r.parentNode.removeChild(r)}}}return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){if(t.nodeType===1){s.cleanData(t.getElementsByTagName("*"))}while(t.firstChild){t.removeChild(t.firstChild)}}return this},clone:function(e,t){e=e==null?false:e;t=t==null?e:t;return this.map(function(){return s.clone(this,e,t)})},html:function(e){if(e===t){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(J,""):null}else if(typeof e==="string"&&!et.test(e)&&(s.support.leadingWhitespace||!K.test(e))&&!ot[(G.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Q,"<$1></$2>");try{for(var n=0,r=this.length;n<r;n++){if(this[n].nodeType===1){s.cleanData(this[n].getElementsByTagName("*"));this[n].innerHTML=e}}}catch(i){this.empty().append(e)}}else if(s.isFunction(e)){this.each(function(t){var n=s(this);n.html(e.call(this,t,n.html()))})}else{this.empty().append(e)}return this},replaceWith:function(e){if(this[0]&&this[0].parentNode){if(s.isFunction(e)){return this.each(function(t){var n=s(this),r=n.html();n.replaceWith(e.call(this,t,r))})}if(typeof e!=="string"){e=s(e).detach()}return this.each(function(){var t=this.nextSibling,n=this.parentNode;s(this).remove();if(t){s(t).before(e)}else{s(n).append(e)}})}else{return this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this}},detach:function(e){return this.remove(e,true)},domManip:function(e,n,r){var i,o,u,a,f=e[0],l=[];if(!s.support.checkClone&&arguments.length===3&&typeof f==="string"&&rt.test(f)){return this.each(function(){s(this).domManip(e,n,r,true)})}if(s.isFunction(f)){return this.each(function(i){var o=s(this);e[0]=f.call(this,i,n?o.html():t);o.domManip(e,n,r)})}if(this[0]){a=f&&f.parentNode;if(s.support.parentNode&&a&&a.nodeType===11&&a.childNodes.length===this.length){i={fragment:a}}else{i=s.buildFragment(e,this,l)}u=i.fragment;if(u.childNodes.length===1){o=u=u.firstChild}else{o=u.firstChild}if(o){n=n&&s.nodeName(o,"tr");for(var c=0,h=this.length,p=h-1;c<h;c++){r.call(n?at(this[c],o):this[c],i.cacheable||h>1&&c<p?s.clone(u,true,true):u)}}if(l.length){s.each(l,vt)}}return this}});s.buildFragment=function(e,t,r){var i,o,u,a,f=e[0];if(t&&t[0]){a=t[0].ownerDocument||t[0]}if(!a.createDocumentFragment){a=n}if(e.length===1&&typeof f==="string"&&f.length<512&&a===n&&f.charAt(0)==="<"&&!tt.test(f)&&(s.support.checkClone||!rt.test(f))&&(s.support.html5Clone||!nt.test(f))){o=true;u=s.fragments[f];if(u&&u!==1){i=u}}if(!i){i=a.createDocumentFragment();s.clean(e,a,i,r)}if(o){s.fragments[f]=u?i:1}return{fragment:i,cacheable:o}};s.fragments={};s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(n){var r=[],i=s(n),o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&i.length===1){i[t](this[0]);return this}else{for(var u=0,a=i.length;u<a;u++){var f=(u>0?this.clone(true):this).get();s(i[u])[t](f);r=r.concat(f)}return this.pushStack(r,e,i.selector)}}});s.extend({clone:function(e,t,n){var r,i,o,u=s.support.html5Clone||!nt.test("<"+e.nodeName)?e.cloneNode(true):dt(e);if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){lt(e,u);r=ct(e);i=ct(u);for(o=0;r[o];++o){if(i[o]){lt(r[o],i[o])}}}if(t){ft(e,u);if(n){r=ct(e);i=ct(u);for(o=0;r[o];++o){ft(r[o],i[o])}}}r=i=null;return u},clean:function(e,t,r,i){var o;t=t||n;if(typeof t.createElement==="undefined"){t=t.ownerDocument||t[0]&&t[0].ownerDocument||n}var u=[],a;for(var f=0,l;(l=e[f])!=null;f++){if(typeof l==="number"){l+=""}if(!l){continue}if(typeof l==="string"){if(!Z.test(l)){l=t.createTextNode(l)}else{l=l.replace(Q,"<$1></$2>");var c=(G.exec(l)||["",""])[1].toLowerCase(),h=ot[c]||ot._default,p=h[0],d=t.createElement("div");if(t===n){ut.appendChild(d)}else{V(t).appendChild(d)}d.innerHTML=h[1]+l+h[2];while(p--){d=d.lastChild}if(!s.support.tbody){var v=Y.test(l),m=c==="table"&&!v?d.firstChild&&d.firstChild.childNodes:h[1]==="<table>"&&!v?d.childNodes:[];for(a=m.length-1;a>=0;--a){if(s.nodeName(m[a],"tbody")&&!m[a].childNodes.length){m[a].parentNode.removeChild(m[a])}}}if(!s.support.leadingWhitespace&&K.test(l)){d.insertBefore(t.createTextNode(K.exec(l)[0]),d.firstChild)}l=d.childNodes}}var g;if(!s.support.appendChecked){if(l[0]&&typeof (g=l.length)==="number"){for(a=0;a<g;a++){pt(l[a])}}else{pt(l)}}if(l.nodeType){u.push(l)}else{u=s.merge(u,l)}}if(r){o=function(e){return!e.type||it.test(e.type)};for(f=0;u[f];f++){if(i&&s.nodeName(u[f],"script")&&(!u[f].type||u[f].type.toLowerCase()==="text/javascript")){i.push(u[f].parentNode?u[f].parentNode.removeChild(u[f]):u[f])}else{if(u[f].nodeType===1){var y=s.grep(u[f].getElementsByTagName("script"),o);u.splice.apply(u,[f+1,0].concat(y))}r.appendChild(u[f])}}}return u},cleanData:function(e){var t,n,r=s.cache,i=s.event.special,o=s.support.deleteExpando;for(var u=0,a;(a=e[u])!=null;u++){if(a.nodeName&&s.noData[a.nodeName.toLowerCase()]){continue}n=a[s.expando];if(n){t=r[n];if(t&&t.events){for(var f in t.events){if(i[f]){s.event.remove(a,f)}else{s.removeEvent(a,f,t.handle)}}if(t.handle){t.handle.elem=null}}if(o){delete a[s.expando]}else if(a.removeAttribute){a.removeAttribute(s.expando)}delete r[n]}}}});var mt=/alpha\([^)]*\)/i,gt=/opacity=([^)]*)/,yt=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,wt=/^-?\d/,Et=/^([\-+])=([\-+.\de]+)/,St={position:"absolute",visibility:"hidden",display:"block"},xt=["Left","Right"],Tt=["Top","Bottom"],Nt,Ct,kt;s.fn.css=function(e,n){if(arguments.length===2&&n===t){return this}return s.access(this,e,n,true,function(e,n,r){return r!==t?s.style(e,n,r):s.css(e,n)})};s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Nt(e,"opacity","opacity");return n===""?"1":n}else{return e.style.opacity}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var o,u,a=s.camelCase(n),f=e.style,l=s.cssHooks[a];n=s.cssProps[a]||a;if(r!==t){u=typeof r;if(u==="string"&&(o=Et.exec(r))){r=+(o[1]+1)*+o[2]+parseFloat(s.css(e,n));u="number"}if(r==null||u==="number"&&isNaN(r)){return}if(u==="number"&&!s.cssNumber[a]){r+="px"}if(!l||!("set"in l)||(r=l.set(e,r))!==t){try{f[n]=r}catch(c){}}}else{if(l&&"get"in l&&(o=l.get(e,false,i))!==t){return o}return f[n]}},css:function(e,n,r){var i,o;n=s.camelCase(n);o=s.cssHooks[n];n=s.cssProps[n]||n;if(n==="cssFloat"){n="float"}if(o&&"get"in o&&(i=o.get(e,true,r))!==t){return i}else if(Nt){return Nt(e,n)}},swap:function(e,t,n){var r={};for(var i in t){r[i]=e.style[i];e.style[i]=t[i]}n.call(e);for(i in t){e.style[i]=r[i]}}});s.curCSS=s.css;s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,n,r){var i;if(n){if(e.offsetWidth!==0){return Lt(e,t,r)}else{s.swap(e,St,function(){i=Lt(e,t,r)})}return i}},set:function(e,t){if(bt.test(t)){t=parseFloat(t);if(t>=0){return t+"px"}}else{return t}}}});if(!s.support.opacity){s.cssHooks.opacity={get:function(e,t){return gt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",o=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&s.trim(o.replace(mt,""))===""){n.removeAttribute("filter");if(r&&!r.filter){return}}n.filter=mt.test(o)?o.replace(mt,i):o+" "+i}}}s(function(){if(!s.support.reliableMarginRight){s.cssHooks.marginRight={get:function(e,t){var n;s.swap(e,{display:"inline-block"},function(){if(t){n=Nt(e,"margin-right","marginRight")}else{n=e.style.marginRight}});return n}}}});if(n.defaultView&&n.defaultView.getComputedStyle){Ct=function(e,t){var n,r,i;t=t.replace(yt,"-$1").toLowerCase();if((r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))){n=i.getPropertyValue(t);if(n===""&&!s.contains(e.ownerDocument.documentElement,e)){n=s.style(e,t)}}return n}}if(n.documentElement.currentStyle){kt=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;if(s===null&&o&&(i=o[t])){s=i}if(!bt.test(s)&&wt.test(s)){n=o.left;r=e.runtimeStyle&&e.runtimeStyle.left;if(r){e.runtimeStyle.left=e.currentStyle.left}o.left=t==="fontSize"?"1em":s||0;s=o.pixelLeft+"px";o.left=n;if(r){e.runtimeStyle.left=r}}return s===""?"auto":s}}Nt=Ct||kt;if(s.expr&&s.expr.filters){s.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"};s.expr.filters.visible=function(e){return!s.expr.filters.hidden(e)}}var At=/%20/g,Ot=/\[\]$/,Mt=/\r?\n/g,_t=/#.*$/,Dt=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Pt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ht=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Bt=/^(?:GET|HEAD)$/,jt=/^\/\//,Ft=/\?/,It=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,qt=/^(?:select|textarea)/i,Rt=/\s+/,Ut=/([?&])_=[^&]*/,zt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Wt=s.fn.load,Xt={},Vt={},$t,Jt,Kt=["*/"]+["*"];try{$t=i.href}catch(Qt){$t=n.createElement("a");$t.href="";$t=$t.href}Jt=zt.exec($t.toLowerCase())||[];s.fn.extend({load:function(e,n,r){if(typeof e!=="string"&&Wt){return Wt.apply(this,arguments)}else if(!this.length){return this}var i=e.indexOf(" ");if(i>=0){var o=e.slice(i,e.length);e=e.slice(0,i)}var u="GET";if(n){if(s.isFunction(n)){r=n;n=t}else if(typeof n==="object"){n=s.param(n,s.ajaxSettings.traditional);u="POST"}}var a=this;s.ajax({url:e,type:u,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText;if(e.isResolved()){e.done(function(e){n=e});a.html(o?s("<div>").append(n.replace(It,"")).find(o):n)}if(r){a.each(r,[n,t,e])}}});return this},serialize:function(){return s.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?s.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||qt.test(this.nodeName)||Pt.test(this.type))}).map(function(e,t){var n=s(this).val();return n==null?null:s.isArray(n)?s.map(n,function(e,n){return{name:t.name,value:e.replace(Mt,"\r\n")}}):{name:t.name,value:n.replace(Mt,"\r\n")}}).get()}});s.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){s.fn[t]=function(e){return this.on(t,e)}});s.each(["get","post"],function(e,n){s[n]=function(e,r,i,o){if(s.isFunction(r)){o=o||i;i=r;r=t}return s.ajax({type:n,url:e,data:r,success:i,dataType:o})}});s.extend({getScript:function(e,n){return s.get(e,t,n,"script")},getJSON:function(e,t,n){return s.get(e,t,n,"json")},ajaxSetup:function(e,t){if(t){Zt(e,s.ajaxSettings)}else{t=e;e=s.ajaxSettings}Zt(e,t);return e},ajaxSettings:{url:$t,isLocal:Ht.test(Jt[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Kt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":true,"text json":s.parseJSON,"text xml":s.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:Gt(Xt),ajaxTransport:Gt(Vt),ajax:function(e,n){function S(e,n,c,h){if(y===2){return}y=2;if(m){clearTimeout(m)}v=t;p=h||"";E.readyState=e>0?4:0;var d,g,w,S=n,x=c?tn(r,E,c):t,T,N;if(e>=200&&e<300||e===304){if(r.ifModified){if(T=E.getResponseHeader("Last-Modified")){s.lastModified[l]=T}if(N=E.getResponseHeader("Etag")){s.etag[l]=N}}if(e===304){S="notmodified";d=true}else{try{g=nn(r,x);S="success";d=true}catch(C){S="parsererror";w=C}}}else{w=S;if(!S||e){S="error";if(e<0){e=0}}}E.status=e;E.statusText=""+(n||S);if(d){u.resolveWith(i,[g,S,E])}else{u.rejectWith(i,[E,S,w])}E.statusCode(f);f=t;if(b){o.trigger("ajax"+(d?"Success":"Error"),[E,r,d?g:w])}a.fireWith(i,[E,S]);if(b){o.trigger("ajaxComplete",[E,r]);if(!--s.active){s.event.trigger("ajaxStop")}}}if(typeof e==="object"){n=e;e=t}n=n||{};var r=s.ajaxSetup({},n),i=r.context||r,o=i!==r&&(i.nodeType||i instanceof s)?s(i):s.event,u=s.Deferred(),a=s.Callbacks("once memory"),f=r.statusCode||{},l,c={},h={},p,d,v,m,g,y=0,b,w,E={readyState:0,setRequestHeader:function(e,t){if(!y){var n=e.toLowerCase();e=h[n]=h[n]||e;c[e]=t}return this},getAllResponseHeaders:function(){return y===2?p:null},getResponseHeader:function(e){var n;if(y===2){if(!d){d={};while(n=Dt.exec(p)){d[n[1].toLowerCase()]=n[2]}}n=d[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){if(!y){r.mimeType=e}return this},abort:function(e){e=e||"abort";if(v){v.abort(e)}S(0,e);return this}};u.promise(E);E.success=E.done;E.error=E.fail;E.complete=a.add;E.statusCode=function(e){if(e){var t;if(y<2){for(t in e){f[t]=[f[t],e[t]]}}else{t=e[E.status];E.then(t,t)}}return this};r.url=((e||r.url)+"").replace(_t,"").replace(jt,Jt[1]+"//");r.dataTypes=s.trim(r.dataType||"*").toLowerCase().split(Rt);if(r.crossDomain==null){g=zt.exec(r.url.toLowerCase());r.crossDomain=!!(g&&(g[1]!=Jt[1]||g[2]!=Jt[2]||(g[3]||(g[1]==="http:"?80:443))!=(Jt[3]||(Jt[1]==="http:"?80:443))))}if(r.data&&r.processData&&typeof r.data!=="string"){r.data=s.param(r.data,r.traditional)}Yt(Xt,r,n,E);if(y===2){return false}b=r.global;r.type=r.type.toUpperCase();r.hasContent=!Bt.test(r.type);if(b&&s.active++===0){s.event.trigger("ajaxStart")}if(!r.hasContent){if(r.data){r.url+=(Ft.test(r.url)?"&":"?")+r.data;delete r.data}l=r.url;if(r.cache===false){var x=s.now(),T=r.url.replace(Ut,"$1_="+x);r.url=T+(T===r.url?(Ft.test(r.url)?"&":"?")+"_="+x:"")}}if(r.data&&r.hasContent&&r.contentType!==false||n.contentType){E.setRequestHeader("Content-Type",r.contentType)}if(r.ifModified){l=l||r.url;if(s.lastModified[l]){E.setRequestHeader("If-Modified-Since",s.lastModified[l])}if(s.etag[l]){E.setRequestHeader("If-None-Match",s.etag[l])}}E.setRequestHeader("Accept",r.dataTypes[0]&&r.accepts[r.dataTypes[0]]?r.accepts[r.dataTypes[0]]+(r.dataTypes[0]!=="*"?", "+Kt+"; q=0.01":""):r.accepts["*"]);for(w in r.headers){E.setRequestHeader(w,r.headers[w])}if(r.beforeSend&&(r.beforeSend.call(i,E,r)===false||y===2)){E.abort();return false}for(w in{success:1,error:1,complete:1}){E[w](r[w])}v=Yt(Vt,r,n,E);if(!v){S(-1,"No Transport")}else{E.readyState=1;if(b){o.trigger("ajaxSend",[E,r])}if(r.async&&r.timeout>0){m=setTimeout(function(){E.abort("timeout")},r.timeout)}try{y=1;v.send(c,S)}catch(N){if(y<2){S(-1,N)}else{throw N}}}return E},param:function(e,n){var r=[],i=function(e,t){t=s.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t){n=s.ajaxSettings.traditional}if(s.isArray(e)||e.jquery&&!s.isPlainObject(e)){s.each(e,function(){i(this.name,this.value)})}else{for(var o in e){en(o,e[o],n,i)}}return r.join("&").replace(At,"+")}});s.extend({active:0,lastModified:{},etag:{}});var rn=s.now(),sn=/(\=)\?(&|$)|\?\?/i;s.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return s.expando+"_"+rn++}});s.ajaxPrefilter("json jsonp",function(t,n,r){var i=t.contentType==="application/x-www-form-urlencoded"&&typeof t.data==="string";if(t.dataTypes[0]==="jsonp"||t.jsonp!==false&&(sn.test(t.url)||i&&sn.test(t.data))){var o,u=t.jsonpCallback=s.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a=e[u],f=t.url,l=t.data,c="$1"+u+"$2";if(t.jsonp!==false){f=f.replace(sn,c);if(t.url===f){if(i){l=l.replace(sn,c)}if(t.data===l){f+=(/\?/.test(f)?"&":"?")+t.jsonp+"="+u}}}t.url=f;t.data=l;e[u]=function(e){o=[e]};r.always(function(){e[u]=a;if(o&&s.isFunction(a)){e[u](o[0])}});t.converters["script json"]=function(){if(!o){s.error(u+" was not called")}return o[0]};t.dataTypes[0]="json";return"script"}});s.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){s.globalEval(e);return e}}});s.ajaxPrefilter("script",function(e){if(e.cache===t){e.cache=false}if(e.crossDomain){e.type="GET";e.global=false}});s.ajaxTransport("script",function(e){if(e.crossDomain){var r,i=n.head||n.getElementsByTagName("head")[0]||n.documentElement;return{send:function(s,o){r=n.createElement("script");r.async="async";if(e.scriptCharset){r.charset=e.scriptCharset}r.src=e.url;r.onload=r.onreadystatechange=function(e,n){if(n||!r.readyState||/loaded|complete/.test(r.readyState)){r.onload=r.onreadystatechange=null;if(i&&r.parentNode){i.removeChild(r)}r=t;if(!n){o(200,"success")}}};i.insertBefore(r,i.firstChild)},abort:function(){if(r){r.onload(0,1)}}}}});var on=e.ActiveXObject?function(){for(var e in an){an[e](0,1)}}:false,un=0,an;s.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&fn()||ln()}:fn;(function(e){s.extend(s.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})})(s.ajaxSettings.xhr());if(s.support.ajax){s.ajaxTransport(function(n){if(!n.crossDomain||s.support.cors){var r;return{send:function(i,o){var u=n.xhr(),a,f;if(n.username){u.open(n.type,n.url,n.async,n.username,n.password)}else{u.open(n.type,n.url,n.async)}if(n.xhrFields){for(f in n.xhrFields){u[f]=n.xhrFields[f]}}if(n.mimeType&&u.overrideMimeType){u.overrideMimeType(n.mimeType)}if(!n.crossDomain&&!i["X-Requested-With"]){i["X-Requested-With"]="XMLHttpRequest"}try{for(f in i){u.setRequestHeader(f,i[f])}}catch(l){}u.send(n.hasContent&&n.data||null);r=function(e,i){var f,l,c,h,p;try{if(r&&(i||u.readyState===4)){r=t;if(a){u.onreadystatechange=s.noop;if(on){delete an[a]}}if(i){if(u.readyState!==4){u.abort()}}else{f=u.status;c=u.getAllResponseHeaders();h={};p=u.responseXML;if(p&&p.documentElement){h.xml=p}h.text=u.responseText;try{l=u.statusText}catch(d){l=""}if(!f&&n.isLocal&&!n.crossDomain){f=h.text?200:404}else if(f===1223){f=204}}}}catch(v){if(!i){o(-1,v)}}if(h){o(f,l,h,c)}};if(!n.async||u.readyState===4){r()}else{a=++un;if(on){if(!an){an={};s(e).unload(on)}an[a]=r}u.onreadystatechange=r}},abort:function(){if(r){r(0,1)}}}}})}var cn={},hn,pn,dn=/^(?:toggle|show|hide)$/,vn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,mn,gn=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],yn;s.fn.extend({show:function(e,t,n){var r,i;if(e||e===0){return this.animate(En("show",3),e,t,n)}else{for(var o=0,u=this.length;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(!s._data(r,"olddisplay")&&i==="none"){i=r.style.display=""}if(i===""&&s.css(r,"display")==="none"){s._data(r,"olddisplay",Sn(r.nodeName))}}}for(o=0;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(i===""||i==="none"){r.style.display=s._data(r,"olddisplay")||""}}}return this}},hide:function(e,t,n){if(e||e===0){return this.animate(En("hide",3),e,t,n)}else{var r,i,o=0,u=this.length;for(;o<u;o++){r=this[o];if(r.style){i=s.css(r,"display");if(i!=="none"&&!s._data(r,"olddisplay")){s._data(r,"olddisplay",i)}}}for(o=0;o<u;o++){if(this[o].style){this[o].style.display="none"}}return this}},_toggle:s.fn.toggle,toggle:function(e,t,n){var r=typeof e==="boolean";if(s.isFunction(e)&&s.isFunction(t)){this._toggle.apply(this,arguments)}else if(e==null||r){this.each(function(){var t=r?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()})}else{this.animate(En("toggle",3),e,t,n)}return this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){function o(){if(i.queue===false){s._mark(this)}var t=s.extend({},i),n=this.nodeType===1,r=n&&s(this).is(":hidden"),o,u,a,f,l,c,h,p,d;t.animatedProperties={};for(a in e){o=s.camelCase(a);if(a!==o){e[o]=e[a];delete e[a]}u=e[o];if(s.isArray(u)){t.animatedProperties[o]=u[1];u=e[o]=u[0]}else{t.animatedProperties[o]=t.specialEasing&&t.specialEasing[o]||t.easing||"swing"}if(u==="hide"&&r||u==="show"&&!r){return t.complete.call(this)}if(n&&(o==="height"||o==="width")){t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(s.css(this,"display")==="inline"&&s.css(this,"float")==="none"){if(!s.support.inlineBlockNeedsLayout||Sn(this.nodeName)==="inline"){this.style.display="inline-block"}else{this.style.zoom=1}}}}if(t.overflow!=null){this.style.overflow="hidden"}for(a in e){f=new s.fx(this,t,a);u=e[a];if(dn.test(u)){d=s._data(this,"toggle"+a)||(u==="toggle"?r?"show":"hide":0);if(d){s._data(this,"toggle"+a,d==="show"?"hide":"show");f[d]()}else{f[u]()}}else{l=vn.exec(u);c=f.cur();if(l){h=parseFloat(l[2]);p=l[3]||(s.cssNumber[a]?"":"px");if(p!=="px"){s.style(this,a,(h||1)+p);c=(h||1)/f.cur()*c;s.style(this,a,c+p)}if(l[1]){h=(l[1]==="-="?-1:1)*h+c}f.custom(c,h,p)}else{f.custom(c,u,"")}}}return true}var i=s.speed(t,n,r);if(s.isEmptyObject(e)){return this.each(i.complete,[false])}e=s.extend({},e);return i.queue===false?this.each(o):this.queue(i.queue,o)},stop:function(e,n,r){if(typeof e!=="string"){r=n;n=e;e=t}if(n&&e!==false){this.queue(e||"fx",[])}return this.each(function(){function u(e,t,n){var i=t[n];s.removeData(e,n,true);i.stop(r)}var t,n=false,i=s.timers,o=s._data(this);if(!r){s._unmark(true,this)}if(e==null){for(t in o){if(o[t]&&o[t].stop&&t.indexOf(".run")===t.length-4){u(this,o,t)}}}else if(o[t=e+".run"]&&o[t].stop){u(this,o,t)}for(t=i.length;t--;){if(i[t].elem===this&&(e==null||i[t].queue===e)){if(r){i[t](true)}else{i[t].saveState()}n=true;i.splice(t,1)}}if(!(r&&n)){s.dequeue(this,e)}})}});s.each({slideDown:En("show",1),slideUp:En("hide",1),slideToggle:En("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}});s.extend({speed:function(e,t,n){var r=e&&typeof e==="object"?s.extend({},e):{complete:n||!n&&t||s.isFunction(e)&&e,duration:e,easing:n&&t||t&&!s.isFunction(t)&&t};r.duration=s.fx.off?0:typeof r.duration==="number"?r.duration:r.duration in s.fx.speeds?s.fx.speeds[r.duration]:s.fx.speeds._default;if(r.queue==null||r.queue===true){r.queue="fx"}r.old=r.complete;r.complete=function(e){if(s.isFunction(r.old)){r.old.call(this)}if(r.queue){s.dequeue(this,r.queue)}else if(e!==false){s._unmark(this)}};return r},easing:{linear:function(e,t,n,r){return n+r*e},swing:function(e,t,n,r){return(-Math.cos(e*Math.PI)/2+.5)*r+n}},timers:[],fx:function(e,t,n){this.options=t;this.elem=e;this.prop=n;t.orig=t.orig||{}}});s.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e},custom:function(e,n,r){function u(e){return i.step(e)}var i=this,o=s.fx;this.startTime=yn||bn();this.end=n;this.now=this.start=e;this.pos=this.state=0;this.unit=r||this.unit||(s.cssNumber[this.prop]?"":"px");u.queue=this.options.queue;u.elem=this.elem;u.saveState=function(){if(i.options.hide&&s._data(i.elem,"fxshow"+i.prop)===t){s._data(i.elem,"fxshow"+i.prop,i.start)}};if(u()&&s.timers.push(u)&&!mn){mn=setInterval(o.tick,o.interval)}},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop);this.options.show=true;if(e!==t){this.custom(this.cur(),e)}else{this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur())}s(this.elem).show()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(e){var t,n,r,i=yn||bn(),o=true,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();a.animatedProperties[this.prop]=true;for(t in a.animatedProperties){if(a.animatedProperties[t]!==true){o=false}}if(o){if(a.overflow!=null&&!s.support.shrinkWrapBlocks){s.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]})}if(a.hide){s(u).hide()}if(a.hide||a.show){for(t in a.animatedProperties){s.style(u,t,a.orig[t]);s.removeData(u,"fxshow"+t,true);s.removeData(u,"toggle"+t,true)}}r=a.complete;if(r){a.complete=false;r.call(u)}}return false}else{if(a.duration==Infinity){this.now=i}else{n=i-this.startTime;this.state=n/a.duration;this.pos=s.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration);this.now=this.start+(this.end-this.start)*this.pos}this.update()}return true}};s.extend(s.fx,{tick:function(){var e,t=s.timers,n=0;for(;n<t.length;n++){e=t[n];if(!e()&&t[n]===e){t.splice(n--,1)}}if(!t.length){s.fx.stop()}},interval:13,stop:function(){clearInterval(mn);mn=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){if(e.elem.style&&e.elem.style[e.prop]!=null){e.elem.style[e.prop]=e.now+e.unit}else{e.elem[e.prop]=e.now}}}});s.each(["width","height"],function(e,t){s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now)+e.unit)}});if(s.expr&&s.expr.filters){s.expr.filters.animated=function(e){return s.grep(s.timers,function(t){return e===t.elem}).length}}var xn=/^t(?:able|d|h)$/i,Tn=/^(?:body|html)$/i;if("getBoundingClientRect"in n.documentElement){s.fn.offset=function(e){var t=this[0],n;if(e){return this.each(function(t){s.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return s.offset.bodyOffset(t)}try{n=t.getBoundingClientRect()}catch(r){}var i=t.ownerDocument,o=i.documentElement;if(!n||!s.contains(o,t)){return n?{top:n.top,left:n.left}:{top:0,left:0}}var u=i.body,a=Nn(i),f=o.clientTop||u.clientTop||0,l=o.clientLeft||u.clientLeft||0,c=a.pageYOffset||s.support.boxModel&&o.scrollTop||u.scrollTop,h=a.pageXOffset||s.support.boxModel&&o.scrollLeft||u.scrollLeft,p=n.top+c-f,d=n.left+h-l;return{top:p,left:d}}}else{s.fn.offset=function(e){var t=this[0];if(e){return this.each(function(t){s.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return s.offset.bodyOffset(t)}var n,r=t.offsetParent,i=t,o=t.ownerDocument,u=o.documentElement,a=o.body,f=o.defaultView,l=f?f.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,h=t.offsetLeft;while((t=t.parentNode)&&t!==a&&t!==u){if(s.support.fixedPosition&&l.position==="fixed"){break}n=f?f.getComputedStyle(t,null):t.currentStyle;c-=t.scrollTop;h-=t.scrollLeft;if(t===r){c+=t.offsetTop;h+=t.offsetLeft;if(s.support.doesNotAddBorder&&!(s.support.doesAddBorderForTableAndCells&&xn.test(t.nodeName))){c+=parseFloat(n.borderTopWidth)||0;h+=parseFloat(n.borderLeftWidth)||0}i=r;r=t.offsetParent}if(s.support.subtractsBorderForOverflowNotVisible&&n.overflow!=="visible"){c+=parseFloat(n.borderTopWidth)||0;h+=parseFloat(n.borderLeftWidth)||0}l=n}if(l.position==="relative"||l.position==="static"){c+=a.offsetTop;h+=a.offsetLeft}if(s.support.fixedPosition&&l.position==="fixed"){c+=Math.max(u.scrollTop,a.scrollTop);h+=Math.max(u.scrollLeft,a.scrollLeft)}return{top:c,left:h}}}s.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;if(s.support.doesNotIncludeMarginInBodyOffset){t+=parseFloat(s.css(e,"marginTop"))||0;n+=parseFloat(s.css(e,"marginLeft"))||0}return{top:t,left:n}},setOffset:function(e,t,n){var r=s.css(e,"position");if(r==="static"){e.style.position="relative"}var i=s(e),o=i.offset(),u=s.css(e,"top"),a=s.css(e,"left"),f=(r==="absolute"||r==="fixed")&&s.inArray("auto",[u,a])>-1,l={},c={},h,p;if(f){c=i.position();h=c.top;p=c.left}else{h=parseFloat(u)||0;p=parseFloat(a)||0}if(s.isFunction(t)){t=t.call(e,n,o)}if(t.top!=null){l.top=t.top-o.top+h}if(t.left!=null){l.left=t.left-o.left+p}if("using"in t){t.using.call(e,l)}else{i.css(l)}}};s.fn.extend({position:function(){if(!this[0]){return null}var e=this[0],t=this.offsetParent(),n=this.offset(),r=Tn.test(t[0].nodeName)?{top:0,left:0}:t.offset();n.top-=parseFloat(s.css(e,"marginTop"))||0;n.left-=parseFloat(s.css(e,"marginLeft"))||0;r.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0;r.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0;return{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||n.body;while(e&&!Tn.test(e.nodeName)&&s.css(e,"position")==="static"){e=e.offsetParent}return e})}});s.each(["Left","Top"],function(e,n){var r="scroll"+n;s.fn[r]=function(n){var i,o;if(n===t){i=this[0];if(!i){return null}o=Nn(i);return o?"pageXOffset"in o?o[e?"pageYOffset":"pageXOffset"]:s.support.boxModel&&o.document.documentElement[r]||o.document.body[r]:i[r]}return this.each(function(){o=Nn(this);if(o){o.scrollTo(!e?n:s(o).scrollLeft(),e?n:s(o).scrollTop())}else{this[r]=n}})}});s.each(["Height","Width"],function(e,n){var r=n.toLowerCase();s.fn["inner"+n]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,r,"padding")):this[r]():null};s.fn["outer"+n]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,r,e?"margin":"border")):this[r]():null};s.fn[r]=function(e){var i=this[0];if(!i){return e==null?null:this}if(s.isFunction(e)){return this.each(function(t){var n=s(this);n[r](e.call(this,t,n[r]()))})}if(s.isWindow(i)){var o=i.document.documentElement["client"+n],u=i.document.body;return i.document.compatMode==="CSS1Compat"&&o||u&&u["client"+n]||o}else if(i.nodeType===9){return Math.max(i.documentElement["client"+n],i.body["scroll"+n],i.documentElement["scroll"+n],i.body["offset"+n],i.documentElement["offset"+n])}else if(e===t){var a=s.css(i,r),f=parseFloat(a);return s.isNumeric(f)?f:a}else{return this.css(r,typeof e==="string"?e:e+"px")}}});e.jQuery=e.$=s;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return s})}})(window);(function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){n=t.parentNode;i=n.name;if(!t.href||!i||n.nodeName.toLowerCase()!=="map")return false;t=e("img[usemap=#"+i+"]")[0];return!!t&&r(t)}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(!e.ui.version){e.extend(e.ui,{version:"1.8.16",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,n){return typeof t==="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus();n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;t=e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){n=e(this[0]);for(var r;n.length&&n[0]!==document;){r=n.css("position");if(r==="absolute"||r==="relative"||r==="fixed"){r=parseInt(n.css("zIndex"),10);if(!isNaN(r)&&r!==0)return r}n=n.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});e.each(["Width","Height"],function(n,r){function i(t,n,r,i){e.each(s,function(){n-=parseFloat(e.curCSS(t,"padding"+this,true))||0;if(r)n-=parseFloat(e.curCSS(t,"border"+this+"Width",true))||0;if(i)n-=parseFloat(e.curCSS(t,"margin"+this,true))||0});return n}var s=r==="Width"?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){if(n===t)return u["inner"+r].call(this);return this.each(function(){e(this).css(o,i(this,n)+"px")})};e.fn["outer"+r]=function(t,n){if(typeof t!=="number")return u["outer"+r].call(this,t);return this.each(function(){e(this).css(o,i(this,t,true,n)+"px")})}});e.extend(e.expr[":"],{data:function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}});e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});e.support.minHeight=n.offsetHeight===100;e.support.selectstart="onselectstart"in n;t.removeChild(n).style.display="none"});e.extend(e.ui,{plugin:{add:function(t,n,r){t=e.ui[t].prototype;for(var i in r){t.plugins[i]=t.plugins[i]||[];t.plugins[i].push([n,r[i]])}},call:function(e,t,n){if((t=e.plugins[t])&&e.element[0].parentNode)for(var r=0;r<t.length;r++)e.options[t[r][0]]&&t[r][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return false;n=n&&n==="left"?"scrollLeft":"scrollTop";var r=false;if(t[n]>0)return true;t[n]=1;r=t[n]>0;t[n]=0;return r},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})}})(jQuery);(function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){if(!n)if(!t||e.filter(t,[this]).length)e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}});return r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1];s=i+"-"+t;if(!r){r=n;n=e.Widget}e.expr[":"][s]=function(n){return!!e.data(n,t)};e[i]=e[i]||{};e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};n=new n;n.options=e.extend(true,{},n.options);e[i][t].prototype=e.extend(true,n,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r);e.widget.bridge(t,e[i][t])};e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i==="string",o=Array.prototype.slice.call(arguments,1),u=this;i=!s&&o.length?e.extend.apply(null,[true,i].concat(o)):i;if(s&&i.charAt(0)==="_")return u;s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t){u=s;return false}}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))});return u}};e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)};e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(t,n){e.data(n,this.widgetName,this);this.element=e(n);this.options=e.extend(true,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n==="string"){if(r===t)return this.options[n];i={};i[n]=r}this._setOptions(i);return this},_setOptions:function(t){var n=this;e.each(t,function(e,t){n._setOption(e,t)});return this},_setOption:function(e,t){this.options[e]=t;if(e==="disabled")this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",t);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(t,n,r){var i=this.options[t];n=e.Event(n);n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase();r=r||{};if(n.originalEvent){t=e.event.props.length;for(var s;t;){s=e.event.props[--t];n[s]=n.originalEvent[s]}}this.element.trigger(n,r);return!(e.isFunction(i)&&i.call(this.element[0],n,r)===false||n.isDefaultPrevented())}}})(jQuery);(function(e){var t=false;e(document).mouseup(function(){t=false});e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(true===e.data(n.target,t.widgetName+".preventClickEvent")){e.removeData(n.target,t.widgetName+".preventClickEvent");n.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n);this._mouseDownEvent=n;var r=this,i=n.which==1,s=typeof this.options.cancel=="string"&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:false;if(!i||s||!this._mouseCapture(n))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(n)&&this._mouseDelayMet(n)){this._mouseStarted=this._mouseStart(n)!==false;if(!this._mouseStarted){n.preventDefault();return true}}true===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(e){return r._mouseMove(e)};this._mouseUpDelegate=function(e){return r._mouseUp(e)};e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);n.preventDefault();return t=true}},_mouseMove:function(t){if(e.browser.msie&&!(document.documentMode>=9)&&!t.button)return this._mouseUp(t);if(this._mouseStarted){this._mouseDrag(t);return t.preventDefault()}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==false)?this._mouseDrag(t):this._mouseUp(t);return!this._mouseStarted},_mouseUp:function(t){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",true);this._mouseStop(t)}return false},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);(function(e){e.ui=e.ui||{};var t=/left|center|right/,n=/top|center|bottom/,r=e.fn.position,i=e.fn.offset;e.fn.position=function(i){if(!i||!i.of)return r.apply(this,arguments);i=e.extend({},i);var s=e(i.of),u=s[0],a=(i.collision||"flip").split(" "),f=i.offset?i.offset.split(" "):[0,0],l,h,p;if(u.nodeType===9){l=s.width();h=s.height();p={top:0,left:0}}else if(u.setTimeout){l=s.width();h=s.height();p={top:s.scrollTop(),left:s.scrollLeft()}}else if(u.preventDefault){i.at="left top";l=h=0;p={top:i.of.pageY,left:i.of.pageX}}else{l=s.outerWidth();h=s.outerHeight();p=s.offset()}e.each(["my","at"],function(){var e=(i[this]||"").split(" ");if(e.length===1)e=t.test(e[0])?e.concat(["center"]):n.test(e[0])?["center"].concat(e):["center","center"];e[0]=t.test(e[0])?e[0]:"center";e[1]=n.test(e[1])?e[1]:"center";i[this]=e});if(a.length===1)a[1]=a[0];f[0]=parseInt(f[0],10)||0;if(f.length===1)f[1]=f[0];f[1]=parseInt(f[1],10)||0;if(i.at[0]==="right")p.left+=l;else if(i.at[0]==="center")p.left+=l/2;if(i.at[1]==="bottom")p.top+=h;else if(i.at[1]==="center")p.top+=h/2;p.left+=f[0];p.top+=f[1];return this.each(function(){var t=e(this),n=t.outerWidth(),r=t.outerHeight(),s=parseInt(e.curCSS(this,"marginLeft",true))||0,o=parseInt(e.curCSS(this,"marginTop",true))||0,u=n+s+(parseInt(e.curCSS(this,"marginRight",true))||0),d=r+o+(parseInt(e.curCSS(this,"marginBottom",true))||0),v=e.extend({},p),m;if(i.my[0]==="right")v.left-=n;else if(i.my[0]==="center")v.left-=n/2;if(i.my[1]==="bottom")v.top-=r;else if(i.my[1]==="center")v.top-=r/2;v.left=Math.round(v.left);v.top=Math.round(v.top);m={left:v.left-s,top:v.top-o};e.each(["left","top"],function(t,s){e.ui.position[a[t]]&&e.ui.position[a[t]][s](v,{targetWidth:l,targetHeight:h,elemWidth:n,elemHeight:r,collisionPosition:m,collisionWidth:u,collisionHeight:d,offset:f,my:i.my,at:i.at})});e.fn.bgiframe&&t.bgiframe();t.offset(e.extend(v,{using:i.using}))})};e.ui.position={fit:{left:function(t,n){var r=e(window);r=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();t.left=r>0?t.left-r:Math.max(t.left-n.collisionPosition.left,t.left)},top:function(t,n){var r=e(window);r=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();t.top=r>0?t.top-r:Math.max(t.top-n.collisionPosition.top,t.top)}},flip:{left:function(t,n){if(n.at[0]!=="center"){var r=e(window);r=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();var i=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,s=n.at[0]==="left"?n.targetWidth:-n.targetWidth,o=-2*n.offset[0];t.left+=n.collisionPosition.left<0?i+s+o:r>0?i+s+o:0}},top:function(t,n){if(n.at[1]!=="center"){var r=e(window);r=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();var i=n.my[1]==="top"?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,s=n.at[1]==="top"?n.targetHeight:-n.targetHeight,o=-2*n.offset[1];t.top+=n.collisionPosition.top<0?i+s+o:r>0?i+s+o:0}}}};if(!e.offset.setOffset){e.offset.setOffset=function(t,n){if(/static/.test(e.curCSS(t,"position")))t.style.position="relative";var r=e(t),i=r.offset(),s=parseInt(e.curCSS(t,"top",true),10)||0,o=parseInt(e.curCSS(t,"left",true),10)||0;i={top:n.top-i.top+s,left:n.left-i.left+o};"using"in n?n.using.call(t,i):r.css(i)};e.fn.offset=function(t){var n=this[0];if(!n||!n.ownerDocument)return null;if(t)return this.each(function(){e.offset.setOffset(this,t)});return i.call(this)}}})(jQuery);(function(e){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(t){var n=this.options;if(this.helper||n.disabled||e(t.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(t);if(!this.handle)return false;if(n.iframeFix)e(n.iframeFix===true?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")});return true},_mouseStart:function(t){var n=this.options;this.helper=this._createHelper(t);this._cacheHelperProportions();if(e.ui.ddmanager)e.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(t);this.originalPageX=t.pageX;this.originalPageY=t.pageY;n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt);n.containment&&this._setContainment();if(this._trigger("start",t)===false){this._clear();return false}this._cacheHelperProportions();e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(t,true);e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t);return true},_mouseDrag:function(t,n){this.position=this._generatePosition(t);this.positionAbs=this._convertPositionTo("absolute");if(!n){n=this._uiHash();if(this._trigger("drag",t,n)===false){this._mouseUp({});return false}this.position=n.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";e.ui.ddmanager&&e.ui.ddmanager.drag(this,t);return false},_mouseStop:function(t){var n=false;if(e.ui.ddmanager&&!this.options.dropBehaviour)n=e.ui.ddmanager.drop(this,t);if(this.dropped){n=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return false;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===true||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==false&&r._clear()})}else this._trigger("stop",t)!==false&&this._clear();return false},_mouseUp:function(t){this.options.iframeFix===true&&e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t);return e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?true:false;e(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==t.target)n=true});return n},_createHelper:function(t){var n=this.options;t=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;t.parents("body").length||t.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo);t[0]!=this.element[0]&&!/(fixed|absolute)/.test(t.css("position"))&&t.css("position","absolute");return t},_adjustOffsetFromHelper:function(t){if(typeof t=="string")t=t.split(" ");if(e.isArray(t))t={left:+t[0],top:+t[1]||0};if("left"in t)this.offset.click.left=t.left+this.margins.left;if("right"in t)this.offset.click.left=this.helperProportions.width-t.right+this.margins.left;if("top"in t)this.offset.click.top=t.top+this.margins.top;if("bottom"in t)this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(t.containment=="parent")t.containment=this.helper[0].parentNode;if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){t=e(t.containment);var n=t[0];if(n){t.offset();var r=e(n).css("overflow")!="hidden";this.containment=[(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0),(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0),(r?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(r?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=t}}else if(t.containment.constructor==Array)this.containment=t.containment},_convertPositionTo:function(t,n){if(!n)n=this.position;t=t=="absolute"?1:-1;var r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName);return{top:n.top+this.offset.relative.top*t+this.offset.parent.top*t-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop())*t),left:n.left+this.offset.relative.left*t+this.offset.parent.left*t-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())*t)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){u=this.relative_container.offset();u=[this.containment[0]+u.left,this.containment[1]+u.top,this.containment[2]+u.left,this.containment[3]+u.top]}else u=this.containment;if(t.pageX-this.offset.click.left<u[0])s=u[0]+this.offset.click.left;if(t.pageY-this.offset.click.top<u[1])o=u[1]+this.offset.click.top;if(t.pageX-this.offset.click.left>u[2])s=u[2]+this.offset.click.left;if(t.pageY-this.offset.click.top>u[3])o=u[3]+this.offset.click.top}if(n.grid){o=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?!(o-this.offset.click.top<u[1]||o-this.offset.click.top>u[3])?o:!(o-this.offset.click.top<u[1])?o-n.grid[1]:o+n.grid[1]:o;s=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?!(s-this.offset.click.left<u[0]||s-this.offset.click.left>u[2])?s:!(s-this.offset.click.left<u[0])?s-n.grid[0]:s+n.grid[0]:s}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(t,n,r){r=r||this._uiHash();e.ui.plugin.call(this,t,[n,r]);if(t=="drag")this.positionAbs=this._convertPositionTo("absolute");return e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});e.extend(e.ui.draggable,{version:"1.8.16"});e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[];e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");if(n&&!n.options.disabled){r.sortables.push({instance:n,shouldRevert:n.options.revert});n.refreshPositions();n._trigger("activate",t,s)}})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;r.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(t);this.instance.options.helper=this.instance.options._helper;r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",t,i)}})},drag:function(t,n){var r=e(this).data("draggable"),i=this;e.each(r.sortables,function(){this.instance.positionAbs=r.positionAbs;this.instance.helperProportions=r.helperProportions;this.instance.offset.click=r.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return n.helper[0]};t.target=this.instance.currentItem[0];this.instance._mouseCapture(t,true);this.instance._mouseStart(t,true,true);this.instance.offset.click.top=r.offset.click.top;this.instance.offset.click.left=r.offset.click.left;this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top;r._trigger("toSortable",t);r.dropped=this.instance.element;r.currentItem=r.element;this.instance.fromOutside=r}this.instance.currentItem&&this.instance._mouseDrag(t)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",t,this.instance._uiHash(this.instance));this.instance._mouseStop(t,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();r._trigger("fromSortable",t);r.dropped=false}})}});e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("draggable").options;if(t.css("cursor"))n._cursor=t.css("cursor");t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}});e.ui.plugin.add("draggable","opacity",{start:function(t,n){t=e(n.helper);n=e(this).data("draggable").options;if(t.css("opacity"))n._opacity=t.css("opacity");t.css("opacity",n.opacity)},stop:function(t,n){t=e(this).data("draggable").options;t._opacity&&e(n.helper).css("opacity",t._opacity)}});e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");if(t.scrollParent[0]!=document&&t.scrollParent[0].tagName!="HTML")t.overflowOffset=t.scrollParent.offset()},drag:function(t){var n=e(this).data("draggable"),r=n.options,i=false;if(n.scrollParent[0]!=document&&n.scrollParent[0].tagName!="HTML"){if(!r.axis||r.axis!="x")if(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity)n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed;else if(t.pageY-n.overflowOffset.top<r.scrollSensitivity)n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed;if(!r.axis||r.axis!="y")if(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity)n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed;else if(t.pageX-n.overflowOffset.left<r.scrollSensitivity)n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed}else{if(!r.axis||r.axis!="x")if(t.pageY-e(document).scrollTop()<r.scrollSensitivity)i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed);else if(e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity)i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed);if(!r.axis||r.axis!="y")if(t.pageX-e(document).scrollLeft()<r.scrollSensitivity)i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed);else if(e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity)i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed)}i!==false&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}});e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),n=t.options;t.snapElements=[];e(n.snap.constructor!=String?n.snap.items||":data(draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){for(var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height,l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,v=p+r.snapElements[l].height;if(c-s<o&&o<h+s&&p-s<a&&a<v+s||c-s<o&&o<h+s&&p-s<f&&f<v+s||c-s<u&&u<h+s&&p-s<a&&a<v+s||c-s<u&&u<h+s&&p-s<f&&f<v+s){if(i.snapMode!="inner"){var m=Math.abs(p-f)<=s,g=Math.abs(v-a)<=s,y=Math.abs(c-u)<=s,b=Math.abs(h-o)<=s;if(m)n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top;if(g)n.position.top=r._convertPositionTo("relative",{top:v,left:0}).top-r.margins.top;if(y)n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left;if(b)n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left}var w=m||g||y||b;if(i.snapMode!="outer"){m=Math.abs(p-a)<=s;g=Math.abs(v-f)<=s;y=Math.abs(c-o)<=s;b=Math.abs(h-u)<=s;if(m)n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top;if(g)n.position.top=r._convertPositionTo("relative",{top:v-r.helperProportions.height,left:0}).top-r.margins.top;if(y)n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left;if(b)n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left}if(!r.snapElements[l].snapping&&(m||g||y||b||w))r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=m||g||y||b||w}else{r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=false}}}});e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options;t=e.makeArray(e(t.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(t.length){var n=parseInt(t[0].style.zIndex)||0;e(t).each(function(e){this.style.zIndex=n+e});this[0].style.zIndex=n+t.length}}});e.ui.plugin.add("draggable","zIndex",{start:function(t,n){t=e(n.helper);n=e(this).data("draggable").options;if(t.css("zIndex"))n._zIndex=t.css("zIndex");t.css("zIndex",n.zIndex)},stop:function(t,n){t=e(this).data("draggable").options;t._zIndex&&e(n.helper).css("zIndex",t._zIndex)}})})(jQuery);(function(e){e.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0;this.isout=1;this.accept=e.isFunction(n)?n:function(e){return e.is(n)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[];e.ui.ddmanager.droppables[t.scope].push(this);t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(t,n){if(t=="accept")this.accept=e.isFunction(n)?n:function(e){return e.is(n)};e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass);n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!(!n||(n.currentItem||n.element)[0]==this.element[0]))if(this.accept.call(this.element[0],n.currentItem||n.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);this._trigger("over",t,this.ui(n))}},_out:function(t){var n=e.ui.ddmanager.current;if(!(!n||(n.currentItem||n.element)[0]==this.element[0]))if(this.accept.call(this.element[0],n.currentItem||n.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",t,this.ui(n))}},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return false;var i=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)){i=true;return false}});if(i)return false;if(this.accept.call(this.element[0],r.currentItem||r.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",t,this.ui(r));return this.element}return false},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}});e.extend(e.ui.droppable,{version:"1.8.16"});e.ui.intersect=function(t,n,r){if(!n.offset)return false;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":return e.ui.isOver((t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,l,a,n.proportions.height,n.proportions.width);case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return false}};e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf(),o=0;e:for(;o<r.length;o++)if(!(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))){for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none";if(r[o].visible){i=="mousedown"&&r[o]._activate.call(r[o],n);r[o].offset=r[o].element.offset();r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}}},drop:function(t,n){var r=false;e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options){if(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance))r=r||this._drop.call(this,n);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)){this.isout=1;this.isover=0;this._deactivate.call(this,n)}}});return r},dragStart:function(t,n){t.element.parents(":not(body,html)").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n);e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var r=e.ui.intersect(t,this,this.options.tolerance);if(r=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null){var i;if(this.options.greedy){var s=this.element.parents(":data(droppable):eq(0)");if(s.length){i=e.data(s[0],"droppable");i.greedyChild=r=="isover"?1:0}}if(i&&r=="isover"){i.isover=0;i.isout=1;i._out.call(i,n)}this[r]=1;this[r=="isout"?"isover":"isout"]=0;this[r=="isover"?"_over":"_out"].call(this,n);if(i&&r=="isout"){i.isout=0;i.isover=1;i._over.call(i,n)}}}})},dragStop:function(t,n){t.element.parents(":not(body,html)").unbind("scroll.droppable");t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}})(jQuery);(function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,n=this.options;this.element.addClass("ui-resizable");e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){/relative/.test(this.element.css("position"))&&e.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"});this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=n.handles||(!e(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all")this.handles="n,e,s,w,se,sw,ne,nw";var r=this.handles.split(",");this.handles={};for(var i=0;i<r.length;i++){var s=e.trim(r[i]),o=e('<div class="ui-resizable-handle '+("ui-resizable-"+s)+'"></div>');/sw|se|ne|nw/.test(s)&&o.css({zIndex:++n.zIndex});"se"==s&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[s]=".ui-resizable-"+s;this.element.append(o)}}this._renderAxis=function(t){t=t||this.element;for(var n in this.handles){if(this.handles[n].constructor==String)this.handles[n]=e(this.handles[n],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=e(this.handles[n],this.element),i=0;i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth();r=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join("");t.css(r,i);this._proportionallyResize()}e(this.handles[n])}};this._renderAxis(this.element);this._handles=e(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}});if(n.autoHide){this._handles.hide();e(this.element).addClass("ui-resizable-autohide").hover(function(){if(!n.disabled){e(this).removeClass("ui-resizable-autohide");t._handles.show()}},function(){if(!n.disabled)if(!t.resizing){e(this).addClass("ui-resizable-autohide");t._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var n=this.element;n.after(this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);t(this.originalElement);return this},_mouseCapture:function(t){var n=false;for(var r in this.handles)if(e(this.handles[r])[0]==t.target)n=true;return!this.options.disabled&&n},_mouseStart:function(n){var r=this.options,i=this.element.position(),s=this.element;this.resizing=true;this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()};if(s.is(".ui-draggable")||/absolute/.test(s.css("position")))s.css({position:"absolute",top:i.top,left:i.left});e.browser.opera&&/relative/.test(s.css("position"))&&s.css({position:"relative",top:"auto",left:"auto"});this._renderProxy();i=t(this.helper.css("left"));var o=t(this.helper.css("top"));if(r.containment){i+=e(r.containment).scrollLeft()||0;o+=e(r.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:i,top:o};this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()};this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()};this.originalPosition={left:i,top:o};this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()};this.originalMousePosition={left:n.pageX,top:n.pageY};this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1;r=e(".ui-resizable-"+this.axis).css("cursor");e("body").css("cursor",r=="auto"?this.axis+"-resize":r);s.addClass("ui-resizable-resizing");this._propagate("start",n);return true},_mouseDrag:function(e){var t=this.helper,n=this.originalMousePosition,r=this._change[this.axis];if(!r)return false;n=r.apply(this,[e,e.pageX-n.left||0,e.pageY-n.top||0]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)n=this._updateRatio(n,e);n=this._respectSize(n,e);this._propagate("resize",e);t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(n);this._trigger("resize",e,this.ui());return false},_mouseStop:function(t){this.resizing=false;var n=this.options,r=this;if(this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName);i=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height;s=s?0:r.sizeDiff.width;s={width:r.helper.width()-s,height:r.helper.height()-i};i=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null;var o=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;n.animate||this.element.css(e.extend(s,{top:o,left:i}));r.helper.height(r.size.height);r.helper.width(r.size.width);this._helper&&!n.animate&&this._proportionallyResize()}e("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",t);this._helper&&this.helper.remove();return false},_updateVirtualBoundaries:function(e){var t=this.options,r,i,s;t={minWidth:n(t.minWidth)?t.minWidth:0,maxWidth:n(t.maxWidth)?t.maxWidth:Infinity,minHeight:n(t.minHeight)?t.minHeight:0,maxHeight:n(t.maxHeight)?t.maxHeight:Infinity};if(this._aspectRatio||e){e=t.minHeight*this.aspectRatio;i=t.minWidth/this.aspectRatio;r=t.maxHeight*this.aspectRatio;s=t.maxWidth/this.aspectRatio;if(e>t.minWidth)t.minWidth=e;if(i>t.minHeight)t.minHeight=i;if(r<t.maxWidth)t.maxWidth=r;if(s<t.maxHeight)t.maxHeight=s}this._vBoundaries=t},_updateCache:function(e){this.offset=this.helper.offset();if(n(e.left))this.position.left=e.left;if(n(e.top))this.position.top=e.top;if(n(e.height))this.size.height=e.height;if(n(e.width))this.size.width=e.width},_updateRatio:function(e){var t=this.position,r=this.size,i=this.axis;if(n(e.height))e.width=e.height*this.aspectRatio;else if(n(e.width))e.height=e.width/this.aspectRatio;if(i=="sw"){e.left=t.left+(r.width-e.width);e.top=null}if(i=="nw"){e.top=t.top+(r.height-e.height);e.left=t.left+(r.width-e.width)}return e},_respectSize:function(e){var t=this._vBoundaries,r=this.axis,i=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,s=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=n(e.width)&&t.minWidth&&t.minWidth>e.width,u=n(e.height)&&t.minHeight&&t.minHeight>e.height;if(o)e.width=t.minWidth;if(u)e.height=t.minHeight;if(i)e.width=t.maxWidth;if(s)e.height=t.maxHeight;var a=this.originalPosition.left+this.originalSize.width,f=this.position.top+this.size.height,l=/sw|nw|w/.test(r);r=/nw|ne|n/.test(r);if(o&&l)e.left=a-t.minWidth;if(i&&l)e.left=a-t.maxWidth;if(u&&r)e.top=f-t.minHeight;if(s&&r)e.top=f-t.maxHeight;if((t=!e.width&&!e.height)&&!e.left&&e.top)e.top=null;else if(t&&!e.top&&e.left)e.left=null;return e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t=this.helper||this.element,n=0;n<this._proportionallyResizeElements.length;n++){var r=this._proportionallyResizeElements[n];if(!this.borderDif){var i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],s=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")];this.borderDif=e.map(i,function(e,t){e=parseInt(e,10)||0;t=parseInt(s[t],10)||0;return e+t})}e.browser.msie&&(e(t).is(":hidden")||e(t).parents(":hidden").length)||r.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.browser.msie&&e.browser.version<7,r=n?1:0;n=n?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+n,height:this.element.outerHeight()+n,position:"absolute",left:this.elementOffset.left-r+"px",top:this.elementOffset.top-r+"px",zIndex:++t.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){return{left:this.originalPosition.left+t,width:this.originalSize.width-t}},n:function(e,t,n){return{top:this.originalPosition.top+n,height:this.originalSize.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]);t!="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});e.extend(e.ui.resizable,{version:"1.8.16"});e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable").options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10),position:t.css("position")})})};if(typeof t.alsoResize=="object"&&!t.alsoResize.parentNode)if(t.alsoResize.length){t.alsoResize=t.alsoResize[0];n(t.alsoResize)}else e.each(t.alsoResize,function(e){n(e)});else n(t.alsoResize)},resize:function(t,n){var r=e(this).data("resizable");t=r.options;var i=r.originalSize,s=r.originalPosition,o={height:r.size.height-i.height||0,width:r.size.width-i.width||0,top:r.position.top-s.top||0,left:r.position.left-s.left||0},u=function(t,i){e(t).each(function(){var t=e(this),s=e(this).data("resizable-alsoresize"),u={},f=i&&i.length?i:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(f,function(e,t){if((e=(s[t]||0)+(o[t]||0))&&e>=0)u[t]=e||null});if(e.browser.opera&&/relative/.test(t.css("position"))){r._revertToRelativePosition=true;t.css({position:"absolute",top:"auto",left:"auto"})}t.css(u)})};typeof t.alsoResize=="object"&&!t.alsoResize.nodeType?e.each(t.alsoResize,function(e,t){u(e,t)}):u(t.alsoResize)},stop:function(){var t=e(this).data("resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.css({position:t.data("resizable-alsoresize").position})})};if(t._revertToRelativePosition){t._revertToRelativePosition=false;typeof n.alsoResize=="object"&&!n.alsoResize.nodeType?e.each(n.alsoResize,function(e){r(e)}):r(n.alsoResize)}e(this).removeData("resizable-alsoresize")}});e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height;s={width:n.size.width-(s?0:n.sizeDiff.width),height:n.size.height-o};o=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null;var u=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(s,u&&o?{top:u,left:o}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height});n._updateCache(r);n._propagate("resize",t)}})}});e.ui.plugin.add("resizable","containment",{start:function(){var n=e(this).data("resizable"),r=n.element,i=n.options.containment;if(r=i instanceof e?i.get(0):/parent/.test(i)?r.parent().get(0):i){n.containerElement=e(r);if(/document/.test(i)||i==document){n.containerOffset={left:0,top:0};n.containerPosition={left:0,top:0};n.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}}else{var s=e(r),o=[];e(["Top","Right","Left","Bottom"]).each(function(e,n){o[e]=t(s.css("padding"+n))});n.containerOffset=s.offset();n.containerPosition=s.position();n.containerSize={height:s.innerHeight()-o[3],width:s.innerWidth()-o[1]};i=n.containerOffset;var u=n.containerSize.height,a=n.containerSize.width;a=e.ui.hasScroll(r,"left")?r.scrollWidth:a;u=e.ui.hasScroll(r)?r.scrollHeight:u;n.parentData={element:r,left:i.left,top:i.top,width:a,height:u}}}},resize:function(t){var n=e(this).data("resizable"),r=n.options,i=n.containerOffset,s=n.position;t=n._aspectRatio||t.shiftKey;var o={top:0,left:0},u=n.containerElement;if(u[0]!=document&&/static/.test(u.css("position")))o=i;if(s.left<(n._helper?i.left:0)){n.size.width+=n._helper?n.position.left-i.left:n.position.left-o.left;if(t)n.size.height=n.size.width/r.aspectRatio;n.position.left=r.helper?i.left:0}if(s.top<(n._helper?i.top:0)){n.size.height+=n._helper?n.position.top-i.top:n.position.top;if(t)n.size.width=n.size.height*r.aspectRatio;n.position.top=n._helper?i.top:0}n.offset.left=n.parentData.left+n.position.left;n.offset.top=n.parentData.top+n.position.top;r=Math.abs((n._helper?n.offset.left-o.left:n.offset.left-o.left)+n.sizeDiff.width);i=Math.abs((n._helper?n.offset.top-o.top:n.offset.top-i.top)+n.sizeDiff.height);s=n.containerElement.get(0)==n.element.parent().get(0);o=/relative|absolute/.test(n.containerElement.css("position"));if(s&&o)r-=n.parentData.left;if(r+n.size.width>=n.parentData.width){n.size.width=n.parentData.width-r;if(t)n.size.height=n.size.width/n.aspectRatio}if(i+n.size.height>=n.parentData.height){n.size.height=n.parentData.height-i;if(t)n.size.width=n.size.height*n.aspectRatio}},stop:function(){var t=e(this).data("resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width;o=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:o});t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:o})}});e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone();t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof n.ghost=="string"?n.ghost:"");t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}});e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis;n.grid=typeof n.grid=="number"?[n.grid,n.grid]:n.grid;var u=Math.round((r.width-i.width)/(n.grid[0]||1))*(n.grid[0]||1);n=Math.round((r.height-i.height)/(n.grid[1]||1))*(n.grid[1]||1);if(/^(se|s|e)$/.test(o)){t.size.width=i.width+u;t.size.height=i.height+n}else if(/^(ne)$/.test(o)){t.size.width=i.width+u;t.size.height=i.height+n;t.position.top=s.top-n}else{if(/^(sw)$/.test(o)){t.size.width=i.width+u;t.size.height=i.height+n}else{t.size.width=i.width+u;t.size.height=i.height+n;t.position.top=s.top-n}t.position.left=s.left-u}}});var t=function(e){return parseInt(e,10)||0},n=function(e){return!isNaN(parseInt(e,10))}})(jQuery);(function(e){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable");this.dragged=false;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]);n.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:false,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})};this.refresh();this.selectees=n.addClass("ui-selectee");this._mouseInit();this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(!this.options.disabled){var r=this.options;this.selectees=e(r.filter,this.element[0]);this._trigger("start",t);e(r.appendTo).append(this.helper);this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0});r.autoRefresh&&this.refresh();this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=true;if(!t.metaKey){r.$element.removeClass("ui-selected");r.selected=false;r.$element.addClass("ui-unselecting");r.unselecting=true;n._trigger("unselecting",t,{unselecting:r.element})}});e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey||!r.$element.hasClass("ui-selected");r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting");r.unselecting=!i;r.selecting=i;(r.selected=i)?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element});return false}})}},_mouseDrag:function(t){var n=this;this.dragged=true;if(!this.options.disabled){var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;if(i>o){var a=o;o=i;i=a}if(s>u){a=u;u=s;s=a}this.helper.css({left:i,top:s,width:o-i,height:u-s});this.selectees.each(function(){var a=e.data(this,"selectable-item");if(!(!a||a.element==n.element[0])){var l=false;if(r.tolerance=="touch")l=!(a.left>o||a.right<i||a.top>u||a.bottom<s);else if(r.tolerance=="fit")l=a.left>i&&a.right<o&&a.top>s&&a.bottom<u;if(l){if(a.selected){a.$element.removeClass("ui-selected");a.selected=false}if(a.unselecting){a.$element.removeClass("ui-unselecting");a.unselecting=false}if(!a.selecting){a.$element.addClass("ui-selecting");a.selecting=true;n._trigger("selecting",t,{selecting:a.element})}}else{if(a.selecting)if(t.metaKey&&a.startselected){a.$element.removeClass("ui-selecting");a.selecting=false;a.$element.addClass("ui-selected");a.selected=true}else{a.$element.removeClass("ui-selecting");a.selecting=false;if(a.startselected){a.$element.addClass("ui-unselecting");a.unselecting=true}n._trigger("unselecting",t,{unselecting:a.element})}if(a.selected)if(!t.metaKey&&!a.startselected){a.$element.removeClass("ui-selected");a.selected=false;a.$element.addClass("ui-unselecting");a.unselecting=true;n._trigger("unselecting",t,{unselecting:a.element})}}}});return false}},_mouseStop:function(t){var n=this;this.dragged=false;e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting");r.unselecting=false;r.startselected=false;n._trigger("unselected",t,{unselected:r.element})});e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected");r.selecting=false;r.selected=true;r.startselected=true;n._trigger("selected",t,{selected:r.element})});this._trigger("stop",t);this.helper.remove();return false}});e.extend(e.ui.selectable,{version:"1.8.16"})})(jQuery);(function(e){e.widget("ui.sortable",e.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData("sortable-item");return this},_setOption:function(t,n){if(t==="disabled"){this.options[t]=n;this.widget()[n?"addClass":"removeClass"]("ui-sortable-disabled")}else e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){if(this.reverting)return false;if(this.options.disabled||this.options.type=="static")return false;this._refreshItems(t);var r=null,i=this;e(t.target).parents().each(function(){if(e.data(this,"sortable-item")==i){r=e(this);return false}});if(e.data(t.target,"sortable-item")==i)r=e(t.target);if(!r)return false;if(this.options.handle&&!n){var s=false;e(this.options.handle,r).find("*").andSelf().each(function(){if(this==t.target)s=true});if(!s)return false}this.currentItem=r;this._removeCurrentsFromItems();return true},_mouseStart:function(t,n,r){n=this.options;var i=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(t);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(t);this.originalPageX=t.pageX;this.originalPageY=t.pageY;n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};this.helper[0]!=this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();n.containment&&this._setContainment();if(n.cursor){if(e("body").css("cursor"))this._storedCursor=e("body").css("cursor");e("body").css("cursor",n.cursor)}if(n.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",n.opacity)}if(n.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",n.zIndex)}if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML")this.overflowOffset=this.scrollParent.offset();this._trigger("start",t,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,i._uiHash(this));if(e.ui.ddmanager)e.ui.ddmanager.current=this;e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(t);return true},_mouseDrag:function(t){this.position=this._generatePosition(t);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs)this.lastPositionAbs=this.positionAbs;if(this.options.scroll){var n=this.options,r=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity)this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed;else if(t.pageY-this.overflowOffset.top<n.scrollSensitivity)this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity)this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed;else if(t.pageX-this.overflowOffset.left<n.scrollSensitivity)this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed}else{if(t.pageY-e(document).scrollTop()<n.scrollSensitivity)r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed);else if(e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity)r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed);if(t.pageX-e(document).scrollLeft()<n.scrollSensitivity)r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed);else if(e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity)r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)}r!==false&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(n=this.items.length-1;n>=0;n--){r=this.items[n];var i=r.item[0],s=this._intersectsWithPointer(r);if(s)if(i!=this.currentItem[0]&&this.placeholder[s==1?"next":"prev"]()[0]!=i&&!e.ui.contains(this.placeholder[0],i)&&(this.options.type=="semi-dynamic"?!e.ui.contains(this.element[0],i):true)){this.direction=s==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(r))this._rearrange(t,r);else break;this._trigger("change",t,this._uiHash());break}}this._contactContainers(t);e.ui.ddmanager&&e.ui.ddmanager.drag(this,t);this._trigger("sort",t,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(t,n){if(t){e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this;n=r.placeholder.offset();r.reverting=true;e(this.helper).animate({left:n.left-this.offset.parent.left-r.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:n.top-this.offset.parent.top-r.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return false}},cancel:function(){var t=this;if(this.dragging){this._mouseUp({target:null});this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var n=this.containers.length-1;n>=0;n--){this.containers[n]._trigger("deactivate",null,t._uiHash(this));if(this.containers[n].containerCache.over){this.containers[n]._trigger("out",null,t._uiHash(this));this.containers[n].containerCache.over=0}}}if(this.placeholder){this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove();e.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)}return this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];t=t||{};e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);if(n)r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))});!r.length&&t.key&&r.push(t.key+"=");return r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];t=t||{};n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")});return r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left;f=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?f:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height);t=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width);n=n&&t;t=this._getDragVerticalDirection();var r=this._getDragHorizontalDirection();if(!n)return false;return this.floating?r&&r=="right"||t=="down"?2:1:t&&(t=="down"?2:1)},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height);t=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width);var r=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?i=="right"&&t||i=="left"&&!t:r&&(r=="down"&&n||r=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){this._refreshItems(e);this.refreshPositions();return this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t)for(t=i.length-1;t>=0;t--)for(var s=e(i[t]),o=s.length-1;o>=0;o--){var u=e.data(s[o],"sortable");if(u&&u!=this&&!u.options.disabled)r.push([e.isFunction(u.options.items)?u.options.items.call(u.element):e(u.options.items,u.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),u])}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(t=r.length-1;t>=0;t--)r[t][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){for(var e=this.currentItem.find(":data(sortable-item)"),t=0;t<this.items.length;t++)for(var n=0;n<e.length;n++)e[n]==this.items[t].item[0]&&this.items.splice(t,1)},_refreshItems:function(t){this.items=[];this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i)for(var s=i.length-1;s>=0;s--)for(var o=e(i[s]),u=o.length-1;u>=0;u--){var a=e.data(o[u],"sortable");if(a&&a!=this&&!a.options.disabled){r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]);this.containers.push(a)}}for(s=r.length-1;s>=0;s--){t=r[s][1];i=r[s][0];u=0;for(o=i.length;u<o;u++){a=e(i[u]);a.data("sortable-item",t);n.push({item:a,instance:t,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){if(this.offsetParent&&this.helper)this.offset.parent=this._getParentOffset();for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(!(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])){var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;if(!t){r.width=i.outerWidth();r.height=i.outerHeight()}i=i.offset();r.left=i.left;r.top=i.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--){i=this.containers[n].element.offset();this.containers[n].containerCache.left=i.left;this.containers[n].containerCache.top=i.top;this.containers[n].containerCache.width=this.containers[n].element.outerWidth();this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(t){var n=t||this,r=n.options;if(!r.placeholder||r.placeholder.constructor==String){var i=r.placeholder;r.placeholder={element:function(){var t=e(document.createElement(n.currentItem[0].nodeName)).addClass(i||n.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!i)t.style.visibility="hidden";return t},update:function(e,t){if(!(i&&!r.forcePlaceholderSize)){t.height()||t.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10));t.width()||t.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10))}}}}n.placeholder=e(r.placeholder.element.call(n.element,n.currentItem));n.currentItem.after(n.placeholder);r.placeholder.update(n,n.placeholder)},_contactContainers:function(t){for(var n=null,r=null,i=this.containers.length-1;i>=0;i--)if(!e.ui.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(!(n&&e.ui.contains(this.containers[i].element[0],n.element[0]))){n=this.containers[i];r=i}}else if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",t,this._uiHash(this));this.containers[i].containerCache.over=0}if(n)if(this.containers.length===1){this.containers[r]._trigger("over",t,this._uiHash(this));this.containers[r].containerCache.over=1}else if(this.currentContainer!=this.containers[r]){n=1e4;i=null;for(var s=this.positionAbs[this.containers[r].floating?"left":"top"],o=this.items.length-1;o>=0;o--)if(e.ui.contains(this.containers[r].element[0],this.items[o].item[0])){var u=this.items[o][this.containers[r].floating?"left":"top"];if(Math.abs(u-s)<n){n=Math.abs(u-s);i=this.items[o]}}if(i||this.options.dropOnEmpty){this.currentContainer=this.containers[r];i?this._rearrange(t,i,null,true):this._rearrange(t,null,this.containers[r].element,true);this._trigger("change",t,this._uiHash());this.containers[r]._trigger("change",t,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[r]._trigger("over",t,this._uiHash(this));this.containers[r].containerCache.over=1}}},_createHelper:function(t){var n=this.options;t=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;t.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(t[0]);if(t[0]==this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(t[0].style.width==""||n.forceHelperSize)t.width(this.currentItem.width());if(t[0].style.height==""||n.forceHelperSize)t.height(this.currentItem.height());return t},_adjustOffsetFromHelper:function(t){if(typeof t=="string")t=t.split(" ");if(e.isArray(t))t={left:+t[0],top:+t[1]||0};if("left"in t)this.offset.click.left=t.left+this.margins.left;if("right"in t)this.offset.click.left=this.helperProportions.width-t.right+this.margins.left;if("top"in t)this.offset.click.top=t.top+this.margins.top;if("bottom"in t)this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(t.containment=="parent")t.containment=this.helper[0].parentNode;if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0];t=e(t.containment).offset();var r=e(n).css("overflow")!="hidden";this.containment=[t.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,t.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,t.left+(r?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,t.top+(r?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){if(!n)n=this.position;t=t=="absolute"?1:-1;var r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName);return{top:n.top+this.offset.relative.top*t+this.offset.parent.top*t-(e.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop())*t),left:n.left+this.offset.relative.left*t+this.offset.parent.left*t-(e.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())*t)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]))this.offset.relative=this._getRelativeOffset();var s=t.pageX,o=t.pageY;if(this.originalPosition){if(this.containment){if(t.pageX-this.offset.click.left<this.containment[0])s=this.containment[0]+this.offset.click.left;if(t.pageY-this.offset.click.top<this.containment[1])o=this.containment[1]+this.offset.click.top;if(t.pageX-this.offset.click.left>this.containment[2])s=this.containment[2]+this.offset.click.left;if(t.pageY-this.offset.click.top>this.containment[3])o=this.containment[3]+this.offset.click.top}if(n.grid){o=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?!(o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3])?o:!(o-this.offset.click.top<this.containment[1])?o-n.grid[1]:o+n.grid[1]:o;s=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?!(s-this.offset.click.left<this.containment[0]||s-this.offset.click.left>this.containment[2])?s:!(s-this.offset.click.left<this.containment[0])?s-n.grid[0]:s+n.grid[0]:s}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var i=this,s=this.counter;window.setTimeout(function(){s==i.counter&&i.refreshPositions(!r)},0)},_clear:function(t,n){this.reverting=false;var r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n)r.push(function(e){this._trigger("update",e,this._uiHash())});if(!e.ui.contains(this.element[0],this.currentItem[0])){n||r.push(function(e){this._trigger("remove",e,this._uiHash())});for(i=this.containers.length-1;i>=0;i--)if(e.ui.contains(this.containers[i].element[0],this.currentItem[0])&&!n){r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.containers[i]));r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.containers[i]))}}for(i=this.containers.length-1;i>=0;i--){n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i]));if(this.containers[i].containerCache.over){r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i]));this.containers[i].containerCache.over=0}}this._storedCursor&&e("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return false}n||this._trigger("beforeStop",t,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!=this.currentItem[0]&&this.helper.remove();this.helper=null;if(!n){for(i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===false&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}});e.extend(e.ui.sortable,{version:"1.8.16"})})(jQuery);(function(e){e.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var t=this,n=t.options;t.running=0;t.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");t.headers=t.element.find(n.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){n.disabled||e(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){n.disabled||e(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){n.disabled||e(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){n.disabled||e(this).removeClass("ui-state-focus")});t.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(n.navigation){var r=t.element.find("a").filter(n.navigationFilter).eq(0);if(r.length){var i=r.closest(".ui-accordion-header");t.active=i.length?i:r.closest(".ui-accordion-content").prev()}}t.active=t._findActive(t.active||n.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");t.active.next().addClass("ui-accordion-content-active");t._createIcons();t.resize();t.element.attr("role","tablist");t.headers.attr("role","tab").bind("keydown.accordion",function(e){return t._keydown(e)}).next().attr("role","tabpanel");t.headers.not(t.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();t.active.length?t.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):t.headers.eq(0).attr("tabIndex",0);e.browser.safari||t.headers.find("a").attr("tabIndex",-1);n.event&&t.headers.bind(n.event.split(" ").join(".accordion ")+".accordion",function(e){t._clickHandler.call(t,e,this);e.preventDefault()})},_createIcons:function(){var t=this.options;if(t.icons){e("<span></span>").addClass("ui-icon "+t.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(t.icons.header).toggleClass(t.icons.headerSelected);this.element.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var t=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var n=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(t.autoHeight||t.fillHeight)n.css("height","");return e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments);t=="active"&&this.activate(n);if(t=="icons"){this._destroyIcons();n&&this._createIcons()}if(t=="disabled")this.headers.add(this.headers.next())[n?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(t){if(!(this.options.disabled||t.altKey||t.ctrlKey)){var n=e.ui.keyCode,r=this.headers.length,i=this.headers.index(t.target),s=false;switch(t.keyCode){case n.RIGHT:case n.DOWN:s=this.headers[(i+1)%r];break;case n.LEFT:case n.UP:s=this.headers[(i-1+r)%r];break;case n.SPACE:case n.ENTER:this._clickHandler({target:t.target},t.target);t.preventDefault()}if(s){e(t.target).attr("tabIndex",-1);e(s).attr("tabIndex",0);s.focus();return false}return true}},resize:function(){var t=this.options,n;if(t.fillSpace){if(e.browser.msie){var r=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}n=this.element.parent().height();e.browser.msie&&this.element.parent().css("overflow",r);this.headers.each(function(){n-=e(this).outerHeight(true)});this.headers.next().each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else if(t.autoHeight){n=0;this.headers.next().each(function(){n=Math.max(n,e(this).height("").height())}).height(n)}return this},activate:function(e){this.options.active=e;e=this._findActive(e)[0];this._clickHandler({target:e},e);return this},_findActive:function(t){return t?typeof t==="number"?this.headers.filter(":eq("+t+")"):this.headers.not(this.headers.not(t)):t===false?e([]):this.headers.filter(":eq(0)")},_clickHandler:function(t,n){var r=this.options;if(!r.disabled)if(t.target){t=e(t.currentTarget||n);n=t[0]===this.active[0];r.active=r.collapsible&&n?false:this.headers.index(t);if(!(this.running||!r.collapsible&&n)){var i=this.active;a=t.next();o=this.active.next();u={options:r,newHeader:n&&r.collapsible?e([]):t,oldHeader:this.active,newContent:n&&r.collapsible?e([]):a,oldContent:o};var s=this.headers.index(this.active[0])>this.headers.index(t[0]);this.active=n?e([]):t;this._toggle(a,o,u,n,s);i.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(r.icons.headerSelected).addClass(r.icons.header);if(!n){t.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(r.icons.header).addClass(r.icons.headerSelected);t.next().addClass("ui-accordion-content-active")}}}else if(r.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(r.icons.headerSelected).addClass(r.icons.header);this.active.next().addClass("ui-accordion-content-active");var o=this.active.next(),u={options:r,newHeader:e([]),oldHeader:r.active,newContent:e([]),oldContent:o},a=this.active=e([]);this._toggle(a,o,u)}},_toggle:function(t,n,r,i,s){var o=this,u=o.options;o.toShow=t;o.toHide=n;o.data=r;var a=function(){if(o)return o._completed.apply(o,arguments)};o._trigger("changestart",null,o.data);o.running=n.size()===0?t.size():n.size();if(u.animated){r={};r=u.collapsible&&i?{toShow:e([]),toHide:n,complete:a,down:s,autoHeight:u.autoHeight||u.fillSpace}:{toShow:t,toHide:n,complete:a,down:s,autoHeight:u.autoHeight||u.fillSpace};if(!u.proxied)u.proxied=u.animated;if(!u.proxiedDuration)u.proxiedDuration=u.duration;u.animated=e.isFunction(u.proxied)?u.proxied(r):u.proxied;u.duration=e.isFunction(u.proxiedDuration)?u.proxiedDuration(r):u.proxiedDuration;i=e.ui.accordion.animations;var f=u.duration,l=u.animated;if(l&&!i[l]&&!e.easing[l])l="slide";i[l]||(i[l]=function(e){this.slide(e,{easing:l,duration:f||700})});i[l](r)}else{if(u.collapsible&&i)t.toggle();else{n.hide();t.show()}a(true)}n.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur();t.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(e){this.running=e?0:--this.running;if(!this.running){this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""});this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length)this.toHide.parent()[0].className=this.toHide.parent()[0].className;this._trigger("change",null,this.data)}}});e.extend(e.ui.accordion,{version:"1.8.16",animations:{slide:function(t,n){t=e.extend({easing:"swing",duration:300},t,n);if(t.toHide.size())if(t.toShow.size()){var r=t.toShow.css("overflow"),i=0,s={},o={},u;n=t.toShow;u=n[0].style.width;n.width(parseInt(n.parent().width(),10)-parseInt(n.css("paddingLeft"),10)-parseInt(n.css("paddingRight"),10)-(parseInt(n.css("borderLeftWidth"),10)||0)-(parseInt(n.css("borderRightWidth"),10)||0));e.each(["height","paddingTop","paddingBottom"],function(n,r){o[r]="hide";n=(""+e.css(t.toShow[0],r)).match(/^([\d+-.]+)(.*)$/);s[r]={value:n[1],unit:n[2]||"px"}});t.toShow.css({height:0,overflow:"hidden"}).show();t.toHide.filter(":hidden").each(t.complete).end().filter(":visible").animate(o,{step:function(e,n){if(n.prop=="height")i=n.end-n.start===0?0:(n.now-n.start)/(n.end-n.start);t.toShow[0].style[n.prop]=i*s[n.prop].value+s[n.prop].unit},duration:t.duration,easing:t.easing,complete:function(){t.autoHeight||t.toShow.css("height","");t.toShow.css({width:u,overflow:r});t.complete()}})}else t.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},t);else t.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},t)},bounceslide:function(e){this.slide(e,{easing:e.down?"easeOutBounce":"swing",duration:e.down?1e3:200})}}})})(jQuery);(function(e){var t=0;e.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t=this,n=this.element[0].ownerDocument,r;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(!(t.options.disabled||t.element.propAttr("readOnly"))){r=false;var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t._move("previousPage",n);break;case i.PAGE_DOWN:t._move("nextPage",n);break;case i.UP:t._move("previous",n);n.preventDefault();break;case i.DOWN:t._move("next",n);n.preventDefault();break;case i.ENTER:case i.NUMPAD_ENTER:if(t.menu.active){r=true;n.preventDefault()};case i.TAB:if(!t.menu.active)return;t.menu.select(n);break;case i.ESCAPE:t.element.val(t.term);t.close(n);break;default:clearTimeout(t.searching);t.searching=setTimeout(function(){if(t.term!=t.element.val()){t.selectedItem=null;t.search(null,n)}},t.options.delay);break}}}).bind("keypress.autocomplete",function(e){if(r){r=false;e.preventDefault()}}).bind("focus.autocomplete",function(){if(!t.options.disabled){t.selectedItem=null;t.previous=t.element.val()}}).bind("blur.autocomplete",function(e){if(!t.options.disabled){clearTimeout(t.searching);t.closing=setTimeout(function(){t.close(e);t._change(e)},150)}});this._initSource();this.response=function(){return t._response.apply(t,arguments)};this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(n){var r=t.menu.element[0];e(n.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(n){n.target!==t.element[0]&&n.target!==r&&!e.ui.contains(r,n.target)&&t.close()})},1);setTimeout(function(){clearTimeout(t.closing)},13)}).menu({focus:function(e,n){n=n.item.data("item.autocomplete");false!==t._trigger("focus",e,{item:n})&&/^key/.test(e.originalEvent.type)&&t.element.val(n.value)},selected:function(e,r){var i=r.item.data("item.autocomplete"),s=t.previous;if(t.element[0]!==n.activeElement){t.element.focus();t.previous=s;setTimeout(function(){t.previous=s;t.selectedItem=i},1)}false!==t._trigger("select",e,{item:i})&&t.element.val(i.value);t.term=t.element.val();t.close(e);t.selectedItem=i},blur:function(){t.menu.element.is(":visible")&&t.element.val()!==t.term&&t.element.val(t.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");e.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments);t==="source"&&this._initSource();if(t==="appendTo")this.menu.element.appendTo(e(n||"body",this.element[0].ownerDocument)[0]);t==="disabled"&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var n=this,r,i;if(e.isArray(this.options.source)){r=this.options.source;this.source=function(t,n){n(e.ui.autocomplete.filter(r,t.term))}}else if(typeof this.options.source==="string"){i=this.options.source;this.source=function(r,s){n.xhr&&n.xhr.abort();n.xhr=e.ajax({url:i,data:r,dataType:"json",autocompleteRequest:++t,success:function(e){this.autocompleteRequest===t&&s(e)},error:function(){this.autocompleteRequest===t&&s([])}})}}else this.source=this.options.source},search:function(e,t){e=e!=null?e:this.element.val();this.term=this.element.val();if(e.length<this.options.minLength)return this.close(t);clearTimeout(this.closing);if(this._trigger("search",t)!==false)return this._search(e)},_search:function(e){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:e},this.response)},_response:function(e){if(!this.options.disabled&&e&&e.length){e=this._normalize(e);this._suggest(e);this._trigger("open")}else this.close();this.pending--;this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(e){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",e)}},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){if(t.length&&t[0].label&&t[0].value)return t;return e.map(t,function(t){if(typeof t==="string")return{label:t,value:t};return e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t);this.menu.deactivate();this.menu.refresh();n.show();this._resizeMenu();n.position(e.extend({of:this.element},this.options.position));this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItem(t,n)})},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>").text(n.label)).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible"))if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)){this.element.val(this.term);this.menu.deactivate()}else this.menu[e](t);else this.search(null,t)},widget:function(){return this.menu.element}});e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}})})(jQuery);(function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(n){if(e(n.target).closest(".ui-menu-item a").length){n.preventDefault();t.select(n)}});this.refresh()},refresh:function(){var t=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(n){t.activate(n,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){this.deactivate();if(this.hasScroll()){var n=t.offset().top-this.element.offset().top,r=this.element.scrollTop(),i=this.element.height();if(n<0)this.element.scrollTop(r+n);else n>=i&&this.element.scrollTop(r+n-i+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",e,{item:t})},deactivate:function(){if(this.active){this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null}},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,n){if(this.active){e=this.active[e+"All"](".ui-menu-item").eq(0);e.length?this.activate(n,e):this.activate(n,this.element.children(t))}else this.activate(n,this.element.children(t))},nextPage:function(t){if(this.hasScroll())if(!this.active||this.last())this.activate(t,this.element.children(".ui-menu-item:first"));else{var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n-r+e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:last"));this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll())if(!this.active||this.first())this.activate(t,this.element.children(".ui-menu-item:last"));else{var n=this.active.offset().top,r=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n+r-e(this).height();return t<10&&t>-10});result.length||(result=this.element.children(".ui-menu-item:first"));this.activate(t,result)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[e.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})})(jQuery);(function(e){var t,n,r,i,s=function(){var t=e(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},o=function(t){var n=t.name,r=t.form,i=e([]);if(n)i=r?e(r).find("[name='"+n+"']"):e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form});return i};e.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",s);if(typeof this.options.disabled!=="boolean")this.options.disabled=this.element.propAttr("disabled");this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var u=this,a=this.options,f=this.type==="checkbox"||this.type==="radio",c="ui-state-hover"+(!f?" ui-state-active":"");if(a.label===null)a.label=this.buttonElement.html();if(this.element.is(":disabled"))a.disabled=true;this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){if(!a.disabled){e(this).addClass("ui-state-hover");this===t&&e(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){a.disabled||e(this).removeClass(c)}).bind("click.button",function(e){if(a.disabled){e.preventDefault();e.stopImmediatePropagation()}});this.element.bind("focus.button",function(){u.buttonElement.addClass("ui-state-focus")}).bind("blur.button",function(){u.buttonElement.removeClass("ui-state-focus")});if(f){this.element.bind("change.button",function(){i||u.refresh()});this.buttonElement.bind("mousedown.button",function(e){if(!a.disabled){i=false;n=e.pageX;r=e.pageY}}).bind("mouseup.button",function(e){if(!a.disabled)if(n!==e.pageX||r!==e.pageY)i=true})}if(this.type==="checkbox")this.buttonElement.bind("click.button",function(){if(a.disabled||i)return false;e(this).toggleClass("ui-state-active");u.buttonElement.attr("aria-pressed",u.element[0].checked)});else if(this.type==="radio")this.buttonElement.bind("click.button",function(){if(a.disabled||i)return false;e(this).addClass("ui-state-active");u.buttonElement.attr("aria-pressed","true");var t=u.element[0];o(t).not(t).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")});else{this.buttonElement.bind("mousedown.button",function(){if(a.disabled)return false;e(this).addClass("ui-state-active");t=this;e(document).one("mouseup",function(){t=null})}).bind("mouseup.button",function(){if(a.disabled)return false;e(this).removeClass("ui-state-active")}).bind("keydown.button",function(t){if(a.disabled)return false;if(t.keyCode==e.ui.keyCode.SPACE||t.keyCode==e.ui.keyCode.ENTER)e(this).addClass("ui-state-active")}).bind("keyup.button",function(){e(this).removeClass("ui-state-active")});this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})}this._setOption("disabled",a.disabled);this._resetButton()},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type==="radio"){var e=this.element.parents().filter(":last"),t="label[for='"+this.element.attr("id")+"']";this.buttonElement=e.find(t);if(!this.buttonElement.length){e=e.length?e.siblings():this.element.siblings();this.buttonElement=e.filter(t);if(!this.buttonElement.length)this.buttonElement=e.find(t)}this.element.addClass("ui-helper-hidden-accessible");(e=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",e)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||this.buttonElement.removeAttr("title");e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments);if(t==="disabled")n?this.element.propAttr("disabled",true):this.element.propAttr("disabled",false);else this._resetButton()},refresh:function(){var t=this.element.is(":disabled");t!==this.options.disabled&&this._setOption("disabled",t);if(this.type==="radio")o(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")});else if(this.type==="checkbox")this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false")},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var t=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),n=e("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary,s=[];if(r.primary||r.secondary){if(this.options.text)s.push("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary"));r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>");r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>");if(!this.options.text){s.push(i?"ui-button-icons-only":"ui-button-icon-only");this.hasTitle||t.attr("title",n)}}else s.push("ui-button-text-only");t.addClass(s.join(" "))}}});e.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,n){t==="disabled"&&this.buttons.button("option",t,n);e.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var t=this.element.css("direction")==="ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(t?"ui-corner-right":"ui-corner-left").end().end()},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");e.Widget.prototype.destroy.call(this)}})})(jQuery);(function(e,t){var n={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},r={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},i=e.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};e.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string")this.originalTitle="";this.options.title=this.options.title||this.originalTitle;var t=this,n=t.options,r=n.title||"&#160;",i=e.ui.dialog.getTitleId(t.element),s=(t.uiDialog=e("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+n.dialogClass).css({zIndex:n.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(r){if(n.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===e.ui.keyCode.ESCAPE){t.close(r);r.preventDefault()}}).attr({role:"dialog","aria-labelledby":i}).mousedown(function(e){t.moveToTop(false,e)});t.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s);var o=(t.uiDialogTitlebar=e("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(s),u=e('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){u.addClass("ui-state-hover")},function(){u.removeClass("ui-state-hover")}).focus(function(){u.addClass("ui-state-focus")}).blur(function(){u.removeClass("ui-state-focus")}).click(function(e){t.close(e);return false}).appendTo(o);(t.uiDialogTitlebarCloseText=e("<span></span>")).addClass("ui-icon ui-icon-closethick").text(n.closeText).appendTo(u);e("<span></span>").addClass("ui-dialog-title").attr("id",i).html(r).prependTo(o);if(e.isFunction(n.beforeclose)&&!e.isFunction(n.beforeClose))n.beforeClose=n.beforeclose;o.find("*").add(o).disableSelection();n.draggable&&e.fn.draggable&&t._makeDraggable();n.resizable&&e.fn.resizable&&t._makeResizable();t._createButtons(n.buttons);t._isOpen=false;e.fn.bgiframe&&s.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var e=this;e.overlay&&e.overlay.destroy();e.uiDialog.hide();e.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");e.uiDialog.remove();e.originalTitle&&e.element.attr("title",e.originalTitle);return e},widget:function(){return this.uiDialog},close:function(t){var n=this,r,i;if(false!==n._trigger("beforeClose",t)){n.overlay&&n.overlay.destroy();n.uiDialog.unbind("keypress.ui-dialog");n._isOpen=false;if(n.options.hide)n.uiDialog.hide(n.options.hide,function(){n._trigger("close",t)});else{n.uiDialog.hide();n._trigger("close",t)}e.ui.dialog.overlay.resize();if(n.options.modal){r=0;e(".ui-dialog").each(function(){if(this!==n.uiDialog[0]){i=e(this).css("z-index");isNaN(i)||(r=Math.max(r,i))}});e.ui.dialog.maxZ=r}return n}},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this,i=r.options;if(i.modal&&!t||!i.stack&&!i.modal)return r._trigger("focus",n);if(i.zIndex>e.ui.dialog.maxZ)e.ui.dialog.maxZ=i.zIndex;if(r.overlay){e.ui.dialog.maxZ+=1;r.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ)}t={scrollTop:r.element.scrollTop(),scrollLeft:r.element.scrollLeft()};e.ui.dialog.maxZ+=1;r.uiDialog.css("z-index",e.ui.dialog.maxZ);r.element.attr(t);r._trigger("focus",n);return r},open:function(){if(!this._isOpen){var t=this,n=t.options,r=t.uiDialog;t.overlay=n.modal?new e.ui.dialog.overlay(t):null;t._size();t._position(n.position);r.show(n.show);t.moveToTop(true);n.modal&&r.bind("keypress.ui-dialog",function(t){if(t.keyCode===e.ui.keyCode.TAB){var n=e(":tabbable",this),r=n.filter(":first");n=n.filter(":last");if(t.target===n[0]&&!t.shiftKey){r.focus(1);return false}else if(t.target===r[0]&&t.shiftKey){n.focus(1);return false}}});e(t.element.find(":tabbable").get().concat(r.find(".ui-dialog-buttonpane :tabbable").get().concat(r.get()))).eq(0).focus();t._isOpen=true;t._trigger("open");return t}},_createButtons:function(t){var n=this,r=false,s=e("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),u=e("<div></div>").addClass("ui-dialog-buttonset").appendTo(s);n.uiDialog.find(".ui-dialog-buttonpane").remove();typeof t==="object"&&t!==null&&e.each(t,function(){return!(r=true)});if(r){e.each(t,function(t,r){r=e.isFunction(r)?{click:r,text:t}:r;var s=e('<button type="button"></button>').click(function(){r.click.apply(n.element[0],arguments)}).appendTo(u);e.each(r,function(e,t){if(e!=="click")e in i?s[e](t):s.attr(e,t)});e.fn.button&&s.button()});s.appendTo(n.uiDialog)}},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var n=this,r=n.options,i=e(document),s;n.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,o){s=r.height==="auto"?"auto":e(this).height();e(this).height(e(this).height()).addClass("ui-dialog-dragging");n._trigger("dragStart",i,t(o))},drag:function(e,r){n._trigger("drag",e,t(r))},stop:function(o,u){r.position=[u.position.left-i.scrollLeft(),u.position.top-i.scrollTop()];e(this).removeClass("ui-dialog-dragging").height(s);n._trigger("dragStop",o,t(u));e.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function r(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}n=n===t?this.options.resizable:n;var i=this,s=i.options,o=i.uiDialog.css("position");n=typeof n==="string"?n:"n,e,s,w,se,sw,ne,nw";i.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:i.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:i._minHeight(),handles:n,start:function(t,n){e(this).addClass("ui-dialog-resizing");i._trigger("resizeStart",t,r(n))},resize:function(e,t){i._trigger("resize",e,r(t))},stop:function(t,n){e(this).removeClass("ui-dialog-resizing");s.height=e(this).height();s.width=e(this).width();i._trigger("resizeStop",t,r(n));e.ui.dialog.overlay.resize()}}).css("position",o).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var n=[],r=[0,0],i;if(t){if(typeof t==="string"||typeof t==="object"&&"0"in t){n=t.split?t.split(" "):[t[0],t[1]];if(n.length===1)n[1]=n[0];e.each(["left","top"],function(e,t){if(+n[e]===n[e]){r[e]=n[e];n[e]=t}});t={my:n.join(" "),at:n.join(" "),offset:r.join(" ")}}t=e.extend({},e.ui.dialog.prototype.options.position,t)}else t=e.ui.dialog.prototype.options.position;(i=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(e.extend({of:window},t));i||this.uiDialog.hide()},_setOptions:function(t){var i=this,s={},o=false;e.each(t,function(e,t){i._setOption(e,t);if(e in n)o=true;if(e in r)s[e]=t});o&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,n){var r=this,i=r.uiDialog;switch(t){case"beforeclose":t="beforeClose";break;case"buttons":r._createButtons(n);break;case"closeText":r.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":i.removeClass(r.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+n);break;case"disabled":n?i.addClass("ui-dialog-disabled"):i.removeClass("ui-dialog-disabled");break;case"draggable":var s=i.is(":data(draggable)");s&&!n&&i.draggable("destroy");!s&&n&&r._makeDraggable();break;case"position":r._position(n);break;case"resizable":(s=i.is(":data(resizable)"))&&!n&&i.resizable("destroy");s&&typeof n==="string"&&i.resizable("option","handles",n);!s&&n!==false&&r._makeResizable(n);break;case"title":e(".ui-dialog-title",r.uiDialogTitlebar).html(""+(n||"&#160;"));break}e.Widget.prototype._setOption.apply(r,arguments)},_size:function(){var t=this.options,n,r,i=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(t.minWidth>t.width)t.width=t.minWidth;n=this.uiDialog.css({height:"auto",width:t.width}).height();r=Math.max(0,t.minHeight-n);if(t.height==="auto")if(e.support.minHeight)this.element.css({minHeight:r,height:"auto"});else{this.uiDialog.show();t=this.element.css("height","auto").height();i||this.uiDialog.hide();this.element.height(Math.max(t,r))}else this.element.height(Math.max(t.height-n,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});e.extend(e.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function(e){e=e.attr("id");if(!e){this.uuid+=1;e=this.uuid}return"ui-dialog-title-"+e},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}});e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){if(this.instances.length===0){setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){if(e(t.target).zIndex()<e.ui.dialog.overlay.maxZ)return false})},1);e(document).bind("keydown.dialog-overlay",function(n){if(t.options.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE){t.close(n);n.preventDefault()}});e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize)}var n=(this.oldInstances.pop()||e("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});e.fn.bgiframe&&n.bgiframe();this.instances.push(n);return n},destroy:function(t){var n=e.inArray(t,this.instances);n!=-1&&this.oldInstances.push(this.instances.splice(n,1)[0]);this.instances.length===0&&e([document,window]).unbind(".dialog-overlay");t.remove();var r=0;e.each(this.instances,function(){r=Math.max(r,this.css("z-index"))});this.maxZ=r},height:function(){var t,n;if(e.browser.msie&&e.browser.version<7){t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return t<n?e(window).height()+"px":t+"px"}else return e(document).height()+"px"},width:function(){var t,n;if(e.browser.msie){t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return t<n?e(window).width()+"px":t+"px"}else return e(document).width()+"px"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)});t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}});e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(e){e.widget("ui.slider",e.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var t=this,n=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),i=n.values&&n.values.length||1,s=[];this._mouseSliding=this._keySliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(n.disabled?" ui-slider-disabled ui-disabled":""));this.range=e([]);if(n.range){if(n.range===true){if(!n.values)n.values=[this._valueMin(),this._valueMin()];if(n.values.length&&n.values.length!==2)n.values=[n.values[0],n.values[0]]}this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(n.range==="min"||n.range==="max"?" ui-slider-range-"+n.range:""))}for(var o=r.length;o<i;o+=1)s.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");this.handles=r.add(e(s.join("")).appendTo(t.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).hover(function(){n.disabled||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).focus(function(){if(n.disabled)e(this).blur();else{e(".ui-slider .ui-state-focus").removeClass("ui-state-focus");e(this).addClass("ui-state-focus")}}).blur(function(){e(this).removeClass("ui-state-focus")});this.handles.each(function(t){e(this).data("index.ui-slider-handle",t)});this.handles.keydown(function(n){var r=true,i=e(this).data("index.ui-slider-handle"),s,o,u;if(!t.options.disabled){switch(n.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:r=false;if(!t._keySliding){t._keySliding=true;e(this).addClass("ui-state-active");s=t._start(n,i);if(s===false)return}break}u=t.options.step;s=t.options.values&&t.options.values.length?o=t.values(i):o=t.value();switch(n.keyCode){case e.ui.keyCode.HOME:o=t._valueMin();break;case e.ui.keyCode.END:o=t._valueMax();break;case e.ui.keyCode.PAGE_UP:o=t._trimAlignValue(s+(t._valueMax()-t._valueMin())/5);break;case e.ui.keyCode.PAGE_DOWN:o=t._trimAlignValue(s-(t._valueMax()-t._valueMin())/5);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===t._valueMax())return;o=t._trimAlignValue(s+u);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===t._valueMin())return;o=t._trimAlignValue(s-u);break}t._slide(n,i,o);return r}}).keyup(function(n){var r=e(this).data("index.ui-slider-handle");if(t._keySliding){t._keySliding=false;t._stop(n,r);t._change(n,r);e(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this},_mouseCapture:function(t){var n=this.options,r,i,s,o,u;if(n.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();r=this._normValueFromMouse({x:t.pageX,y:t.pageY});i=this._valueMax()-this._valueMin()+1;o=this;this.handles.each(function(t){var n=Math.abs(r-o.values(t));if(i>n){i=n;s=e(this);u=t}});if(n.range===true&&this.values(1)===n.min){u+=1;s=e(this.handles[u])}if(this._start(t,u)===false)return false;this._mouseSliding=true;o._handleIndex=u;s.addClass("ui-state-active").focus();n=s.offset();this._clickOffset=!e(t.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:t.pageX-n.left-s.width()/2,top:t.pageY-n.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(t,u,r);return this._animateOff=true},_mouseStart:function(){return true},_mouseDrag:function(e){var t=this._normValueFromMouse({x:e.pageX,y:e.pageY});this._slide(e,this._handleIndex,t);return false},_mouseStop:function(e){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(e,this._handleIndex);this._change(e,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t;if(this.orientation==="horizontal"){t=this.elementSize.width;e=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{t=this.elementSize.height;e=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}t=e/t;if(t>1)t=1;if(t<0)t=0;if(this.orientation==="vertical")t=1-t;e=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+t*e)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){n.value=this.values(t);n.values=this.values()}return this._trigger("start",e,n)},_slide:function(e,t,n){var r;if(this.options.values&&this.options.values.length){r=this.values(t?0:1);if(this.options.values.length===2&&this.options.range===true&&(t===0&&n>r||t===1&&n<r))n=r;if(n!==this.values(t)){r=this.values();r[t]=n;e=this._trigger("slide",e,{handle:this.handles[t],value:n,values:r});this.values(t?0:1);e!==false&&this.values(t,n,true)}}else if(n!==this.value()){e=this._trigger("slide",e,{handle:this.handles[t],value:n});e!==false&&this.value(n)}},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){n.value=this.values(t);n.values=this.values()}this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){n.value=this.values(t);n.values=this.values()}this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e);this._refreshValue();this._change(null,0)}else return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n);this._refreshValue();this._change(null,t)}else if(arguments.length)if(e.isArray(arguments[0])){r=this.options.values;i=arguments[0];for(s=0;s<r.length;s+=1){r[s]=this._trimAlignValue(i[s]);this._change(null,s)}this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(t):this.value();else return this._values()},_setOption:function(t,n){var r,i=0;if(e.isArray(this.options.values))i=this.options.values.length;e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":if(n){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=false;break}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,n;if(arguments.length){t=this.options.values[e];return t=this._trimAlignValue(t)}else{t=this.options.values.slice();for(n=0;n<t.length;n+=1)t[n]=this._trimAlignValue(t[n]);return t}},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t;e=e-n;if(Math.abs(n)*2>=t)e+=n>0?t:-t;return parseFloat(e.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t=this.options.range,n=this.options,r=this,i=!this._animateOff?n.animate:false,s,o={},u,a,f,l;if(this.options.values&&this.options.values.length)this.handles.each(function(t){s=(r.values(t)-r._valueMin())/(r._valueMax()-r._valueMin())*100;o[r.orientation==="horizontal"?"left":"bottom"]=s+"%";e(this).stop(1,1)[i?"animate":"css"](o,n.animate);if(r.options.range===true)if(r.orientation==="horizontal"){if(t===0)r.range.stop(1,1)[i?"animate":"css"]({left:s+"%"},n.animate);if(t===1)r.range[i?"animate":"css"]({width:s-u+"%"},{queue:false,duration:n.animate})}else{if(t===0)r.range.stop(1,1)[i?"animate":"css"]({bottom:s+"%"},n.animate);if(t===1)r.range[i?"animate":"css"]({height:s-u+"%"},{queue:false,duration:n.animate})}u=s});else{a=this.value();f=this._valueMin();l=this._valueMax();s=l!==f?(a-f)/(l-f)*100:0;o[r.orientation==="horizontal"?"left":"bottom"]=s+"%";this.handle.stop(1,1)[i?"animate":"css"](o,n.animate);if(t==="min"&&this.orientation==="horizontal")this.range.stop(1,1)[i?"animate":"css"]({width:s+"%"},n.animate);if(t==="max"&&this.orientation==="horizontal")this.range[i?"animate":"css"]({width:100-s+"%"},{queue:false,duration:n.animate});if(t==="min"&&this.orientation==="vertical")this.range.stop(1,1)[i?"animate":"css"]({height:s+"%"},n.animate);if(t==="max"&&this.orientation==="vertical")this.range[i?"animate":"css"]({height:100-s+"%"},{queue:false,duration:n.animate})}}});e.extend(e.ui.slider,{version:"1.8.16"})})(jQuery);(function(e,n){function r(){return++s}function i(){return++o}var s=0,o=0;e.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true)},_setOption:function(e,t){if(e=="selected")this.options.collapsible&&t==this.options.selected||this.select(t);else{this.options[e]=t;this._tabify()}},_tabId:function(e){return e.title&&e.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+r()},_sanitizeSelector:function(e){return e.replace(/:/g,"\\:")},_cookie:function(){var t=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+i());return e.cookie.apply(null,[t].concat(e.makeArray(arguments)))},_ui:function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var t=e(this);t.html(t.data("label.tabs")).removeData("label.tabs")})},_tabify:function(t){function r(t,n){t.css("display","");!e.support.opacity&&n.opacity&&t[0].style.removeAttribute("filter")}var i=this,s=this.options,o=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=e(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return e("a",this)[0]});this.panels=e([]);this.anchors.each(function(t,n){var r=e(n).attr("href"),u=r.split("#")[0],a;if(u&&(u===location.toString().split("#")[0]||(a=e("base")[0])&&u===a.href)){r=n.hash;n.href=r}if(o.test(r))i.panels=i.panels.add(i.element.find(i._sanitizeSelector(r)));else if(r&&r!=="#"){e.data(n,"href.tabs",r);e.data(n,"load.tabs",r.replace(/#.*$/,""));r=i._tabId(n);n.href="#"+r;n=i.element.find("#"+r);if(!n.length){n=e(s.panelTemplate).attr("id",r).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(i.panels[t-1]||i.list);n.data("destroy.tabs",true)}i.panels=i.panels.add(n)}else s.disabled.push(t)});if(t){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(s.selected===n){location.hash&&this.anchors.each(function(e,t){if(t.hash==location.hash){s.selected=e;return false}});if(typeof s.selected!=="number"&&s.cookie)s.selected=parseInt(i._cookie(),10);if(typeof s.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length)s.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));s.selected=s.selected||(this.lis.length?0:-1)}else if(s.selected===null)s.selected=-1;s.selected=s.selected>=0&&this.anchors[s.selected]||s.selected<0?s.selected:0;s.disabled=e.unique(s.disabled.concat(e.map(this.lis.filter(".ui-state-disabled"),function(e){return i.lis.index(e)}))).sort();e.inArray(s.selected,s.disabled)!=-1&&s.disabled.splice(e.inArray(s.selected,s.disabled),1);this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");if(s.selected>=0&&this.anchors.length){i.element.find(i._sanitizeSelector(i.anchors[s.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(s.selected).addClass("ui-tabs-selected ui-state-active");i.element.queue("tabs",function(){i._trigger("show",null,i._ui(i.anchors[s.selected],i.element.find(i._sanitizeSelector(i.anchors[s.selected].hash))[0]))});this.load(s.selected)}e(window).bind("unload",function(){i.lis.add(i.anchors).unbind(".tabs");i.lis=i.anchors=i.panels=null})}else s.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));this.element[s.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");s.cookie&&this._cookie(s.selected,s.cookie);t=0;for(var u;u=this.lis[t];t++)e(u)[e.inArray(t,s.disabled)!=-1&&!e(u).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");s.cache===false&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if(s.event!=="mouseover"){var a=function(e,t){t.is(":not(.ui-state-disabled)")&&t.addClass("ui-state-"+e)},f=function(e,t){t.removeClass("ui-state-"+e)};this.lis.bind("mouseover.tabs",function(){a("hover",e(this))});this.lis.bind("mouseout.tabs",function(){f("hover",e(this))});this.anchors.bind("focus.tabs",function(){a("focus",e(this).closest("li"))});this.anchors.bind("blur.tabs",function(){f("focus",e(this).closest("li"))})}var l,c;if(s.fx)if(e.isArray(s.fx)){l=s.fx[0];c=s.fx[1]}else l=c=s.fx;var h=c?function(t,n){e(t).closest("li").addClass("ui-tabs-selected ui-state-active");n.hide().removeClass("ui-tabs-hide").animate(c,c.duration||"normal",function(){r(n,c);i._trigger("show",null,i._ui(t,n[0]))})}:function(t,n){e(t).closest("li").addClass("ui-tabs-selected ui-state-active");n.removeClass("ui-tabs-hide");i._trigger("show",null,i._ui(t,n[0]))},v=l?function(e,t){t.animate(l,l.duration||"normal",function(){i.lis.removeClass("ui-tabs-selected ui-state-active");t.addClass("ui-tabs-hide");r(t,l);i.element.dequeue("tabs")})}:function(e,t){i.lis.removeClass("ui-tabs-selected ui-state-active");t.addClass("ui-tabs-hide");i.element.dequeue("tabs")};this.anchors.bind(s.event+".tabs",function(){var t=this,n=e(t).closest("li"),r=i.panels.filter(":not(.ui-tabs-hide)"),o=i.element.find(i._sanitizeSelector(t.hash));if(n.hasClass("ui-tabs-selected")&&!s.collapsible||n.hasClass("ui-state-disabled")||n.hasClass("ui-state-processing")||i.panels.filter(":animated").length||i._trigger("select",null,i._ui(this,o[0]))===false){this.blur();return false}s.selected=i.anchors.index(this);i.abort();if(s.collapsible)if(n.hasClass("ui-tabs-selected")){s.selected=-1;s.cookie&&i._cookie(s.selected,s.cookie);i.element.queue("tabs",function(){v(t,r)}).dequeue("tabs");this.blur();return false}else if(!r.length){s.cookie&&i._cookie(s.selected,s.cookie);i.element.queue("tabs",function(){h(t,o)});i.load(i.anchors.index(this));this.blur();return false}s.cookie&&i._cookie(s.selected,s.cookie);if(o.length){r.length&&i.element.queue("tabs",function(){v(t,r)});i.element.queue("tabs",function(){h(t,o)});i.load(i.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";e.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},_getIndex:function(e){if(typeof e=="string")e=this.anchors.index(this.anchors.filter("[href$="+e+"]"));return e},destroy:function(){var t=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var t=e.data(this,"href.tabs");if(t)this.href=t;var n=e(this).unbind(".tabs");e.each(["href","load","cache"],function(e,t){n.removeData(t+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){e.data(this,"destroy.tabs")?e(this).remove():e(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});t.cookie&&this._cookie(null,t.cookie);return this},add:function(t,r,i){if(i===n)i=this.anchors.length;var s=this,o=this.options;r=e(o.tabTemplate.replace(/#\{href\}/g,t).replace(/#\{label\}/g,r));t=!t.indexOf("#")?t.replace("#",""):this._tabId(e("a",r)[0]);r.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var u=s.element.find("#"+t);u.length||(u=e(o.panelTemplate).attr("id",t).data("destroy.tabs",true));u.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(i>=this.lis.length){r.appendTo(this.list);u.appendTo(this.list[0].parentNode)}else{r.insertBefore(this.lis[i]);u.insertBefore(this.panels[i])}o.disabled=e.map(o.disabled,function(e){return e>=i?++e:e});this._tabify();if(this.anchors.length==1){o.selected=0;r.addClass("ui-tabs-selected ui-state-active");u.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){s._trigger("show",null,s._ui(s.anchors[0],s.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.anchors[i],this.panels[i]));return this},remove:function(t){t=this._getIndex(t);var n=this.options,r=this.lis.eq(t).remove(),i=this.panels.eq(t).remove();if(r.hasClass("ui-tabs-selected")&&this.anchors.length>1)this.select(t+(t+1<this.anchors.length?1:-1));n.disabled=e.map(e.grep(n.disabled,function(e){return e!=t}),function(e){return e>=t?--e:e});this._tabify();this._trigger("remove",null,this._ui(r.find("a")[0],i[0]));return this},enable:function(t){t=this._getIndex(t);var n=this.options;if(e.inArray(t,n.disabled)!=-1){this.lis.eq(t).removeClass("ui-state-disabled");n.disabled=e.grep(n.disabled,function(e){return e!=t});this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t]));return this}},disable:function(e){e=this._getIndex(e);var t=this.options;if(e!=t.selected){this.lis.eq(e).addClass("ui-state-disabled");t.disabled.push(e);t.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[e],this.panels[e]))}return this},select:function(e){e=this._getIndex(e);if(e==-1)if(this.options.collapsible&&this.options.selected!=-1)e=this.options.selected;else return this;this.anchors.eq(e).trigger(this.options.event+".tabs");return this},load:function(t){t=this._getIndex(t);var n=this,r=this.options,i=this.anchors.eq(t)[0],s=e.data(i,"load.tabs");this.abort();if(!s||this.element.queue("tabs").length!==0&&e.data(i,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(t).addClass("ui-state-processing");if(r.spinner){var o=e("span",i);o.data("label.tabs",o.html()).html(r.spinner)}this.xhr=e.ajax(e.extend({},r.ajaxOptions,{url:s,success:function(s,o){n.element.find(n._sanitizeSelector(i.hash)).html(s);n._cleanup();r.cache&&e.data(i,"cache.tabs",true);n._trigger("load",null,n._ui(n.anchors[t],n.panels[t]));try{r.ajaxOptions.success(s,o)}catch(u){}},error:function(e,s){n._cleanup();n._trigger("load",null,n._ui(n.anchors[t],n.panels[t]));try{r.ajaxOptions.error(e,s,t,i)}catch(o){}}}));n.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._cleanup();return this},url:function(e,t){this.anchors.eq(e).removeData("cache.tabs").data("load.tabs",t);return this},length:function(){return this.anchors.length}});e.extend(e.ui.tabs,{version:"1.8.16"});e.extend(e.ui.tabs.prototype,{rotation:null,rotate:function(e,n){var r=this,i=this.options,s=r._rotate||(r._rotate=function(t){clearTimeout(r.rotation);r.rotation=setTimeout(function(){var e=i.selected;r.select(++e<r.anchors.length?e:0)},e);t&&t.stopPropagation()});n=r._unrotate||(r._unrotate=!n?function(e){e.clientX&&r.rotate(null)}:function(){t=i.selected;s()});if(e){this.element.bind("tabsshow",s);this.anchors.bind(i.event+".tabs",n);s()}else{clearTimeout(r.rotation);this.element.unbind("tabsshow",s);this.anchors.unbind(i.event+".tabs",n);delete this._rotate;delete this._unrotate}return this}})})(jQuery);(function(d,C){function M(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._inDialog=this._datepickerShowing=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};d.extend(this._defaults,this.regional[""]);this.dpDiv=N(d('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function N(e){return e.bind("mouseout",function(e){e=d(e.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");e.length&&e.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(t){t=d(t.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!(d.datepicker._isDisabledDatepicker(J.inline?e.parent()[0]:J.input[0])||!t.length)){t.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");t.addClass("ui-state-hover");t.hasClass("ui-datepicker-prev")&&t.addClass("ui-datepicker-prev-hover");t.hasClass("ui-datepicker-next")&&t.addClass("ui-datepicker-next-hover")}})}function H(e,t){d.extend(e,t);for(var n in t)if(t[n]==null||t[n]==C)e[n]=t[n];return e}d.extend(d.ui,{datepicker:{version:"1.8.16"}});var B=(new Date).getTime(),J;d.extend(M.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){H(this._defaults,e||{});return this},_attachDatepicker:function(a,b){var c=null;for(var e in this._defaults){var f=a.getAttribute("date:"+e);if(f){c=c||{};try{c[e]=eval(f)}catch(h){c[e]=f}}}e=a.nodeName.toLowerCase();f=e=="div"||e=="span";if(!a.id){this.uuid+=1;a.id="dp"+this.uuid}var i=this._newInst(d(a),f);i.settings=d.extend({},b||{},c||{});if(e=="input")this._connectDatepicker(a,i);else f&&this._inlineDatepicker(a,i)},_newInst:function(e,t){return{id:e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:!t?this.dpDiv:N(d('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(e,t){var n=d(e);t.append=d([]);t.trigger=d([]);if(!n.hasClass(this.markerClassName)){this._attachments(n,t);n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)});this._autoSize(t);d.data(e,"datepicker",t);t.settings.disabled&&this._disableDatepicker(e)}},_attachments:function(e,t){var n=this._get(t,"appendText"),r=this._get(t,"isRTL");t.append&&t.append.remove();if(n){t.append=d('<span class="'+this._appendClass+'">'+n+"</span>");e[r?"before":"after"](t.append)}e.unbind("focus",this._showDatepicker);t.trigger&&t.trigger.remove();n=this._get(t,"showOn");if(n=="focus"||n=="both")e.focus(this._showDatepicker);if(n=="button"||n=="both"){n=this._get(t,"buttonText");var i=this._get(t,"buttonImage");t.trigger=d(this._get(t,"buttonImageOnly")?d("<img/>").addClass(this._triggerClass).attr({src:i,alt:n,title:n}):d('<button type="button"></button>').addClass(this._triggerClass).html(i==""?n:d("<img/>").attr({src:i,alt:n,title:n})));e[r?"before":"after"](t.trigger);t.trigger.click(function(){d.datepicker._datepickerShowing&&d.datepicker._lastInput==e[0]?d.datepicker._hideDatepicker():d.datepicker._showDatepicker(e[0]);return false})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),n=this._get(e,"dateFormat");if(n.match(/[DM]/)){var r=function(e){for(var t=0,n=0,r=0;r<e.length;r++)if(e[r].length>t){t=e[r].length;n=r}return n};t.setMonth(r(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort")));t.setDate(r(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var n=d(e);if(!n.hasClass(this.markerClassName)){n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)});d.data(e,"datepicker",t);this._setDate(t,this._getDefaultDate(t),true);this._updateDatepicker(t);this._updateAlternate(t);t.settings.disabled&&this._disableDatepicker(e);t.dpDiv.css("display","block")}},_dialogDatepicker:function(e,t,n,r,i){e=this._dialogInst;if(!e){this.uuid+=1;this._dialogInput=d('<input type="text" id="'+("dp"+this.uuid)+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);d("body").append(this._dialogInput);e=this._dialogInst=this._newInst(this._dialogInput,false);e.settings={};d.data(this._dialogInput[0],"datepicker",e)}H(e.settings,r||{});t=t&&t.constructor==Date?this._formatDate(e,t):t;this._dialogInput.val(t);this._pos=i?i.length?i:[i.pageX,i.pageY]:null;if(!this._pos)this._pos=[document.documentElement.clientWidth/2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)];this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");e.settings.onSelect=n;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);d.blockUI&&d.blockUI(this.dpDiv);d.data(this._dialogInput[0],"datepicker",e);return this},_destroyDatepicker:function(e){var t=d(e),n=d.data(e,"datepicker");if(t.hasClass(this.markerClassName)){var r=e.nodeName.toLowerCase();d.removeData(e,"datepicker");if(r=="input"){n.append.remove();n.trigger.remove();t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else if(r=="div"||r=="span")t.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(e){var t=d(e),n=d.data(e,"datepicker");if(t.hasClass(this.markerClassName)){var r=e.nodeName.toLowerCase();if(r=="input"){e.disabled=false;n.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(r=="div"||r=="span"){t=t.children("."+this._inlineClass);t.children().removeClass("ui-state-disabled");t.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=d.map(this._disabledInputs,function(t){return t==e?null:t})}},_disableDatepicker:function(e){var t=d(e),n=d.data(e,"datepicker");if(t.hasClass(this.markerClassName)){var r=e.nodeName.toLowerCase();if(r=="input"){e.disabled=true;n.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(r=="div"||r=="span"){t=t.children("."+this._inlineClass);t.children().addClass("ui-state-disabled");t.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=d.map(this._disabledInputs,function(t){return t==e?null:t});this._disabledInputs[this._disabledInputs.length]=e}},_isDisabledDatepicker:function(e){if(!e)return false;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return true;return false},_getInst:function(e){try{return d.data(e,"datepicker")}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,n){var r=this._getInst(e);if(arguments.length==2&&typeof t=="string")return t=="defaults"?d.extend({},d.datepicker._defaults):r?t=="all"?d.extend({},r.settings):this._get(r,t):null;var i=t||{};if(typeof t=="string"){i={};i[t]=n}if(r){this._curInst==r&&this._hideDatepicker();var s=this._getDateDatepicker(e,true),o=this._getMinMaxDate(r,"min"),u=this._getMinMaxDate(r,"max");H(r.settings,i);if(o!==null&&i.dateFormat!==C&&i.minDate===C)r.settings.minDate=this._formatDate(r,o);if(u!==null&&i.dateFormat!==C&&i.maxDate===C)r.settings.maxDate=this._formatDate(r,u);this._attachments(d(e),r);this._autoSize(r);this._setDate(r,s);this._updateAlternate(r);this._updateDatepicker(r)}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){(e=this._getInst(e))&&this._updateDatepicker(e)},_setDateDatepicker:function(e,t){if(e=this._getInst(e)){this._setDate(e,t);this._updateDatepicker(e);this._updateAlternate(e)}},_getDateDatepicker:function(e,t){(e=this._getInst(e))&&!e.inline&&this._setDateFromField(e,t);return e?this._getDate(e):null},_doKeyDown:function(e){var t=d.datepicker._getInst(e.target),n=true,r=t.dpDiv.is(".ui-datepicker-rtl");t._keyEvent=true;if(d.datepicker._datepickerShowing)switch(e.keyCode){case 9:d.datepicker._hideDatepicker();n=false;break;case 13:n=d("td."+d.datepicker._dayOverClass+":not(."+d.datepicker._currentClass+")",t.dpDiv);n[0]&&d.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,n[0]);if(e=d.datepicker._get(t,"onSelect")){n=d.datepicker._formatDate(t);e.apply(t.input?t.input[0]:null,[n,t])}else d.datepicker._hideDatepicker();return false;case 27:d.datepicker._hideDatepicker();break;case 33:d.datepicker._adjustDate(e.target,e.ctrlKey?-d.datepicker._get(t,"stepBigMonths"):-d.datepicker._get(t,"stepMonths"),"M");break;case 34:d.datepicker._adjustDate(e.target,e.ctrlKey?+d.datepicker._get(t,"stepBigMonths"):+d.datepicker._get(t,"stepMonths"),"M");break;case 35:if(e.ctrlKey||e.metaKey)d.datepicker._clearDate(e.target);n=e.ctrlKey||e.metaKey;break;case 36:if(e.ctrlKey||e.metaKey)d.datepicker._gotoToday(e.target);n=e.ctrlKey||e.metaKey;break;case 37:if(e.ctrlKey||e.metaKey)d.datepicker._adjustDate(e.target,r?+1:-1,"D");n=e.ctrlKey||e.metaKey;if(e.originalEvent.altKey)d.datepicker._adjustDate(e.target,e.ctrlKey?-d.datepicker._get(t,"stepBigMonths"):-d.datepicker._get(t,"stepMonths"),"M");break;case 38:if(e.ctrlKey||e.metaKey)d.datepicker._adjustDate(e.target,-7,"D");n=e.ctrlKey||e.metaKey;break;case 39:if(e.ctrlKey||e.metaKey)d.datepicker._adjustDate(e.target,r?-1:+1,"D");n=e.ctrlKey||e.metaKey;if(e.originalEvent.altKey)d.datepicker._adjustDate(e.target,e.ctrlKey?+d.datepicker._get(t,"stepBigMonths"):+d.datepicker._get(t,"stepMonths"),"M");break;case 40:if(e.ctrlKey||e.metaKey)d.datepicker._adjustDate(e.target,+7,"D");n=e.ctrlKey||e.metaKey;break;default:n=false}else if(e.keyCode==36&&e.ctrlKey)d.datepicker._showDatepicker(this);else n=false;if(n){e.preventDefault();e.stopPropagation()}},_doKeyPress:function(e){var t=d.datepicker._getInst(e.target);if(d.datepicker._get(t,"constrainInput")){t=d.datepicker._possibleChars(d.datepicker._get(t,"dateFormat"));var n=String.fromCharCode(e.charCode==C?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||n<" "||!t||t.indexOf(n)>-1}},_doKeyUp:function(e){e=d.datepicker._getInst(e.target);if(e.input.val()!=e.lastVal)try{if(d.datepicker.parseDate(d.datepicker._get(e,"dateFormat"),e.input?e.input.val():null,d.datepicker._getFormatConfig(e))){d.datepicker._setDateFromField(e);d.datepicker._updateAlternate(e);d.datepicker._updateDatepicker(e)}}catch(t){d.datepicker.log(t)}return true},_showDatepicker:function(e){e=e.target||e;if(e.nodeName.toLowerCase()!="input")e=d("input",e.parentNode)[0];if(!(d.datepicker._isDisabledDatepicker(e)||d.datepicker._lastInput==e)){var t=d.datepicker._getInst(e);if(d.datepicker._curInst&&d.datepicker._curInst!=t){d.datepicker._datepickerShowing&&d.datepicker._triggerOnClose(d.datepicker._curInst);d.datepicker._curInst.dpDiv.stop(true,true)}var n=d.datepicker._get(t,"beforeShow");n=n?n.apply(e,[e,t]):{};if(n!==false){H(t.settings,n);t.lastVal=null;d.datepicker._lastInput=e;d.datepicker._setDateFromField(t);if(d.datepicker._inDialog)e.value="";if(!d.datepicker._pos){d.datepicker._pos=d.datepicker._findPos(e);d.datepicker._pos[1]+=e.offsetHeight}var r=false;d(e).parents().each(function(){r|=d(this).css("position")=="fixed";return!r});if(r&&d.browser.opera){d.datepicker._pos[0]-=document.documentElement.scrollLeft;d.datepicker._pos[1]-=document.documentElement.scrollTop}n={left:d.datepicker._pos[0],top:d.datepicker._pos[1]};d.datepicker._pos=null;t.dpDiv.empty();t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});d.datepicker._updateDatepicker(t);n=d.datepicker._checkOffset(t,n,r);t.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":r?"fixed":"absolute",display:"none",left:n.left+"px",top:n.top+"px"});if(!t.inline){n=d.datepicker._get(t,"showAnim");var i=d.datepicker._get(t,"duration"),s=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(e.length){var n=d.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex(d(e).zIndex()+1);d.datepicker._datepickerShowing=true;d.effects&&d.effects[n]?t.dpDiv.show(n,d.datepicker._get(t,"showOptions"),i,s):t.dpDiv[n||"show"](n?i:null,s);if(!n||!i)s();t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus();d.datepicker._curInst=t}}}},_updateDatepicker:function(e){this.maxRows=4;var t=d.datepicker._getBorders(e.dpDiv);J=e;e.dpDiv.empty().append(this._generateHTML(e));var n=e.dpDiv.find("iframe.ui-datepicker-cover");n.length&&n.css({left:-t[0],top:-t[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()});e.dpDiv.find("."+this._dayOverClass+" a").mouseover();t=this._getNumberOfMonths(e);n=t[1];e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em");e.dpDiv[(t[0]!=1||t[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");e==d.datepicker._curInst&&d.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus();if(e.yearshtml){var r=e.yearshtml;setTimeout(function(){r===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml);r=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,n){var r=e.dpDiv.outerWidth(),i=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,u=document.documentElement.clientWidth+d(document).scrollLeft(),a=document.documentElement.clientHeight+d(document).scrollTop();t.left-=this._get(e,"isRTL")?r-s:0;t.left-=n&&t.left==e.input.offset().left?d(document).scrollLeft():0;t.top-=n&&t.top==e.input.offset().top+o?d(document).scrollTop():0;t.left-=Math.min(t.left,t.left+r>u&&u>r?Math.abs(t.left+r-u):0);t.top-=Math.min(t.top,t.top+i>a&&a>i?Math.abs(i+o):0);return t},_findPos:function(e){for(var t=this._get(this._getInst(e),"isRTL");e&&(e.type=="hidden"||e.nodeType!=1||d.expr.filters.hidden(e));)e=e[t?"previousSibling":"nextSibling"];e=d(e).offset();return[e.left,e.top]},_triggerOnClose:function(e){var t=this._get(e,"onClose");if(t)t.apply(e.input?e.input[0]:null,[e.input?e.input.val():"",e])},_hideDatepicker:function(e){var t=this._curInst;if(!(!t||e&&t!=d.data(e,"datepicker")))if(this._datepickerShowing){e=this._get(t,"showAnim");var n=this._get(t,"duration"),r=function(){d.datepicker._tidyDialog(t);this._curInst=null};d.effects&&d.effects[e]?t.dpDiv.hide(e,d.datepicker._get(t,"showOptions"),n,r):t.dpDiv[e=="slideDown"?"slideUp":e=="fadeIn"?"fadeOut":"hide"](e?n:null,r);e||r();d.datepicker._triggerOnClose(t);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if(d.blockUI){d.unblockUI();d("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(d.datepicker._curInst){e=d(e.target);e[0].id!=d.datepicker._mainDivId&&e.parents("#"+d.datepicker._mainDivId).length==0&&!e.hasClass(d.datepicker.markerClassName)&&!e.hasClass(d.datepicker._triggerClass)&&d.datepicker._datepickerShowing&&!(d.datepicker._inDialog&&d.blockUI)&&d.datepicker._hideDatepicker()}},_adjustDate:function(e,t,n){e=d(e);var r=this._getInst(e[0]);if(!this._isDisabledDatepicker(e[0])){this._adjustInstDate(r,t+(n=="M"?this._get(r,"showCurrentAtPos"):0),n);this._updateDatepicker(r)}},_gotoToday:function(e){e=d(e);var t=this._getInst(e[0]);if(this._get(t,"gotoCurrent")&&t.currentDay){t.selectedDay=t.currentDay;t.drawMonth=t.selectedMonth=t.currentMonth;t.drawYear=t.selectedYear=t.currentYear}else{var n=new Date;t.selectedDay=n.getDate();t.drawMonth=t.selectedMonth=n.getMonth();t.drawYear=t.selectedYear=n.getFullYear()}this._notifyChange(t);this._adjustDate(e)},_selectMonthYear:function(e,t,n){e=d(e);var r=this._getInst(e[0]);r["selected"+(n=="M"?"Month":"Year")]=r["draw"+(n=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10);this._notifyChange(r);this._adjustDate(e)},_selectDay:function(e,t,n,r){var i=d(e);if(!(d(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(i[0]))){i=this._getInst(i[0]);i.selectedDay=i.currentDay=d("a",r).html();i.selectedMonth=i.currentMonth=t;i.selectedYear=i.currentYear=n;this._selectDate(e,this._formatDate(i,i.currentDay,i.currentMonth,i.currentYear))}},_clearDate:function(e){e=d(e);this._getInst(e[0]);this._selectDate(e,"")},_selectDate:function(e,t){e=this._getInst(d(e)[0]);t=t!=null?t:this._formatDate(e);e.input&&e.input.val(t);this._updateAlternate(e);var n=this._get(e,"onSelect");if(n)n.apply(e.input?e.input[0]:null,[t,e]);else e.input&&e.input.trigger("change");if(e.inline)this._updateDatepicker(e);else{this._hideDatepicker();this._lastInput=e.input[0];typeof e.input[0]!="object"&&e.input.focus();this._lastInput=null}},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),i=this.formatDate(n,r,this._getFormatConfig(e));d(t).each(function(){d(this).val(i)})}},noWeekends:function(e){e=e.getDay();return[e>0&&e<6,""]},iso8601Week:function(e){e=new Date(e.getTime());e.setDate(e.getDate()+4-(e.getDay()||7));var t=e.getTime();e.setMonth(0);e.setDate(1);return Math.floor(Math.round((t-e)/864e5)/7)+1},parseDate:function(e,t,n){if(e==null||t==null)throw"Invalid arguments";t=typeof t=="object"?t.toString():t+"";if(t=="")return null;var r=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;r=typeof r!="string"?r:(new Date).getFullYear()%100+parseInt(r,10);for(var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=n=-1,f=-1,l=-1,c=false,h=function(t){(t=y+1<e.length&&e.charAt(y+1)==t)&&y++;return t},p=function(e){var n=h(e);e=new RegExp("^\\d{1,"+(e=="@"?14:e=="!"?20:e=="y"&&n?4:e=="o"?3:2)+"}");e=t.substring(g).match(e);if(!e)throw"Missing number at position "+g;g+=e[0].length;return parseInt(e[0],10)},v=function(e,n,r){e=d.map(h(e)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});var i=-1;d.each(e,function(e,n){e=n[1];if(t.substr(g,e.length).toLowerCase()==e.toLowerCase()){i=n[0];g+=e.length;return false}});if(i!=-1)return i+1;else throw"Unknown name at position "+g},m=function(){if(t.charAt(g)!=e.charAt(y))throw"Unexpected literal at position "+g;g++},g=0,y=0;y<e.length;y++)if(c)if(e.charAt(y)=="'"&&!h("'"))c=false;else m();else switch(e.charAt(y)){case"d":f=p("d");break;case"D":v("D",i,s);break;case"o":l=p("o");break;case"m":a=p("m");break;case"M":a=v("M",o,u);break;case"y":n=p("y");break;case"@":var b=new Date(p("@"));n=b.getFullYear();a=b.getMonth()+1;f=b.getDate();break;case"!":b=new Date((p("!")-this._ticksTo1970)/1e4);n=b.getFullYear();a=b.getMonth()+1;f=b.getDate();break;case"'":if(h("'"))m();else c=true;break;default:m()}if(g<t.length)throw"Extra/unparsed characters found in date: "+t.substring(g);if(n==-1)n=(new Date).getFullYear();else if(n<100)n+=(new Date).getFullYear()-(new Date).getFullYear()%100+(n<=r?0:-100);if(l>-1){a=1;f=l;do{r=this._getDaysInMonth(n,a-1);if(f<=r)break;a++;f-=r}while(1)}b=this._daylightSavingAdjust(new Date(n,a-1,f));if(b.getFullYear()!=n||b.getMonth()+1!=a||b.getDate()!=f)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,i=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort;n=(n?n.monthNames:null)||this._defaults.monthNames;var o=function(t){(t=c+1<e.length&&e.charAt(c+1)==t)&&c++;return t},u=function(e,t,n){t=""+t;if(o(e))for(;t.length<n;)t="0"+t;return t},a=function(e,t,n,r){return o(e)?r[t]:n[t]},f="",l=false;if(t)for(var c=0;c<e.length;c++)if(l)if(e.charAt(c)=="'"&&!o("'"))l=false;else f+=e.charAt(c);else switch(e.charAt(c)){case"d":f+=u("d",t.getDate(),2);break;case"D":f+=a("D",t.getDay(),r,i);break;case"o":f+=u("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":f+=u("m",t.getMonth()+1,2);break;case"M":f+=a("M",t.getMonth(),s,n);break;case"y":f+=o("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":f+=t.getTime();break;case"!":f+=t.getTime()*1e4+this._ticksTo1970;break;case"'":if(o("'"))f+="'";else l=true;break;default:f+=e.charAt(c)}return f},_possibleChars:function(e){for(var t="",n=false,r=function(t){(t=i+1<e.length&&e.charAt(i+1)==t)&&i++;return t},i=0;i<e.length;i++)if(n)if(e.charAt(i)=="'"&&!r("'"))n=false;else t+=e.charAt(i);else switch(e.charAt(i)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":if(r("'"))t+="'";else n=true;break;default:t+=e.charAt(i)}return t},_get:function(e,t){return e.settings[t]!==C?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!=e.lastVal){var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i,s;i=s=this._getDefaultDate(e);var o=this._getFormatConfig(e);try{i=this.parseDate(n,r,o)||s}catch(u){this.log(u);r=t?"":r}e.selectedDay=i.getDate();e.drawMonth=e.selectedMonth=i.getMonth();e.drawYear=e.selectedYear=i.getFullYear();e.currentDay=r?i.getDate():0;e.currentMonth=r?i.getMonth():0;e.currentYear=r?i.getFullYear():0;this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,n){var r=function(e){var t=new Date;t.setDate(t.getDate()+e);return t},i=function(t){try{return d.datepicker.parseDate(d.datepicker._get(e,"dateFormat"),t,d.datepicker._getFormatConfig(e))}catch(n){}var r=(t.toLowerCase().match(/^c/)?d.datepicker._getDate(e):null)||new Date,i=r.getFullYear(),s=r.getMonth();r=r.getDate();for(var o=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,u=o.exec(t);u;){switch(u[2]||"d"){case"d":case"D":r+=parseInt(u[1],10);break;case"w":case"W":r+=parseInt(u[1],10)*7;break;case"m":case"M":s+=parseInt(u[1],10);r=Math.min(r,d.datepicker._getDaysInMonth(i,s));break;case"y":case"Y":i+=parseInt(u[1],10);r=Math.min(r,d.datepicker._getDaysInMonth(i,s));break}u=o.exec(t)}return new Date(i,s,r)};if(t=(t=t==null||t===""?n:typeof t=="string"?i(t):typeof t=="number"?isNaN(t)?n:r(t):new Date(t.getTime()))&&t.toString()=="Invalid Date"?n:t){t.setHours(0);t.setMinutes(0);t.setSeconds(0);t.setMilliseconds(0)}return this._daylightSavingAdjust(t)},_daylightSavingAdjust:function(e){if(!e)return null;e.setHours(e.getHours()>12?e.getHours()+2:0);return e},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear;t=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=t.getDate();e.drawMonth=e.selectedMonth=e.currentMonth=t.getMonth();e.drawYear=e.selectedYear=e.currentYear=t.getFullYear();if((i!=e.selectedMonth||s!=e.selectedYear)&&!n)this._notifyChange(e);this._adjustInstDate(e);if(e.input)e.input.val(r?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var n=this._get(e,"isRTL"),r=this._get(e,"showButtonPanel"),i=this._get(e,"hideIfNoPrevNext"),s=this._get(e,"navigationAsDateFormat"),o=this._getNumberOfMonths(e),u=this._get(e,"showCurrentAtPos"),a=this._get(e,"stepMonths"),f=o[0]!=1||o[1]!=1,l=this._daylightSavingAdjust(!e.currentDay?new Date(9999,9,9):new Date(e.currentYear,e.currentMonth,e.currentDay)),c=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max");u=e.drawMonth-u;var p=e.drawYear;if(u<0){u+=12;p--}if(h){var v=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-o[0]*o[1]+1,h.getDate()));for(v=c&&v<c?c:v;this._daylightSavingAdjust(new Date(p,u,1))>v;){u--;if(u<0){u=11;p--}}}e.drawMonth=u;e.drawYear=p;v=this._get(e,"prevText");v=!s?v:this.formatDate(v,this._daylightSavingAdjust(new Date(p,u-a,1)),this._getFormatConfig(e));v=this._canAdjustMonth(e,-1,p,u)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._adjustDate('#"+e.id+"', -"+a+", 'M');\" title=\""+v+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+v+"</span></a>":i?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+v+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+v+"</span></a>";var m=this._get(e,"nextText");m=!s?m:this.formatDate(m,this._daylightSavingAdjust(new Date(p,u+a,1)),this._getFormatConfig(e));i=this._canAdjustMonth(e,+1,p,u)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._adjustDate('#"+e.id+"', +"+a+", 'M');\" title=\""+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+m+"</span></a>":i?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+m+"</span></a>";a=this._get(e,"currentText");m=this._get(e,"gotoCurrent")&&e.currentDay?l:t;a=!s?a:this.formatDate(a,m,this._getFormatConfig(e));s=!e.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+B+'.datepicker._hideDatepicker();">'+this._get(e,"closeText")+"</button>":"";r=r?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?s:"")+(this._isInRange(e,m)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._gotoToday('#"+e.id+"');\">"+a+"</button>":"")+(n?"":s)+"</div>":"";s=parseInt(this._get(e,"firstDay"),10);s=isNaN(s)?0:s;a=this._get(e,"showWeek");m=this._get(e,"dayNames");this._get(e,"dayNamesShort");var g=this._get(e,"dayNamesMin"),y=this._get(e,"monthNames"),b=this._get(e,"monthNamesShort"),w=this._get(e,"beforeShowDay"),E=this._get(e,"showOtherMonths"),S=this._get(e,"selectOtherMonths");this._get(e,"calculateWeek");for(var x=this._getDefaultDate(e),T="",N=0;N<o[0];N++){var C="";this.maxRows=4;for(var k=0;k<o[1];k++){var L=this._daylightSavingAdjust(new Date(p,u,e.selectedDay)),A=" ui-corner-all",O="";if(f){O+='<div class="ui-datepicker-group';if(o[1]>1)switch(k){case 0:O+=" ui-datepicker-group-first";A=" ui-corner-"+(n?"right":"left");break;case o[1]-1:O+=" ui-datepicker-group-last";A=" ui-corner-"+(n?"left":"right");break;default:O+=" ui-datepicker-group-middle";A="";break}O+='">'}O+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+A+'">'+(/all|left/.test(A)&&N==0?n?i:v:"")+(/all|right/.test(A)&&N==0?n?v:i:"")+this._generateMonthYearHeader(e,u,p,c,h,N>0||k>0,y,b)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var M=a?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"";for(A=0;A<7;A++){var _=(A+s)%7;M+="<th"+((A+s+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+m[_]+'">'+g[_]+"</span></th>"}O+=M+"</tr></thead><tbody>";M=this._getDaysInMonth(p,u);if(p==e.selectedYear&&u==e.selectedMonth)e.selectedDay=Math.min(e.selectedDay,M);A=(this._getFirstDayOfMonth(p,u)-s+7)%7;M=Math.ceil((A+M)/7);this.maxRows=M=f?this.maxRows>M?this.maxRows:M:M;_=this._daylightSavingAdjust(new Date(p,u,1-A));for(var D=0;D<M;D++){O+="<tr>";var P=!a?"":'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(_)+"</td>";for(A=0;A<7;A++){var H=w?w.apply(e.input?e.input[0]:null,[_]):[true,""],j=_.getMonth()!=u,F=j&&!S||!H[0]||c&&_<c||h&&_>h;P+='<td class="'+((A+s+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(_.getTime()==L.getTime()&&u==e.selectedMonth&&e._keyEvent||x.getTime()==_.getTime()&&x.getTime()==L.getTime()?" "+this._dayOverClass:"")+(F?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!E?"":" "+H[1]+(_.getTime()==l.getTime()?" "+this._currentClass:"")+(_.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+((!j||E)&&H[2]?' title="'+H[2]+'"':"")+(F?"":' onclick="DP_jQuery_'+B+".datepicker._selectDay('#"+e.id+"',"+_.getMonth()+","+_.getFullYear()+', this);return false;"')+">"+(j&&!E?"&#xa0;":F?'<span class="ui-state-default">'+_.getDate()+"</span>":'<a class="ui-state-default'+(_.getTime()==t.getTime()?" ui-state-highlight":"")+(_.getTime()==l.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+'" href="#">'+_.getDate()+"</a>")+"</td>";_.setDate(_.getDate()+1);_=this._daylightSavingAdjust(_)}O+=P+"</tr>"}u++;if(u>11){u=0;p++}O+="</tbody></table>"+(f?"</div>"+(o[0]>0&&k==o[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");C+=O}T+=C}T+=r+(d.browser.msie&&parseInt(d.browser.version,10)<7&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':"");e._keyEvent=false;return T},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a=this._get(e,"changeMonth"),f=this._get(e,"changeYear"),l=this._get(e,"showMonthAfterYear"),c='<div class="ui-datepicker-title">',h="";if(s||!a)h+='<span class="ui-datepicker-month">'+o[t]+"</span>";else{o=r&&r.getFullYear()==n;var p=i&&i.getFullYear()==n;h+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+B+".datepicker._selectMonthYear('#"+e.id+"', this, 'M');\" >";for(var d=0;d<12;d++)if((!o||d>=r.getMonth())&&(!p||d<=i.getMonth()))h+='<option value="'+d+'"'+(d==t?' selected="selected"':"")+">"+u[d]+"</option>";h+="</select>"}l||(c+=h+(s||!(a&&f)?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(s||!f)c+='<span class="ui-datepicker-year">'+n+"</span>";else{u=this._get(e,"yearRange").split(":");var v=(new Date).getFullYear();o=function(e){e=e.match(/c[+-].*/)?n+parseInt(e.substring(1),10):e.match(/[+-].*/)?v+parseInt(e,10):parseInt(e,10);return isNaN(e)?v:e};t=o(u[0]);u=Math.max(t,o(u[1]||""));t=r?Math.max(t,r.getFullYear()):t;u=i?Math.min(u,i.getFullYear()):u;for(e.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+B+".datepicker._selectMonthYear('#"+e.id+"', this, 'Y');\" >";t<=u;t++)e.yearshtml+='<option value="'+t+'"'+(t==n?' selected="selected"':"")+">"+t+"</option>";e.yearshtml+="</select>";c+=e.yearshtml;e.yearshtml=null}}c+=this._get(e,"yearSuffix");if(l)c+=(s||!(a&&f)?"&#xa0;":"")+h;c+="</div>";return c},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n=="Y"?t:0),i=e.drawMonth+(n=="M"?t:0);t=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n=="D"?t:0);r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,t)));e.selectedDay=r.getDate();e.drawMonth=e.selectedMonth=r.getMonth();e.drawYear=e.selectedYear=r.getFullYear();if(n=="M"||n=="Y")this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min");e=this._getMinMaxDate(e,"max");t=n&&t<n?n:t;return t=e&&t>e?e:t},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");if(t)t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){e=this._get(e,"numberOfMonths");return e==null?[1,1]:typeof e=="number"?[1,e]:e},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e);n=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));t<0&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth()));return this._isInRange(e,n)},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min");e=this._getMinMaxDate(e,"max");return(!n||t.getTime()>=n.getTime())&&(!e||t.getTime()<=e.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10);return{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){if(!t){e.currentDay=e.selectedDay;e.currentMonth=e.selectedMonth;e.currentYear=e.selectedYear}t=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),t,this._getFormatConfig(e))}});d.fn.datepicker=function(e){if(!this.length)return this;if(!d.datepicker.initialized){d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv);d.datepicker.initialized=true}var t=Array.prototype.slice.call(arguments,1);if(typeof e=="string"&&(e=="isDisabled"||e=="getDate"||e=="widget"))return d.datepicker["_"+e+"Datepicker"].apply(d.datepicker,[this[0]].concat(t));if(e=="option"&&arguments.length==2&&typeof arguments[1]=="string")return d.datepicker["_"+e+"Datepicker"].apply(d.datepicker,[this[0]].concat(t));return this.each(function(){typeof e=="string"?d.datepicker["_"+e+"Datepicker"].apply(d.datepicker,[this].concat(t)):d.datepicker._attachDatepicker(this,e)})};d.datepicker=new M;d.datepicker.initialized=false;d.datepicker.uuid=(new Date).getTime();d.datepicker.version="1.8.16";window["DP_jQuery_"+B]=d})(jQuery);(function(e,t){e.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();e.Widget.prototype.destroy.apply(this,arguments)},value:function(e){if(e===t)return this._value();this._setOption("value",e);return this},_setOption:function(t,n){if(t==="value"){this.options.value=n;this._refreshValue();this._value()===this.options.max&&this._trigger("complete")}e.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var e=this.options.value;if(typeof e!=="number")e=0;return Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();if(this.oldValue!==e){this.oldValue=e;this._trigger("change")}this.valueDiv.toggle(e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%");this.element.attr("aria-valuenow",e)}});e.extend(e.ui.progressbar,{version:"1.8.16"})})(jQuery);jQuery.effects||function(e,t){function n(t){var n;if(t&&t.constructor==Array&&t.length==3)return t;if(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)];if(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))return[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55];if(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))return[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)];if(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))return[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)];if(/rgba\(0, 0, 0, 0\)/.exec(t))return f.transparent;return f[e.trim(t).toLowerCase()]}function r(t,r){var i;do{i=e.curCSS(t,r);if(i!=""&&i!="transparent"||e.nodeName(t,"body"))break;r="backgroundColor"}while(t=t.parentNode);return n(i)}function i(){var e=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,t={},n,r;if(e&&e.length&&e[0]&&e[e[0]])for(var i=e.length;i--;){n=e[i];if(typeof e[n]=="string"){r=n.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()});t[r]=e[n]}}else for(n in e)if(typeof e[n]==="string")t[n]=e[n];return t}function s(t){var n,r;for(n in t){r=t[n];if(r==null||e.isFunction(r)||n in c||/scrollbar/.test(n)||!/color/i.test(n)&&isNaN(parseFloat(r)))delete t[n]}return t}function o(e,t){var n={_:0},r;for(r in t)if(e[r]!=t[r])n[r]=t[r];return n}function u(t,n,r,i){if(typeof t=="object"){i=n;r=null;n=t;t=n.effect}if(e.isFunction(n)){i=n;r=null;n={}}if(typeof n=="number"||e.fx.speeds[n]){i=r;r=n;n={}}if(e.isFunction(r)){i=r;r=null}n=n||{};r=r||n.duration;r=e.fx.off?0:typeof r=="number"?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default;i=i||n.complete;return[t,n,r,i]}function a(t){if(!t||typeof t==="number"||e.fx.speeds[t])return true;if(typeof t==="string"&&!e.effects[t])return true;return false}e.effects={};e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(t,i){e.fx.step[i]=function(e){if(!e.colorInit){e.start=r(e.elem,i);e.end=n(e.end);e.colorInit=true}e.elem.style[i]="rgb("+Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2],10),255),0)+")"}});var f={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},l=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.effects.animateClass=function(t,n,r,u){if(e.isFunction(r)){u=r;r=null}return this.queue(function(){var a=e(this),f=a.attr("style")||" ",c=s(i.call(this)),h,v=a.attr("class");e.each(l,function(e,n){t[n]&&a[n+"Class"](t[n])});h=s(i.call(this));a.attr("class",v);a.animate(o(c,h),{queue:false,duration:n,easing:r,complete:function(){e.each(l,function(e,n){t[n]&&a[n+"Class"](t[n])});if(typeof a.attr("style")=="object"){a.attr("style").cssText="";a.attr("style").cssText=f}else a.attr("style",f);u&&u.apply(this,arguments);e.dequeue(this)}})})};e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{add:t},n,r,i]):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{remove:t},n,r,i]):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){return typeof r=="boolean"||r===t?i?e.effects.animateClass.apply(this,[r?{add:n}:{remove:n},i,s,o]):this._toggleClass(n,r):e.effects.animateClass.apply(this,[{toggle:n},r,i,s])},switchClass:function(t,n,r,i,s){return e.effects.animateClass.apply(this,[{add:n,remove:t},r,i,s])}});e.extend(e.effects,{version:"1.8.16",save:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.data("ec.storage."+t[n],e[0].style[t[n]])},restore:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.css(t[n],e.data("ec.storage."+t[n]))},setMode:function(e,t){if(t=="toggle")t=e.is(":hidden")?"show":"hide";return t},getBaseline:function(e,t){var n;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":e=0;break;case"center":e=.5;break;case"right":e=1;break;default:e=e[1]/t.width}return{x:e,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(true),height:t.outerHeight(true),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i=document.activeElement;t.wrap(r);if(t[0]===i||e.contains(t[0],i))e(i).focus();r=t.parent();if(t.css("position")=="static"){r.css({position:"relative"});t.css({position:"relative"})}else{e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")});e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r);if(isNaN(parseInt(n[r],10)))n[r]="auto"});t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return r.css(n).show()},removeWrapper:function(t){var n,r=document.activeElement;if(t.parent().is(".ui-effects-wrapper")){n=t.parent().replaceWith(t);if(t[0]===r||e.contains(t[0],r))e(r).focus();return n}return t},setTransition:function(t,n,r,i){i=i||{};e.each(n,function(e,n){unit=t.cssUnit(n);if(unit[0]>0)i[n]=unit[0]*r+unit[1]});return i}});e.fn.extend({effect:function(t){var n=u.apply(this,arguments),r={options:n[1],duration:n[2],callback:n[3]};n=r.options.mode;var i=e.effects[t];if(e.fx.off||!i)return n?this[n](r.duration,r.callback):this.each(function(){r.callback&&r.callback.call(this)});return i.call(this,r)},_show:e.fn.show,show:function(e){if(a(e))return this._show.apply(this,arguments);else{var t=u.apply(this,arguments);t[1].mode="show";return this.effect.apply(this,t)}},_hide:e.fn.hide,hide:function(e){if(a(e))return this._hide.apply(this,arguments);else{var t=u.apply(this,arguments);t[1].mode="hide";return this.effect.apply(this,t)}},__toggle:e.fn.toggle,toggle:function(t){if(a(t)||typeof t==="boolean"||e.isFunction(t))return this.__toggle.apply(this,arguments);else{var n=u.apply(this,arguments);n[1].mode="toggle";return this.effect.apply(this,n)}},cssUnit:function(t){var n=this.css(t),r=[];e.each(["em","px","%","pt"],function(e,t){if(n.indexOf(t)>0)r=[parseFloat(n),t]});return r}});e.easing.jswing=e.easing.swing;e.extend(e.easing,{def:"easeOutQuad",swing:function(t,n,r,i,s){return e.easing[e.easing.def](t,n,r,i,s)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t+n;return-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t+n;return r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t*t+n;return-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t*t*t+n;return r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){if(t==0)return n;if(t==i)return n+r;if((t/=i/2)<1)return r/2*Math.pow(2,10*(t-1))+n;return r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){if((t/=i/2)<1)return-r/2*(Math.sqrt(1-t*t)-1)+n;return r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){e=1.70158;var s=0,o=r;if(t==0)return n;if((t/=i)==1)return n+r;s||(s=i*.3);if(o<Math.abs(r)){o=r;e=s/4}else e=s/(2*Math.PI)*Math.asin(r/o);return-(o*Math.pow(2,10*(t-=1))*Math.sin((t*i-e)*2*Math.PI/s))+n},easeOutElastic:function(e,t,n,r,i){e=1.70158;var s=0,o=r;if(t==0)return n;if((t/=i)==1)return n+r;s||(s=i*.3);if(o<Math.abs(r)){o=r;e=s/4}else e=s/(2*Math.PI)*Math.asin(r/o);return o*Math.pow(2,-10*t)*Math.sin((t*i-e)*2*Math.PI/s)+r+n},easeInOutElastic:function(e,t,n,r,i){e=1.70158;var s=0,o=r;if(t==0)return n;if((t/=i/2)==2)return n+r;s||(s=i*.3*1.5);if(o<Math.abs(r)){o=r;e=s/4}else e=s/(2*Math.PI)*Math.asin(r/o);if(t<1)return-.5*o*Math.pow(2,10*(t-=1))*Math.sin((t*i-e)*2*Math.PI/s)+n;return o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-e)*2*Math.PI/s)*.5+r+n},easeInBack:function(e,n,r,i,s,o){if(o==t)o=1.70158;return i*(n/=s)*n*((o+1)*n-o)+r},easeOutBack:function(e,n,r,i,s,o){if(o==t)o=1.70158;return i*((n=n/s-1)*n*((o+1)*n+o)+1)+r},easeInOutBack:function(e,n,r,i,s,o){if(o==t)o=1.70158;if((n/=s/2)<1)return i/2*n*n*(((o*=1.525)+1)*n-o)+r;return i/2*((n-=2)*n*(((o*=1.525)+1)*n+o)+2)+r},easeInBounce:function(t,n,r,i,s){return i-e.easing.easeOutBounce(t,s-n,0,i,s)+r},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(t,n,r,i,s){if(n<s/2)return e.easing.easeInBounce(t,n*2,0,i,s)*.5+r;return e.easing.easeOutBounce(t,n*2-s,0,i,s)*.5+i*.5+r}})}(jQuery);(function(e){e.effects.blind=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.direction||"vertical";e.effects.save(n,r);n.show();var o=e.effects.createWrapper(n).css({overflow:"hidden"}),u=s=="vertical"?"height":"width";s=s=="vertical"?o.height():o.width();i=="show"&&o.css(u,0);var a={};a[u]=i=="show"?s:0;o.animate(a,t.duration,t.options.easing,function(){i=="hide"&&n.hide();e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(n[0],arguments);n.dequeue()})})}})(jQuery);(function(e){e.effects.bounce=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"effect"),s=t.options.direction||"up",o=t.options.distance||20,u=t.options.times||5,a=t.duration||250;/show|hide/.test(i)&&r.push("opacity");e.effects.save(n,r);n.show();e.effects.createWrapper(n);var f=s=="up"||s=="down"?"top":"left";s=s=="up"||s=="left"?"pos":"neg";o=t.options.distance||(f=="top"?n.outerHeight({margin:true})/3:n.outerWidth({margin:true})/3);if(i=="show")n.css("opacity",0).css(f,s=="pos"?-o:o);if(i=="hide")o/=u*2;i!="hide"&&u--;if(i=="show"){var l={opacity:1};l[f]=(s=="pos"?"+=":"-=")+o;n.animate(l,a/2,t.options.easing);o/=2;u--}for(l=0;l<u;l++){var c={},h={};c[f]=(s=="pos"?"-=":"+=")+o;h[f]=(s=="pos"?"+=":"-=")+o;n.animate(c,a/2,t.options.easing).animate(h,a/2,t.options.easing);o=i=="hide"?o*2:o/2}if(i=="hide"){l={opacity:0};l[f]=(s=="pos"?"-=":"+=")+o;n.animate(l,a/2,t.options.easing,function(){n.hide();e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(this,arguments)})}else{c={};h={};c[f]=(s=="pos"?"-=":"+=")+o;h[f]=(s=="pos"?"+=":"-=")+o;n.animate(c,a/2,t.options.easing).animate(h,a/2,t.options.easing,function(){e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(this,arguments)})}n.queue("fx",function(){n.dequeue()});n.dequeue()})}})(jQuery);(function(e){e.effects.clip=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right","height","width"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.direction||"vertical";e.effects.save(n,r);n.show();var o=e.effects.createWrapper(n).css({overflow:"hidden"});o=n[0].tagName=="IMG"?o:n;var u={size:s=="vertical"?"height":"width",position:s=="vertical"?"top":"left"};s=s=="vertical"?o.height():o.width();if(i=="show"){o.css(u.size,0);o.css(u.position,s/2)}var a={};a[u.size]=i=="show"?s:0;a[u.position]=i=="show"?0:s/2;o.animate(a,{queue:false,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide();e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(n[0],arguments);n.dequeue()}})})}})(jQuery);(function(e){e.effects.drop=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right","opacity"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.direction||"left";e.effects.save(n,r);n.show();e.effects.createWrapper(n);var o=s=="up"||s=="down"?"top":"left";s=s=="up"||s=="left"?"pos":"neg";var u=t.options.distance||(o=="top"?n.outerHeight({margin:true})/2:n.outerWidth({margin:true})/2);if(i=="show")n.css("opacity",0).css(o,s=="pos"?-u:u);var a={opacity:i=="show"?1:0};a[o]=(i=="show"?s=="pos"?"+=":"-=":s=="pos"?"-=":"+=")+u;n.animate(a,{queue:false,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide();e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(this,arguments);n.dequeue()}})})}})(jQuery);(function(e){e.effects.explode=function(t){return this.queue(function(){var n=t.options.pieces?Math.round(Math.sqrt(t.options.pieces)):3,r=t.options.pieces?Math.round(Math.sqrt(t.options.pieces)):3;t.options.mode=t.options.mode=="toggle"?e(this).is(":visible")?"hide":"show":t.options.mode;var i=e(this).show().css("visibility","hidden"),s=i.offset();s.top-=parseInt(i.css("marginTop"),10)||0;s.left-=parseInt(i.css("marginLeft"),10)||0;for(var o=i.outerWidth(true),u=i.outerHeight(true),f=0;f<n;f++)for(var l=0;l<r;l++)i.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-l*(o/r),top:-f*(u/n)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:o/r,height:u/n,left:s.left+l*(o/r)+(t.options.mode=="show"?(l-Math.floor(r/2))*(o/r):0),top:s.top+f*(u/n)+(t.options.mode=="show"?(f-Math.floor(n/2))*(u/n):0),opacity:t.options.mode=="show"?0:1}).animate({left:s.left+l*(o/r)+(t.options.mode=="show"?0:(l-Math.floor(r/2))*(o/r)),top:s.top+f*(u/n)+(t.options.mode=="show"?0:(f-Math.floor(n/2))*(u/n)),opacity:t.options.mode=="show"?1:0},t.duration||500);setTimeout(function(){t.options.mode=="show"?i.css({visibility:"visible"}):i.css({visibility:"visible"}).hide();t.callback&&t.callback.apply(i[0]);i.dequeue();e("div.ui-effects-explode").remove()},t.duration||500)})}})(jQuery);(function(e){e.effects.fade=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"hide");n.animate({opacity:r},{queue:false,duration:t.duration,easing:t.options.easing,complete:function(){t.callback&&t.callback.apply(this,arguments);n.dequeue()}})})}})(jQuery);(function(e){e.effects.fold=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.size||15,o=!!t.options.horizFirst,u=t.duration?t.duration/2:e.fx.speeds._default/2;e.effects.save(n,r);n.show();var f=e.effects.createWrapper(n).css({overflow:"hidden"}),l=i=="show"!=o,h=l?["width","height"]:["height","width"];l=l?[f.width(),f.height()]:[f.height(),f.width()];var p=/([0-9]+)%/.exec(s);if(p)s=parseInt(p[1],10)/100*l[i=="hide"?0:1];if(i=="show")f.css(o?{height:0,width:s}:{height:s,width:0});o={};p={};o[h[0]]=i=="show"?l[0]:s;p[h[1]]=i=="show"?l[1]:0;f.animate(o,u,t.options.easing).animate(p,u,t.options.easing,function(){i=="hide"&&n.hide();e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(n[0],arguments);n.dequeue()})})}})(jQuery);(function(e){e.effects.highlight=function(t){return this.queue(function(){var n=e(this),r=["backgroundImage","backgroundColor","opacity"],i=e.effects.setMode(n,t.options.mode||"show"),s={backgroundColor:n.css("backgroundColor")};if(i=="hide")s.opacity=0;e.effects.save(n,r);n.show().css({backgroundImage:"none",backgroundColor:t.options.color||"#ffff99"}).animate(s,{queue:false,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide();e.effects.restore(n,r);i=="show"&&!e.support.opacity&&this.style.removeAttribute("filter");t.callback&&t.callback.apply(this,arguments);n.dequeue()}})})}})(jQuery);(function(e){e.effects.pulsate=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"show");times=(t.options.times||5)*2-1;duration=t.duration?t.duration/2:e.fx.speeds._default/2;isVisible=n.is(":visible");animateTo=0;if(!isVisible){n.css("opacity",0).show();animateTo=1}if(r=="hide"&&isVisible||r=="show"&&!isVisible)times--;for(r=0;r<times;r++){n.animate({opacity:animateTo},duration,t.options.easing);animateTo=(animateTo+1)%2}n.animate({opacity:animateTo},duration,t.options.easing,function(){animateTo==0&&n.hide();t.callback&&t.callback.apply(this,arguments)});n.queue("fx",function(){n.dequeue()}).dequeue()})}})(jQuery);(function(e){e.effects.puff=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"hide"),i=parseInt(t.options.percent,10)||150,s=i/100,o={height:n.height(),width:n.width()};e.extend(t.options,{fade:true,mode:r,percent:r=="hide"?i:100,from:r=="hide"?o:{height:o.height*s,width:o.width*s}});n.effect("scale",t.options,t.duration,t.callback);n.dequeue()})};e.effects.scale=function(t){return this.queue(function(){var n=e(this),r=e.extend(true,{},t.options),i=e.effects.setMode(n,t.options.mode||"effect"),s=parseInt(t.options.percent,10)||(parseInt(t.options.percent,10)==0?0:i=="hide"?0:100),o=t.options.direction||"both",u=t.options.origin;if(i!="effect"){r.origin=u||["middle","center"];r.restore=true}u={height:n.height(),width:n.width()};n.from=t.options.from||(i=="show"?{height:0,width:0}:u);s={y:o!="horizontal"?s/100:1,x:o!="vertical"?s/100:1};n.to={height:u.height*s.y,width:u.width*s.x};if(t.options.fade){if(i=="show"){n.from.opacity=0;n.to.opacity=1}if(i=="hide"){n.from.opacity=1;n.to.opacity=0}}r.from=n.from;r.to=n.to;r.mode=i;n.effect("size",r,t.duration,t.callback);n.dequeue()})};e.effects.size=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],i=["position","top","bottom","left","right","overflow","opacity"],s=["width","height","overflow"],o=["fontSize"],u=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],a=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],f=e.effects.setMode(n,t.options.mode||"effect"),l=t.options.restore||false,h=t.options.scale||"both",p=t.options.origin,d={height:n.height(),width:n.width()};n.from=t.options.from||d;n.to=t.options.to||d;if(p){p=e.effects.getBaseline(p,d);n.from.top=(d.height-n.from.height)*p.y;n.from.left=(d.width-n.from.width)*p.x;n.to.top=(d.height-n.to.height)*p.y;n.to.left=(d.width-n.to.width)*p.x}var v={from:{y:n.from.height/d.height,x:n.from.width/d.width},to:{y:n.to.height/d.height,x:n.to.width/d.width}};if(h=="box"||h=="both"){if(v.from.y!=v.to.y){r=r.concat(u);n.from=e.effects.setTransition(n,u,v.from.y,n.from);n.to=e.effects.setTransition(n,u,v.to.y,n.to)}if(v.from.x!=v.to.x){r=r.concat(a);n.from=e.effects.setTransition(n,a,v.from.x,n.from);n.to=e.effects.setTransition(n,a,v.to.x,n.to)}}if(h=="content"||h=="both")if(v.from.y!=v.to.y){r=r.concat(o);n.from=e.effects.setTransition(n,o,v.from.y,n.from);n.to=e.effects.setTransition(n,o,v.to.y,n.to)}e.effects.save(n,l?r:i);n.show();e.effects.createWrapper(n);n.css("overflow","hidden").css(n.from);if(h=="content"||h=="both"){u=u.concat(["marginTop","marginBottom"]).concat(o);a=a.concat(["marginLeft","marginRight"]);s=r.concat(u).concat(a);n.find("*[width]").each(function(){child=e(this);l&&e.effects.save(child,s);var n={height:child.height(),width:child.width()};child.from={height:n.height*v.from.y,width:n.width*v.from.x};child.to={height:n.height*v.to.y,width:n.width*v.to.x};if(v.from.y!=v.to.y){child.from=e.effects.setTransition(child,u,v.from.y,child.from);child.to=e.effects.setTransition(child,u,v.to.y,child.to)}if(v.from.x!=v.to.x){child.from=e.effects.setTransition(child,a,v.from.x,child.from);child.to=e.effects.setTransition(child,a,v.to.x,child.to)}child.css(child.from);child.animate(child.to,t.duration,t.options.easing,function(){l&&e.effects.restore(child,s)})})}n.animate(n.to,{queue:false,duration:t.duration,easing:t.options.easing,complete:function(){n.to.opacity===0&&n.css("opacity",n.from.opacity);f=="hide"&&n.hide();e.effects.restore(n,l?r:i);e.effects.removeWrapper(n);t.callback&&t.callback.apply(this,arguments);n.dequeue()}})})}})(jQuery);(function(e){e.effects.shake=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"];e.effects.setMode(n,t.options.mode||"effect");var i=t.options.direction||"left",s=t.options.distance||20,o=t.options.times||3,u=t.duration||t.options.duration||140;e.effects.save(n,r);n.show();e.effects.createWrapper(n);var f=i=="up"||i=="down"?"top":"left",l=i=="up"||i=="left"?"pos":"neg";i={};var c={},h={};i[f]=(l=="pos"?"-=":"+=")+s;c[f]=(l=="pos"?"+=":"-=")+s*2;h[f]=(l=="pos"?"-=":"+=")+s*2;n.animate(i,u,t.options.easing);for(s=1;s<o;s++)n.animate(c,u,t.options.easing).animate(h,u,t.options.easing);n.animate(c,u,t.options.easing).animate(i,u/2,t.options.easing,function(){e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(this,arguments)});n.queue("fx",function(){n.dequeue()});n.dequeue()})}})(jQuery);(function(e){e.effects.slide=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"show"),s=t.options.direction||"left";e.effects.save(n,r);n.show();e.effects.createWrapper(n).css({overflow:"hidden"});var o=s=="up"||s=="down"?"top":"left";s=s=="up"||s=="left"?"pos":"neg";var u=t.options.distance||(o=="top"?n.outerHeight({margin:true}):n.outerWidth({margin:true}));if(i=="show")n.css(o,s=="pos"?isNaN(u)?"-"+u:-u:u);var a={};a[o]=(i=="show"?s=="pos"?"+=":"-=":s=="pos"?"-=":"+=")+u;n.animate(a,{queue:false,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide();e.effects.restore(n,r);e.effects.removeWrapper(n);t.callback&&t.callback.apply(this,arguments);n.dequeue()}})})}})(jQuery);(function(e){e.effects.transfer=function(t){return this.queue(function(){var n=e(this),r=e(t.options.to),i=r.offset();r={top:i.top,left:i.left,height:r.innerHeight(),width:r.innerWidth()};i=n.offset();var s=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(t.options.className).css({top:i.top,left:i.left,height:n.innerHeight(),width:n.innerWidth(),position:"absolute"}).animate(r,t.duration,t.options.easing,function(){s.remove();t.callback&&t.callback.apply(n[0],arguments);n.dequeue()})})}})(jQuery);(function(e){var t=[],n,r=function(){for(var r=0;r<t.length;r++){if(e(t[r][0])[0]&&(t[r][2]||e(t[r][0]).next()[0]||e.isReady)){try{t[r][1].apply(e(t[r][0]).eq(0))}catch(i){if(typeof console!="undefined"){console.log(i)}}t.splice(r,1);r--}}if(!t.length||e.isReady){n=clearInterval(n)}};e.fn.available=function(e,i){i=i||false;t.push([this.selector,e,i]);if(!n){n=setInterval(r,1)}return this}})(jQuery);(function(e){e.fn.fitText=function(t,n){var r={minFontSize:Number.NEGATIVE_INFINITY,maxFontSize:Number.POSITIVE_INFINITY};return this.each(function(){var i=e(this);var s=t||1;if(n){e.extend(r,n)}var o=function(){i.css("font-size",Math.max(Math.min(i.width()/(s*10),parseFloat(r.maxFontSize)),parseFloat(r.minFontSize)))};o();e(window).resize(o)})}})(jQuery);jQuery.fn.autoSize=function(){return this.each(function(){var e=this.scrollHeight;var t=function(){n(this)};var n=function(t){var n=t.scrollHeight;if(n!==e){t.style.height=n+"px";e=n}};this.style.overflow="hidden";this.onkeydown=t;this.onfocus=t;this.onblur=t;this.onchange=t})};(function(e){e.fn.numeric=function(t,n){if(typeof t==="boolean"){t={decimal:t}}t=t||{};if(typeof t.negative=="undefined")t.negative=true;var r=t.decimal===false?"":t.decimal||".";var i=t.negative===true?true:false;var n=typeof n=="function"?n:function(){};return this.data("numeric.decimal",r).data("numeric.negative",i).data("numeric.callback",n).keypress(e.fn.numeric.keypress).keyup(e.fn.numeric.keyup).blur(e.fn.numeric.blur)};e.fn.numeric.keypress=function(t){var n=e.data(this,"numeric.decimal");var r=e.data(this,"numeric.negative");var i=t.charCode?t.charCode:t.keyCode?t.keyCode:0;if(i==13&&this.nodeName.toLowerCase()=="input"){return true}else if(i==13){return false}var s=false;if(t.ctrlKey&&i==97||t.ctrlKey&&i==65)return true;if(t.ctrlKey&&i==120||t.ctrlKey&&i==88)return true;if(t.ctrlKey&&i==99||t.ctrlKey&&i==67)return true;if(t.ctrlKey&&i==122||t.ctrlKey&&i==90)return true;if(t.ctrlKey&&i==118||t.ctrlKey&&i==86||t.shiftKey&&i==45)return true;if(i<48||i>57){if(this.value.indexOf("-")!=0&&r&&i==45&&(this.value.length==0||e.fn.getSelectionStart(this)==0))return true;if(n&&i==n.charCodeAt(0)&&this.value.indexOf(n)!=-1){s=false}if(i!=8&&i!=9&&i!=13&&i!=35&&i!=36&&i!=37&&i!=39&&i!=46){s=false}else{if(typeof t.charCode!="undefined"){if(t.keyCode==t.which&&t.which!=0){s=true;if(t.which==46)s=false}else if(t.keyCode!=0&&t.charCode==0&&t.which==0){s=true}}}if(n&&i==n.charCodeAt(0)){if(this.value.indexOf(n)==-1){s=true}else{s=false}}}else{s=true}return s};e.fn.numeric.keyup=function(t){var n=this.value;if(n.length>0){var r=e.fn.getSelectionStart(this);var i=e.data(this,"numeric.decimal");var s=e.data(this,"numeric.negative");if(i!=""){var o=n.indexOf(i);if(o==0){this.value="0"+n}if(o==1&&n.charAt(0)=="-"){this.value="-0"+n.substring(1)}n=this.value}var u=[0,1,2,3,4,5,6,7,8,9,"-",i];var a=n.length;for(var f=a-1;f>=0;f--){var l=n.charAt(f);if(f!=0&&l=="-"){n=n.substring(0,f)+n.substring(f+1)}else if(f==0&&!s&&l=="-"){n=n.substring(1)}var c=false;for(var h=0;h<u.length;h++){if(l==u[h]){c=true;break}}if(!c||l==" "){n=n.substring(0,f)+n.substring(f+1)}}var p=n.indexOf(i);if(p>0){for(var f=a-1;f>p;f--){var l=n.charAt(f);if(l==i){n=n.substring(0,f)+n.substring(f+1)}}}this.value=n;e.fn.setSelection(this,r)}};e.fn.numeric.blur=function(){var t=e.data(this,"numeric.decimal");var n=e.data(this,"numeric.callback");var r=this.value;if(r!=""){var i=new RegExp("^\\d+$|\\d*"+t+"\\d+");if(!i.exec(r)){n.apply(this)}}};e.fn.removeNumeric=function(){return this.data("numeric.decimal",null).data("numeric.negative",null).data("numeric.callback",null).unbind("keypress",e.fn.numeric.keypress).unbind("blur",e.fn.numeric.blur)};e.fn.getSelectionStart=function(e){if(e.createTextRange){var t=document.selection.createRange().duplicate();t.moveEnd("character",e.value.length);if(t.text=="")return e.value.length;return e.value.lastIndexOf(t.text)}else return e.selectionStart};e.fn.setSelection=function(e,t){if(typeof t=="number")t=[t,t];if(t&&t.constructor==Array&&t.length==2){if(e.createTextRange){var n=e.createTextRange();n.collapse(true);n.moveStart("character",t[0]);n.moveEnd("character",t[1]);n.select()}else if(e.setSelectionRange){e.focus();e.setSelectionRange(t[0],t[1])}}}})(jQuery);if(!window.Seadragon){window.Seadragon={}}var Seadragon=window.Seadragon;var SeadragonConfig=Seadragon.Config;(function(){if(SeadragonConfig){return}SeadragonConfig=Seadragon.Config={debugMode:false,animationTime:1.5,blendTime:.5,alwaysBlend:false,autoHideControls:true,constrainDuringPan:true,immediateRender:false,logarithmicZoom:true,wrapHorizontal:false,wrapVertical:false,wrapOverlays:false,transformOverlays:false,minZoomDimension:null,minZoomImageRatio:.8,maxZoomPixelRatio:2,visibilityRatio:.8,springStiffness:5,imageLoaderLimit:2,clickTimeThreshold:200,clickDistThreshold:25,zoomPerClick:2,zoomPerScroll:Math.pow(2,1/3),zoomPerSecond:2,proxyUrl:null,imagePath:"img/",fps:60}})();var SeadragonStrings=Seadragon.Strings;(function(){if(SeadragonStrings){return}SeadragonStrings=Seadragon.Strings={Errors:{Failure:"Sorry, but Seadragon Ajax can't run on your browser!\n"+"Please try using IE 8 or Firefox 3.\n",Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Empty:"You asked us to open nothing, so we did just that.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from "+"loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",Unknown:"Whoops, something inexplicably went wrong. Sorry!"},Messages:{Loading:"Loading..."},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in (you can also use your mouse's scroll wheel)",ZoomOut:"Zoom out (you can also use your mouse's scroll wheel)"}};SeadragonStrings.getString=function(e){var t=e.split(".");var n=SeadragonStrings;for(var r=0;r<t.length;r++){n=n[t[r]]||{}}if(typeof n!="string"){n=""}var i=arguments;return n.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/))+1;return t<i.length?i[t]:""})};SeadragonStrings.setString=function(e,t){var n=e.split(".");var r=SeadragonStrings;for(var i=0;i<n.length-1;i++){if(!r[n[i]]){r[n[i]]={}}r=r[n[i]]}r[n[i]]=t}})();var SeadragonDebug=function(){this.log=function(e,t){var n=window.console||{};var r=SeadragonConfig.debugMode;if(r&&n.log){n.log(e)}else if(r&&t){alert(e)}};this.error=function(e,t){var n=window.console||{};var r=SeadragonConfig.debugMode;if(r&&n.error){n.error(e)}else if(r){alert(e)}if(r){throw t||new Error(e)}};this.fail=function(e){alert(SeadragonStrings.getString("Errors.Failure"));throw new Error(e)}};SeadragonDebug=Seadragon.Debug=new SeadragonDebug;var SeadragonProfiler=Seadragon.Profiler=function(){var e=this;var t=false;var n=0;var r=null;var i=null;var s=Infinity;var o=0;var u=0;var a=Infinity;var f=0;var l=0;this.getAvgUpdateTime=function(){return o};this.getMinUpdateTime=function(){return s};this.getMaxUpdateTime=function(){return u};this.getAvgIdleTime=function(){return f};this.getMinIdleTime=function(){return a};this.getMaxIdleTime=function(){return l};this.isMidUpdate=function(){return t};this.getNumUpdates=function(){return n};this.beginUpdate=function(){if(t){e.endUpdate()}t=true;r=Date.now();if(n<1){return}var s=r-i;f=(f*(n-1)+s)/n;if(s<a){a=s}if(s>l){l=s}};this.endUpdate=function(){if(!t){return}i=Date.now();t=false;var e=i-r;n++;o=(o*(n-1)+e)/n;if(e<s){s=e}if(e>u){u=e}};this.clearProfile=function(){t=false;n=0;r=null;i=null;s=Infinity;o=0;u=0;a=Infinity;f=0;l=0}};var SeadragonPoint=Seadragon.Point;(function(){if(SeadragonPoint){return}SeadragonPoint=Seadragon.Point=function(e,t){this.x=typeof e=="number"?e:0;this.y=typeof t=="number"?t:0};var e=SeadragonPoint.prototype;e.plus=function(e){return new SeadragonPoint(this.x+e.x,this.y+e.y)};e.minus=function(e){return new SeadragonPoint(this.x-e.x,this.y-e.y)};e.times=function(e){return new SeadragonPoint(this.x*e,this.y*e)};e.divide=function(e){return new SeadragonPoint(this.x/e,this.y/e)};e.negate=function(){return new SeadragonPoint(-this.x,-this.y)};e.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))};e.distance2To=function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)};e.apply=function(e){return new SeadragonPoint(e(this.x),e(this.y))};e.equals=function(e){return e instanceof SeadragonPoint&&this.x===e.x&&this.y===e.y};e.toString=function(){return"("+this.x+","+this.y+")"}})();var SeadragonRect=Seadragon.Rect;(function(){if(SeadragonRect){return}SeadragonRect=Seadragon.Rect=function(e,t,n,r){this.x=typeof e=="number"?e:0;this.y=typeof t=="number"?t:0;this.width=typeof n=="number"?n:0;this.height=typeof r=="number"?r:0};var e=SeadragonRect.prototype;e.getAspectRatio=function(){return this.width/this.height};e.getTopLeft=function(){return new SeadragonPoint(this.x,this.y)};e.getBottomRight=function(){return new SeadragonPoint(this.x+this.width,this.y+this.height)};e.getCenter=function(){return new SeadragonPoint(this.x+this.width/2,this.y+this.height/2)};e.getSize=function(){return new SeadragonPoint(this.width,this.height)};e.equals=function(e){return e instanceof SeadragonRect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height};e.toString=function(){return"["+this.x+","+this.y+","+this.width+"x"+this.height+"]"}})();var SeadragonSpring=Seadragon.Spring=function(e){function u(e){var t=SeadragonConfig.springStiffness;return(1-Math.exp(-e*t))/(1-Math.exp(-t))}var t=typeof e=="number"?e:0;var n=t;var r=t;var i=Date.now();var s=i;var o=i;this.getCurrent=function(){return t};this.getTarget=function(){return r};this.resetTo=function(e){r=e;o=i;n=r;s=o};this.springTo=function(e){n=t;s=i;r=e;o=s+1e3*SeadragonConfig.animationTime};this.shiftBy=function(e){n+=e;r+=e};this.update=function(){i=Date.now();t=i>=o?r:n+(r-n)*u((i-s)/(o-s))}};var SeadragonBrowser=Seadragon.Browser={UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5};var SeadragonUtils=function(){function u(e,t){if(t&&e!=document.body){return document.body}else{return e.offsetParent}}var e=this;var t=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"];var n={bmp:false,jpeg:true,jpg:true,png:true,tif:false,wdp:false};var r=SeadragonBrowser.UNKNOWN;var i=0;var s=false;var o={};(function(){var e=navigator.appName;var t=navigator.appVersion;var n=navigator.userAgent;if(e=="Microsoft Internet Explorer"&&!!window.attachEvent&&!!window.ActiveXObject){var u=n.indexOf("MSIE");r=SeadragonBrowser.IE;i=parseFloat(n.substring(u+5,n.indexOf(";",u)));var a=document.documentMode;if(typeof a!=="undefined"){i=a}}else if(e=="Netscape"&&!!window.addEventListener){var f=n.indexOf("Firefox");var l=n.indexOf("Safari");var c=n.indexOf("Chrome");if(f>=0){r=SeadragonBrowser.FIREFOX;i=parseFloat(n.substring(f+8))}else if(l>=0){var h=n.substring(0,l).lastIndexOf("/");r=c>=0?SeadragonBrowser.CHROME:SeadragonBrowser.SAFARI;i=parseFloat(n.substring(h+1,l))}}else if(e=="Opera"&&!!window.opera&&!!window.attachEvent){r=SeadragonBrowser.OPERA;i=parseFloat(t)}var p=window.location.search.substring(1);var d=p.split("&");for(var v=0;v<d.length;v++){var m=d[v];var g=m.indexOf("=");if(g>0){o[m.substring(0,g)]=decodeURIComponent(m.substring(g+1))}}s=r==SeadragonBrowser.IE&&i<9||r==SeadragonBrowser.CHROME&&i<2})();this.getBrowser=function(){return r};this.getBrowserVersion=function(){return i};this.getElement=function(e){if(typeof e=="string"){e=document.getElementById(e)}return e};this.getElementPosition=function(t){var t=e.getElement(t);var n=new SeadragonPoint;var r=e.getElementStyle(t).position=="fixed";var i=u(t,r);while(i){n.x+=t.offsetLeft;n.y+=t.offsetTop;if(r){n=n.plus(e.getPageScroll())}t=i;r=e.getElementStyle(t).position=="fixed";i=u(t,r)}return n};this.getElementSize=function(t){var t=e.getElement(t);return new SeadragonPoint(t.clientWidth,t.clientHeight)};this.getElementStyle=function(t){var t=e.getElement(t);if(t.currentStyle){return t.currentStyle}else if(window.getComputedStyle){return window.getComputedStyle(t,"")}else{SeadragonDebug.fail("Unknown element style, no known technique.")}};this.getEvent=function(e){return e?e:window.event};this.getMousePosition=function(t){var t=e.getEvent(t);var n=new SeadragonPoint;if(t.type=="DOMMouseScroll"&&r==SeadragonBrowser.FIREFOX&&i<3){n.x=t.screenX;n.y=t.screenY}else if(typeof t.pageX=="number"){n.x=t.pageX;n.y=t.pageY}else if(typeof t.clientX=="number"){n.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;n.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop}else{SeadragonDebug.fail("Unknown event mouse position, no known technique.")}return n};this.getMouseScroll=function(t){var t=e.getEvent(t);var n=0;if(typeof t.wheelDelta=="number"){n=t.wheelDelta}else if(typeof t.detail=="number"){n=t.detail*-1}else{SeadragonDebug.fail("Unknown event mouse scroll, no known technique.")}return n?n/Math.abs(n):0};this.getPageScroll=function(){var e=new SeadragonPoint;var t=document.documentElement||{};var n=document.body||{};if(typeof window.pageXOffset=="number"){e.x=window.pageXOffset;e.y=window.pageYOffset}else if(n.scrollLeft||n.scrollTop){e.x=n.scrollLeft;e.y=n.scrollTop}else if(t.scrollLeft||t.scrollTop){e.x=t.scrollLeft;e.y=t.scrollTop}return e};this.getWindowSize=function(){var e=new SeadragonPoint;var t=document.documentElement||{};var n=document.body||{};if(typeof window.innerWidth=="number"){e.x=window.innerWidth;e.y=window.innerHeight}else if(t.clientWidth||t.clientHeight){e.x=t.clientWidth;e.y=t.clientHeight}else if(n.clientWidth||n.clientHeight){e.x=n.clientWidth;e.y=n.clientHeight}else{SeadragonDebug.fail("Unknown window size, no known technique.")}return e};this.imageFormatSupported=function(e){var e=e?e:"";return!!n[e.toLowerCase()]};this.makeCenteredNode=function(t){var t=SeadragonUtils.getElement(t);var n=e.makeNeutralElement("div");var r=[];r.push('<div style="display:table; height:100%; width:100%;');r.push("border:none; margin:0px; padding:0px;");r.push('#position:relative; overflow:hidden; text-align:left;">');r.push('<div style="#position:absolute; #top:50%; width:100%; ');r.push("border:none; margin:0px; padding:0px;");r.push('display:table-cell; vertical-align:middle;">');r.push('<div style="#position:relative; #top:-50%; width:100%; ');r.push("border:none; margin:0px; padding:0px;");r.push('text-align:center;"></div></div></div>');n.innerHTML=r.join("");n=n.firstChild;var i=n;var s=n.getElementsByTagName("div");while(s.length>0){i=s[0];s=i.getElementsByTagName("div")}i.appendChild(t);return n};this.makeNeutralElement=function(e){var t=document.createElement(e);var n=t.style;n.background="transparent none";n.border="none";n.margin="0px";n.padding="0px";n.position="static";return t};this.makeTransparentImage=function(t){var n=e.makeNeutralElement("img");var s=null;if(r==SeadragonBrowser.IE&&i<7){s=e.makeNeutralElement("span");s.style.display="inline-block";n.onload=function(){s.style.width=s.style.width||n.width+"px";s.style.height=s.style.height||n.height+"px";n.onload=null;n=null};n.src=t;s.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')"}else{s=n;s.src=t}return s};this.setElementOpacity=function(t,n,r){var t=e.getElement(t);if(r&&s){n=Math.round(n)}if(n<1){t.style.opacity=n}else{t.style.opacity=""}var i=t.style.filter||"";t.style.filter=i.replace(/[\s]*alpha\(.*?\)[\s]*/g,"");if(n>=1){return}var o=Math.round(100*n);var u=" alpha(opacity="+o+") ";t.style.filter+=u};this.addEvent=function(t,n,r,i){var t=e.getElement(t);if(t.addEventListener){if(n=="mousewheel"){t.addEventListener("DOMMouseScroll",r,i)}t.addEventListener(n,r,i)}else if(t.attachEvent){t.attachEvent("on"+n,r);if(i&&t.setCapture){t.setCapture()}}else{SeadragonDebug.fail("Unable to attach event handler, no known technique.")}};this.removeEvent=function(t,n,r,i){var t=e.getElement(t);if(t.removeEventListener){if(n=="mousewheel"){t.removeEventListener("DOMMouseScroll",r,i)}t.removeEventListener(n,r,i)}else if(t.detachEvent){t.detachEvent("on"+n,r);if(i&&t.releaseCapture){t.releaseCapture()}}else{SeadragonDebug.fail("Unable to detach event handler, no known technique.")}};this.cancelEvent=function(t){var t=e.getEvent(t);if(t.preventDefault){t.preventDefault()}t.cancel=true;t.returnValue=false};this.stopEvent=function(t){var t=e.getEvent(t);if(t.stopPropagation){t.stopPropagation()}t.cancelBubble=true};this.createCallback=function(e,t){var n=[];for(var r=2;r<arguments.length;r++){n.push(arguments[r])}return function(){var r=n.concat([]);for(var i=0;i<arguments.length;i++){r.push(arguments[i])}return t.apply(e,r)}};this.getUrlParameter=function(e){var t=o[e];return t?t:null};this.makeAjaxRequest=function(e,n){var r=typeof n=="function";var i=null;if(r){var s=n;var n=function(){window.setTimeout(SeadragonUtils.createCallback(null,s,i),1)}}if(false&&window.ActiveXObject){for(var o=0;o<t.length;o++){try{i=new ActiveXObject(t[o]);break}catch(u){continue}}}else if(window.XMLHttpRequest){i=new XMLHttpRequest}if(!i){SeadragonDebug.fail("Browser doesn't support XMLHttpRequest.")}if(SeadragonConfig.proxyUrl){e=SeadragonConfig.proxyUrl+e}if(r){i.onreadystatechange=function(){if(i.readyState==4){i.onreadystatechange=new Function;n()}}}try{i.open("GET",e,r);i.send(null)}catch(u){SeadragonDebug.log(u.name+" while making AJAX request: "+u.message);i.onreadystatechange=null;i=null;if(r){n()}}return r?null:i};this.parseXml=function(e){var t=null;if(window.ActiveXObject){try{t=new ActiveXObject("Microsoft.XMLDOM");t.async=false;t.loadXML(e)}catch(n){SeadragonDebug.log(n.name+" while parsing XML (ActiveX): "+n.message);console.log("error creating ActiveXObject in Seadragon.Utils parseXml")}}else if(window.DOMParser){try{var r=new DOMParser;t=r.parseFromString(e,"text/xml")}catch(n){SeadragonDebug.log(n.name+" while parsing XML (DOMParser): "+n.message)}}else{SeadragonDebug.fail("Browser doesn't support XML DOM.")}return t}};SeadragonUtils=Seadragon.Utils=new SeadragonUtils;var SeadragonMouseTracker=Seadragon.MouseTracker;(function(){function s(e){return SeadragonUtils.getMousePosition(e)}function o(e,t){var n=SeadragonUtils.getMousePosition(e);var r=SeadragonUtils.getElementPosition(t);return n.minus(r)}function u(e,t){var n=document.body;while(t&&e!=t&&n!=t){try{t=t.parentNode}catch(r){return false}}return e==t}function a(){t=true}function f(){t=false}if(SeadragonMouseTracker){return}var e=SeadragonUtils.getBrowser()==SeadragonBrowser.IE&&SeadragonUtils.getBrowserVersion()<9;var t=false;var n=false;var r={};var i=[];(function(){if(e){SeadragonUtils.addEvent(document,"mousedown",a,false);SeadragonUtils.addEvent(document,"mouseup",f,false)}else{SeadragonUtils.addEvent(window,"mousedown",a,true);SeadragonUtils.addEvent(window,"mouseup",f,true)}})();SeadragonMouseTracker=Seadragon.MouseTracker=function(a){function b(){if(!h){SeadragonUtils.addEvent(a,"mouseover",N,false);SeadragonUtils.addEvent(a,"mouseout",C,false);SeadragonUtils.addEvent(a,"mousedown",k,false);SeadragonUtils.addEvent(a,"mouseup",L,false);SeadragonUtils.addEvent(a,"mousewheel",H,false);SeadragonUtils.addEvent(a,"click",M,false);h=true;r[c]=l}}function w(){if(h){SeadragonUtils.removeEvent(a,"mouseover",N,false);SeadragonUtils.removeEvent(a,"mouseout",C,false);SeadragonUtils.removeEvent(a,"mousedown",k,false);SeadragonUtils.removeEvent(a,"mouseup",L,false);SeadragonUtils.removeEvent(a,"mousewheel",H,false);SeadragonUtils.removeEvent(a,"click",M,false);S();h=false;delete r[c]}}function E(){if(!p){if(e){SeadragonUtils.removeEvent(a,"mouseup",L,false);SeadragonUtils.addEvent(a,"mouseup",A,true);SeadragonUtils.addEvent(a,"mousemove",P,true)}else{SeadragonUtils.addEvent(window,"mouseup",O,true);SeadragonUtils.addEvent(window,"mousemove",D,true)}p=true}}function S(){if(p){if(e){SeadragonUtils.removeEvent(a,"mousemove",P,true);SeadragonUtils.removeEvent(a,"mouseup",A,true);SeadragonUtils.addEvent(a,"mouseup",L,false)}else{SeadragonUtils.removeEvent(window,"mousemove",D,true);SeadragonUtils.removeEvent(window,"mouseup",O,true)}p=false}}function x(e,t){var n=r;for(var i in n){if(n.hasOwnProperty(i)&&c!=i){n[i][e](t)}}}function T(){return v}function N(n){var n=SeadragonUtils.getEvent(n);if(e&&p&&!u(n.srcElement,a)){x("onMouseOver",n)}var r=n.target?n.target:n.srcElement;var i=n.relatedTarget?n.relatedTarget:n.fromElement;if(!u(a,r)||u(a,i)){return}v=true;if(typeof f.enterHandler=="function"){try{f.enterHandler(f,o(n,a),d,t)}catch(s){SeadragonDebug.error(s.name+" while executing enter handler: "+s.message,s)}}}function C(n){var n=SeadragonUtils.getEvent(n);if(e&&p&&!u(n.srcElement,a)){x("onMouseOut",n)}var r=n.target?n.target:n.srcElement;var i=n.relatedTarget?n.relatedTarget:n.toElement;if(!u(a,r)||u(a,i)){return}v=false;if(typeof f.exitHandler=="function"){try{f.exitHandler(f,o(n,a),d,t)}catch(s){SeadragonDebug.error(s.name+" while executing exit handler: "+s.message,s)}}}function k(t){var t=SeadragonUtils.getEvent(t);if(t.button==2){return}d=true;m=s(t);y=m;g=Date.now();if(typeof f.pressHandler=="function"){try{f.pressHandler(f,o(t,a))}catch(r){SeadragonDebug.error(r.name+" while executing press handler: "+r.message,r)}}if(f.pressHandler||f.dragHandler){SeadragonUtils.cancelEvent(t)}if(!e||!n){E();n=true;i=[l]}else if(e){i.push(l)}}function L(e){var e=SeadragonUtils.getEvent(e);var t=d;var n=v;if(e.button==2){return}d=false;if(typeof f.releaseHandler=="function"){try{f.releaseHandler(f,o(e,a),t,n)}catch(r){SeadragonDebug.error(r.name+" while executing release handler: "+r.message,r)}}if(t&&n){_(e)}}function A(e){var e=SeadragonUtils.getEvent(e);if(e.button==2){return}for(var t=0;t<i.length;t++){var r=i[t];if(!r.hasMouse()){r.onMouseUp(e)}}S();n=false;e.srcElement.fireEvent("on"+e.type,document.createEventObject(e));SeadragonUtils.stopEvent(e)}function O(e){if(!v){L(e)}S()}function M(e){if(f.clickHandler){SeadragonUtils.cancelEvent(e)}}function _(e){var e=SeadragonUtils.getEvent(e);if(e.button==2){return}var t=Date.now()-g;var n=s(e);var r=y.distance2To(n);var i=t<=SeadragonConfig.clickTimeThreshold&&r<=SeadragonConfig.clickDistThreshold;if(typeof f.clickHandler=="function"){try{f.clickHandler(f,o(e,a),i,e.shiftKey)}catch(u){SeadragonDebug.error(u.name+" while executing click handler: "+u.message,u)}}}function D(e){var e=SeadragonUtils.getEvent(e);var t=s(e);var n=t.minus(m);m=t;if(typeof f.dragHandler=="function"){try{f.dragHandler(f,o(e,a),n,e.shiftKey)}catch(r){SeadragonDebug.error(r.name+" while executing drag handler: "+r.message,r)}SeadragonUtils.cancelEvent(e)}}function P(e){for(var t=0;t<i.length;t++){i[t].onMouseMove(e)}SeadragonUtils.stopEvent(e)}function H(e){var e=SeadragonUtils.getEvent(e);var t=SeadragonUtils.getMouseScroll(e);if(typeof f.scrollHandler=="function"){if(t){try{f.scrollHandler(f,o(e,a),t,e.shiftKey)}catch(n){SeadragonDebug.error(n.name+" while executing scroll handler: "+n.message,n)}}SeadragonUtils.cancelEvent(e)}}var f=this;var l=null;var c=Math.random();var a=SeadragonUtils.getElement(a);var h=false;var p=false;var d=false;var v=false;var m=null;var g=null;var y=null;this.target=a;this.enterHandler=null;this.exitHandler=null;this.pressHandler=null;this.releaseHandler=null;this.clickHandler=null;this.dragHandler=null;this.scrollHandler=null;(function(){l={hasMouse:T,onMouseOver:N,onMouseOut:C,onMouseUp:L,onMouseMove:D}})();this.isTracking=function(){return h};this.setTracking=function(e){if(e){b()}else{w()}}}})();var SeadragonEventManager=Seadragon.EventManager=function(){var e={};this.addListener=function(t,n){if(typeof n!="function"){return}if(!e[t]){e[t]=[]}e[t].push(n)};this.removeListener=function(t,n){var r=e[t];if(typeof n!="function"){return}else if(!r){return}for(var i=0;i<r.length;i++){if(n==r[i]){r.splice(i,1);return}}};this.clearListeners=function(t){if(e[t]){delete e[t]}};this.trigger=function(t){var n=e[t];var r=[];if(!n){return}for(var i=1;i<arguments.length;i++){r.push(arguments[i])}for(var i=0;i<n.length;i++){try{n[i].apply(window,r)}catch(s){SeadragonDebug.error(s.name+" while executing "+t+" handler: "+s.message,s)}}}};var SeadragonImageLoader;(function(){function t(e,t){this.src=e;this.callback=t;this.image=null;this.timeout=null;this.running=false}var e=15e3;t.prototype.start=function(){var t=this;if(!t.running){t.running=true;t.image=new Image;var n=function(){t.finish(true)};var r=function(){t.finish(false)};var i=function(){SeadragonDebug.log("Image timed out: "+t.src);t.finish(false)};t.image.onload=n;t.image.onabort=r;t.image.onerror=r;t.timeout=window.setTimeout(i,e);t.image.src=t.src}};t.prototype.finish=function(e){this.image.onload=null;this.image.onabort=null;this.image.onerror=null;if(this.timeout){window.clearTimeout(this.timeout)}this.callback(this.src,e?this.image:null)};SeadragonImageLoader=Seadragon.ImageLoader=function(){function r(t,r,i){var s;e--;if(typeof t==="function"){setTimeout(function(){try{t(i)}catch(e){SeadragonDebug.error(e.name+" while executing "+r+" callback: "+e.message,e)}},2)}while(e<SeadragonConfig.imageLoaderLimit&&n.length>0){s=n.shift();if(!s.tile.loaded){setTimeout(s.job.start(),2);e++}}}var e=0,n=[];this.loadImage=function(i,s){var o=SeadragonUtils.createCallback(null,r,s);var u=new t(i.url,o);if(e>=SeadragonConfig.imageLoaderLimit){n.push({job:u,tile:i})}else{e++;u.start()}i.loading=true};this.clear=function(){n.map(function(e){e.tile.loading=false});n=[]}}})();var SeadragonButton,SeadragonButtonGroup;(function(){var e={REST:0,GROUP:1,HOVER:2,DOWN:3};SeadragonButton=Seadragon.Button=function(t,n,r,i,s,o,u,a,f,l){function S(){window.setTimeout(x,20)}function x(){if(E){var e=(new Date).getTime();var t=e-w;var n=1-t/b;n=Math.min(1,n);n=Math.max(0,n);SeadragonUtils.setElementOpacity(v,n,true);if(n>0){S()}}}function T(){E=true;w=(new Date).getTime()+y;window.setTimeout(S,y)}function N(){E=false;SeadragonUtils.setElementOpacity(v,1,true)}function C(t){if(t>=e.GROUP&&h==e.REST){N();h=e.GROUP}if(t>=e.HOVER&&h==e.GROUP){m.style.visibility="";h=e.HOVER}if(t>=e.DOWN&&h==e.HOVER){g.style.visibility="";h=e.DOWN}}function k(t){if(t<=e.HOVER&&h==e.DOWN){g.style.visibility="hidden";h=e.HOVER}if(t<=e.GROUP&&h==e.HOVER){m.style.visibility="hidden";h=e.GROUP}if(t<=e.REST&&h==e.GROUP){h=e.REST}}function L(t,n,r,i){if(r){C(e.DOWN);if(f){f()}}else if(!i){C(e.HOVER)}}function A(t,n,r,i){k(e.GROUP);if(r&&l){l()}}function O(t,n){C(e.DOWN);if(o){o()}}function M(t,n,r,i){if(r&&i){k(e.HOVER);if(u){u()}}else if(r){k(e.GROUP)}else{C(e.HOVER)}}function _(e,t,n,r){if(a&&n){a()}}var c=SeadragonUtils.makeNeutralElement("span");var h=e.GROUP;var p=new SeadragonMouseTracker(c);var d=SeadragonUtils.makeTransparentImage(n);var v=SeadragonUtils.makeTransparentImage(r);var m=SeadragonUtils.makeTransparentImage(i);var g=SeadragonUtils.makeTransparentImage(s);var o=typeof o=="function"?o:null;var u=typeof u=="function"?u:null;var a=typeof a=="function"?a:null;var f=typeof f=="function"?f:null;var l=typeof l=="function"?l:null;var y=0;var b=2e3;var w=null;var E=false;this.elmt=c;this.notifyGroupEnter=function(){C(e.GROUP)};this.notifyGroupExit=function(){k(e.REST)};(function(){c.style.display="inline-block";c.style.position="relative";c.title=t;c.appendChild(d);c.appendChild(v);c.appendChild(m);c.appendChild(g);var n=d.style;var r=v.style;var i=m.style;var s=g.style;r.position=i.position=s.position="absolute";r.top=i.top=s.top="0px";r.left=i.left=s.left="0px";i.visibility=s.visibility="hidden";if(SeadragonUtils.getBrowser()==SeadragonBrowser.FIREFOX&&SeadragonUtils.getBrowserVersion()<3){r.top=i.top=s.top=""}p.enterHandler=L;p.exitHandler=A;p.pressHandler=O;p.releaseHandler=M;p.clickHandler=_;p.setTracking(true);k(e.REST)})()};SeadragonButtonGroup=Seadragon.ButtonGroup=function(e){function r(t,n,r,i){for(var s=0;s<e.length;s++){e[s].notifyGroupEnter()}}function i(t,n,r,i){if(!r){for(var s=0;s<e.length;s++){e[s].notifyGroupExit()}}}function s(t,n,r,i){if(!i){for(var s=0;s<e.length;s++){e[s].notifyGroupExit()}}}var t=SeadragonUtils.makeNeutralElement("span");var e=e.concat([]);var n=new SeadragonMouseTracker(t);this.elmt=t;this.emulateEnter=function(){r()};this.emulateExit=function(){i()};(function(){t.style.display="inline-block";for(var o=0;o<e.length;o++){t.appendChild(e[o].elmt)}n.enterHandler=r;n.exitHandler=i;n.releaseHandler=s;n.setTracking(true)})()}})();var SeadragonTileSource=Seadragon.TileSource=function(e,t,n,r,i,s){var o=this;var u=t/e;this.width=e;this.height=t;this.aspectRatio=e/t;this.dimensions=new SeadragonPoint(e,t);this.minLevel=i?i:0;this.maxLevel=s?s:Math.ceil(Math.log(Math.max(e,t))/Math.log(2));this.tileSize=n?n:0;this.tileOverlap=r?r:0;this.getLevelScale=function(e){return 1/(1<<o.maxLevel-e)};this.getNumTiles=function(n){var r=o.getLevelScale(n);var i=Math.ceil(r*e/o.tileSize);var s=Math.ceil(r*t/o.tileSize);return new SeadragonPoint(i,s)};this.getPixelRatio=function(e){var t=o.dimensions.times(o.getLevelScale(e));var n=1/t.x;var r=1/t.y;return new SeadragonPoint(n,r)};this.getTileAtPoint=function(e,t){var n=o.dimensions.times(o.getLevelScale(e));var r=t.times(n.x);var i,s;if(t.x>=0&&t.x<=1){i=Math.floor(r.x/o.tileSize)}else{i=Math.ceil(n.x/o.tileSize)*Math.floor(r.x/n.x)+Math.floor((n.x+r.x%n.x)%n.x/o.tileSize)}if(t.y>=0&&t.y<=u){s=Math.floor(r.y/o.tileSize)}else{s=Math.ceil(n.y/o.tileSize)*Math.floor(r.y/n.y)+Math.floor((n.y+r.y%n.y)%n.y/o.tileSize)}return new SeadragonPoint(i,s)};this.getTileBounds=function(e,t,n){var r=o.dimensions.times(o.getLevelScale(e));var i=t===0?0:o.tileSize*t-o.tileOverlap;var s=n===0?0:o.tileSize*n-o.tileOverlap;var u=o.tileSize+(t===0?1:2)*o.tileOverlap;var a=o.tileSize+(n===0?1:2)*o.tileOverlap;u=Math.min(u,r.x-i);a=Math.min(a,r.y-s);var f=1/r.x;return new SeadragonRect(i*f,s*f,u*f,a*f)};this.getTileUrl=function(e,t,n){throw new Error("Method not implemented.")};this.tileExists=function(e,t,n){var r=o.getNumTiles(e);return e>=o.minLevel&&e<=o.maxLevel&&t>=0&&n>=0&&t<r.x&&n<r.y}};var SeadragonDisplayRect=Seadragon.DisplayRect=function(e,t,n,r,i,s){SeadragonRect.apply(this,arguments);this.minLevel=i;this.maxLevel=s};SeadragonDisplayRect.prototype=new SeadragonRect;var SeadragonDziTileSource=Seadragon.DziTileSource=function(e,t,n,r,i,s,o){SeadragonTileSource.apply(this,[e,t,n,r]);var u=this;var a={};this.fileFormat=s;this.tileFormat=s;this.displayRects=o;(function(){if(!o){return}for(var e=o.length-1;e>=0;e--){var t=o[e];for(var n=t.minLevel;n<=t.maxLevel;n++){if(!a[n]){a[n]=[]}a[n].push(t)}}})();this.getTileUrl=function(e,t,n){return[i,e,"/",t,"_",n,".",s].join("")};this.tileExists=function(e,t,r){var i=a[e];if(!i||!i.length){return true}var s=u.getLevelScale(e);for(var o=i.length-1;o>=0;o--){var f=i[o];if(e<f.minLevel||e>f.maxLevel){continue}var l=f.x*s;var c=f.y*s;var h=l+f.width*s;var p=c+f.height*s;l=Math.floor(l/n);c=Math.floor(c/n);h=Math.ceil(h/n);p=Math.ceil(p/n);if(l<=t&&t<h&&c<=r&&r<p){return true}}return false}};SeadragonDziTileSource.prototype=new SeadragonTileSource;(function(){function e(e){Error.apply(this,arguments);this.message=e}function t(t){if(!(t instanceof e)){SeadragonDebug.error(t.name+" while creating DZI from XML: "+t.message);t=new e(SeadragonStrings.getString("Errors.Unknown"))}return t}function n(e){var t=e.split("/");var n=t[t.length-1];var r=n.lastIndexOf(".");if(r>-1){t[t.length-1]=n.slice(0,r)}return t.join("/")+"_files/"}function r(t,n){if(!t){throw new e(SeadragonStrings.getString("Errors.Security"))}var r=null;if(t.responseXML&&t.responseXML.documentElement){r=t.responseXML}else if(t.responseText){r=SeadragonUtils.parseXml(t.responseText)}return i(r,n)}function i(t,n){if(!t||!t.documentElement){throw new e(SeadragonStrings.getString("Errors.Xml"))}var r=t.documentElement;var i=r.tagName;if(i=="Image"){try{return s(r,n)}catch(u){var a=SeadragonStrings.getString("Errors.Dzi");throw u instanceof e?u:new e(a)}}else if(i=="Collection"){throw new e(SeadragonStrings.getString("Errors.Dzc"))}else if(i=="Error"){return o(r)}throw new e(SeadragonStrings.getString("Errors.Dzi"))}function s(t,n){var r=t.getAttribute("Format");if(!SeadragonUtils.imageFormatSupported(r)){throw new e(SeadragonStrings.getString("Errors.ImageFormat",r.toUpperCase()))}var i=t.getElementsByTagName("Size")[0];var s=t.getElementsByTagName("DisplayRect");var o=parseInt(i.getAttribute("Width"),10);var u=parseInt(i.getAttribute("Height"),10);var a=parseInt(t.getAttribute("TileSize"));var f=parseInt(t.getAttribute("Overlap"));var l=[];for(var c=0;c<s.length;c++){var h=s[c];var p=h.getElementsByTagName("Rect")[0];l.push(new SeadragonDisplayRect(parseInt(p.getAttribute("X"),10),parseInt(p.getAttribute("Y"),10),parseInt(p.getAttribute("Width"),10),parseInt(p.getAttribute("Height"),10),parseInt(h.getAttribute("MinLevel"),10),parseInt(h.getAttribute("MaxLevel"),10)))}return new SeadragonDziTileSource(o,u,a,f,n,r,l)}function o(t){var n=t.getElementsByTagName("Message")[0];var r=n.firstChild.nodeValue;throw new e(r)}e.prototype=new Error;SeadragonDziTileSource.getTilesUrl=n;SeadragonDziTileSource.createFromJson=function(r,i){var s=typeof i=="function";var o,u;var a=r;if(!a||!a.url&&!a.tilesUrl){u=new e(SeadragonStrings.getString("Errors.Empty"))}else{try{var f=a.displayRects;if(f&&f.length){for(var l=0,c=f.length;l<c;l++){var h=f[l];f[l]=new SeadragonDisplayRect(h.x||h[0],h.y||h[1],h.width||h[2],h.height||h[3],h.minLevel||h[4],h.maxLevel||h[5])}}o=new SeadragonDziTileSource(a.width,a.height,a.tileSize,a.tileOverlap,a.tilesUrl||n(a.url),a.tileFormat,a.displayRects);o.xmlUrl=a.url}catch(p){u=t(p)}}if(s){window.setTimeout(SeadragonUtils.createCallback(null,i,o,u&&u.message),1)}else if(u){throw u}else{return o}};SeadragonDziTileSource.createFromXml=function(s,o,u){function c(e,n){try{var r=e(n,l);r.xmlUrl=s;return r}catch(i){if(a){f=t(i).message;return null}else{throw t(i)}}}var a=typeof u=="function";var f=null;if(!s){f=SeadragonStrings.getString("Errors.Empty");if(a){window.setTimeout(function(){u(null,f)},1);return null}throw new e(f)}var l=n(s);if(a){if(o){window.setTimeout(function(){var e=c(i,SeadragonUtils.parseXml(o));u(e,f)},1)}else{SeadragonUtils.makeAjaxRequest(s,function(e){var t=c(r,e);u(t,f)})}return null}if(o){return c(i,SeadragonUtils.parseXml(o))}else{return c(r,SeadragonUtils.makeAjaxRequest(s))}}})();var SeadragonViewport=Seadragon.Viewport=function(e,t,n){function p(){r.goHome(true);r.update()}function d(e){return Math.log(e)/h}function v(e){return Math.pow(2,e)}function m(e,t,n){return Math.min(Math.max(e,t),n)}function g(e,t){var n=e.x,r=e.y,i=m(n,t.x,t.x+t.width),s=m(r,t.y,t.y+t.height);return n===i&&r===s?e:new SeadragonPoint(i,s)}function y(e){var t=r.getZoom(e),n=1/t,i=n/r.getAspectRatio(),o=SeadragonConfig.visibilityRatio,u=(o-.5)*n,a=(o-.5)*i,f=1-2*u,l=s-2*a;if(f<0){u+=.5*f;f=0}if(l<0){a+=.5*l;l=0}return new Seadragon.Rect(u,a,f,l)}var r=this;var e=new SeadragonPoint(e.x,e.y);var i=t.x/t.y;var s=t.y/t.x;var o=new SeadragonSpring(0);var u=new SeadragonSpring(0);var a=new SeadragonSpring(SeadragonConfig.logarithmicZoom?0:1);var f=null;var l=new SeadragonRect(0,0,1,s);var c=l.getCenter();var h=Math.LN2;this.getHomeBounds=function(){var e=r.getAspectRatio();var t=new SeadragonRect(l.x,l.y,l.width,l.height);if(i>=e){t.height=l.width/e;t.y=c.y-t.height/2}else{t.width=l.height*e;t.x=c.x-t.width/2}return t};this.getHomeCenter=function(){return c};this.getHomeZoom=function(){var e=i/r.getAspectRatio();return e>=1?1:e};this.getMinCenter=function(e){return y(e).getTopLeft()};this.getMaxCenter=function(e){return y(e).getBottomRight()};this.getMinZoom=function(){var n=r.getHomeZoom();if(SeadragonConfig.minZoomDimension){var i=t.x<=t.y?SeadragonConfig.minZoomDimension/e.x:SeadragonConfig.minZoomDimension/(e.x*s)}else{var i=SeadragonConfig.minZoomImageRatio*n}return Math.min(i,n)};this.getMaxZoom=function(){var n=t.x*SeadragonConfig.maxZoomPixelRatio/e.x;return Math.max(n,r.getHomeZoom())};this.getAspectRatio=function(){return e.x/e.y};this.getContainerSize=function(){return new SeadragonPoint(e.x,e.y)};this.getBounds=function(e){var t=r.getCenter(e);var n=1/r.getZoom(e);var i=n/r.getAspectRatio();return new SeadragonRect(t.x-n/2,t.y-i/2,n,i)};this.getCenter=function(t){var n=new SeadragonPoint(o.getCurrent(),u.getCurrent());var i=new SeadragonPoint(o.getTarget(),u.getTarget());if(t){return n}else if(!f){return i}var s=r.getZoom();var a=1/s;var l=a/r.getAspectRatio();var c=new SeadragonRect(n.x-a/2,n.y-l/2,a,l);var h=r.pixelFromPoint(f,true);var p=f.minus(c.getTopLeft()).times(e.x/c.width);var d=p.minus(h);var v=d.divide(e.x*s);return i.plus(v)};this.getZoom=function(e){var t;if(e){t=a.getCurrent();return SeadragonConfig.logarithmicZoom?v(t):t}else{t=a.getTarget();return SeadragonConfig.logarithmicZoom?v(t):t}};this.applyConstraints=function(e){var t=r.getZoom();var n=m(t,r.getMinZoom(),r.getMaxZoom());if(t!=n){r.zoomTo(n,f,e)}var i=r.getCenter();var s=g(i,y());if(SeadragonConfig.wrapHorizontal){s.x=i.x}if(SeadragonConfig.wrapVertical){s.y=i.y}if(!i.equals(s)){var o=1/n,u=o/r.getAspectRatio();r.fitBounds(new SeadragonRect(s.x-.5*o,s.y-.5*u,o,u),e);return true}else{return false}};this.ensureVisible=function(e){r.applyConstraints(e)};this.fitBounds=function(t,n){var i=r.getAspectRatio();var s=t.getCenter();var o=new SeadragonRect(t.x,t.y,t.width,t.height);if(o.getAspectRatio()>=i){o.height=t.width/i;o.y=s.y-o.height/2}else{o.width=t.height*i;o.x=s.x-o.width/2}r.panTo(r.getCenter(true),true);r.zoomTo(r.getZoom(true),null,true);var u=r.getBounds();var a=r.getZoom();var f=1/o.width;if(f==a||Math.abs(o.width-u.width)<1e-6){r.panTo(s,n);return}var l=u.getTopLeft().times(e.x/u.width).minus(o.getTopLeft().times(e.x/o.width)).divide(e.x/u.width-e.x/o.width);r.zoomTo(f,l,n)};this.goHome=function(e){var t=r.getCenter();if(SeadragonConfig.wrapHorizontal){t.x=(1+t.x%1)%1;o.resetTo(t.x);o.update()}if(SeadragonConfig.wrapVertical){t.y=(s+t.y%s)%s;u.resetTo(t.y);u.update()}r.fitBounds(l,e)};this.panBy=function(e,t){r.panTo(r.getCenter().plus(e),t)};this.panTo=function(t,i){if(i){o.resetTo(t.x);u.resetTo(t.y);return}if(!f){f=new Seadragon.Point(0,0)}var s=r.getZoom();var a=1/s;var l=a/r.getAspectRatio();var c=new SeadragonRect(o.getCurrent()-a/2,u.getCurrent()-l/2,a,l);var h=r.pixelFromPoint(f,true);var p=f.minus(c.getTopLeft()).times(e.x/c.width);var d=p.minus(h);var v=d.divide(e.x*s);var m=t.minus(v);o.springTo(m.x);u.springTo(m.y);n.scheduleUpdate()};this.zoomBy=function(e,t,n){r.zoomTo(r.getZoom()*e,t,n)};this.zoomTo=function(e,t,r){if(r){a.resetTo(SeadragonConfig.logarithmicZoom?d(e):e)}else{a.springTo(SeadragonConfig.logarithmicZoom?d(e):e)}f=t instanceof SeadragonPoint?t:null;n.scheduleUpdate()};this.resize=function(t,n){var i=r.getBounds();var s=i;var o=t.x/e.x;e=new SeadragonPoint(t.x,t.y);if(n){s.width=i.width*o;s.height=s.width/r.getAspectRatio()}r.fitBounds(s,true)};this.update=function(){var e=o.getCurrent();var t=u.getCurrent();var n=a.getCurrent();if(f){var i=r.pixelFromPoint(f,true)}a.update();if(f&&a.getCurrent()!=n){var s=r.pixelFromPoint(f,true);var l=s.minus(i);var c=r.deltaPointsFromPixels(l,true);o.shiftBy(c.x);u.shiftBy(c.y)}else{f=null}o.update();u.update();return o.getCurrent()!=e||u.getCurrent()!=t||a.getCurrent()!=n};this.deltaPixelsFromPoints=function(t,n){return t.times(e.x*r.getZoom(n))};this.deltaPointsFromPixels=function(t,n){return t.divide(e.x*r.getZoom(n))};this.pixelFromPoint=function(t,n){var i=r.getBounds(n);return t.minus(i.getTopLeft()).times(e.x/i.width)};this.pointFromPixel=function(t,n){var i=r.getBounds(n);return t.divide(e.x/i.width).plus(i.getTopLeft())};p()};var SeadragonDrawer,SeadragonOverlayPlacement;(function(){function x(e,t,n,r,i,s){this.level=e;this.x=t;this.y=n;this.bounds=r;this.exists=i;this.url=s;this.elmt=null;this.image=null;this.loaded=false;this.loading=false;this.style=null;this.position=null;this.size=null;this.blendStart=null;this.opacity=null;this.distance=null;this.visibility=null;this.beingDrawn=false;this.covered=false;this.lastDrawnTime=0;this.lastTouchTime=0}function T(e){switch(e){case SeadragonOverlayPlacement.TOP_LEFT:return function(e,t){};case SeadragonOverlayPlacement.TOP:return function(e,t){e.x-=t.x/2};case SeadragonOverlayPlacement.TOP_RIGHT:return function(e,t){e.x-=t.x};case SeadragonOverlayPlacement.RIGHT:return function(e,t){e.x-=t.x;e.y-=t.y/2};case SeadragonOverlayPlacement.BOTTOM_RIGHT:return function(e,t){e.x-=t.x;e.y-=t.y};case SeadragonOverlayPlacement.BOTTOM:return function(e,t){e.x-=t.x/2;e.y-=t.y};case SeadragonOverlayPlacement.BOTTOM_LEFT:return function(e,t){e.y-=t.y};case SeadragonOverlayPlacement.LEFT:return function(e,t){e.y-=t.y/2};case SeadragonOverlayPlacement.CENTER:default:return function(e,t){e.x-=t.x/2;e.y-=t.y/2}}}function N(e,t,n){this.elmt=e;this.scales=t instanceof SeadragonRect;this.bounds=new SeadragonRect(t.x,t.y,t.width,t.height);this.adjust=T(t instanceof SeadragonPoint?n:SeadragonOverlayPlacement.TOP_LEFT);this.position=new SeadragonPoint(t.x,t.y);this.size=new SeadragonPoint(t.width,t.height);this.style=e.style;this.naturalSize=new SeadragonPoint(e.clientWidth,e.clientHeight)}var e=1500;var t=.5;var n=SeadragonUtils.getBrowser();var r=SeadragonUtils.getBrowserVersion();var i=navigator.userAgent;var s=!!document.createElement("canvas").getContext;var o=document.documentElement||{};var u=o.style||{};var a=false;var f=["msTransform","WebkitTransform","MozTransform"];var l,c;while(l=f.shift()){if(typeof u[l]!=="undefined"){a=true;c=/webkit/i.test(l);break}}var h="-webkit-transform";var p="WebkitTransition";var d=typeof u[p]!=="undefined";var v="progid:DXImageTransform.Microsoft.Matrix";var m=new RegExp(v+"\\(.*?\\)","g");var g=function(){try{return n===SeadragonBrowser.IE&&!!document.documentElement.filters}catch(e){return false}}();var y=n===SeadragonBrowser.SAFARI&&r<4||n===SeadragonBrowser.CHROME;var b=s&&!y;var w=!b&&a;var E=false;var S=typeof document.documentMode!=="undefined"?"bicubic":"nearest-neighbor";x.prototype.toString=function(){return this.level+"/"+this.x+"_"+this.y};x.prototype.drawHTML=function(e){if(!this.loaded){SeadragonDebug.error("Attempting to draw tile "+this.toString()+" when it's not yet loaded.");return}if(!this.elmt){this.elmt=SeadragonUtils.makeNeutralElement("img");this.elmt.src=this.url;this.style=this.elmt.style;this.style.position="absolute";this.style.msInterpolationMode=S;if(w){this.style[l+"Origin"]="0px 0px"}}var t=this.elmt;var n=this.image;var r=this.style;var i=this.position;var s=this.size;if(t.parentNode!==e){e.appendChild(t)}if(w){r[l]=["matrix(",(s.x/n.width).toFixed(8),",0,0,",(s.y/n.height).toFixed(8),",",i.x.toFixed(8),c?",":"px,",i.y.toFixed(8),c?")":"px)"].join("")}else if(E){var o=e.clientWidth,u=e.clientHeight;r.width=o+"px";r.height=u+"px";r.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(s.x/o).toFixed(8),",M22=",(s.y/u).toFixed(8),",Dx=",i.x.toFixed(8),",Dy=",i.y.toFixed(8),")"].join("")}else{i=i.apply(Math.floor);s=s.apply(Math.ceil);r.left=i.x+"px";r.top=i.y+"px";r.width=s.x+"px";r.height=s.y+"px"}SeadragonUtils.setElementOpacity(t,this.opacity)};x.prototype.drawCanvas=function(e){if(!this.loaded){SeadragonDebug.error("Attempting to draw tile "+this.toString()+" when it's not yet loaded.");return}var t=this.position;var n=this.size;e.globalAlpha=this.opacity;e.drawImage(this.image,t.x,t.y,n.x,n.y)};x.prototype.unload=function(){if(this.elmt&&this.elmt.parentNode){this.elmt.parentNode.removeChild(this.elmt)}this.elmt=null;this.image=null;this.loaded=false;this.loading=false};SeadragonOverlayPlacement=Seadragon.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8};N.prototype.destroy=function(){var e=this.elmt;var t=this.style;if(e.parentNode){e.parentNode.removeChild(e)}t.top="";t.left="";t.position="";if(this.scales){t.width="";t.height=""}};N.prototype.drawHTML=function(e){var t=this.elmt;var n=this.style;var r=this.scales;var i=this.naturalSize;if(t.parentNode!==e){e.appendChild(t);n.position="absolute";i.x=t.clientWidth;i.y=t.clientHeight}var s=this.position;var o=this.size;if(!r){o.x=i.x=i.x||t.clientWidth;o.y=i.y=i.y||t.clientHeight}this.adjust(s,o);if(SeadragonConfig.transformOverlays&&a){n[l+"Origin"]="0px 0px";n[l]=["translate(",s.x.toFixed(8),"px,",s.y.toFixed(8),"px)"].join("");if(r){if(!t.clientWidth){n.width="100%"}if(!t.clientHeight){n.height="100%"}n[l]+=[" scale(",(o.x/t.clientWidth).toFixed(8),",",(o.y/t.clientHeight).toFixed(8),")"].join("")}}else if(SeadragonConfig.transformOverlays&&E){var u=e.clientWidth,f=e.clientHeight;n.width=u+"px";n.height=f+"px";n.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(o.x/u).toFixed(8),",M22=",(o.y/f).toFixed(8),",Dx=",s.x.toFixed(8),",Dy=",s.y.toFixed(8),")"].join("")}else{s=s.apply(Math.floor);o=o.apply(Math.ceil);n.left=s.x+"px";n.top=s.y+"px";if(r){n.width=o.x+"px";n.height=o.y+"px"}}};N.prototype.update=function(e,t){this.scales=e instanceof SeadragonRect;this.bounds=new SeadragonRect(e.x,e.y,e.width,e.height);this.adjust=T(e instanceof SeadragonPoint?t:SeadragonOverlayPlacement.TOP_LEFT)};SeadragonDrawer=Seadragon.Drawer=function(r,i,s,o,u){function _(e){if(!y[e]){y[e]=r.getNumTiles(e)}return y[e]}function D(e){if(!w[e]){w[e]=r.getPixelRatio(e)}return w[e]}function P(e,t,n,i,s,o){if(!E[e]){E[e]={}}if(!E[e][t]){E[e][t]={}}if(!E[e][t][n]){var u=(s+t%s)%s;var a=(o+n%o)%o;var f=r.getTileBounds(e,u,a);var l=r.tileExists(e,u,a);var c=r.getTileUrl(e,u,a);f.x+=1*(t-u)/s;f.y+=g*(n-a)/o;E[e][t][n]=new x(e,t,n,f,l,c)}var h=E[e][t][n];h.lastTouchTime=i;return h}function H(e,t){c.loadImage(e,SeadragonUtils.createCallback(null,B,e,t))}function B(t,n,r){t.loading=false;if(O){SeadragonDebug.error("Tile load callback in middle of drawing routine.");return}else if(!r){SeadragonDebug.log("Tile "+t+" failed to load: "+t.url);t.exists=false;return}t.image=r;t.loaded=true;var i=S.length;if(S.length>=e){var s=Math.ceil(Math.log(v)/Math.log(2));var o=null;var u=-1;for(var a=S.length-1;a>=0;a--){var f=S[a];if(f.level<=s||f.beingDrawn){continue}else if(!o){o=f;u=a;continue}var l=f.lastTouchTime;var c=o.lastTouchTime;var h=f.level;var p=o.level;if(l<c||l===c&&h>p){o=f;u=a}}if(o&&u>=0){o.unload();i=u}}S[i]=t;M=true}function j(){E={};S=[]}function F(e,t,n){if(!T[e]){return false}if(t===undefined||n===undefined){var r=T[e];for(var i in r){if(r.hasOwnProperty(i)){var s=r[i];for(var o in s){if(s.hasOwnProperty(o)&&!s[o]){return false}}}}return true}return T[e][t]===undefined||T[e][t][n]===undefined||T[e][t][n]===true}function I(e,t,n){if(t===undefined||n===undefined){return F(e+1)}else{return F(e+1,2*t,2*n)&&F(e+1,2*t,2*n+1)&&F(e+1,2*t+1,2*n)&&F(e+1,2*t+1,2*n+1)}}function q(e,t,n,r){if(!T[e]){SeadragonDebug.error("Setting coverage for a tile before its "+"level's coverage has been reset: "+e);return}if(!T[e][t]){T[e][t]={}}T[e][t][n]=r}function R(e){T[e]={}}function U(e,t){if(!e){return t}if(t.visibility>e.visibility){return t}else if(t.visibility===e.visibility){if(t.distance<e.distance){return t}}return e}function z(e,t){if(e.visibility>t.visibility){return-1}else if(e.visibility<t.visibility){return 1}else{if(e.distance<t.distance){return-1}else if(e.distance>t.distance){return 1}}return 0}function W(e){for(var t=C.length-1;t>=0;t--){if(C[t].elmt===e){return t}}return-1}function X(e){var s;for(s=0;s<k.length;s++){k[s].beingDrawn=false;k[s].covered=false}k=[];var o=k;c.clear();var u=i.getBounds(true);if(isNaN(u.x)){i.goHome(true);u=i.getBounds(true)}var a=u.getTopLeft();var f=u.getBottomRight();var l=SeadragonConfig.wrapHorizontal;var h=SeadragonConfig.wrapVertical;if(!l&&(f.x<0||a.x>1)){return}else if(!h&&(f.y<0||a.y>g)){return}var v=_;var y=D;var b=P;var w=I;var E=q;var S=R;var x=F;var T=m;var N=L;var C=n===SeadragonBrowser.CHROME;var A=Math.abs;var O=Math.floor;var M=Math.log;var B=Math.max;var j=Math.min;var U=i.deltaPixelsFromPoints;var z=i.pixelFromPoint;var W=r.getTileAtPoint;var X=SeadragonConfig.immediateRender;var V=SeadragonConfig.minZoomDimension||64;if(!l){a.x=B(a.x,0);f.x=j(f.x,1)}if(!h){a.y=B(a.y,0);f.y=j(f.y,g)}var $=Date.now();var J=i.getCenter();var K=z(J);var Q=U(y(0),false).x;var G=X?1:Q;var Y=i.getZoom(true)<.8?t:.5;var Z=U(y(0),true).x;var et=j(d,O(M(Z/Y)/M(2)));var tt=B(p,O(M(V)/M(2)));tt=j(tt,et);var nt=[];var rt=null;var it=false;for(var st=et;st>=tt;st--){var ot=false;var ut=U(y(st),true).x;if(!it&&ut>=Y||st===tt){ot=true;it=true}else if(!it){continue}S(st);var at=W(st,a);var ft=W(st,f);var lt=v(st);var ct=lt.x;var ht=lt.y;if(!l){ft.x=j(ft.x,ct-1)}if(!h){ft.y=j(ft.y,ht-1)}var pt=1,dt=0,vt=1,mt=ft.x-at.x,gt=ft.y-at.y,yt=at.x+Math.floor(mt/2),bt=at.y+Math.floor(gt/2),wt=0,lt=(mt+1)*(gt+1),Et=[],St=Infinity,xt=-Infinity,Tt=Infinity,Nt=-Infinity,Ct,kt;for(Ct=0;Ct<lt;Ct++){St=Math.min(yt,St);xt=Math.max(yt,xt);Tt=Math.min(bt,Tt);Nt=Math.max(bt,Nt);var Lt=b(st,yt,bt,$,ct,ht);var At=ot;E(st,yt,bt,false);if(Lt.exists){if(it&&!At){if(w(st,yt,bt)){E(st,yt,bt,true)}else{At=true}}if(At){var Ot=Lt.bounds.getTopLeft();var Mt=Lt.bounds.getSize();var _t=z(Ot,true);var Dt=U(Mt,true);if(!T){Dt=Dt.plus(new SeadragonPoint(1,1))}Lt.position=_t;Lt.size=Dt;o.push(Lt);if(!Lt.loaded&&!Lt.loading){Et.push(Lt)}}}yt+=pt;bt+=dt;wt++;var Pt=0;while(!(at.x<=yt&&yt<=ft.x&&at.y<=bt&&bt<=ft.y)){Pt++;if(Pt>=4){break}wt=0;if(yt<at.x){yt=at.x;bt=Tt-1;pt=1;dt=0;vt=Math.max(1,xt-at.x+1)}else if(bt>ft.y){yt=St-1;bt=ft.y;pt=0;dt=-1;vt=Math.max(1,ft.y-Tt+1)}else if(yt>ft.x){yt=ft.x;bt=Nt+1;pt=-1;dt=0;vt=Math.max(1,ft.x-St+1)}else if(bt<at.y){yt=xt+1;bt=at.y;pt=0;dt=1;vt=Math.max(1,Nt-at.y+1)}}if(wt===vt){wt=0;kt=pt;pt=-dt;dt=kt;if(dt===0){vt++}}}if(Et.length>0){nt.push(Et)}}var Ht;if(e){for(s=nt.length-1;s>=0;s--){Ht=nt[s];Ht.map(H)}}else if(nt.length>0){Ht=nt[nt.length-1];H(Ht[0],10)}}function V(){var e,t,n,r,s=f,o=l,u=SeadragonConfig.alwaysBlend,c=1e3*SeadragonConfig.blendTime,h=b,p=k,d=q,v=i.deltaPixelsFromPoints,m=i.pixelFromPoint,g=i.getContainerSize(),y=g.x,w=g.y,E=Math.min,S=Math.floor,x=Date.now(),T=SeadragonConfig.wrapOverlays,N=SeadragonConfig.wrapHorizontal,A=SeadragonConfig.wrapVertical;M=false;if(h){s.width=y;s.height=w}else{s.innerHTML=""}for(e=p.length-1;e>=0;e--){t=p[e];if(t.covered||I(t.level,t.x,t.y)){t.covered=true}else if(t.loaded){if(t.opacity<1){if(!t.blendStart){t.blendStart=x}n=x-t.blendStart;r=c===0?1:E(1,n/c);t.opacity=r}if(t.opacity>=1){d(t.level,t.x,t.y,true)}else{M=true}if(h){t.drawCanvas(o)}else{t.drawHTML(s)}t.beingDrawn=true}else if(t.exists){M=true}}var O,_,D;for(e=0;e<C.length;e++){O=C[e];_=O.bounds;D=_.getTopLeft();if(T&&N){D.x+=S(viewportCenterPoint.x)}if(T&&A){}O.position=m(D,true);O.size=v(_.getSize(),true);O.drawHTML(a)}L=x}t=u?.1:.5;var a=SeadragonUtils.getElement(s);var f=SeadragonUtils.makeNeutralElement(b?"canvas":"div");var l=b?f.getContext("2d"):null;var c=new SeadragonImageLoader;var h=new SeadragonProfiler;var p=r.minLevel;var d=r.maxLevel;var v=r.tileSize;var m=r.tileOverlap;var g=r.height/r.width;var y={};var w={};var E={};var S=[];var T={};var C=[];var k=[];var L=0;var A=0;var O=false;var M=true;this.elmt=a;this.profiler=h;(function(){f.style.width="100%";f.style.height="100%";f.style.position="absolute";a.style.textAlign="left";a.appendChild(f)})();this.addOverlay=function(e,t,n){e=SeadragonUtils.getElement(e);if(W(e)>=0){return}C.push(new N(e,t,n));M=true;o.scheduleUpdate()};this.updateOverlay=function(e,t,n){e=SeadragonUtils.getElement(e);var r=W(e);if(r>=0){C[r].update(t,n);M=true;o.scheduleUpdate()}};this.removeOverlay=function(e){e=SeadragonUtils.getElement(e);var t=W(e);if(t>=0){C[t].destroy();C.splice(t,1);M=true;o.scheduleUpdate()}};this.clearOverlays=function(){while(C.length>0){C.pop().destroy();M=true;o.scheduleUpdate()}};this.needsUpdate=function(){return M};this.numTilesLoaded=function(){return S.length};this.reset=function(){j();A=Date.now();M=true};this.update=function(e,t){O=true;if(e){X(t)}V();O=false};this.idle=function(){}}})();var SeadragonViewer,SeadragonControlAnchor;(function(){function n(e,t,n){if(t===SeadragonControlAnchor.TOP_RIGHT||t===SeadragonControlAnchor.BOTTOM_RIGHT){n.insertBefore(e,n.firstChild)}else{n.appendChild(e)}}function r(e,t,r){var i=SeadragonUtils.makeNeutralElement("span");this.elmt=e;this.anchor=t;this.container=r;this.wrapper=i;i.style.display="inline-block";i.appendChild(e);if(t===SeadragonControlAnchor.NONE){i.style.width=i.style.height="100%"}n(i,t,r)}function h(t){function d(){if(t.viewport){t.viewport.goHome()}}function v(){t.setFullPage(!t.isFullPage());n.emulateExit();if(t.viewport){t.viewport.applyConstraints()}}function m(){p=Date.now();h=SeadragonConfig.zoomPerSecond;r=true;b()}function g(){p=Date.now();h=1/SeadragonConfig.zoomPerSecond;r=true;b()}function y(){r=false}function b(){window.setTimeout(w,10)}function w(){if(r&&t.viewport){var e=Date.now();var n=e-p;var i=Math.pow(h,n/1e3);t.viewport.zoomBy(i);t.viewport.applyConstraints();p=e;b()}}function E(){if(t.viewport){r=false;t.viewport.zoomBy(SeadragonConfig.zoomPerClick/1);t.viewport.applyConstraints()}}function S(){if(t.viewport){r=false;t.viewport.zoomBy(1/SeadragonConfig.zoomPerClick);t.viewport.applyConstraints()}}function x(){n.emulateEnter();n.emulateExit()}function T(e,t){return SeadragonConfig.imagePath+e+t}var n=null;var r=false;var h=null;var p=null;var N=new SeadragonButton(SeadragonStrings.getString("Tooltips.ZoomIn"),T(o,a),T(o,f),T(o,l),T(o,c),m,y,E,m,y);var C=new SeadragonButton(SeadragonStrings.getString("Tooltips.ZoomOut"),T(u,a),T(u,f),T(u,l),T(u,c),g,y,S,g,y);var k=new SeadragonButton(SeadragonStrings.getString("Tooltips.Home"),T(s,a),T(s,f),T(s,l),T(s,c),null,d,null,null,null);var L=new SeadragonButton(SeadragonStrings.getString("Tooltips.FullPage"),T(i,a),T(i,f),T(i,l),T(i,c),null,v,null,null,null);n=new SeadragonButtonGroup([N,C,k,L]);n.elmt[e]=true;t.addEventListener("open",x);return n.elmt}var e="----seadragon----";var t=SeadragonUtils.getBrowser();SeadragonControlAnchor=Seadragon.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};r.prototype.destroy=function(){this.wrapper.removeChild(this.elmt);this.container.removeChild(this.wrapper)};r.prototype.isVisible=function(){return this.wrapper.style.display!=="none"};r.prototype.setVisible=function(e){this.wrapper.style.display=e?"inline-block":"none"};r.prototype.setOpacity=function(n){if(this.elmt[e]&&t===SeadragonBrowser.IE){SeadragonUtils.setElementOpacity(this.elmt,n,true)}else{SeadragonUtils.setElementOpacity(this.wrapper,n,true)}};var i="fullpage";var s="home";var o="zoomin";var u="zoomout";var a="_rest.png";var f="_grouphover.png";var l="_hover.png";var c="_pressed.png";SeadragonViewer=Seadragon.Viewer=function(e,t){function I(){var t=s.style;var r=e.style;var l=o.style;var c=u.style;var p=a.style;var d=f.style;r.width="100%";r.height="100%";r.position="relative";r.left="0px";r.top="0px";r.textAlign="left";t.width="100%";t.height="100%";t.overflow="hidden";t.position="absolute";t.top="0px";t.left="0px";l.position=c.position=p.position=d.position="absolute";l.top=c.top="0px";l.left=d.left="0px";c.right=p.right="0px";d.bottom=p.bottom="0px";m.clickHandler=et;m.pressHandler=tt;m.dragHandler=nt;m.releaseHandler=rt;m.scrollHandler=it;m.setTracking(true);b=h(n);b.style.marginRight="4px";b.style.marginBottom="4px";n.addControl(b,SeadragonControlAnchor.BOTTOM_RIGHT);g.enterHandler=G;g.exitHandler=Y;g.releaseHandler=Z;g.setTracking(true);window.setTimeout(Q,1);e.appendChild(s);e.appendChild(o);e.appendChild(u);e.appendChild(a);e.appendChild(f);i.innerHTML="";i.appendChild(e)}function q(e){var t=document.createTextNode(e);s.innerHTML="";s.appendChild(document.createElement("div"))}function R(){if(l){z()}O=Date.now();window.setTimeout(function(){if(O>M){q(SeadragonStrings.getString("Messages.Loading"))}},2e3);return O}function U(r,i,o){M=Date.now();if(r<O){SeadragonDebug.log("Ignoring out-of-date open.");v.trigger("ignore",n);return}else if(!i){q(o);v.trigger("error",n);return}s.innerHTML="";A=SeadragonUtils.getElementSize(e);if(A.x===0||A.y===0){window.setTimeout(function(){U(r,i,o)},10);return}l=i;p=new SeadragonViewport(A,l.dimensions,n);c=new SeadragonDrawer(l,p,s,n,t);d=new SeadragonProfiler;n.source=l;n.viewport=p;n.drawer=c;n.profiler=d;P=false;H=true;v.trigger("open",n);if(!n.loopId)n.loopId=j(X)}function z(){n.source=l=null;n.viewport=p=null;n.drawer=c=null;n.profiler=d=null;s.innerHTML=""}function W(){if(!n.loopId){n.loopId=j(X)}H=true}function X(){n.loopId=j(X);if(!l){return}var t=SeadragonUtils.getElementSize(e);if(!t.equals(A)&&t.x>0&&t.y>0){p.resize(t,true);A=t;v.trigger("resize",n)}var r=p.update();var i=P&&!r;if(!P&&r){v.trigger("animationstart",n);K()}if(r){c.update(true,false);v.trigger("animation",n)}else if(H||c.needsUpdate()){var s=i||H;c.update(s,s)}else{F(n.loopId);n.loopId=null}if(i){v.trigger("animationfinish",n)}P=r;H=false}function V(e){for(var t=y.length-1;t>=0;t--){if(y[t].elmt===e){return t}}return-1}function $(){window.setTimeout(J,20)}function J(){if(x){var e=Date.now();var t=e-S;var n=1-t/E;n=Math.min(1,n);n=Math.max(0,n);for(var r=y.length-1;r>=0;r--){y[r].setOpacity(n)}if(n>0){$()}}}function K(){x=false;for(var e=y.length-1;e>=0;e--){y[e].setOpacity(1)}}function Q(){if(!SeadragonConfig.autoHideControls){return}x=true;S=Date.now()+w;window.setTimeout($,w)}function G(e,t,n,r){B=true;K()}function Y(e,t,n,r){if(!n){B=false;if(!P){}}}function Z(e,t,n,r){if(!r){B=false;if(!P){Q()}}}function et(e,t,n,r){if(p&&n){var i=SeadragonConfig.zoomPerClick;var s=r?1/i:i;p.zoomBy(s,p.pointFromPixel(t,true));p.applyConstraints()}}function tt(e,t){if(p){_=t;D=p.getCenter()}}function nt(e,t,n,r){if(p){if(SeadragonConfig.constrainDuringPan){var i=t.minus(_);var s=p.deltaPointsFromPixels(i.negate(),true);p.panTo(D.plus(s));p.applyConstraints()}else{p.panBy(p.deltaPointsFromPixels(n.negate(),true))}}}function rt(e,n,r,i){if(r&&p&&!t){p.applyConstraints()}}function it(e,t,n,r){if(p){var i=Math.pow(SeadragonConfig.zoomPerScroll,n);p.zoomBy(i,p.pointFromPixel(t,true));p.applyConstraints()}}function st(e){e=SeadragonUtils.getEvent(e);if(e.keyCode===27){n.setFullPage(false)}}if(t){Seadragon.Config.minZoomImageRatio=.1}else{Seadragon.Config.minZoomImageRatio=.8}var n=this;var i=SeadragonUtils.getElement(e);e=SeadragonUtils.makeNeutralElement("div");n.container=e;var s=SeadragonUtils.makeNeutralElement("div");n.canvas=s;var o=SeadragonUtils.makeNeutralElement("div");var u=SeadragonUtils.makeNeutralElement("div");var a=SeadragonUtils.makeNeutralElement("div");var f=SeadragonUtils.makeNeutralElement("div");var l=null;var c=null;var p=null;var d=null;var v=new SeadragonEventManager;var m=new SeadragonMouseTracker(s);var g=new SeadragonMouseTracker(e);var y=[];var b=null;var w=1e3;var E=2e3;var S=null;var x=false;var T=document.body.style.width;var N=document.body.style.height;var C=document.body.style.overflow;var k=document.documentElement.style.overflow;var L=new SeadragonPoint(1,1);var A=null;var O=0;var M=0;var _=null;var D=null;var P=false;var H=false;var B=false;this.container=i;this.elmt=e;this.source=null;this.drawer=null;this.viewport=null;this.profiler=null;this.tracker=m;n.loopId=null;var j=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){var t=Date.now();var n=Math.max(0,16-(t-lastTime));var r=window.setTimeout(function(){e(t+n)},n);lastTime=t+n;return r};var F=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCanelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){clearTimeout(e)};this.scheduleUpdate=W;this.isOpen=function(){return!!l};this.openDzi=function(e,t){var n=R();var r=SeadragonUtils.createCallback(null,U,n);if(typeof e==="string"){SeadragonDziTileSource.createFromXml(e,t,r)}else{SeadragonDziTileSource.createFromJson(e,r)}};this.openTileSource=function(e){var t=R();window.setTimeout(function(){U(t,e)},1)};this.close=function(){if(!l){return}z()};this.addControl=function(t,n){t=SeadragonUtils.getElement(t);if(V(t)>=0){return}var i=null;switch(n){case SeadragonControlAnchor.TOP_RIGHT:i=u;t.style.position="relative";break;case SeadragonControlAnchor.BOTTOM_RIGHT:i=a;t.style.position="relative";break;case SeadragonControlAnchor.BOTTOM_LEFT:i=f;t.style.position="relative";break;case SeadragonControlAnchor.TOP_LEFT:i=o;t.style.position="relative";break;case SeadragonControlAnchor.NONE:default:i=e;t.style.position="absolute";break}y.push(new r(t,n,i))};this.removeControl=function(e){e=SeadragonUtils.getElement(e);var t=V(e);if(t>=0){y[t].destroy();y.splice(t,1)}};this.clearControls=function(){while(y.length>0){y.pop().destroy()}};this.getNavControl=function(){return b};this.isDashboardEnabled=function(){for(var e=y.length-1;e>=0;e--){if(y[e].isVisible()){return true}}return false};this.isFullPage=function(){return e.parentNode===document.body};this.isMouseNavEnabled=function(){return m.isTracking()};this.isVisible=function(){return e.style.visibility!=="hidden"};this.setDashboardEnabled=function(e){for(var t=y.length-1;t>=0;t--){y[t].setVisible(e)}};this.setFullPage=function(t){if(t===n.isFullPage()){return}var r=document.body;var o=r.style;var u=document.documentElement.style;var a=e.style;var f=s.style;if(t){C=o.overflow;k=u.overflow;o.overflow="hidden";u.overflow="hidden";T=o.width;N=o.height;o.width="100%";o.height="100%";f.backgroundColor="black";f.color="white";a.position="fixed";a.zIndex="99999999";r.appendChild(e);A=SeadragonUtils.getWindowSize();SeadragonUtils.addEvent(document,"keydown",st);G()}else{o.overflow=C;u.overflow=k;o.width=T;o.height=N;f.backgroundColor="";f.color="";a.position="relative";a.zIndex="";i.appendChild(e);A=SeadragonUtils.getElementSize(i);SeadragonUtils.removeEvent(document,"keydown",st);Y()}if(p){var l=p.getBounds();p.resize(A);var c=p.getBounds();if(t){L=new SeadragonPoint(c.width/l.width,c.height/l.height)}else{p.update();p.zoomBy(Math.max(L.x,L.y),null,true)}H=true;v.trigger("resize",n);X()}};this.setMouseNavEnabled=function(e){m.setTracking(e)};this.setVisible=function(t){e.style.visibility=t?"":"hidden"};this.showMessage=function(e,t){if(!t){q(e);return}window.setTimeout(function(){if(!n.isOpen()){q(e)}},t)};this.addEventListener=function(e,t){v.addListener(e,t)};this.removeEventListener=function(e,t){v.removeListener(e,t)};this.unload=function(){if(n.loopId){F(n.loopId);n.loopId=null}};I()}})();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=t.Hasher,i=[],t=e.algo.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=0;80>f;f++){if(16>f)i[f]=e[t+f]|0;else{var c=i[f-3]^i[f-8]^i[f-14]^i[f-16];i[f]=c<<1|c>>>31}c=(r<<5|r>>>27)+a+i[f];c=20>f?c+((s&o|~s&u)+1518500249):40>f?c+((s^o^u)+1859775393):60>f?c+((s&o|s&u|o&u)-1894007588):c+((s^o^u)-899497514);a=u;u=o;o=s<<30|s>>>2;s=r;r=c}n[0]=n[0]+r|0;n[1]=n[1]+s|0;n[2]=n[2]+o|0;n[3]=n[3]+u|0;n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296);t[(r+64>>>9<<4)+15]=n;e.sigBytes=4*t.length;this._process();return this._hash},clone:function(){var e=r.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=r._createHelper(t);e.HmacSHA1=r._createHmacHelper(t)})();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(e){for(var t=CryptoJS,n=t.lib,r=n.WordArray,i=n.Hasher,n=t.algo,s=[],o=[],u=function(e){return 4294967296*(e-(e|0))|0},a=2,f=0;64>f;){var l;e:{l=a;for(var c=e.sqrt(l),h=2;h<=c;h++)if(!(l%h)){l=!1;break e}l=!0}l&&(8>f&&(s[f]=u(e.pow(a,.5))),o[f]=u(e.pow(a,1/3)),f++);a++}var p=[],n=n.SHA256=i.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=0;64>h;h++){if(16>h)p[h]=e[t+h]|0;else{var d=p[h-15],v=p[h-2];p[h]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+p[h-7]+((v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10)+p[h-16]}d=c+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&f^~a&l)+o[h]+p[h];v=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&s^i&s);c=l;l=f;f=a;a=u+d|0;u=s;s=i;i=r;r=d+v|0}n[0]=n[0]+r|0;n[1]=n[1]+i|0;n[2]=n[2]+s|0;n[3]=n[3]+u|0;n[4]=n[4]+a|0;n[5]=n[5]+f|0;n[6]=n[6]+l|0;n[7]=n[7]+c|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;n[(i+64>>>9<<4)+14]=e.floor(r/4294967296);n[(i+64>>>9<<4)+15]=r;t.sigBytes=4*n.length;this._process();return this._hash},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});t.SHA256=i._createHelper(n);t.HmacSHA256=i._createHmacHelper(n)})(Math);(function(){var e=CryptoJS,t=e.lib.WordArray,n=e.algo,r=n.SHA256,n=n.SHA224=r.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=r._doFinalize.call(this);e.sigBytes-=4;return e}});e.SHA224=r._createHelper(n);e.HmacSHA224=r._createHmacHelper(n)})();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(e){for(var t=CryptoJS,n=t.lib,r=n.WordArray,i=n.Hasher,n=t.algo,s=[],o=[],u=function(e){return 4294967296*(e-(e|0))|0},a=2,f=0;64>f;){var l;e:{l=a;for(var c=e.sqrt(l),h=2;h<=c;h++)if(!(l%h)){l=!1;break e}l=!0}l&&(8>f&&(s[f]=u(e.pow(a,.5))),o[f]=u(e.pow(a,1/3)),f++);a++}var p=[],n=n.SHA256=i.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=0;64>h;h++){if(16>h)p[h]=e[t+h]|0;else{var d=p[h-15],v=p[h-2];p[h]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+p[h-7]+((v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10)+p[h-16]}d=c+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&f^~a&l)+o[h]+p[h];v=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&s^i&s);c=l;l=f;f=a;a=u+d|0;u=s;s=i;i=r;r=d+v|0}n[0]=n[0]+r|0;n[1]=n[1]+i|0;n[2]=n[2]+s|0;n[3]=n[3]+u|0;n[4]=n[4]+a|0;n[5]=n[5]+f|0;n[6]=n[6]+l|0;n[7]=n[7]+c|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;n[(i+64>>>9<<4)+14]=e.floor(r/4294967296);n[(i+64>>>9<<4)+15]=r;t.sigBytes=4*n.length;this._process();return this._hash},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});t.SHA256=i._createHelper(n);t.HmacSHA256=i._createHmacHelper(n)})(Math);var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(e){var t=CryptoJS,n=t.lib,r=n.Base,i=n.WordArray,t=t.x64={};t.Word=r.extend({init:function(e,t){this.high=e;this.low=t}});t.WordArray=r.extend({init:function(t,n){t=this.words=t||[];this.sigBytes=n!=e?n:8*t.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var s=e[r];n.push(s.high);n.push(s.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}})})();(function(){function e(){return i.create.apply(i,arguments)}for(var t=CryptoJS,n=t.lib.Hasher,r=t.x64,i=r.Word,s=r.WordArray,r=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],u=[],a=0;80>a;a++)u[a]=e();r=r.SHA512=n.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],a=n[3],f=n[4],l=n[5],c=n[6],n=n[7],h=r.high,p=r.low,d=i.high,m=i.low,g=s.high,y=s.low,b=a.high,w=a.low,E=f.high,S=f.low,x=l.high,T=l.low,N=c.high,C=c.low,k=n.high,L=n.low,A=h,O=p,M=d,_=m,D=g,P=y,H=b,j=w,F=E,I=S,q=x,R=T,U=N,z=C,W=k,X=L,V=0;80>V;V++){var $=u[V];if(16>V)var J=$.high=e[t+2*V]|0,K=$.low=e[t+2*V+1]|0;else{var J=u[V-15],K=J.high,Q=J.low,J=(K>>>1|Q<<31)^(K>>>8|Q<<24)^K>>>7,Q=(Q>>>1|K<<31)^(Q>>>8|K<<24)^(Q>>>7|K<<25),G=u[V-2],K=G.high,Y=G.low,G=(K>>>19|Y<<13)^(K<<3|Y>>>29)^K>>>6,Y=(Y>>>19|K<<13)^(Y<<3|K>>>29)^(Y>>>6|K<<26),K=u[V-7],Z=K.high,et=u[V-16],tt=et.high,et=et.low,K=Q+K.low,J=J+Z+(K>>>0<Q>>>0?1:0),K=K+Y,J=J+G+(K>>>0<Y>>>0?1:0),K=K+et,J=J+tt+(K>>>0<et>>>0?1:0);$.high=J;$.low=K}var Z=F&q^~F&U,et=I&R^~I&z,$=A&M^A&D^M&D,nt=O&_^O&P^_&P,Q=(A>>>28|O<<4)^(A<<30|O>>>2)^(A<<25|O>>>7),G=(O>>>28|A<<4)^(O<<30|A>>>2)^(O<<25|A>>>7),Y=o[V],rt=Y.high,it=Y.low,Y=X+((I>>>14|F<<18)^(I>>>18|F<<14)^(I<<23|F>>>9)),tt=W+((F>>>14|I<<18)^(F>>>18|I<<14)^(F<<23|I>>>9))+(Y>>>0<X>>>0?1:0),Y=Y+et,tt=tt+Z+(Y>>>0<et>>>0?1:0),Y=Y+it,tt=tt+rt+(Y>>>0<it>>>0?1:0),Y=Y+K,tt=tt+J+(Y>>>0<K>>>0?1:0),K=G+nt,$=Q+$+(K>>>0<G>>>0?1:0),W=U,X=z,U=q,z=R,q=F,R=I,I=j+Y|0,F=H+tt+(I>>>0<j>>>0?1:0)|0,H=D,j=P,D=M,P=_,M=A,_=O,O=Y+K|0,A=tt+$+(O>>>0<Y>>>0?1:0)|0}p=r.low=p+O;r.high=h+A+(p>>>0<O>>>0?1:0);m=i.low=m+_;i.high=d+M+(m>>>0<_>>>0?1:0);y=s.low=y+P;s.high=g+D+(y>>>0<P>>>0?1:0);w=a.low=w+j;a.high=b+H+(w>>>0<j>>>0?1:0);S=f.low=S+I;f.high=E+F+(S>>>0<I>>>0?1:0);T=l.low=T+R;l.high=x+q+(T>>>0<R>>>0?1:0);C=c.low=C+z;c.high=N+U+(C>>>0<z>>>0?1:0);L=n.low=L+X;n.high=k+W+(L>>>0<X>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;t[(r+128>>>10<<5)+30]=Math.floor(n/4294967296);t[(r+128>>>10<<5)+31]=n;e.sigBytes=4*t.length;this._process();return this._hash.toX32()},clone:function(){var e=n.clone.call(this);e._hash=this._hash.clone();return e},blockSize:32});t.SHA512=n._createHelper(r);t.HmacSHA512=n._createHmacHelper(r)})();(function(){var e=CryptoJS,t=e.x64,n=t.Word,r=t.WordArray,t=e.algo,i=t.SHA512,t=t.SHA384=i.extend({_doReset:function(){this._hash=new r.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);e.sigBytes-=16;return e}});e.SHA384=i._createHelper(t);e.HmacSHA384=i._createHmacHelper(t)})();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(e){var t=CryptoJS,n=t.lib,r=n.Base,i=n.WordArray,t=t.x64={};t.Word=r.extend({init:function(e,t){this.high=e;this.low=t}});t.WordArray=r.extend({init:function(t,n){t=this.words=t||[];this.sigBytes=n!=e?n:8*t.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var s=e[r];n.push(s.high);n.push(s.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}})})();(function(){function e(){return i.create.apply(i,arguments)}for(var t=CryptoJS,n=t.lib.Hasher,r=t.x64,i=r.Word,s=r.WordArray,r=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],u=[],a=0;80>a;a++)u[a]=e();r=r.SHA512=n.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],a=n[3],f=n[4],l=n[5],c=n[6],n=n[7],h=r.high,d=r.low,v=i.high,m=i.low,g=s.high,b=s.low,w=a.high,E=a.low,S=f.high,x=f.low,T=l.high,N=l.low,C=c.high,k=c.low,L=n.high,A=n.low,O=h,M=d,_=v,D=m,P=g,H=b,B=w,j=E,F=S,I=x,q=T,R=N,U=C,z=k,W=L,X=A,V=0;80>V;V++){var $=u[V];if(16>V)var J=$.high=e[t+2*V]|0,K=$.low=e[t+2*V+1]|0;else{var J=u[V-15],K=J.high,Q=J.low,J=(K>>>1|Q<<31)^(K>>>8|Q<<24)^K>>>7,Q=(Q>>>1|K<<31)^(Q>>>8|K<<24)^(Q>>>7|K<<25),G=u[V-2],K=G.high,Y=G.low,G=(K>>>19|Y<<13)^(K<<3|Y>>>29)^K>>>6,Y=(Y>>>19|K<<13)^(Y<<3|K>>>29)^(Y>>>6|K<<26),K=u[V-7],Z=K.high,et=u[V-16],tt=et.high,et=et.low,K=Q+K.low,J=J+Z+(K>>>0<Q>>>0?1:0),K=K+Y,J=J+G+(K>>>0<Y>>>0?1:0),K=K+et,J=J+tt+(K>>>0<et>>>0?1:0);$.high=J;$.low=K}var Z=F&q^~F&U,et=I&R^~I&z,$=O&_^O&P^_&P,nt=M&D^M&H^D&H,Q=(O>>>28|M<<4)^(O<<30|M>>>2)^(O<<25|M>>>7),G=(M>>>28|O<<4)^(M<<30|O>>>2)^(M<<25|O>>>7),Y=o[V],rt=Y.high,it=Y.low,Y=X+((I>>>14|F<<18)^(I>>>18|F<<14)^(I<<23|F>>>9)),tt=W+((F>>>14|I<<18)^(F>>>18|I<<14)^(F<<23|I>>>9))+(Y>>>0<X>>>0?1:0),Y=Y+et,tt=tt+Z+(Y>>>0<et>>>0?1:0),Y=Y+it,tt=tt+rt+(Y>>>0<it>>>0?1:0),Y=Y+K,tt=tt+J+(Y>>>0<K>>>0?1:0),K=G+nt,$=Q+$+(K>>>0<G>>>0?1:0),W=U,X=z,U=q,z=R,q=F,R=I,I=j+Y|0,F=B+tt+(I>>>0<j>>>0?1:0)|0,B=P,j=H,P=_,H=D,_=O,D=M,M=Y+K|0,O=tt+$+(M>>>0<Y>>>0?1:0)|0}d=r.low=d+M;r.high=h+O+(d>>>0<M>>>0?1:0);m=i.low=m+D;i.high=v+_+(m>>>0<D>>>0?1:0);b=s.low=b+H;s.high=g+P+(b>>>0<H>>>0?1:0);E=a.low=E+j;a.high=w+B+(E>>>0<j>>>0?1:0);x=f.low=x+I;f.high=S+F+(x>>>0<I>>>0?1:0);N=l.low=N+R;l.high=T+q+(N>>>0<R>>>0?1:0);k=c.low=k+z;c.high=C+U+(k>>>0<z>>>0?1:0);A=n.low=A+X;n.high=L+W+(A>>>0<X>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;t[(r+128>>>10<<5)+30]=Math.floor(n/4294967296);t[(r+128>>>10<<5)+31]=n;e.sigBytes=4*t.length;this._process();return this._hash.toX32()},clone:function(){var e=n.clone.call(this);e._hash=this._hash.clone();return e},blockSize:32});t.SHA512=n._createHelper(r);t.HmacSHA512=n._createHmacHelper(r)})();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();e=[];for(var i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-8*(i%4)&255)<<16|(t[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|t[i+2>>>2]>>>24-8*((i+2)%4)&255,o=0;4>o&&i+.75*o<n;o++)e.push(r.charAt(s>>>6*(3-o)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map,i=r.charAt(64);i&&(i=e.indexOf(i),-1!=i&&(n=i));for(var i=[],s=0,o=0;o<n;o++)if(o%4){var u=r.indexOf(e.charAt(o-1))<<2*(o%4),a=r.indexOf(e.charAt(o))>>>6-2*(o%4);i[s>>>2]|=(u|a)<<24-8*(s%4);s++}return t.create(i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(e){function t(e,t,n,r,i,s,o){e=e+(t&n|~t&r)+i+o;return(e<<s|e>>>32-s)+t}function n(e,t,n,r,i,s,o){e=e+(t&r|n&~r)+i+o;return(e<<s|e>>>32-s)+t}function r(e,t,n,r,i,s,o){e=e+(t^n^r)+i+o;return(e<<s|e>>>32-s)+t}function i(e,t,n,r,i,s,o){e=e+(n^(t|~r))+i+o;return(e<<s|e>>>32-s)+t}for(var s=CryptoJS,o=s.lib,u=o.WordArray,a=o.Hasher,o=s.algo,f=[],l=0;64>l;l++)f[l]=4294967296*e.abs(e.sin(l+1))|0;o=o.MD5=a.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var o=0;16>o;o++){var u=s+o,a=e[u];e[u]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360}var o=this._hash.words,u=e[s+0],a=e[s+1],l=e[s+2],c=e[s+3],h=e[s+4],v=e[s+5],m=e[s+6],g=e[s+7],y=e[s+8],w=e[s+9],E=e[s+10],S=e[s+11],x=e[s+12],T=e[s+13],N=e[s+14],C=e[s+15],k=o[0],L=o[1],A=o[2],O=o[3],k=t(k,L,A,O,u,7,f[0]),O=t(O,k,L,A,a,12,f[1]),A=t(A,O,k,L,l,17,f[2]),L=t(L,A,O,k,c,22,f[3]),k=t(k,L,A,O,h,7,f[4]),O=t(O,k,L,A,v,12,f[5]),A=t(A,O,k,L,m,17,f[6]),L=t(L,A,O,k,g,22,f[7]),k=t(k,L,A,O,y,7,f[8]),O=t(O,k,L,A,w,12,f[9]),A=t(A,O,k,L,E,17,f[10]),L=t(L,A,O,k,S,22,f[11]),k=t(k,L,A,O,x,7,f[12]),O=t(O,k,L,A,T,12,f[13]),A=t(A,O,k,L,N,17,f[14]),L=t(L,A,O,k,C,22,f[15]),k=n(k,L,A,O,a,5,f[16]),O=n(O,k,L,A,m,9,f[17]),A=n(A,O,k,L,S,14,f[18]),L=n(L,A,O,k,u,20,f[19]),k=n(k,L,A,O,v,5,f[20]),O=n(O,k,L,A,E,9,f[21]),A=n(A,O,k,L,C,14,f[22]),L=n(L,A,O,k,h,20,f[23]),k=n(k,L,A,O,w,5,f[24]),O=n(O,k,L,A,N,9,f[25]),A=n(A,O,k,L,c,14,f[26]),L=n(L,A,O,k,y,20,f[27]),k=n(k,L,A,O,T,5,f[28]),O=n(O,k,L,A,l,9,f[29]),A=n(A,O,k,L,g,14,f[30]),L=n(L,A,O,k,x,20,f[31]),k=r(k,L,A,O,v,4,f[32]),O=r(O,k,L,A,y,11,f[33]),A=r(A,O,k,L,S,16,f[34]),L=r(L,A,O,k,N,23,f[35]),k=r(k,L,A,O,a,4,f[36]),O=r(O,k,L,A,h,11,f[37]),A=r(A,O,k,L,g,16,f[38]),L=r(L,A,O,k,E,23,f[39]),k=r(k,L,A,O,T,4,f[40]),O=r(O,k,L,A,u,11,f[41]),A=r(A,O,k,L,c,16,f[42]),L=r(L,A,O,k,m,23,f[43]),k=r(k,L,A,O,w,4,f[44]),O=r(O,k,L,A,x,11,f[45]),A=r(A,O,k,L,C,16,f[46]),L=r(L,A,O,k,l,23,f[47]),k=i(k,L,A,O,u,6,f[48]),O=i(O,k,L,A,g,10,f[49]),A=i(A,O,k,L,N,15,f[50]),L=i(L,A,O,k,v,21,f[51]),k=i(k,L,A,O,x,6,f[52]),O=i(O,k,L,A,c,10,f[53]),A=i(A,O,k,L,E,15,f[54]),L=i(L,A,O,k,a,21,f[55]),k=i(k,L,A,O,y,6,f[56]),O=i(O,k,L,A,C,10,f[57]),A=i(A,O,k,L,m,15,f[58]),L=i(L,A,O,k,T,21,f[59]),k=i(k,L,A,O,h,6,f[60]),O=i(O,k,L,A,S,10,f[61]),A=i(A,O,k,L,l,15,f[62]),L=i(L,A,O,k,w,21,f[63]);o[0]=o[0]+k|0;o[1]=o[1]+L|0;o[2]=o[2]+A|0;o[3]=o[3]+O|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(r/4294967296);n[(i+64>>>9<<4)+15]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360;n[(i+64>>>9<<4)+14]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360;t.sigBytes=4*(n.length+1);this._process();t=this._hash;n=t.words;for(r=0;4>r;r++)i=n[r],n[r]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360;return t},clone:function(){var e=a.clone.call(this);e._hash=this._hash.clone();return e}});s.MD5=a._createHelper(o);s.HmacMD5=a._createHmacHelper(o)})(Math);(function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,t=e.algo,i=t.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),s=r.create(),o=s.words,u=n.keySize,n=n.iterations;o.length<u;){a&&i.update(a);var a=i.update(e).finalize(t);i.reset();for(var f=1;f<n;f++)a=i.finalize(a),i.reset();s.concat(a)}s.sigBytes=4*u;return s}});e.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}})();CryptoJS.lib.Cipher||function(e){var t=CryptoJS,n=t.lib,r=n.Base,i=n.WordArray,s=n.BufferedBlockAlgorithm,o=t.enc.Base64,u=t.algo.EvpKDF,a=n.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n);this._xformMode=e;this._key=t;this.reset()},reset:function(){s.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?d:p).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?d:p).decrypt(e,t,n,r)}}}});n.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var f=t.mode={},l=function(t,n,r){var i=this._iv;i?this._iv=e:i=this._prevBlock;for(var s=0;s<r;s++)t[n+s]^=i[s]},c=(n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e;this._iv=t}})).extend();c.Encryptor=c.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r);n.encryptBlock(e,t);this._prevBlock=e.slice(t,t+r)}});c.Decryptor=c.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t);l.call(this,e,t,r);this._prevBlock=i}});f=f.CBC=c;c=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,r=n<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(r);n=i.create(s,n);e.concat(n)},unpad:function(e){e.sigBytes-=e.words[e.sigBytes-1>>>2]&255}};n.BlockCipher=a.extend({cfg:a.cfg.extend({mode:f,padding:c}),reset:function(){a.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;e=e.salt;return(e?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){e=o.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=i.create(t.slice(2,4));t.splice(0,4);e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},p=n.SerializableCipher=r.extend({cfg:r.extend({format:f}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);t=i.finalize(t);i=i.cfg;return h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){r=this.cfg.extend(r);t=this._parse(t,r.format);return e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){r||(r=i.random(8));e=u.create({keySize:t+n}).compute(e,r);n=i.create(e.words.slice(t),4*n);e.sigBytes=4*t;return h.create({key:e,iv:n,salt:r})}},d=n.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:t}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);n=r.kdf.execute(n,e.keySize,e.ivSize);r.iv=n.iv;e=p.encrypt.call(this,e,t,n.key,r);e.mixIn(n);return e},decrypt:function(e,t,n,r){r=this.cfg.extend(r);t=this._parse(t,r.format);n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);r.iv=n.iv;return p.decrypt.call(this,e,t,n.key,r)}})}();(function(){function e(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n;this._lBlock^=n<<e}function t(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n;this._rBlock^=n<<e}var n=CryptoJS,r=n.lib,i=r.WordArray,r=r.BlockCipher,s=n.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],a=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],f=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],c=s.DES=r.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;56>n;n++){var r=o[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}e=this._subKeys=[];for(r=0;16>r;r++){for(var i=e[r]=[],s=a[r],n=0;24>n;n++)i[n/6|0]|=t[(u[n]-1+s)%28]<<31-n%6,i[4+(n/6|0)]|=t[28+(u[n+24]-1+s)%28]<<31-n%6;i[0]=i[0]<<1|i[0]>>>31;for(n=1;7>n;n++)i[n]>>>=4*(n-1)+3;i[7]=i[7]<<5|i[7]>>>27}t=this._invSubKeys=[];for(n=0;16>n;n++)t[n]=e[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(n,r,i){this._lBlock=n[r];this._rBlock=n[r+1];e.call(this,4,252645135);e.call(this,16,65535);t.call(this,2,858993459);t.call(this,8,16711935);e.call(this,1,1431655765);for(var s=0;16>s;s++){for(var o=i[s],u=this._lBlock,a=this._rBlock,c=0,h=0;8>h;h++)c|=f[h][((a^o[h])&l[h])>>>0];this._lBlock=a;this._rBlock=u^c}i=this._lBlock;this._lBlock=this._rBlock;this._rBlock=i;e.call(this,1,1431655765);t.call(this,8,16711935);t.call(this,2,858993459);e.call(this,16,65535);e.call(this,4,252645135);n[r]=this._lBlock;n[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});n.DES=r._createHelper(c);s=s.TripleDES=r.extend({_doReset:function(){var e=this._key.words;this._des1=c.createEncryptor(i.create(e.slice(0,2)));this._des2=c.createEncryptor(i.create(e.slice(2,4)));this._des3=c.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t);this._des2.decryptBlock(e,t);this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t);this._des2.encryptBlock(e,t);this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});n.TripleDES=r._createHelper(s)})();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},s=r.Base={extend:function(e){i.prototype=this;var t=new i;e&&t.mixIn(e);t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,n){e=this.words=e||[];this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);this.sigBytes+=e;return this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4);t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16));n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},f=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0);t=u*s;i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=s)this._doProcessBlock(r,a);a=r.splice(0,t);n.sigBytes-=i}return new o.init(a,i)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});r.Hasher=c.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}});var h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();e=[];for(var i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-8*(i%4)&255)<<16|(t[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|t[i+2>>>2]>>>24-8*((i+2)%4)&255,o=0;4>o&&i+.75*o<n;o++)e.push(r.charAt(s>>>6*(3-o)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map,i=r.charAt(64);i&&(i=e.indexOf(i),-1!=i&&(n=i));for(var i=[],s=0,o=0;o<n;o++)if(o%4){var u=r.indexOf(e.charAt(o-1))<<2*(o%4),a=r.indexOf(e.charAt(o))>>>6-2*(o%4);i[s>>>2]|=(u|a)<<24-8*(s%4);s++}return t.create(i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(e){function t(e,t,n,r,i,s,o){e=e+(t&n|~t&r)+i+o;return(e<<s|e>>>32-s)+t}function n(e,t,n,r,i,s,o){e=e+(t&r|n&~r)+i+o;return(e<<s|e>>>32-s)+t}function r(e,t,n,r,i,s,o){e=e+(t^n^r)+i+o;return(e<<s|e>>>32-s)+t}function i(e,t,n,r,i,s,o){e=e+(n^(t|~r))+i+o;return(e<<s|e>>>32-s)+t}for(var s=CryptoJS,o=s.lib,u=o.WordArray,a=o.Hasher,o=s.algo,f=[],l=0;64>l;l++)f[l]=4294967296*e.abs(e.sin(l+1))|0;o=o.MD5=a.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var o=0;16>o;o++){var u=s+o,a=e[u];e[u]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360}var o=this._hash.words,u=e[s+0],a=e[s+1],l=e[s+2],c=e[s+3],h=e[s+4],v=e[s+5],m=e[s+6],g=e[s+7],y=e[s+8],w=e[s+9],E=e[s+10],S=e[s+11],x=e[s+12],T=e[s+13],N=e[s+14],C=e[s+15],k=o[0],L=o[1],A=o[2],O=o[3],k=t(k,L,A,O,u,7,f[0]),O=t(O,k,L,A,a,12,f[1]),A=t(A,O,k,L,l,17,f[2]),L=t(L,A,O,k,c,22,f[3]),k=t(k,L,A,O,h,7,f[4]),O=t(O,k,L,A,v,12,f[5]),A=t(A,O,k,L,m,17,f[6]),L=t(L,A,O,k,g,22,f[7]),k=t(k,L,A,O,y,7,f[8]),O=t(O,k,L,A,w,12,f[9]),A=t(A,O,k,L,E,17,f[10]),L=t(L,A,O,k,S,22,f[11]),k=t(k,L,A,O,x,7,f[12]),O=t(O,k,L,A,T,12,f[13]),A=t(A,O,k,L,N,17,f[14]),L=t(L,A,O,k,C,22,f[15]),k=n(k,L,A,O,a,5,f[16]),O=n(O,k,L,A,m,9,f[17]),A=n(A,O,k,L,S,14,f[18]),L=n(L,A,O,k,u,20,f[19]),k=n(k,L,A,O,v,5,f[20]),O=n(O,k,L,A,E,9,f[21]),A=n(A,O,k,L,C,14,f[22]),L=n(L,A,O,k,h,20,f[23]),k=n(k,L,A,O,w,5,f[24]),O=n(O,k,L,A,N,9,f[25]),A=n(A,O,k,L,c,14,f[26]),L=n(L,A,O,k,y,20,f[27]),k=n(k,L,A,O,T,5,f[28]),O=n(O,k,L,A,l,9,f[29]),A=n(A,O,k,L,g,14,f[30]),L=n(L,A,O,k,x,20,f[31]),k=r(k,L,A,O,v,4,f[32]),O=r(O,k,L,A,y,11,f[33]),A=r(A,O,k,L,S,16,f[34]),L=r(L,A,O,k,N,23,f[35]),k=r(k,L,A,O,a,4,f[36]),O=r(O,k,L,A,h,11,f[37]),A=r(A,O,k,L,g,16,f[38]),L=r(L,A,O,k,E,23,f[39]),k=r(k,L,A,O,T,4,f[40]),O=r(O,k,L,A,u,11,f[41]),A=r(A,O,k,L,c,16,f[42]),L=r(L,A,O,k,m,23,f[43]),k=r(k,L,A,O,w,4,f[44]),O=r(O,k,L,A,x,11,f[45]),A=r(A,O,k,L,C,16,f[46]),L=r(L,A,O,k,l,23,f[47]),k=i(k,L,A,O,u,6,f[48]),O=i(O,k,L,A,g,10,f[49]),A=i(A,O,k,L,N,15,f[50]),L=i(L,A,O,k,v,21,f[51]),k=i(k,L,A,O,x,6,f[52]),O=i(O,k,L,A,c,10,f[53]),A=i(A,O,k,L,E,15,f[54]),L=i(L,A,O,k,a,21,f[55]),k=i(k,L,A,O,y,6,f[56]),O=i(O,k,L,A,C,10,f[57]),A=i(A,O,k,L,m,15,f[58]),L=i(L,A,O,k,T,21,f[59]),k=i(k,L,A,O,h,6,f[60]),O=i(O,k,L,A,S,10,f[61]),A=i(A,O,k,L,l,15,f[62]),L=i(L,A,O,k,w,21,f[63]);o[0]=o[0]+k|0;o[1]=o[1]+L|0;o[2]=o[2]+A|0;o[3]=o[3]+O|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(r/4294967296);n[(i+64>>>9<<4)+15]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360;n[(i+64>>>9<<4)+14]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360;t.sigBytes=4*(n.length+1);this._process();t=this._hash;n=t.words;for(r=0;4>r;r++)i=n[r],n[r]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360;return t},clone:function(){var e=a.clone.call(this);e._hash=this._hash.clone();return e}});s.MD5=a._createHelper(o);s.HmacMD5=a._createHmacHelper(o)})(Math);(function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,t=e.algo,i=t.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),s=r.create(),o=s.words,u=n.keySize,n=n.iterations;o.length<u;){a&&i.update(a);var a=i.update(e).finalize(t);i.reset();for(var f=1;f<n;f++)a=i.finalize(a),i.reset();s.concat(a)}s.sigBytes=4*u;return s}});e.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}})();CryptoJS.lib.Cipher||function(e){var t=CryptoJS,n=t.lib,r=n.Base,i=n.WordArray,s=n.BufferedBlockAlgorithm,o=t.enc.Base64,u=t.algo.EvpKDF,a=n.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n);this._xformMode=e;this._key=t;this.reset()},reset:function(){s.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?d:p).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?d:p).decrypt(e,t,n,r)}}}});n.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var f=t.mode={},l=function(t,n,r){var i=this._iv;i?this._iv=e:i=this._prevBlock;for(var s=0;s<r;s++)t[n+s]^=i[s]},c=(n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e;this._iv=t}})).extend();c.Encryptor=c.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r);n.encryptBlock(e,t);this._prevBlock=e.slice(t,t+r)}});c.Decryptor=c.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t);l.call(this,e,t,r);this._prevBlock=i}});f=f.CBC=c;c=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,r=n<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(r);n=i.create(s,n);e.concat(n)},unpad:function(e){e.sigBytes-=e.words[e.sigBytes-1>>>2]&255}};n.BlockCipher=a.extend({cfg:a.cfg.extend({mode:f,padding:c}),reset:function(){a.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;e=e.salt;return(e?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){e=o.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=i.create(t.slice(2,4));t.splice(0,4);e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},p=n.SerializableCipher=r.extend({cfg:r.extend({format:f}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);t=i.finalize(t);i=i.cfg;return h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){r=this.cfg.extend(r);t=this._parse(t,r.format);return e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){r||(r=i.random(8));e=u.create({keySize:t+n}).compute(e,r);n=i.create(e.words.slice(t),4*n);e.sigBytes=4*t;return h.create({key:e,iv:n,salt:r})}},d=n.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:t}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);n=r.kdf.execute(n,e.keySize,e.ivSize);r.iv=n.iv;e=p.encrypt.call(this,e,t,n.key,r);e.mixIn(n);return e},decrypt:function(e,t,n,r){r=this.cfg.extend(r);t=this._parse(t,r.format);n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);r.iv=n.iv;return p.decrypt.call(this,e,t,n.key,r)}})}();(function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],s=[],o=[],u=[],a=[],f=[],l=[],c=[],h=[],p=[],d=0;256>d;d++)p[d]=128>d?d<<1:d<<1^283;for(var v=0,m=0,d=0;256>d;d++){var g=m^m<<1^m<<2^m<<3^m<<4,g=g>>>8^g&255^99;r[v]=g;i[g]=v;var y=p[v],b=p[y],w=p[b],E=257*p[g]^16843008*g;s[v]=E<<24|E>>>8;o[v]=E<<16|E>>>16;u[v]=E<<8|E>>>24;a[v]=E;E=16843009*w^65537*b^257*y^16843008*v;f[g]=E<<24|E>>>8;l[g]=E<<16|E>>>16;c[g]=E<<8|E>>>24;h[g]=E;v?(v=y^p[p[p[w^y]]],m^=p[p[m]]):v=m=1}var S=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,e=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],s=0;s<e;s++)if(s<n)i[s]=t[s];else{var o=i[s-1];s%n?6<n&&4==s%n&&(o=r[o>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[o&255]):(o=o<<8|o>>>24,o=r[o>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[o&255],o^=S[s/n|0]<<24);i[s]=i[s-n]^o}t=this._invKeySchedule=[];for(n=0;n<e;n++)s=e-n,o=n%4?i[s]:i[s-4],t[n]=4>n||4>=s?o:f[r[o>>>24]]^l[r[o>>>16&255]]^c[r[o>>>8&255]]^h[r[o&255]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,o,u,a,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3];e[t+3]=n;this._doCryptBlock(e,t,this._invKeySchedule,f,l,c,h,i);n=e[t+1];e[t+1]=e[t+3];e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,s,o,u){for(var a=this._nRounds,f=e[t]^n[0],l=e[t+1]^n[1],c=e[t+2]^n[2],h=e[t+3]^n[3],p=4,d=1;d<a;d++)var v=r[f>>>24]^i[l>>>16&255]^s[c>>>8&255]^o[h&255]^n[p++],m=r[l>>>24]^i[c>>>16&255]^s[h>>>8&255]^o[f&255]^n[p++],g=r[c>>>24]^i[h>>>16&255]^s[f>>>8&255]^o[l&255]^n[p++],h=r[h>>>24]^i[f>>>16&255]^s[l>>>8&255]^o[c&255]^n[p++],f=v,l=m,c=g;v=(u[f>>>24]<<24|u[l>>>16&255]<<16|u[c>>>8&255]<<8|u[h&255])^n[p++];m=(u[l>>>24]<<24|u[c>>>16&255]<<16|u[h>>>8&255]<<8|u[f&255])^n[p++];g=(u[c>>>24]<<24|u[h>>>16&255]<<16|u[f>>>8&255]<<8|u[l&255])^n[p++];h=(u[h>>>24]<<24|u[f>>>16&255]<<16|u[l>>>8&255]<<8|u[c&255])^n[p++];e[t]=v;e[t+1]=m;e[t+2]=g;e[t+3]=h},keySize:8});e.AES=t._createHelper(n)})();(function(e){var t=0;e.getScrollbarWidth=function(){if(!t){if(e.browser.msie){var n=e('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body"),r=e('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body");t=n.width()-r.width();n.add(r).remove()}else{var i=e("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:-1e3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});t=100-i.width();i.parent().remove()}}return t}})(jQuery);(function(e,t){"$:nomunge";var n=e.jQuery||e.Cowboy||(e.Cowboy={}),r;n.throttle=r=function(e,r,i,s){function a(){function l(){u=+(new Date);i.apply(n,f)}function c(){o=t}var n=this,a=+(new Date)-u,f=arguments;if(s&&!o){l()}o&&clearTimeout(o);if(s===t&&a>e){l()}else if(r!==true){o=setTimeout(s?c:l,s===t?e-a:e)}}var o,u=0;if(typeof r!=="boolean"){s=i;i=r;r=t}if(n.guid){a.guid=i.guid=i.guid||n.guid++}return a};n.debounce=function(e,n,i){return i===t?r(e,n,false):r(e,i,n!==false)}})(this);(function(e){function t(e){var t=["transform","WebkitTransform","msTransform","MozTransform","OTransform"];var n;while(n=t.shift()){if(e&&typeof e.style[n]!="undefined"){return n}}return"transform"}var n=null;var r=e.fn.css;e.fn.css=function(i,s){if(n===null){if(typeof e.cssProps!="undefined"){n=e.cssProps}else if(typeof e.props!="undefined"){n=e.props}else{n={}}}if(typeof n["transform"]=="undefined"&&(i=="transform"||typeof i=="object"&&typeof i["transform"]!="undefined")){n["transform"]=t(this.get(0))}if(n["transform"]!="transform"){if(i=="transform"){i=n["transform"];if(typeof s=="undefined"&&jQuery.style){return jQuery.style(this.get(0),i)}}else if(typeof i=="object"&&typeof i["transform"]!="undefined"){i[n["transform"]]=i["transform"];delete i["transform"]}}return r.apply(this,arguments)}})(jQuery);(function(e){var t="deg";e.fn.rotate=function(n){var r=e(this).css("transform")||"none";if(typeof n=="undefined"){if(r){var i=r.match(/rotate\(([^)]+)\)/);if(i&&i[1]){return i[1]}}return 0}var i=n.toString().match(/^(-?\d+(\.\d+)?)(.+)?$/);if(i){if(i[3]){t=i[3]}e(this).css("transform",r.replace(/none|rotate\([^)]*\)/,"")+"rotate("+i[1]+t+")")}return this};e.fn.scale=function(t,n,r){var i=e(this).css("transform");if(typeof t=="undefined"){if(i){var s=i.match(/scale\(([^)]+)\)/);if(s&&s[1]){return s[1]}}return 1}e(this).css("transform",i.replace(/none|scale\([^)]*\)/,"")+"scale("+t+")");return this};var n=e.fx.prototype.cur;e.fx.prototype.cur=function(){if(this.prop=="rotate"){return parseFloat(e(this.elem).rotate())}else if(this.prop=="scale"){return parseFloat(e(this.elem).scale())}return n.apply(this,arguments)};e.fx.step.rotate=function(n){e(n.elem).rotate(n.now+t)};e.fx.step.scale=function(t){e(t.elem).scale(t.now)};var r=e.fn.animate;e.fn.animate=function(e){if(typeof e["rotate"]!="undefined"){var n=e["rotate"].toString().match(/^(([+-]=)?(-?\d+(\.\d+)?))(.+)?$/);if(n&&n[5]){t=n[5]}e["rotate"]=n[1]}return r.apply(this,arguments)}})(jQuery);if(window.jQuery)(function(e){e.extend({xml2json:function(t,n){function r(t,s){if(!t)return null;var u="",a=null,f=null;var l=t.nodeType,c=i(t.localName||t.nodeName);var h=t.text||t.nodeValue||"";if(t.childNodes){if(t.childNodes.length>0){e.each(t.childNodes,function(e,t){var n=t.nodeType,s=i(t.localName||t.nodeName);var f=t.text||t.nodeValue||"";if(n==8){return}else if(n==3||n==4||!s){if(f.match(/^\s+$/)){return}u+=f.replace(/^\s+/,"").replace(/\s+$/,"")}else{a=a||{};if(a[s]){if(!a[s].length)a[s]=o(a[s]);a[s]=o(a[s]);a[s][a[s].length]=r(t,true);a[s].length=a[s].length}else{a[s]=r(t)}}})}}if(t.attributes){if(t.attributes.length>0){f={};a=a||{};e.each(t.attributes,function(e,t){var n=i(t.name),r=t.value;f[n]=r;if(a[n]){a[cnn]=o(a[cnn]);a[n][a[n].length]=r;a[n].length=a[n].length}else{a[n]=r}})}}if(a){a=e.extend(u!=""?new String(u):{},a||{});u=a.text?(typeof a.text=="object"?a.text:[a.text||""]).concat([u]):u;if(u)a.text=u;u=""}var p=a||u;if(n){if(u)p={};u=p.text||u||"";if(u)p.text=u;if(!s)p=o(p)}return p}function s(e){var t=/^((-)?([0-9]+)(([\.\,]{0,1})([0-9]+))?$)/;return typeof e=="number"||t.test(String(e&&typeof e=="string"?jQuery.trim(e):""))}if(!t)return{};var i=function(e){return String(e||"").replace(/-/g,"_")};var o=function(t){if(!e.isArray(t))t=[t];t.length=t.length;return t};if(typeof t=="string")t=e.text2xml(t);if(!t.nodeType)return;if(t.nodeType==3||t.nodeType==4)return t.nodeValue;var u=t.nodeType==9?t.documentElement:t;var a=r(u,true);t=null;u=null;return a},text2xml:function(t){var n;try{var r=e.browser.msie?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser;r.async=false}catch(i){throw new Error("XML Parser could not be instantiated")}try{if(e.browser.msie)n=r.loadXML(t)?r:false;else n=r.parseFromString(t,"text/xml")}catch(i){throw new Error("Error parsing XML string")}return n}})})(jQuery);(function(e,t){"use strict";function r(){if(n.READY){return}n.event.determineEventTypes();for(var e in n.gestures){if(n.gestures.hasOwnProperty(e)){n.detection.register(n.gestures[e])}}n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect);n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect);n.READY=true}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled;n.HAS_TOUCHEVENTS="ontouchstart"in e;n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&navigator.userAgent.match(n.MOBILE_REGEX);n.EVENT_TYPES={};n.DIRECTION_DOWN="down";n.DIRECTION_LEFT="left";n.DIRECTION_UP="up";n.DIRECTION_RIGHT="right";n.POINTER_MOUSE="mouse";n.POINTER_TOUCH="touch";n.POINTER_PEN="pen";n.EVENT_START="start";n.EVENT_MOVE="move";n.EVENT_END="end";n.DOCUMENT=document;n.plugins={};n.READY=false;n.Instance=function(e,t){var i=this;r();this.element=e;this.enabled=true;this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{});if(this.options.stop_browser_behavior){n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior)}n.event.onTouch(e,n.EVENT_START,function(e){if(i.enabled){n.detection.startDetect(i,e)}});return this};n.Instance.prototype={on:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++){this.element.addEventListener(r[i],n,false)}return this},off:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++){this.element.removeEventListener(r[i],n,false)}return this},trigger:function(t,r){var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,true,true);i.gesture=r;var s=this.element;if(n.utils.hasParent(r.target,s)){s=r.target}s.dispatchEvent(i);return this},enable:function(t){this.enabled=t;return this}};var i=null;var s=false;var o=false;n.event={bindDom:function(e,t,n){var r=t.split(" ");for(var i=0;i<r.length;i++){e.addEventListener(r[i],n,false)}},onTouch:function(t,r,u){var a=this;this.bindDom(t,n.EVENT_TYPES[r],function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&o){return}else if(l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1){s=true}if(l.match(/touch|pointer/)){o=true}var c=0;if(s){if(n.HAS_POINTEREVENTS&&r!=n.EVENT_END){c=n.PointerEvent.updatePointer(r,f)}else if(l.match(/touch/)){c=f.touches.length}else if(!o){c=l.match(/up/)?0:1}if(c>0&&r==n.EVENT_END){r=n.EVENT_MOVE}else if(!c){r=n.EVENT_END}if(!c&&i!==null){f=i}else{i=f}u.call(n.detection,a.collectEventData(t,r,f));if(n.HAS_POINTEREVENTS&&r==n.EVENT_END){c=n.PointerEvent.updatePointer(r,f)}}if(!c){i=null;s=false;o=false;n.PointerEvent.reset()}})},determineEventTypes:function(){var t;if(n.HAS_POINTEREVENTS){t=n.PointerEvent.getEvents()}else if(n.NO_MOUSEEVENTS){t=["touchstart","touchmove","touchend touchcancel"]}else{t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"]}n.EVENT_TYPES[n.EVENT_START]=t[0];n.EVENT_TYPES[n.EVENT_MOVE]=t[1];n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){if(n.HAS_POINTEREVENTS){return n.PointerEvent.getTouchList()}else if(t.touches){return t.touches}else{return[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]}},collectEventData:function(t,r,i){var s=this.getTouchList(i,r);var o=n.POINTER_TOUCH;if(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i)){o=n.POINTER_MOUSE}return{center:n.utils.getCenter(s),timeStamp:(new Date).getTime(),target:i.target,touches:s,eventType:r,pointerType:o,srcEvent:i,preventDefault:function(){if(this.srcEvent.preventManipulation){this.srcEvent.preventManipulation()}if(this.srcEvent.preventDefault){this.srcEvent.preventDefault()}},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}};n.PointerEvent={pointers:{},getTouchList:function(){var e=this;var t=[];Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])});return t},updatePointer:function(e,t){if(e==n.EVENT_END){this.pointers={}}else{t.identifier=t.pointerId;this.pointers[t.pointerId]=t}return Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType){return false}var r={};r[n.POINTER_MOUSE]=t.pointerType==t.MSPOINTER_TYPE_MOUSE||t.pointerType==n.POINTER_MOUSE;r[n.POINTER_TOUCH]=t.pointerType==t.MSPOINTER_TYPE_TOUCH||t.pointerType==n.POINTER_TOUCH;r[n.POINTER_PEN]=t.pointerType==t.MSPOINTER_TYPE_PEN||t.pointerType==n.POINTER_PEN;return r[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}};n.utils={extend:function(n,r,i){for(var s in r){if(n[s]!==t&&i){continue}n[s]=r[s]}return n},hasParent:function(e,t){while(e){if(e==t){return true}e=e.parentNode}return false},getCenter:function(t){var n=[],r=[];for(var i=0,s=t.length;i<s;i++){n.push(t[i].pageX);r.push(t[i].pageY)}return{pageX:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,pageY:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,r){var i=Math.abs(t.pageX-r.pageX),s=Math.abs(t.pageY-r.pageY);if(i>=s){return t.pageX-r.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT}else{return t.pageY-r.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN}},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){if(t.length>=2&&n.length>=2){return this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1])}return 1},getRotation:function(t,n){if(t.length>=2&&n.length>=2){return this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0])}return 0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,n){var r,i=["webkit","khtml","moz","ms","o",""];if(!n||!t.style){return}for(var s=0;s<i.length;s++){for(var o in n){if(n.hasOwnProperty(o)){r=o;if(i[s]){r=i[s]+r.substring(0,1).toUpperCase()+r.substring(1)}t.style[r]=n[o]}}}if(n.userSelect=="none"){t.onselectstart=function(){return false}}}};n.detection={gestures:[],current:null,previous:null,stopped:false,startDetect:function(t,r){if(this.current){return}this.stopped=false;this.current={inst:t,startEvent:n.utils.extend({},r),lastEvent:false,name:""};this.detect(r)},detect:function(t){if(!this.current||this.stopped){return}t=this.extendEventData(t);var r=this.current.inst.options;for(var i=0,s=this.gestures.length;i<s;i++){var o=this.gestures[i];if(!this.stopped&&r[o.name]!==false){if(o.handler.call(o,t,this.current.inst)===false){this.stopDetect();break}}}if(this.current){this.current.lastEvent=t}if(t.eventType==n.EVENT_END&&!t.touches.length-1){this.stopDetect()}return t},stopDetect:function(){this.previous=n.utils.extend({},this.current);this.current=null;this.stopped=true},extendEventData:function(t){var r=this.current.startEvent;if(r&&(t.touches.length!=r.touches.length||t.touches===r.touches)){r.touches=[];for(var i=0,s=t.touches.length;i<s;i++){r.touches.push(n.utils.extend({},t.touches[i]))}}var o=t.timeStamp-r.timeStamp,u=t.center.pageX-r.center.pageX,a=t.center.pageY-r.center.pageY,f=n.utils.getVelocity(o,u,a);n.utils.extend(t,{deltaTime:o,deltaX:u,deltaY:a,velocityX:f.x,velocityY:f.y,distance:n.utils.getDistance(r.center,t.center),angle:n.utils.getAngle(r.center,t.center),direction:n.utils.getDirection(r.center,t.center),scale:n.utils.getScale(r.touches,t.touches),rotation:n.utils.getRotation(r.touches,t.touches),startEvent:r});return t},register:function(r){var i=r.defaults||{};if(i[r.name]===t){i[r.name]=true}n.utils.extend(n.defaults,i,true);r.index=r.index||1e3;this.gestures.push(r);this.gestures.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0});return this.gestures}};n.gestures=n.gestures||{};n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,r){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer);n.detection.current.name=this.name;this.timer=setTimeout(function(){if(n.detection.current.name=="hold"){r.trigger("hold",t)}},r.options.hold_timeout);break;case n.EVENT_MOVE:if(t.distance>r.options.hold_threshold){clearTimeout(this.timer)}break;case n.EVENT_END:clearTimeout(this.timer);break}}};n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:true,doubletap_distance:20,doubletap_interval:300},handler:function(t,r){if(t.eventType==n.EVENT_END){var i=n.detection.previous,s=false;if(t.deltaTime>r.options.tap_max_touchtime||t.distance>r.options.tap_max_distance){return}if(i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<r.options.doubletap_interval&&t.distance<r.options.doubletap_distance){r.trigger("doubletap",t);s=true}if(!s||r.options.tap_always){n.detection.current.name="tap";r.trigger(n.detection.current.name,t)}}}};n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,r){if(t.eventType==n.EVENT_END){if(r.options.swipe_max_touches>0&&t.touches.length>r.options.swipe_max_touches){return}if(t.velocityX>r.options.swipe_velocity||t.velocityY>r.options.swipe_velocity){r.trigger(this.name,t);r.trigger(this.name+t.direction,t)}}}};n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:false,drag_block_vertical:false,drag_lock_to_axis:false,drag_lock_min_distance:25},triggered:false,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t);this.triggered=false;return}if(r.options.drag_max_touches>0&&t.touches.length>r.options.drag_max_touches){return}switch(t.eventType){case n.EVENT_START:this.triggered=false;break;case n.EVENT_MOVE:if(t.distance<r.options.drag_min_distance&&n.detection.current.name!=this.name){return}n.detection.current.name=this.name;if(n.detection.current.lastEvent.drag_locked_to_axis||r.options.drag_lock_to_axis&&r.options.drag_lock_min_distance<=t.distance){t.drag_locked_to_axis=true}var i=n.detection.current.lastEvent.direction;if(t.drag_locked_to_axis&&i!==t.direction){if(n.utils.isVertical(i)){t.direction=t.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN}else{t.direction=t.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT}}if(!this.triggered){r.trigger(this.name+"start",t);this.triggered=true}r.trigger(this.name,t);r.trigger(this.name+t.direction,t);if(r.options.drag_block_vertical&&n.utils.isVertical(t.direction)||r.options.drag_block_horizontal&&!n.utils.isVertical(t.direction)){t.preventDefault()}break;case n.EVENT_END:if(this.triggered){r.trigger(this.name+"end",t)}this.triggered=false;break}}};n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:false},triggered:false,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t);this.triggered=false;return}if(t.touches.length<2){return}if(r.options.transform_always_block){t.preventDefault()}switch(t.eventType){case n.EVENT_START:this.triggered=false;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale);var s=Math.abs(t.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation){return}n.detection.current.name=this.name;if(!this.triggered){r.trigger(this.name+"start",t);this.triggered=true}r.trigger(this.name,t);if(s>r.options.transform_min_rotation){r.trigger("rotate",t)}if(i>r.options.transform_min_scale){r.trigger("pinch",t);r.trigger("pinch"+(t.scale<1?"in":"out"),t)}break;case n.EVENT_END:if(this.triggered){r.trigger(this.name+"end",t)}this.triggered=false;break}}};n.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:false,prevent_mouseevents:false},handler:function(t,r){if(r.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE){t.stopDetect();return}if(r.options.prevent_default){t.preventDefault()}if(t.eventType==n.EVENT_START){r.trigger(this.name,t)}}};n.gestures.Release={name:"release",index:Infinity,handler:function(t,r){if(t.eventType==n.EVENT_END){r.trigger(this.name,t)}}};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=n}else{e.Hammer=n;if(typeof e.define==="function"&&e.define.amd){e.define("hammer",[],function(){return n})}}})(this);(function(e,t){"use strict";if(e===t){return}Hammer.event.bindDom=function(n,r,i){e(n).on(r,function(e){var n=e.originalEvent||e;if(n.pageX===t){n.pageX=e.pageX;n.pageY=e.pageY}if(!n.target){n.target=e.target}if(n.which===t){n.which=n.button}if(!n.preventDefault){n.preventDefault=e.preventDefault}if(!n.stopPropagation){n.stopPropagation=e.stopPropagation}i.call(this,n)})};Hammer.Instance.prototype.on=function(t,n){return e(this.element).on(t,n)};Hammer.Instance.prototype.off=function(t,n){return e(this.element).off(t,n)};Hammer.Instance.prototype.trigger=function(t,n){var r=e(this.element);if(r.has(n.target).length){r=e(n.target)}return r.trigger({type:t,gesture:n})};e.fn.hammer=function(t){return this.each(function(){var n=e(this);var r=n.data("hammer");if(!r){n.data("hammer",new Hammer(this,t||{}))}else if(r&&t){Hammer.utils.extend(r.options,t)}})}})(window.jQuery||window.Zepto);(function(e,t){"use strict";function r(){if(n.READY){return}n.event.determineEventTypes();for(var t in n.gestures){if(n.gestures.hasOwnProperty(t)){n.detection.register(n.gestures[t])}}n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect);n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect);n.event.onTouch(e.top,n.EVENT_END,n.detection.detect);n.READY=true}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled;n.HAS_TOUCHEVENTS="ontouchstart"in e;n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&navigator.userAgent.match(n.MOBILE_REGEX);n.EVENT_TYPES={};n.DIRECTION_DOWN="down";n.DIRECTION_LEFT="left";n.DIRECTION_UP="up";n.DIRECTION_RIGHT="right";n.POINTER_MOUSE="mouse";n.POINTER_TOUCH="touch";n.POINTER_PEN="pen";n.EVENT_START="start";n.EVENT_MOVE="move";n.EVENT_END="end";n.DOCUMENT=document;n.plugins={};n.READY=false;n.Instance=function(e,t){var i=this;r();this.element=e;this.enabled=true;this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{});if(this.options.stop_browser_behavior){n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior)}n.event.onTouch(e,n.EVENT_START,function(e){if(i.enabled){n.detection.startDetect(i,e)}});return this};n.Instance.prototype={on:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++){this.element.addEventListener(r[i],n,false)}return this},off:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++){this.element.removeEventListener(r[i],n,false)}return this},trigger:function(t,r){var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,true,true);i.gesture=r;var s=this.element;if(n.utils.hasParent(r.target,s)){s=r.target}s.dispatchEvent(i);return this},enable:function(t){this.enabled=t;return this}};var i=null;var s=false;var o=false;n.event={bindDom:function(e,t,n){var r=t.split(" ");for(var i=0;i<r.length;i++){e.addEventListener(r[i],n,false)}},onTouch:function(t,r,u){var a=this;this.bindDom(t,n.EVENT_TYPES[r],function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&o){return}else if(l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1){s=true}if(l.match(/touch|pointer/)){o=true}var c=0;if(s){if(n.HAS_POINTEREVENTS&&r!=n.EVENT_END){c=n.PointerEvent.updatePointer(r,f)}else if(l.match(/touch/)){c=f.touches.length}else if(!o){c=l.match(/up/)?0:1}if(c>0&&r==n.EVENT_END){r=n.EVENT_MOVE}else if(!c){r=n.EVENT_END}if(!c&&i!==null){f=i}else{i=f}u.call(n.detection,a.collectEventData(t,r,f));if(n.HAS_POINTEREVENTS&&r==n.EVENT_END){c=n.PointerEvent.updatePointer(r,f)}}if(!c){i=null;s=false;o=false;n.PointerEvent.reset()}})},determineEventTypes:function(){var t;if(n.HAS_POINTEREVENTS){t=n.PointerEvent.getEvents()}else if(n.NO_MOUSEEVENTS){t=["touchstart","touchmove","touchend touchcancel"]}else{t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"]}n.EVENT_TYPES[n.EVENT_START]=t[0];n.EVENT_TYPES[n.EVENT_MOVE]=t[1];n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){if(n.HAS_POINTEREVENTS){return n.PointerEvent.getTouchList()}else if(t.touches){return t.touches}else{return[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]}},collectEventData:function(t,r,i){var s=this.getTouchList(i,r);var o=n.POINTER_TOUCH;if(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i)){o=n.POINTER_MOUSE}return{center:n.utils.getCenter(s),timeStamp:(new Date).getTime(),target:i.target,touches:s,eventType:r,pointerType:o,srcEvent:i,preventDefault:function(){if(this.srcEvent.preventManipulation){this.srcEvent.preventManipulation()}if(this.srcEvent.preventDefault){this.srcEvent.preventDefault()}},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}};n.PointerEvent={pointers:{},getTouchList:function(){var e=this;var t=[];Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])});return t},updatePointer:function(e,t){if(e==n.EVENT_END){this.pointers={}}else{t.identifier=t.pointerId;this.pointers[t.pointerId]=t}return Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType){return false}var r={};r[n.POINTER_MOUSE]=t.pointerType==t.MSPOINTER_TYPE_MOUSE||t.pointerType==n.POINTER_MOUSE;r[n.POINTER_TOUCH]=t.pointerType==t.MSPOINTER_TYPE_TOUCH||t.pointerType==n.POINTER_TOUCH;r[n.POINTER_PEN]=t.pointerType==t.MSPOINTER_TYPE_PEN||t.pointerType==n.POINTER_PEN;return r[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}};n.utils={extend:function(n,r,i){for(var s in r){if(n[s]!==t&&i){continue}n[s]=r[s]}return n},hasParent:function(e,t){while(e){if(e==t){return true}e=e.parentNode}return false},getCenter:function(t){var n=[],r=[];for(var i=0,s=t.length;i<s;i++){n.push(t[i].pageX);r.push(t[i].pageY)}return{pageX:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,pageY:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,r){var i=Math.abs(t.pageX-r.pageX),s=Math.abs(t.pageY-r.pageY);if(i>=s){return t.pageX-r.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT}else{return t.pageY-r.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN}},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){if(t.length>=2&&n.length>=2){return this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1])}return 1},getRotation:function(t,n){if(t.length>=2&&n.length>=2){return this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0])}return 0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,n){var r,i=["webkit","khtml","moz","ms","o",""];if(!n||!t.style){return}for(var s=0;s<i.length;s++){for(var o in n){if(n.hasOwnProperty(o)){r=o;if(i[s]){r=i[s]+r.substring(0,1).toUpperCase()+r.substring(1)}t.style[r]=n[o]}}}if(n.userSelect=="none"){t.onselectstart=function(){return false}}}};n.detection={gestures:[],current:null,previous:null,stopped:false,startDetect:function(t,r){if(this.current){return}this.stopped=false;this.current={inst:t,startEvent:n.utils.extend({},r),lastEvent:false,name:""};this.detect(r)},detect:function(t){if(!this.current||this.stopped){return}t=this.extendEventData(t);var r=this.current.inst.options;for(var i=0,s=this.gestures.length;i<s;i++){var o=this.gestures[i];if(!this.stopped&&r[o.name]!==false){if(o.handler.call(o,t,this.current.inst)===false){this.stopDetect();break}}}if(this.current){this.current.lastEvent=t}if(t.eventType==n.EVENT_END&&!t.touches.length-1){this.stopDetect()}return t},stopDetect:function(){this.previous=n.utils.extend({},this.current);this.current=null;this.stopped=true},extendEventData:function(t){var r=this.current.startEvent;if(r&&(t.touches.length!=r.touches.length||t.touches===r.touches)){r.touches=[];for(var i=0,s=t.touches.length;i<s;i++){r.touches.push(n.utils.extend({},t.touches[i]))}}var o=t.timeStamp-r.timeStamp,u=t.center.pageX-r.center.pageX,a=t.center.pageY-r.center.pageY,f=n.utils.getVelocity(o,u,a);n.utils.extend(t,{deltaTime:o,deltaX:u,deltaY:a,velocityX:f.x,velocityY:f.y,distance:n.utils.getDistance(r.center,t.center),angle:n.utils.getAngle(r.center,t.center),direction:n.utils.getDirection(r.center,t.center),scale:n.utils.getScale(r.touches,t.touches),rotation:n.utils.getRotation(r.touches,t.touches),startEvent:r});return t},register:function(r){var i=r.defaults||{};if(i[r.name]===t){i[r.name]=true}n.utils.extend(n.defaults,i,true);r.index=r.index||1e3;this.gestures.push(r);this.gestures.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0});return this.gestures}};n.gestures=n.gestures||{};n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,r){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer);n.detection.current.name=this.name;this.timer=setTimeout(function(){if(n.detection.current.name=="hold"){r.trigger("hold",t)}},r.options.hold_timeout);break;case n.EVENT_MOVE:if(t.distance>r.options.hold_threshold){clearTimeout(this.timer)}break;case n.EVENT_END:clearTimeout(this.timer);break}}};n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:true,doubletap_distance:20,doubletap_interval:300},handler:function(t,r){if(t.eventType==n.EVENT_END){var i=n.detection.previous,s=false;if(t.deltaTime>r.options.tap_max_touchtime||t.distance>r.options.tap_max_distance){return}if(i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<r.options.doubletap_interval&&t.distance<r.options.doubletap_distance){r.trigger("doubletap",t);s=true}if(!s||r.options.tap_always){n.detection.current.name="tap";r.trigger(n.detection.current.name,t)}}}};n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,r){if(t.eventType==n.EVENT_END){if(r.options.swipe_max_touches>0&&t.touches.length>r.options.swipe_max_touches){return}if(t.velocityX>r.options.swipe_velocity||t.velocityY>r.options.swipe_velocity){r.trigger(this.name,t);r.trigger(this.name+t.direction,t)}}}};n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:false,drag_block_vertical:false,drag_lock_to_axis:false,drag_lock_min_distance:25},triggered:false,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t);this.triggered=false;return}if(r.options.drag_max_touches>0&&t.touches.length>r.options.drag_max_touches){return}switch(t.eventType){case n.EVENT_START:this.triggered=false;break;case n.EVENT_MOVE:if(t.distance<r.options.drag_min_distance&&n.detection.current.name!=this.name){return}n.detection.current.name=this.name;if(n.detection.current.lastEvent.drag_locked_to_axis||r.options.drag_lock_to_axis&&r.options.drag_lock_min_distance<=t.distance){t.drag_locked_to_axis=true}var i=n.detection.current.lastEvent.direction;if(t.drag_locked_to_axis&&i!==t.direction){if(n.utils.isVertical(i)){t.direction=t.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN}else{t.direction=t.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT}}if(!this.triggered){r.trigger(this.name+"start",t);this.triggered=true}r.trigger(this.name,t);r.trigger(this.name+t.direction,t);if(r.options.drag_block_vertical&&n.utils.isVertical(t.direction)||r.options.drag_block_horizontal&&!n.utils.isVertical(t.direction)){t.preventDefault()}break;case n.EVENT_END:if(this.triggered){r.trigger(this.name+"end",t)}this.triggered=false;break}}};n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:false},triggered:false,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t);this.triggered=false;return}if(t.touches.length<2){return}if(r.options.transform_always_block){t.preventDefault()}switch(t.eventType){case n.EVENT_START:this.triggered=false;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale);var s=Math.abs(t.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation){return}n.detection.current.name=this.name;if(!this.triggered){r.trigger(this.name+"start",t);this.triggered=true}r.trigger(this.name,t);if(s>r.options.transform_min_rotation){r.trigger("rotate",t)}if(i>r.options.transform_min_scale){r.trigger("pinch",t);r.trigger("pinch"+(t.scale<1?"in":"out"),t)}break;case n.EVENT_END:if(this.triggered){r.trigger(this.name+"end",t)}this.triggered=false;break}}};n.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:false,prevent_mouseevents:false},handler:function(t,r){if(r.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE){t.stopDetect();return}if(r.options.prevent_default){t.preventDefault()}if(t.eventType==n.EVENT_START){r.trigger(this.name,t)}}};n.gestures.Release={name:"release",index:Infinity,handler:function(t,r){if(t.eventType==n.EVENT_END){r.trigger(this.name,t)}}};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=n}else{e.Hammer=n;if(typeof e.define==="function"&&e.define.amd){e.define("hammer",[],function(){return n})}}})(this);AVLTree.prototype.add=function(e){if(!this._root){this._root=new AVLNode(e,this._comparator);return this._root}else{var t=this._root.add(e);this._root=t[0];if(!t[1]||!t[0]){console.log("failed to add data")}return t[1]}};AVLTree.prototype.remove=function(e){if(this._root){var t=this._root.remove(e);this._root=t[0];return t[1]}else{return null}};AVLTree.prototype.find=function(e){var t=this._find(e);return t?t._value:null};AVLTree.prototype.isEmpty=function(){return this._root===null||this._root===undefined};AVLTree.prototype.map=function(e){var t=this.getContents();var n;for(n=0;n<t.length;n++){e(t[n])}};AVLTree.prototype.getContents=function(){var e=[];var t=[];if(!this._root){return[]}var n=this._root;while(t.length>0||n!=null){if(n){t.push(n);n=n._left}else{n=t.pop();e.push(n._value);n=n._right}}return e};AVLTree.prototype.printAVL=function(){var e=this.getContents();for(var t=0;t<e.length;t++){console.log(e[t].key)}};AVLTree.prototype.clone=function(e){var t=e||this.getContents();var n;var r=new AVLTree(this._comparator,this._valuation);for(n=0;n<t.length;n++){r.add(t[n])}return r};AVLTree.prototype.clear=function(e){var t=this.getNodesPostorder();if(e){t.map(e)}t.map(function(e){e._left=null;e._right=null});this._current=null;this._root=null;this._intermediates=[]};AVLTree.prototype.getNodesPostorder=function(){var e=[];if(!this._root){return[]}var t=this._root;this.postorderHelper(t,e);return e};AVLTree.prototype.postorderHelper=function(e,t){if(!e){return}this.postorderHelper(e._left,t);this.postorderHelper(e._right,t);t.push(e)};AVLTree.prototype.nearestNeighbors=function(e,t){var n=this._root;var r,i;while(n){var s=this._valuation(e,n._value);if(s===0){if(t===-1){return[this.findPrevious(n._value),n._value]}else if(t===1){return[n._value,this.findNext(n._value)]}else{return[this.findPrevious(n._value),this.findNext(n._value)]}}else if(s>0){r=n._value;n=n._right}else{i=n._value;n=n._left}}return[r,i]};AVLTree.prototype.debugNN=function(e){var t=this.nearestNeighbors(e);var n=t[0]?t[0].key:"is null";var r=t[1]?t[1].key:"is null";console.log(n+", "+r)};AVLTree.prototype.findNext=function(e){var t=this._find(e,true);var n=this._next(t);return n?n._value:null};AVLTree.prototype.findPrevious=function(e){var t=this._find(e,true);var n=this._previous(t);return n?n._value:null};AVLTree.prototype.max=function(){var e=this._max();return e?e._value:null};AVLTree.prototype.min=function(){var e=this._min();return e?e._value:null};AVLTree.prototype.next=function(){this._current=this._next(this._current);return this._current?this._current._value:null};AVLTree.prototype.previous=function(){this._current=this._previous(this._current);return this._current?this._current._value:null};AVLTree.prototype.isSolo=function(){if(!this._root._left&&!this._root._right){return true}else{return false}};AVLTree.prototype._find=function(e,t){t=t||false;var n=this._root;if(t){this._intermediates=[]}while(n!==null){var r=this._comparator(e,n._value);if(r!==0){if(t){this._intermediates.push(n)}if(r<0){n=n._left}else{n=n._right}}else{break}}return n};AVLTree.prototype._min=function(e,t){var n=e||this._root;t=t||false;if(n){while(n._left){if(t){this._intermediates.push(e)}n=n._left}}return n};AVLTree.prototype._max=function(e,t){var n=e||this._root;t=t||false;if(n){while(n._right){if(t){this._intermediates.push(e)}n=n._right}}return n};AVLTree.prototype._next=function(e){if(e){if(e._right){this._intermediates.push(e);e=this._min(e._right,true)}else{var t=this._intermediates;var n=t.pop();while(n&&n._right===e){e=n;n=t.pop()}e=n}}else{this._intermediates=[];e=this._min(this._root,true)}return e};AVLTree.prototype._previous=function(e){if(e){if(e._left){this._intermediates.push(e);e=this._max(e._left,true)}else{var t=this._intermediates;var n=t.pop();while(n&&n._left===e){e=n;n=t.pop()}e=n}}else{this._intermediates=[];e=this._max(this._root,true)}return e};AVLNode.prototype.add=function(e){var t=this._comparator(e,this._value);var n;var r;if(t!==0){if(t<0){if(this._left){n=this._left.add(e);this._left=n[0];r=n[1]}else{this._left=new AVLNode(e,this._comparator);r=this._left}}else if(t>0){if(this._right){n=this._right.add(e);this._right=n[0];r=n[1]}else{this._right=new AVLNode(e,this._comparator);r=this._right}}return[this.balanceTree(),r]}else{return[this,this]}};AVLNode.prototype.remove=function(e){var t=this._comparator(e,this._value);var n;var r;var i;if(t){if(t<0){if(this._left){n=this._left.remove(e);this._left=n[0];r=n[1]}else{r=null}}else{if(this._right){n=this._right.remove(e);this._right=n[0];r=n[1]}else{r=null}}i=this}else{r=this;if(this._left==null){i=this._right}else if(this._right==null){i=this._left}else{i=this._left.merge(this._right);this._left=null;this._right=null}}if(r){if(i){return[i.balanceTree(),r]}else{return[i,r]}}else{return[this,null]}};AVLNode.prototype.balanceTree=function(){var e=this._left!=null?this._left._height:0;var t=this._right!=null?this._right._height:0;if(e>t+1){return this.swingRight()}else if(t>e+1){return this.swingLeft()}else{this.setHeight();return this}return result};AVLNode.prototype.merge=function(e){if(e==null){return this}else{var t;if(this._height>e._height){t=this;t._right=e.merge(t._right)}else{t=e;t._left=this.merge(t._left)}return t.balanceTree()}};AVLNode.prototype.moveLeft=function(){var e=this._right;var t=e._left;this._right=t;e._left=this;this.setHeight();e.setHeight();return e};AVLNode.prototype.moveRight=function(){var e=this._left;var t=e._right;this._left=t;e._right=this;this.setHeight();e.setHeight();return e};AVLNode.prototype.setHeight=function(){var e=this._left?this._left._height:0;var t=this._right?this._right._height:0;this._height=e<t?t+1:e+1};AVLNode.prototype.swingLeft=function(){var e=this._right;var t=e._left;var n=e._right;var r=this._left;var i=r?r._height:0;var s=t?t._height:0;var o=n?n._height:0;if(s>o){this._right=e.moveRight()}return this.moveLeft()};AVLNode.prototype.swingRight=function(){var e=this._left;var t=e._right;var n=e._left;var r=this._right;var i=r!=null?r._height:0;var s=t!=null?t._height:0;var o=n!=null?n._height:0;if(s>o){this._left=e.moveLeft()}return this.moveRight()};AVLNode.prototype.traverse=function(e){if(this._left){this._left.traverse(e)}e(this);if(this._right){this._right.traverse(e)}};AVLNode.prototype.toString=function(){return this._value.toString()};binaryHeap.prototype={push:function(e){this.content.push(e);this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0];var t=this.content.pop();if(this.content.length>0){this.content[0]=t;this.sinkDown(0)}return e},peek:function(){return this.content[0]},remove:function(e){var t=this.content.length;for(var n=0;n<t;n++){if(this.content[n]!==e){continue}var r=this.content.pop();if(n==t-1){break}this.content[n]=r;this.bubbleUp(n);this.sinkDown(n);break}},size:function(){return this.content.length},findValue:function(e,t){var n=this.content.length;var r;for(var i=0;i<n;i++){if(t(this.content[i])!==e){continue}var s=this.content.pop();if(i==n-1){r=s;break}this.content[i]=s;this.bubbleUp(i);this.sinkDown(i);break}return r},bubbleUp:function(e){var t=this.content[e],n=this.scoreFunction(t);while(e>0){var r=Math.floor((e+1)/2)-1,i=this.content[r];if(n>=this.scoreFunction(i))break;this.content[r]=t;this.content[e]=i;e=r}},sinkDown:function(e){var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);while(true){var i=(e+1)*2,s=i-1;var o=null;if(s<t){var u=this.content[s],a=this.scoreFunction(u);if(a<r)o=s}if(i<t){var f=this.content[i],l=this.scoreFunction(f);if(l<(o==null?r:a))o=i}if(o==null)break;this.content[e]=this.content[o];this.content[o]=n;e=o}},find:function(e){var t=this.content.length;var n;for(var r=0;r<t;r++){if(this.content[r]!==e){continue}var i=this.content.pop();if(r==t-1){n=i;break}this.content[r]=i;this.bubbleUp(r);this.sinkDown(r);break}return n}};DataHolder.prototype.reInitHeaps=function(){this._leftExternal=new binaryHeap(this._scoreFunctionMin);this._leftInternal=new binaryHeap(this._scoreFunctionMin);this._rightExternal=new binaryHeap(this._scoreFunctionMin);this._rightInternal=new binaryHeap(this._scoreFunctionMin)};DataHolder.prototype.insertTrack=function(e,t){var n={track:e,displays:new AVLTree(this._dispComparator,this._dispValuation)};e.setStorageContainer(n);if(typeof t==="undefined"||t===null){this._trackArray.push(n)}else{this._trackArray.splice(t,0,n)}this.mapTracks(function(e,t){e.track.updatePos(t)});return n};DataHolder.prototype.removeTrack=function(e){var t=this._trackArray[e.getPos()];this._trackArray.splice(e.getPos(),1);this.mapTracks(function(e,t){e.track.updatePos(t)});return t};DataHolder.prototype.selectTrack=function(e){this._selectedTrack=e};DataHolder.prototype.getSelectedTrack=function(){return this._selectedTrack};DataHolder.prototype.indexOfTrack=function(e){var t;for(t=0;t<this._trackArray.length;t++){var n=this._trackArray[t];if(n.track=e){return t}}return false};DataHolder.prototype.mapTracks=function(e){this._trackArray.map(e)};DataHolder.prototype.getType=function(e){return e.getType()};DataHolder.prototype.getInkEnabled=function(e){return e.getInkEnabled()};DataHolder.prototype.getInkLink=function(e){return e.getInkLink()};DataHolder.prototype.getTracks=function(){return this._trackArray};DataHolder.prototype.numTracks=function(){return this._trackArray.length};DataHolder.prototype.findTrackByTitle=function(e){var t;for(t=0;t<this._trackArray.length;t++){if(this._trackArray[t].track.getTitle()===e){return this._trackArray[t].track}}return null};DataHolder.prototype.addDisplay=function(e,t){var n=this._trackArray[e];var r=new AVLTree(this._kfComparator,this._kfValuation);var i={display:t,keyframes:r,displayTree:n.displays,hostTrack:n.track};n.displays.add(i);t.setStorageContainer(i);t.setKeyframeTree(r);this.mapDisplays(n,function(e,t){e.display.setID(t)});return i};DataHolder.prototype.mapDisplays=function(e,t){e.displays.map(t)};DataHolder.prototype.removeDisplay=function(e,t){var n=this._trackArray[e];var r=t.getStorageContainer();return n.displays.remove(r)};DataHolder.prototype.findDisplay=function(e,t){var n=this._trackArray[e];var r=t.getStorageContainer();return n.displays.find(r)};DataHolder.prototype.findPreviousDisplay=function(e,t){var n=this._trackArray[e];var r=t.getStorageContainer();return n.displays.findPrevious(r)};DataHolder.prototype.findNextDisplay=function(e,t){var n=this._trackArray[e];var r=t.getStorageContainer();return n.displays.findNext(r)};DataHolder.prototype.minDisplay=function(e){var t=this._trackArray[e];return t.displays.min()};DataHolder.prototype.maxDisplay=function(e){var t=this._trackArray[e];return t.displays.max()};DataHolder.prototype.replaceKeyframes=function(e,t){e.getStorageContainer().keyframes=t};DataHolder.prototype.getDisplays=function(e){return this._trackArray[e]&&this._trackArray[e].displays};DataHolder.prototype.addKeyframe=function(e,t){var n=e.getStorageContainer();n.keyframes.add(t);return newKeyframe};DataHolder.prototype.removeKeyframe=function(e,t){var n=e.getStorageContainer();return n.keyframes.remove(t)};DataHolder.prototype.findKeyframe=function(e,t){var n=e.getStorageContainer();return n.keyframes.find(t)};DataHolder.prototype.findPrevKeyframe=function(e,t){var n=e.getStorageContainer();return n.keyframes.findPrevious(t)};DataHolder.prototype.findNextKeyframe=function(e,t){var n=e.getStorageContainer();return n.keyframes.findNext(t)};DataHolder.prototype.firstKeyframe=function(e){var t=e.getStorageContainer();return t.keyframes.min()};DataHolder.prototype.lastKeyframe=function(e){var t=e.getStorageContainer();return t.keyframes.max()};DataHolder.prototype.mapKeyframes=function(e,t){e.keyframes.map(t)};DataHolder.prototype.getKeyframes=function(e){return e.keyframes};DoublyLinkedList.prototype._createNewNode=function(e){var t={data:e,next:null,prev:null};return t};DoublyLinkedList.prototype.append=function(e){var t=this._createNewNode(e);if(this._length===0){this._head=t;this._tail=t}else{this._tail.next=t;t.prev=this._tail;this._tail=t}this._length++;return t};DoublyLinkedList.prototype.prepend=function(e){var t=this._createNewNode(e);if(this.first===null){this.append(t);return}else{this._head.prev=t;t.next=this._head;this._head=t}this._length++;return t};DoublyLinkedList.prototype.item=function(e){if(e>=0&&e<this._length){var t=this._head;while(e--){t=t.next}return t}};DoublyLinkedList.prototype.search=function(e){var t=this._head;while(t!=null){if(t.data===e){return t}t=t.next}return null};DoublyLinkedList.prototype.findNext=function(e){var t=this._head;while(t!=null){if(t.data>=e){return t}t=t.next}return null};DoublyLinkedList.prototype.findPrev=function(e){var t=this._head;while(t!=null){if(t.data>=e){if(t.prev===null){return null}else{return t.prev}}t=t.next}return null};DoublyLinkedList.prototype.head=function(){return this._head};DoublyLinkedList.prototype.tail=function(){return this._tail};DoublyLinkedList.prototype.size=function(){return this._length};DoublyLinkedList.prototype.printList=function(){var e=this._head;if(e===null){console.log("Empty List\n")}else{console.log("Printing List...");for(var t=0;t<this._length;t++){console.log(e.data+" ");e=e.next}console.log("\n")}};DoublyLinkedList.prototype.remove=function(e){if(e<0||e>=this._length||this._length===0){console.log("index is out of bounds")}else{var t=this.item(e);var n=t.next;var r=t.prev;if(n!=null&&r!=null){r.next=n;n.prev=r}else if(n===null&&r!=null){r.next=null;this._tail=r}else if(r===null&&n!=null){n.prev=null;this._head=n}else{this._head=null;this._tail=null}this._length--;return t}};HashTable.prototype.insert=function(e,t){var n=undefined;if(this._hasItem(e)){n=this._items[e]}else{this._length++}this._items[e]=t;return n};HashTable.prototype.getLength=function(e){return this._length};HashTable.prototype.lookup=function(e){return this._hasItem(e)?this._items[e]:undefined};HashTable.prototype._hasItem=function(e){return this._items.hasOwnProperty(e)};HashTable.prototype.removeItem=function(e){if(this._hasItem(e)){previous=this._items[e];this._length--;delete this._items[e];return previous}else{return undefined}};HashTable.prototype.keys=function(){var e=[];for(var t in this._items){if(this._hasItem(t)){e.push(t)}}return e};HashTable.prototype.values=function(){var e=[];for(var t in this._items){if(this._hasItem(t)){e.push(this._items[t])}}return e};HashTable.prototype.each=function(e){for(var t in this._items){if(this._hasItem(t)){e(t,this._items[t])}}};HashTable.prototype.clear=function(){this._items={};this._length=0};(function(){function r(e,t){try{for(var n in t){Object.defineProperty(e.prototype,n,{value:t[n],enumerable:false})}}catch(r){e.prototype=t}}function s(e){var t=-1,n=e.length,r=[];while(++t<n)r.push(e[t]);return r}function o(e){return Array.prototype.slice.call(e)}function f(){}function h(e){return e}function p(){return this}function d(){return true}function v(e){return typeof e==="function"?e:function(){return e}}function m(e,t,n){return function(){var r=n.apply(t,arguments);return arguments.length?e:r}}function g(e){return e!=null&&!isNaN(e)}function y(e){return e.length}function w(e){return e==null}function E(e){return e.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}function S(e){var t=1;while(e*t%1)t*=10;return t}function N(){}function C(e){function r(){var n=t,r=-1,i=n.length,s;while(++r<i)if(s=n[r].on)s.apply(this,arguments);return e}var t=[],n=new f;r.on=function(r,i){var s=n.get(r),o;if(arguments.length<2)return s&&s.on;if(s){s.on=null;t=t.slice(0,o=t.indexOf(s)).concat(t.slice(o+1));n.remove(r)}if(i)t.push(n.set(r,{on:i}));return e};return r}function A(e,t){return t-(e?1+Math.floor(Math.log(e+Math.pow(10,1+Math.floor(Math.log(e)/Math.LN10)-t))/Math.LN10):1)}function O(e){return e+""}function M(e){var t=e.lastIndexOf("."),n=t>=0?e.substring(t):(t=e.length,""),r=[];while(t>0)r.push(e.substring(t-=3,t+3));return r.reverse().join(",")+n}function D(e,t){var n=Math.pow(10,Math.abs(8-t)*3);return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function I(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function q(e){return function(t){return 1-e(1-t)}}function R(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function U(e){return e}function z(e){return function(t){return Math.pow(t,e)}}function W(e){return 1-Math.cos(e*Math.PI/2)}function X(e){return Math.pow(2,10*(e-1))}function V(e){return 1-Math.sqrt(1-e*e)}function $(e,t){var n;if(arguments.length<2)t=.45;if(arguments.length<1){e=1;n=t/4}else n=t/(2*Math.PI)*Math.asin(1/e);return function(r){return 1+e*Math.pow(2,10*-r)*Math.sin((r-n)*2*Math.PI/t)}}function J(e){if(!e)e=1.70158;return function(t){return t*t*((e+1)*t-e)}}function K(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Q(){d3.event.stopPropagation();d3.event.preventDefault()}function G(){var e=d3.event,t;while(t=e.sourceEvent)e=t;return e}function Y(e){var t=new N,n=0,r=arguments.length;while(++n<r)t[arguments[n]]=C(t);t.of=function(n,r){return function(i){try{var s=i.sourceEvent=d3.event;i.target=e;d3.event=i;t[i.type].apply(n,r)}finally{d3.event=s}}};return t}function et(e){return e=="transform"?d3.interpolateTransform:d3.interpolate}function tt(e,t){t=t-(e=+e)?1/(t-e):0;return function(n){return(n-e)*t}}function nt(e,t){t=t-(e=+e)?1/(t-e):0;return function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function rt(e,t,n){return new it(e,t,n)}function it(e,t,n){this.r=e;this.g=t;this.b=n}function st(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function ot(e,t,n){var r=0,i=0,s=0,o,u,a;o=/([a-z]+)\((.*)\)/i.exec(e);if(o){u=o[2].split(",");switch(o[1]){case"hsl":{return n(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100)};case"rgb":{return t(at(u[0]),at(u[1]),at(u[2]))}}}if(a=ft.get(e))return t(a.r,a.g,a.b);if(e!=null&&e.charAt(0)==="#"){if(e.length===4){r=e.charAt(1);r+=r;i=e.charAt(2);i+=i;s=e.charAt(3);s+=s}else if(e.length===7){r=e.substring(1,3);i=e.substring(3,5);s=e.substring(5,7)}r=parseInt(r,16);i=parseInt(i,16);s=parseInt(s,16)}return t(r,i,s)}function ut(e,t,n){var r=Math.min(e/=255,t/=255,n/=255),i=Math.max(e,t,n),s=i-r,o,u,a=(i+r)/2;if(s){u=a<.5?s/(i+r):s/(2-i-r);if(e==i)o=(t-n)/s+(t<n?6:0);else if(t==i)o=(n-e)/s+2;else o=(e-t)/s+4;o*=60}else{u=o=0}return lt(o,u,a)}function at(e){var t=parseFloat(e);return e.charAt(e.length-1)==="%"?Math.round(t*2.55):t}function lt(e,t,n){return new ct(e,t,n)}function ct(e,t,n){this.h=e;this.s=t;this.l=n}function ht(e,t,n){function s(e){if(e>360)e-=360;else if(e<0)e+=360;if(e<60)return r+(i-r)*e/60;if(e<180)return i;if(e<240)return r+(i-r)*(240-e)/60;return r}function o(e){return Math.round(s(e)*255)}var r,i;e=e%360;if(e<0)e+=360;t=t<0?0:t>1?1:t;n=n<0?0:n>1?1:n;i=n<=.5?n*(1+t):n+t-n*t;r=2*n-i;return rt(o(e+120),o(e),o(e-120))}function pt(e){a(e,bt);return e}function wt(e){return function(){return dt(e,this)}}function Et(e){return function(){return vt(e,this)}}function St(e,t){function s(){if(t=this.classList)return t.add(e);var t=this.className,r=t.baseVal!=null,i=r?t.baseVal:t;n.lastIndex=0;if(!n.test(i)){i=E(i+" "+e);if(r)t.baseVal=i;else this.className=i}}function o(){if(t=this.classList)return t.remove(e);var t=this.className,r=t.baseVal!=null,i=r?t.baseVal:t;i=E(i.replace(n," "));if(r)t.baseVal=i;else this.className=i}function u(){(t.apply(this,arguments)?s:o).call(this)}var n=new RegExp("(^|\\s+)"+d3.requote(e)+"(\\s+|$)","g");if(arguments.length<2){var r=this.node();if(i=r.classList)return i.contains(e);var i=r.className;n.lastIndex=0;return n.test(i.baseVal!=null?i.baseVal:i)}return this.each(typeof t==="function"?u:t?s:o)}function xt(e){return{__data__:e}}function Tt(e){return function(){return yt(this,e)}}function Nt(e){if(!arguments.length)e=d3.ascending;return function(t,n){return e(t&&t.__data__,n&&n.__data__)}}function Ct(e,t){for(var n=0,r=e.length;n<r;n++){for(var i=e[n],s=0,o=i.length,u;s<o;s++){if(u=i[s])t(u,s,n)}}return e}function Lt(e){a(e,At);return e}function Ot(e,t,n){a(e,Pt);var r=new f,i=d3.dispatch("start","end"),s=Ut;e.id=t;e.time=n;e.tween=function(t,n){if(arguments.length<2)return r.get(t);if(n==null)r.remove(t);else r.set(t,n);return e};e.ease=function(t){if(!arguments.length)return s;s=typeof t==="function"?t:d3.ease.apply(d3,arguments);return e};e.each=function(t,n){if(arguments.length<2)return zt.call(e,t);i.on(t,n);return e};d3.timer(function(o){return Ct(e,function(e,u,a){function d(s){if(h.active>t)return m();h.active=t;r.forEach(function(t,n){if(n=n.call(e,p,u)){f.push(n)}});i.start.call(e,p,u);if(!v(s))d3.timer(v,0,n);return 1}function v(n){if(h.active!==t)return m();var r=(n-l)/c,o=s(r),a=f.length;while(a>0){f[--a].call(e,o)}if(r>=1){m();Bt=t;i.end.call(e,p,u);Bt=0;return 1}}function m(){if(!--h.count)delete e.__transition__;return 1}var f=[],l=e.delay,c=e.duration,h=(e=e.node).__transition__||(e.__transition__={active:0,count:0}),p=e.__data__;++h.count;l<=o?d(o):d3.timer(d,l,n)})},0,n);return e}function _t(e,t,n){return n!=""&&Mt}function Dt(e,t){function r(e,r,i){var s=t.call(this,e,r);return s==null?i!=""&&Mt:i!=s&&n(i,s)}function i(e,r,i){return i!=t&&n(i,t)}var n=et(e);return typeof t==="function"?r:t==null?_t:(t+="",i)}function zt(e){var t=Bt,n=Ut,r=qt,i=Rt;Bt=this.id;Ut=this.ease();Ct(this,function(t,n,r){qt=t.delay;Rt=t.duration;e.call(t=t.node,t.__data__,n,r)});Bt=t;Ut=n;qt=r;Rt=i;return this}function $t(){var e,t=Date.now(),n=Wt;while(n){e=t-n.then;if(e>=n.delay)n.flush=n.callback(e);n=n.next}var r=Jt()-t;if(r>24){if(isFinite(r)){clearTimeout(Vt);Vt=setTimeout($t,r)}Xt=0}else{Xt=1;Kt($t)}}function Jt(){var e=null,t=Wt,n=Infinity;while(t){if(t.flush){t=e?e.next=t.next:Wt=t.next}else{n=Math.min(n,t.then+t.delay);t=(e=t).next}}return n}function Qt(e){var t=[e.a,e.b],n=[e.c,e.d],r=Yt(t),i=Gt(t,n),s=Yt(Zt(n,t,-i))||0;if(t[0]*n[1]<n[0]*t[1]){t[0]*=-1;t[1]*=-1;r*=-1;i*=-1}this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*en;this.translate=[e.e,e.f];this.scale=[r,s];this.skew=s?Math.atan2(i,s)*en:0}function Gt(e,t){return e[0]*t[0]+e[1]*t[1]}function Yt(e){var t=Math.sqrt(Gt(e,e));if(t){e[0]/=t;e[1]/=t}return t}function Zt(e,t,n){e[0]+=n*t[0];e[1]+=n*t[1];return e}function nn(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(tn<0&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var i=n[0][0].getScreenCTM();tn=!(i.f||i.e);n.remove()}if(tn){r.x=t.pageX;r.y=t.pageY}else{r.x=t.clientX;r.y=t.clientY}r=r.matrixTransform(e.getScreenCTM().inverse());return[r.x,r.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function rn(){}function sn(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function on(e){return e.rangeExtent?e.rangeExtent():sn(e.range())}function un(e,t){var n=0,r=e.length-1,i=e[n],s=e[r],o;if(s<i){o=n;n=r;r=o;o=i;i=s;s=o}if(o=s-i){t=t(o);e[n]=t.floor(i);e[r]=t.ceil(s)}return e}function an(){return Math}function fn(e,t,n,r){function o(){var o=Math.min(e.length,t.length)>2?mn:vn,a=r?nt:tt;i=o(e,t,a,n);s=o(t,e,a,d3.interpolate);return u}function u(e){return i(e)}var i,s;u.invert=function(e){return s(e)};u.domain=function(t){if(!arguments.length)return e;e=t.map(Number);return o()};u.range=function(e){if(!arguments.length)return t;t=e;return o()};u.rangeRound=function(e){return u.range(e).interpolate(d3.interpolateRound)};u.clamp=function(e){if(!arguments.length)return r;r=e;return o()};u.interpolate=function(e){if(!arguments.length)return n;n=e;return o()};u.ticks=function(t){return pn(e,t)};u.tickFormat=function(t){return dn(e,t)};u.nice=function(){un(e,cn);return o()};u.copy=function(){return fn(e,t,n,r)};return o()}function ln(e,t){return d3.rebind(e,t,"range","rangeRound","interpolate","clamp")}function cn(e){e=Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1);return{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}}function hn(e,t){var n=sn(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;if(s<=.15)i*=10;else if(s<=.35)i*=5;else if(s<=.75)i*=2;n[0]=Math.ceil(n[0]/i)*i;n[1]=Math.floor(n[1]/i)*i+i*.5;n[2]=i;return n}function pn(e,t){return d3.range.apply(d3,hn(e,t))}function dn(e,t){return d3.format(",."+Math.max(0,-Math.floor(Math.log(hn(e,t)[2])/Math.LN10+.01))+"f")}function vn(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function mn(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;if(e[u]<e[0]){e=e.slice().reverse();t=t.slice().reverse()}while(++o<=u){i.push(n(e[o-1],e[o]));s.push(r(t[o-1],t[o]))}return function(t){var n=d3.bisect(e,t,1,u)-1;return s[n](i[n](t))}}function gn(e,t){function r(n){return e(t(n))}var n=t.pow;r.invert=function(t){return n(e.invert(t))};r.domain=function(i){if(!arguments.length)return e.domain().map(n);t=i[0]<0?wn:bn;n=t.pow;e.domain(i.map(t));return r};r.nice=function(){e.domain(un(e.domain(),an));return r};r.ticks=function(){var r=sn(e.domain()),i=[];if(r.every(isFinite)){var s=Math.floor(r[0]),o=Math.ceil(r[1]),u=n(r[0]),a=n(r[1]);if(t===wn){i.push(n(s));for(;s++<o;)for(var f=9;f>0;f--)i.push(n(s)*f)}else{for(;s<o;s++)for(var f=1;f<10;f++)i.push(n(s)*f);i.push(n(s))}for(s=0;i[s]<u;s++){}for(o=i.length;i[o-1]>a;o--){}i=i.slice(s,o)}return i};r.tickFormat=function(e,i){if(arguments.length<2)i=yn;if(arguments.length<1)return i;var s=Math.max(.1,e/r.ticks().length),o=t===wn?(u=-1e-12,Math.floor):(u=1e-12,Math.ceil),u;return function(e){return e/n(o(t(e)+u))<=s?i(e):""}};r.copy=function(){return gn(e.copy(),t)};return ln(r,e)}function bn(e){return Math.log(e<0?0:e)/Math.LN10}function wn(e){return-Math.log(e>0?0:-e)/Math.LN10}function En(e,t){function i(t){return e(n(t))}var n=Sn(t),r=Sn(1/t);i.invert=function(t){return r(e.invert(t))};i.domain=function(t){if(!arguments.length)return e.domain().map(r);e.domain(t.map(n));return i};i.ticks=function(e){return pn(i.domain(),e)};i.tickFormat=function(e){return dn(i.domain(),e)};i.nice=function(){return i.domain(un(i.domain(),cn))};i.exponent=function(e){if(!arguments.length)return t;var s=i.domain();n=Sn(t=e);r=Sn(1/t);return i.domain(s)};i.copy=function(){return En(e.copy(),t)};return ln(i,e)}function Sn(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function xn(e,t){function s(t){return r[((n.get(t)||n.set(t,e.push(t)))-1)%r.length]}function o(t,n){return d3.range(e.length).map(function(e){return t+n*e})}var n,r,i;s.domain=function(r){if(!arguments.length)return e;e=[];n=new f;var i=-1,o=r.length,u;while(++i<o)if(!n.has(u=r[i]))n.set(u,e.push(u));return s[t.t](t.x,t.p)};s.range=function(e){if(!arguments.length)return r;r=e;i=0;t={t:"range",x:e};return s};s.rangePoints=function(n,u){if(arguments.length<2)u=0;var a=n[0],f=n[1],l=(f-a)/(e.length-1+u);r=o(e.length<2?(a+f)/2:a+l*u/2,l);i=0;t={t:"rangePoints",x:n,p:u};return s};s.rangeBands=function(n,u){if(arguments.length<2)u=0;var a=n[1]<n[0],f=n[a-0],l=n[1-a],c=(l-f)/(e.length+u);r=o(f+c*u,c);if(a)r.reverse();i=c*(1-u);t={t:"rangeBands",x:n,p:u};return s};s.rangeRoundBands=function(n,u){if(arguments.length<2)u=0;var a=n[1]<n[0],f=n[a-0],l=n[1-a],c=Math.floor((l-f)/(e.length+u)),h=l-f-(e.length-u)*c;r=o(f+Math.round(h/2),c);if(a)r.reverse();i=Math.round(c*(1-u));t={t:"rangeRoundBands",x:n,p:u};return s};s.rangeBand=function(){return i};s.rangeExtent=function(){return sn(t.x)};s.copy=function(){return xn(e,t)};return s.domain(e)}function Ln(e,t){function r(){var r=0,s=e.length,o=t.length;n=[];while(++r<o)n[r-1]=d3.quantile(e,r/o);return i}function i(e){if(isNaN(e=+e))return NaN;return t[d3.bisect(n,e)]}var n;i.domain=function(t){if(!arguments.length)return e;e=t.filter(function(e){return!isNaN(e)}).sort(d3.ascending);return r()};i.range=function(e){if(!arguments.length)return t;t=e;return r()};i.quantiles=function(){return n};i.copy=function(){return Ln(e,t)};return r()}function An(e,t,n){function s(t){return n[Math.max(0,Math.min(i,Math.floor(r*(t-e))))]}function o(){r=n.length/(t-e);i=n.length-1;return s}var r,i;s.domain=function(n){if(!arguments.length)return[e,t];e=+n[0];t=+n[n.length-1];return o()};s.range=function(e){if(!arguments.length)return n;n=e;return o()};s.copy=function(){return An(e,t,n)};return o()}function On(e){function t(e){return+e}t.invert=t;t.domain=t.range=function(n){if(!arguments.length)return e;e=n.map(t);return t};t.ticks=function(t){return pn(e,t)};t.tickFormat=function(t){return dn(e,t)};t.copy=function(){return On(e)};return t}function Dn(e){return e.innerRadius}function Pn(e){return e.outerRadius}function Hn(e){return e.startAngle}function Bn(e){return e.endAngle}function jn(e){function u(i){function d(){u.push("M",s(e(a),o))}var u=[],a=[],f=-1,l=i.length,c,h=v(t),p=v(n);while(++f<l){if(r.call(this,c=i[f],f)){a.push([+h.call(this,c,f),+p.call(this,c,f)])}else if(a.length){d();a=[]}}if(a.length)d();return u.length?u.join(""):null}var t=Fn,n=In,r=d,i=qn,s=Un,o=.7;u.x=function(e){if(!arguments.length)return t;t=e;return u};u.y=function(e){if(!arguments.length)return n;n=e;return u};u.defined=function(e){if(!arguments.length)return r;r=e;return u};u.interpolate=function(e){if(!arguments.length)return i;if(!Rn.has(e+=""))e=qn;s=Rn.get(i=e);return u};u.tension=function(e){if(!arguments.length)return o;o=e;return u};return u}function Fn(e){return e[0]}function In(e){return e[1]}function Un(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("L",(r=e[t])[0],",",r[1]);return i.join("")}function zn(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function Wn(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function Xn(e,t){return e.length<4?Un(e):e[1]+Jn(e.slice(1,e.length-1),Kn(e,t))}function Vn(e,t){return e.length<3?Un(e):e[0]+Jn((e.push(e[0]),e),Kn([e[e.length-2]].concat(e,[e[1]]),t))}function $n(e,t,n){return e.length<3?Un(e):e[0]+Jn(e,Kn(e,t))}function Jn(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2){return Un(e)}var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;if(n){r+="Q"+(s[0]-o[0]*2/3)+","+(s[1]-o[1]*2/3)+","+s[0]+","+s[1];i=e[1];a=2}if(t.length>1){u=t[1];s=e[a];a++;r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++){s=e[a];u=t[f];r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}}if(n){var l=e[a];r+="Q"+(s[0]+u[0]*2/3)+","+(s[1]+u[1]*2/3)+","+l[0]+","+l[1]}return r}function Kn(e,t){var n=[],r=(1-t)/2,i,s=e[0],o=e[1],u=1,a=e.length;while(++u<a){i=s;s=o;o=e[u];n.push([r*(o[0]-i[0]),r*(o[1]-i[1])])}return n}function Qn(e){if(e.length<3)return Un(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s];ir(a,o,u);while(++t<n){r=e[t];o.shift();o.push(r[0]);u.shift();u.push(r[1]);ir(a,o,u)}t=-1;while(++t<2){o.shift();o.push(r[0]);u.shift();u.push(r[1]);ir(a,o,u)}return a.join("")}function Gn(e){if(e.length<4)return Un(e);var t=[],n=-1,r=e.length,i,s=[0],o=[0];while(++n<3){i=e[n];s.push(i[0]);o.push(i[1])}t.push(er(rr,s)+","+er(rr,o));--n;while(++n<r){i=e[n];s.shift();s.push(i[0]);o.shift();o.push(i[1]);ir(t,s,o)}return t.join("")}function Yn(e){var t,n=-1,r=e.length,i=r+4,s,o=[],u=[];while(++n<4){s=e[n%r];o.push(s[0]);u.push(s[1])}t=[er(rr,o),",",er(rr,u)];--n;while(++n<i){s=e[n%r];o.shift();o.push(s[0]);u.shift();u.push(s[1]);ir(t,o,u)}return t.join("")}function Zn(e,t){var n=e.length-1;if(n){var r=e[0][0],i=e[0][1],s=e[n][0]-r,o=e[n][1]-i,u=-1,a,f;while(++u<=n){a=e[u];f=u/n;a[0]=t*a[0]+(1-t)*(r+f*s);a[1]=t*a[1]+(1-t)*(i+f*o)}}return Qn(e)}function er(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ir(e,t,n){e.push("C",er(tr,t),",",er(tr,n),",",er(nr,t),",",er(nr,n),",",er(rr,t),",",er(rr,n))}function sr(e,t){return(t[1]-e[1])/(t[0]-e[0])}function or(e){var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=sr(i,s);while(++t<n){r[t]=o+(o=sr(i=s,s=e[t+1]))}r[t]=o;return r}function ur(e){var t=[],n,r,i,s,o=or(e),u=-1,a=e.length-1;while(++u<a){n=sr(e[u],e[u+1]);if(Math.abs(n)<1e-6){o[u]=o[u+1]=0}else{r=o[u]/n;i=o[u+1]/n;s=r*r+i*i;if(s>9){s=n*3/Math.sqrt(s);o[u]=s*r;o[u+1]=s*i}}}u=-1;while(++u<=a){s=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u]));t.push([s||0,o[u]*s||0])}return t}function ar(e){return e.length<3?Un(e):e[0]+Jn(e,ur(e))}function fr(e){var t,n=-1,r=e.length,i,s;while(++n<r){t=e[n];i=t[0];s=t[1]+Mn;t[0]=i*Math.cos(s);t[1]=i*Math.sin(s)}return e}function lr(e){function c(o){function T(){c.push("M",u(e(p),l),f,a(e(h.reverse()),l),"Z")}var c=[],h=[],p=[],d=-1,m=o.length,g,y=v(t),b=v(r),w=t===n?function(){return S}:v(n),E=r===i?function(){return x}:v(i),S,x;while(++d<m){if(s.call(this,g=o[d],d)){h.push([S=+y.call(this,g,d),x=+b.call(this,g,d)]);p.push([+w.call(this,g,d),+E.call(this,g,d)])}else if(h.length){T();h=[];p=[]}}if(h.length)T();return c.length?c.join(""):null}var t=Fn,n=Fn,r=0,i=In,s=d,o=qn,u=Un,a=Un,f="L",l=.7;c.x=function(e){if(!arguments.length)return n;t=n=e;return c};c.x0=function(e){if(!arguments.length)return t;t=e;return c};c.x1=function(e){if(!arguments.length)return n;n=e;return c};c.y=function(e){if(!arguments.length)return i;r=i=e;return c};c.y0=function(e){if(!arguments.length)return r;r=e;return c};c.y1=function(e){if(!arguments.length)return i;i=e;return c};c.defined=function(e){if(!arguments.length)return s;s=e;return c};c.interpolate=function(e){if(!arguments.length)return o;if(!Rn.has(e+=""))e=qn;u=Rn.get(o=e);a=u.reverse||u;f=/-closed$/.test(e)?"M":"L";return c};c.tension=function(e){if(!arguments.length)return l;l=e;return c};return c}function cr(e){return e.source}function hr(e){return e.target}function pr(e){return e.radius}function dr(e){return e.startAngle}function vr(e){return e.endAngle}function mr(e){return[e.x,e.y]}function gr(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+Mn;return[n*Math.cos(r),n*Math.sin(r)]}}function yr(){return 64}function br(){return"circle"}function wr(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Tr(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function Nr(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function Cr(e,t,n){i=[];if(n&&t.length>1){var r=sn(e.domain()),i,s=-1,o=t.length,u=(t[1]-t[0])/++n,a,f;while(++s<o){for(a=n;--a>0;){if((f=+t[s]-a*u)>=r[0]){i.push(f)}}}for(--s,a=0;++a<n&&(f=+t[s]+a*u)<r[1];){i.push(f)}}return i}function Mr(){if(!Ar){Ar=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode}var e=d3.event,t;try{Ar.scrollTop=1e3;Ar.dispatchEvent(e);t=1e3-Ar.scrollTop}catch(n){t=e.wheelDelta||-e.detail*5}return t}function _r(e){var t=e.source,n=e.target,r=Pr(t,n),i=[t];while(t!==r){t=t.parent;i.push(t)}var s=i.length;while(n!==r){i.splice(s,0,n);n=n.parent}return i}function Dr(e){var t=[],n=e.parent;while(n!=null){t.push(e);e=n;n=n.parent}t.push(e);return t}function Pr(e,t){if(e===t)return e;var n=Dr(e),r=Dr(t),i=n.pop(),s=r.pop(),o=null;while(i===s){o=i;i=n.pop();s=r.pop()}return o}function jr(e){e.fixed|=2}function Fr(e){if(e!==Br)e.fixed&=1}function Ir(){Br.fixed&=1;Hr=Br=null}function qr(){Br.px=d3.event.x;Br.py=d3.event.y;Hr.resume()}function Rr(e,t,n){var r=0,i=0;e.charge=0;if(!e.leaf){var s=e.nodes,o=s.length,u=-1,a;while(++u<o){a=s[u];if(a==null)continue;Rr(a,t,n);e.charge+=a.charge;r+=a.charge*a.cx;i+=a.charge*a.cy}}if(e.point){if(!e.leaf){e.point.x+=Math.random()-.5;e.point.y+=Math.random()-.5}var f=t*n[e.point.index];e.charge+=e.pointCharge=f;r+=f*e.point.x;i+=f*e.point.y}e.cx=r/e.charge;e.cy=i/e.charge}function Ur(e){return 20}function zr(e){return 1}function Xr(e){return e.x}function Vr(e){return e.y}function $r(e,t,n){e.y0=t;e.y=n}function Qr(e){return d3.range(e.length)}function Gr(e){var t=-1,n=e[0].length,r=[];while(++t<n)r[t]=0;return r}function Yr(e){var t=1,n=0,r=e[0][1],i,s=e.length;for(;t<s;++t){if((i=e[t][1])>r){n=t;r=i}}return n}function Zr(e){return e.reduce(ei,0)}function ei(e,t){return e+t[1]}function ti(e,t){return ni(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function ni(e,t){var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];while(++n<=t)s[n]=i*n+r;return s}function ri(e){return[d3.min(e),d3.max(e)]}function ii(e,t){d3.rebind(e,t,"sort","children","value");e.links=ai;e.nodes=function(t){fi=true;return(e.nodes=e)(t)};return e}function si(e){return e.children}function oi(e){return e.value}function ui(e,t){return t.value-e.value}function ai(e){return d3.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function li(e,t){return e.value-t.value}function ci(e,t){var n=e._pack_next;e._pack_next=t;t._pack_prev=e;t._pack_next=n;n._pack_prev=t}function hi(e,t){e._pack_next=t;t._pack_prev=e}function pi(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return i*i-n*n-r*r>.001}function di(e){function c(e){t=Math.min(e.x-e.r,t);n=Math.max(e.x+e.r,n);r=Math.min(e.y-e.r,r);i=Math.max(e.y+e.r,i)}var t=Infinity,n=-Infinity,r=Infinity,i=-Infinity,s=e.length,o,u,a,f,l;e.forEach(vi);o=e[0];o.x=-o.r;o.y=0;c(o);if(s>1){u=e[1];u.x=u.r;u.y=0;c(u);if(s>2){a=e[2];bi(o,u,a);c(a);ci(o,a);o._pack_prev=a;ci(a,u);u=o._pack_next;for(var h=3;h<s;h++){bi(o,u,a=e[h]);var p=0,d=1,v=1;for(f=u._pack_next;f!==u;f=f._pack_next,d++){if(pi(f,a)){p=1;break}}if(p==1){for(l=o._pack_prev;l!==f._pack_prev;l=l._pack_prev,v++){if(pi(l,a)){break}}}if(p){if(d<v||d==v&&u.r<o.r)hi(o,u=f);else hi(o=l,u);h--}else{ci(o,a);u=a;c(a)}}}}var m=(t+n)/2,g=(r+i)/2,y=0;for(var h=0;h<s;h++){var b=e[h];b.x-=m;b.y-=g;y=Math.max(y,b.r+Math.sqrt(b.x*b.x+b.y*b.y))}e.forEach(mi);return y}function vi(e){e._pack_next=e._pack_prev=e}function mi(e){delete e._pack_next;delete e._pack_prev}function gi(e){var t=e.children;if(t&&t.length){t.forEach(gi);e.r=di(t)}else{e.r=Math.sqrt(e.value)}}function yi(e,t,n,r){var i=e.children;e.x=t+=r*e.x;e.y=n+=r*e.y;e.r*=r;if(i){var s=-1,o=i.length;while(++s<o)yi(i[s],t,n,r)}}function bi(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=Math.sqrt(i*i+s*s),a=Math.max(-1,Math.min(1,(r*r+u*u-o*o)/(2*r*u))),f=Math.acos(a),l=a*(r/=u),c=Math.sin(f)*r;n.x=e.x+l*i+c*s;n.y=e.y+l*s-c*i}else{n.x=e.x+r;n.y=e.y}}function wi(e){return 1+d3.max(e,function(e){return e.y})}function Ei(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Si(e){var t=e.children;return t&&t.length?Si(t[0]):e}function xi(e){var t=e.children,n;return t&&(n=t.length)?xi(t[n-1]):e}function Ti(e,t){return e.parent==t.parent?1:2}function Ni(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function Ci(e){var t=e.children,n;return t&&(n=t.length)?t[n-1]:e._tree.thread}function ki(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,s=-1;while(++s<i){if(t(r=ki(n[s],t),e)>0){e=r}}}return e}function Li(e,t){return e.x-t.x}function Ai(e,t){return t.x-e.x}function Oi(e,t){return e.depth-t.depth}function Mi(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length)){var s,o=null,u=-1,a;while(++u<a){s=i[u];n(s,o);o=s}}t(e,r)}n(e,null)}function _i(e){var t=0,n=0,r=e.children,i=r.length,s;while(--i>=0){s=r[i]._tree;s.prelim+=t;s.mod+=t;t+=s.shift+(n+=s.change)}}function Di(e,t,n){e=e._tree;t=t._tree;var r=n/(t.number-e.number);e.change+=r;t.change-=r;t.shift+=n;t.prelim+=n;t.mod+=n}function Pi(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function Hi(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Bi(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];if(i<0){n+=i/2;i=0}if(s<0){r+=s/2;s=0}return{x:n,y:r,dx:i,dy:s}}function ji(e){return e.map(Fi).join(",")}function Fi(e){return/[",\n]/.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}function qi(e,t){return function(n){return n&&e.hasOwnProperty(n.type)?e[n.type](n):t}}function Ri(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+ +2*e+"z"}function Ui(e,t){if(zi.hasOwnProperty(e.type))zi[e.type](e,t)}function Wi(e,t){Ui(e.geometry,t)}function Xi(e,t){for(var n=e.features,r=0,i=n.length;r<i;r++){Ui(n[r].geometry,t)}}function Vi(e,t){for(var n=e.geometries,r=0,i=n.length;r<i;r++){Ui(n[r],t)}}function $i(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++){t.apply(null,n[r])}}function Ji(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++){for(var s=n[r],o=0,u=s.length;o<u;o++){t.apply(null,s[o])}}}function Ki(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++){for(var s=n[r][0],o=0,u=s.length;o<u;o++){t.apply(null,s[o])}}}function Qi(e,t){t.apply(null,e.coordinates)}function Gi(e,t){for(var n=e.coordinates[0],r=0,i=n.length;r<i;r++){t.apply(null,n[r])}}function Yi(e){return e.source}function Zi(e){return e.target}function es(){function d(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,o=n*i+t*l,u=n*s+t*c,a=n*r+t*f;return[Math.atan2(u,o)/Ii,Math.atan2(a,Math.sqrt(o*o+u*u))/Ii]}var e,t,n,r,i,s,o,u,a,f,l,c,h,p;d.distance=function(){if(h==null)p=1/Math.sin(h=Math.acos(Math.max(-1,Math.min(1,r*f+n*a*Math.cos(o-e)))));return h};d.source=function(o){var u=Math.cos(e=o[0]*Ii),a=Math.sin(e);n=Math.cos(t=o[1]*Ii);r=Math.sin(t);i=n*u;s=n*a;h=null;return d};d.target=function(e){var t=Math.cos(o=e[0]*Ii),n=Math.sin(o);a=Math.cos(u=e[1]*Ii);f=Math.sin(u);l=a*t;c=a*n;h=null;return d};return d}function ts(e,t){var n=es().source(e).target(t);n.distance();return n}function is(e){var t=0,n=0;while(true){if(e(t,n)){return[t,n]}if(t===0){t=n+1;n=0}else{t=t-1;n=n+1}}}function ss(e,t,n,r){var i,s,o,u,a,f,l;i=r[e];s=i[0];o=i[1];i=r[t];u=i[0];a=i[1];i=r[n];f=i[0];l=i[1];return(l-o)*(u-s)-(a-o)*(f-s)>0}function os(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function us(e,t,n,r){var i=e[0],s=t[0],o=n[0],u=r[0],a=e[1],f=t[1],l=n[1],c=r[1],h=i-o,p=s-i,d=u-o,v=a-l,m=f-a,g=c-l,y=(d*v-g*h)/(g*p-d*m);return[i+y*p,a+y*m]}function fs(e,t){var n={list:e.map(function(e,t){return{index:t,x:e[0],y:e[1]}}).sort(function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}),bottomSite:null};var r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l");r.rightEnd=r.createHalfEdge(null,"l");r.leftEnd.r=r.rightEnd;r.rightEnd.l=r.leftEnd;r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(e,t){return{edge:e,side:t,vertex:null,l:null,r:null}},insert:function(e,t){t.l=e;t.r=e.r;e.r.l=t;e.r=t},leftBound:function(e){var t=r.leftEnd;do{t=t.r}while(t!=r.rightEnd&&i.rightOf(t,e));t=t.l;return t},del:function(e){e.l.r=e.r;e.r.l=e.l;e.edge=null},right:function(e){return e.r},left:function(e){return e.l},leftRegion:function(e){return e.edge==null?n.bottomSite:e.edge.region[e.side]},rightRegion:function(e){return e.edge==null?n.bottomSite:e.edge.region[as[e.side]]}};var i={bisect:function(e,t){var n={region:{l:e,r:t},ep:{l:null,r:null}};var r=t.x-e.x,i=t.y-e.y,s=r>0?r:-r,o=i>0?i:-i;n.c=e.x*r+e.y*i+(r*r+i*i)*.5;if(s>o){n.a=1;n.b=i/r;n.c/=r}else{n.b=1;n.a=r/i;n.c/=i}return n},intersect:function(e,t){var n=e.edge,r=t.edge;if(!n||!r||n.region.r==r.region.r){return null}var i=n.a*r.b-n.b*r.a;if(Math.abs(i)<1e-10){return null}var s=(n.c*r.b-r.c*n.b)/i,o=(r.c*n.a-n.c*r.a)/i,u=n.region.r,a=r.region.r,f,l;if(u.y<a.y||u.y==a.y&&u.x<a.x){f=e;l=n}else{f=t;l=r}var c=s>=l.region.r.x;if(c&&f.side==="l"||!c&&f.side==="r"){return null}return{x:s,y:o}},rightOf:function(e,t){var n=e.edge,r=n.region.r,i=t.x>r.x;if(i&&e.side==="l"){return 1}if(!i&&e.side==="r"){return 0}if(n.a===1){var s=t.y-r.y,o=t.x-r.x,u=0,a=0;if(!i&&n.b<0||i&&n.b>=0){a=u=s>=n.b*o}else{a=t.x+t.y*n.b>n.c;if(n.b<0){a=!a}if(!a){u=1}}if(!u){var f=r.x-n.region.l.x;a=n.b*(o*o-s*s)<f*s*(1+2*o/f+n.b*n.b);if(n.b<0){a=!a}}}else{var l=n.c-n.a*t.x,c=t.y-l,h=t.x-r.x,p=l-r.y;a=c*c>h*h+p*p}return e.side==="l"?a:!a},endPoint:function(e,n,r){e.ep[n]=r;if(!e.ep[as[n]])return;t(e)},distance:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}};var s={list:[],insert:function(e,t,n){e.vertex=t;e.ystar=t.y+n;for(var r=0,i=s.list,o=i.length;r<o;r++){var u=i[r];if(e.ystar>u.ystar||e.ystar==u.ystar&&t.x>u.vertex.x){continue}else{break}}i.splice(r,0,e)},del:function(e){for(var t=0,n=s.list,r=n.length;t<r&&n[t]!=e;++t){}n.splice(t,1)},empty:function(){return s.list.length===0},nextEvent:function(e){for(var t=0,n=s.list,r=n.length;t<r;++t){if(n[t]==e)return n[t+1]}return null},min:function(){var e=s.list[0];return{x:e.vertex.x,y:e.ystar}},extractMin:function(){return s.list.shift()}};r.init();n.bottomSite=n.list.shift();var o=n.list.shift(),u;var a,f,l,c,h;var p,d,v,m,g;var y,b;while(true){if(!s.empty()){u=s.min()}if(o&&(s.empty()||o.y<u.y||o.y==u.y&&o.x<u.x)){a=r.leftBound(o);f=r.right(a);p=r.rightRegion(a);y=i.bisect(p,o);h=r.createHalfEdge(y,"l");r.insert(a,h);m=i.intersect(a,h);if(m){s.del(a);s.insert(a,m,i.distance(m,o))}a=h;h=r.createHalfEdge(y,"r");r.insert(a,h);m=i.intersect(h,f);if(m){s.insert(h,m,i.distance(m,o))}o=n.list.shift()}else if(!s.empty()){a=s.extractMin();l=r.left(a);f=r.right(a);c=r.right(f);p=r.leftRegion(a);d=r.rightRegion(f);g=a.vertex;i.endPoint(a.edge,a.side,g);i.endPoint(f.edge,f.side,g);r.del(a);s.del(f);r.del(f);b="l";if(p.y>d.y){v=p;p=d;d=v;b="r"}y=i.bisect(p,d);h=r.createHalfEdge(y,b);r.insert(l,h);i.endPoint(y,as[b],g);m=i.intersect(l,h);if(m){s.del(l);s.insert(l,m,i.distance(m,p))}m=i.intersect(h,c);if(m){s.insert(h,m,i.distance(m,p))}}else{break}}for(a=r.right(r.leftEnd);a!=r.rightEnd;a=r.right(a)){t(a.edge)}}function ls(){return{leaf:true,nodes:[],point:null}}function cs(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=(n+i)*.5,u=(r+s)*.5,a=t.nodes;if(a[0])cs(e,a[0],n,r,o,u);if(a[1])cs(e,a[1],o,r,i,u);if(a[2])cs(e,a[2],n,u,o,s);if(a[3])cs(e,a[3],o,u,i,s)}}function hs(e){return{x:e[0],y:e[1]}}function ds(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function ms(e,t,n,r){var i,s,o=0,u=t.length,a=n.length;while(o<u){if(r>=a)return-1;i=t.charCodeAt(o++);if(i==37){s=Ss[t.charAt(o++)];if(!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++)){return-1}}return r}function xs(e,t,n){return Ns.test(t.substring(n,n+=3))?n:-1}function Ts(e,t,n){Cs.lastIndex=0;var r=Cs.exec(t.substring(n,n+10));return r?n+=r[0].length:-1}function Ls(e,t,n){var r=As.get(t.substring(n,n+=3).toLowerCase());return r==null?-1:(e.m=r,n)}function Os(e,t,n){Ms.lastIndex=0;var r=Ms.exec(t.substring(n,n+12));return r?(e.m=_s.get(r[0].toLowerCase()),n+=r[0].length):-1}function Ps(e,t,n){return ms(e,Es.c.toString(),t,n)}function Hs(e,t,n){return ms(e,Es.x.toString(),t,n)}function Bs(e,t,n){return ms(e,Es.X.toString(),t,n)}function js(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+=r[0].length):-1}function Fs(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+2));return r?(e.y=Is()+ +r[0],n+=r[0].length):-1}function Is(){return~~((new Date).getFullYear()/1e3)*1e3}function qs(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+=r[0].length):-1}function Rs(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+=r[0].length):-1}function Us(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+=r[0].length):-1}function zs(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+=r[0].length):-1}function Ws(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+=r[0].length):-1}function Xs(e,t,n){Vs.lastIndex=0;var r=Vs.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+=r[0].length):-1}function $s(e,t,n){var r=Js.get(t.substring(n,n+=2).toLowerCase());return r==null?-1:(e.p=r,n)}function Ks(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(Math.abs(t)/60),i=Math.abs(t)%60;return n+gs(r)+gs(i)}function Gs(e){return e.toISOString()}function Ys(e,t,n){function r(t){var n=e(t),r=s(n,1);return t-n<r-t?n:r}function i(n){t(n=e(new ps(n-1)),1);return n}function s(e,n){t(e=new ps(+e),n);return e}function o(e,r,s){var o=i(e),u=[];if(s>1){while(o<r){if(!(n(o)%s))u.push(new Date(+o));t(o,1)}}else{while(o<r)u.push(new Date(+o)),t(o,1)}return u}function u(e,t,n){try{ps=ds;var r=new ds;r._=e;return o(r,t,n)}finally{ps=Date}}e.floor=e;e.round=r;e.ceil=i;e.offset=s;e.range=o;var a=e.utc=Zs(e);a.floor=a;a.round=Zs(r);a.ceil=Zs(i);a.offset=Zs(s);a.range=u;return e}function Zs(e){return function(t,n){try{ps=ds;var r=new ds;r._=t;return e(r,n)._}finally{ps=Date}}}function eo(e,t,n){function r(t){return e(t)}r.invert=function(t){return no(e.invert(t))};r.domain=function(t){if(!arguments.length)return e.domain().map(no);e.domain(t);return r};r.nice=function(e){var t=to(r.domain());return r.domain([e.floor(t[0]),e.ceil(t[1])])};r.ticks=function(n,i){var s=to(r.domain());if(typeof n!=="function"){var o=s[1]-s[0],u=o/n,a=d3.bisect(oo,u);if(a==oo.length)return t.year(s,n);if(!a)return e.ticks(n).map(no);if(Math.log(u/oo[a-1])<Math.log(oo[a]/u))--a;n=t[a];i=n[1];n=n[0].range}return n(s[0],new Date(+s[1]+1),i)};r.tickFormat=function(){return n};r.copy=function(){return eo(e.copy(),t,n)};return d3.rebind(r,e,"range","rangeRound","interpolate","clamp")}function to(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function no(e){return new Date(e)}function ro(e){return function(t){var n=e.length-1,r=e[n];while(!r[1](t))r=e[--n];return r[0](t)}}function io(e){var t=new Date(e,0,1);t.setFullYear(e);return t}function so(e){var t=e.getFullYear(),n=io(t),r=io(t+1);return t+(e-n)/(r-n)}function vo(e){var t=new Date(Date.UTC(e,0,1));t.setUTCFullYear(e);return t}function mo(e){var t=e.getUTCFullYear(),n=vo(t),r=vo(t+1);return t+(e-n)/(r-n)}if(!Date.now)Date.now=function(){return+(new Date)};try{document.createElement("div").style.setProperty("opacity",0,"")}catch(e){var t=CSSStyleDeclaration.prototype,n=t.setProperty;t.setProperty=function(e,t,r){n.call(this,e,t+"",r)}}d3={version:"2.9.6"};var i=o;try{i(document.documentElement.childNodes)[0].nodeType}catch(u){i=s}var a=[].__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};d3.map=function(e){var t=new f;for(var n in e)t.set(n,e[n]);return t};r(f,{has:function(e){return l+e in this},get:function(e){return this[l+e]},set:function(e,t){return this[l+e]=t},remove:function(e){e=l+e;return e in this&&delete this[e]},keys:function(){var e=[];this.forEach(function(t){e.push(t)});return e},values:function(){var e=[];this.forEach(function(t,n){e.push(n)});return e},entries:function(){var e=[];this.forEach(function(t,n){e.push({key:t,value:n})});return e},forEach:function(e){for(var t in this){if(t.charCodeAt(0)===c){e.call(this,t.substring(1),this[t])}}}});var l="\0",c=l.charCodeAt(0);d3.functor=v;d3.rebind=function(e,t){var n=1,r=arguments.length,i;while(++n<r)e[i=arguments[n]]=m(e,t,t[i]);return e};d3.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN};d3.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN};d3.mean=function(e,t){var n=e.length,r,i=0,s=-1,o=0;if(arguments.length===1){while(++s<n)if(g(r=e[s]))i+=(r-i)/++o}else{while(++s<n)if(g(r=t.call(e,e[s],s)))i+=(r-i)/++o}return o?i:undefined};d3.median=function(e,t){if(arguments.length>1)e=e.map(t);e=e.filter(g);return e.length?d3.quantile(e.sort(d3.ascending),.5):undefined};d3.min=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&((i=e[n])==null||i!=i))i=undefined;while(++n<r)if((s=e[n])!=null&&i>s)i=s}else{while(++n<r&&((i=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)if((s=t.call(e,e[n],n))!=null&&i>s)i=s}return i};d3.max=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&((i=e[n])==null||i!=i))i=undefined;while(++n<r)if((s=e[n])!=null&&s>i)i=s}else{while(++n<r&&((i=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)if((s=t.call(e,e[n],n))!=null&&s>i)i=s}return i};d3.extent=function(e,t){var n=-1,r=e.length,i,s,o;if(arguments.length===1){while(++n<r&&((i=o=e[n])==null||i!=i))i=o=undefined;while(++n<r)if((s=e[n])!=null){if(i>s)i=s;if(o<s)o=s}}else{while(++n<r&&((i=o=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)if((s=t.call(e,e[n],n))!=null){if(i>s)i=s;if(o<s)o=s}}return[i,o]};d3.random={normal:function(e,t){if(arguments.length<2)t=1;if(arguments.length<1)e=0;return function(){var n,r,i;do{n=Math.random()*2-1;r=Math.random()*2-1;i=n*n+r*r}while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}}};d3.sum=function(e,t){var n=0,r=e.length,i,s=-1;if(arguments.length===1){while(++s<r)if(!isNaN(i=+e[s]))n+=i}else{while(++s<r)if(!isNaN(i=+t.call(e,e[s],s)))n+=i}return n};d3.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=e[r-1],s=n-r;return s?i+s*(e[r]-i):i};d3.transpose=function(e){return d3.zip.apply(d3,e)};d3.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,t=d3.min(arguments,y),n=new Array(t);++e<t;){for(var r=-1,i,s=n[e]=new Array(i);++r<i;){s[r]=arguments[r][e]}}return n};d3.bisector=function(e){return{left:function(t,n,r,i){if(arguments.length<3)r=0;if(arguments.length<4)i=t.length;while(r<i){var s=r+i>>1;if(e.call(t,t[s],s)<n)r=s+1;else i=s}return r},right:function(t,n,r,i){if(arguments.length<3)r=0;if(arguments.length<4)i=t.length;while(r<i){var s=r+i>>1;if(n<e.call(t,t[s],s))i=s;else r=s+1}return r}}};var b=d3.bisector(function(e){return e});d3.bisectLeft=b.left;d3.bisect=d3.bisectRight=b.right;d3.first=function(e,t){var n=0,r=e.length,i=e[0],s;if(arguments.length===1)t=d3.ascending;while(++n<r){if(t.call(e,i,s=e[n])>0){i=s}}return i};d3.last=function(e,t){var n=0,r=e.length,i=e[0],s;if(arguments.length===1)t=d3.ascending;while(++n<r){if(t.call(e,i,s=e[n])<=0){i=s}}return i};d3.nest=function(){function s(n,o){if(o>=t.length)return i?i.call(e,n):r?n.sort(r):n;var u=-1,a=n.length,l=t[o++],c,h,p=new f,d,v={};while(++u<a){if(d=p.get(c=l(h=n[u]))){d.push(h)}else{p.set(c,[h])}}p.forEach(function(e){v[e]=s(p.get(e),o)});return v}function o(e,r){if(r>=t.length)return e;var i=[],s=n[r++],u;for(u in e){i.push({key:u,values:o(e[u],r)})}if(s)i.sort(function(e,t){return s(e.key,t.key)});return i}var e={},t=[],n=[],r,i;e.map=function(e){return s(e,0)};e.entries=function(e){return o(s(e,0),0)};e.key=function(n){t.push(n);return e};e.sortKeys=function(r){n[t.length-1]=r;return e};e.sortValues=function(t){r=t;return e};e.rollup=function(t){i=t;return e};return e};d3.keys=function(e){var t=[];for(var n in e)t.push(n);return t};d3.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t};d3.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t};d3.permute=function(e,t){var n=[],r=-1,i=t.length;while(++r<i)n[r]=e[t[r]];return n};d3.merge=function(e){return Array.prototype.concat.apply([],e)};d3.split=function(e,t){var n=[],r=[],i,s=-1,o=e.length;if(arguments.length<2)t=w;while(++s<o){if(t.call(r,i=e[s],s)){r=[]}else{if(!r.length)n.push(r);r.push(i)}}return n};d3.range=function(e,t,n){if(arguments.length<3){n=1;if(arguments.length<2){t=e;e=0}}if((t-e)/n===Infinity)throw new Error("infinite range");var r=[],i=S(Math.abs(n)),s=-1,o;e*=i,t*=i,n*=i;if(n<0)while((o=e+n*++s)>t)r.push(o/i);else while((o=e+n*++s)<t)r.push(o/i);return r};d3.requote=function(e){return e.replace(x,"\\$&")};var x=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};d3.xhr=function(e,t,n){var r=new XMLHttpRequest;if(arguments.length<3)n=t,t=null;else if(t&&r.overrideMimeType)r.overrideMimeType(t);r.open("GET",e,true);if(t)r.setRequestHeader("Accept",t);r.onreadystatechange=function(){if(r.readyState===4){var e=r.status;n(!e&&r.response||e>=200&&e<300||e===304?r:null)}};r.send(null)};d3.text=function(e,t,n){function r(e){n(e&&e.responseText)}if(arguments.length<3){n=t;t=null}d3.xhr(e,t,r)};d3.json=function(e,t){d3.text(e,"application/json",function(e){t(e?JSON.parse(e):null)})};d3.html=function(e,t){d3.text(e,"text/html",function(e){if(e!=null){var n=document.createRange();n.selectNode(document.body);e=n.createContextualFragment(e)}t(e)})};d3.xml=function(e,t,n){function r(e){n(e&&e.responseXML)}if(arguments.length<3){n=t;t=null}d3.xhr(e,t,r)};var T={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:T,qualify:function(e){var t=e.indexOf(":"),n=e;if(t>=0){n=e.substring(0,t);e=e.substring(t+1)}return T.hasOwnProperty(n)?{space:T[n],local:e}:e}};d3.dispatch=function(){var e=new N,t=-1,n=arguments.length;while(++t<n)e[arguments[t]]=C(e);return e};N.prototype.on=function(e,t){var n=e.indexOf("."),r="";if(n>0){r=e.substring(n+1);e=e.substring(0,n)}return arguments.length<2?this[e].on(r):this[e].on(r,t)};d3.format=function(e){var t=k.exec(e),n=t[1]||" ",r=t[3]||"",i=t[5],s=+t[6],o=t[7],u=t[8],a=t[9],f=1,l="",c=false;if(u)u=+u.substring(1);if(i){n="0";if(o)s-=Math.floor((s-1)/4)}switch(a){case"n":o=true;a="g";break;case"%":f=100;l="%";a="f";break;case"p":f=100;l="%";a="r";break;case"d":c=true;u=0;break;case"s":f=-1;a="r";break}if(a=="r"&&!u)a="g";a=L.get(a)||O;return function(e){if(c&&e%1)return"";var t=e<0&&(e=-e)?"−":r;if(f<0){var h=d3.formatPrefix(e,u);e=h.scale(e);l=h.symbol}else{e*=f}e=a(e,u);if(i){var p=e.length+t.length;if(p<s)e=(new Array(s-p+1)).join(n)+e;if(o)e=M(e);e=t+e}else{if(o)e=M(e);e=t+e;var p=e.length;if(p<s)e=(new Array(s-p+1)).join(n)+e}return e+l}};var k=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/;var L=d3.map({g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return d3.round(e,t=A(e,t)).toFixed(Math.max(0,Math.min(20,t)))}});var _=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(D);d3.formatPrefix=function(e,t){var n=0;if(e){if(e<0)e*=-1;if(t)e=d3.round(e,A(e,t));n=1+Math.floor(1e-12+Math.log(e)/Math.LN10);n=Math.max(-24,Math.min(24,Math.floor((n<=0?n+1:n-1)/3)*3))}return _[8+n/3]};var P=z(2),H=z(3),B=function(){return U};var j=d3.map({linear:B,poly:z,quad:function(){return P},cubic:function(){return H},sin:function(){return W},exp:function(){return X},circle:function(){return V},elastic:$,back:J,bounce:function(){return K}});var F=d3.map({"in":U,out:q,"in-out":R,"out-in":function(e){return R(q(e))}});d3.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";n=j.get(n)||B;r=F.get(r)||U;return I(r(n.apply(null,Array.prototype.slice.call(arguments,1))))};d3.event=null;d3.interpolate=function(e,t){var n=d3.interpolators.length,r;while(--n>=0&&!(r=d3.interpolators[n](e,t)));return r};d3.interpolateNumber=function(e,t){t-=e;return function(n){return e+t*n}};d3.interpolateRound=function(e,t){t-=e;return function(n){return Math.round(e+t*n)}};d3.interpolateString=function(e,t){var n,r,i,s=0,o=0,u=[],a=[],f,l;Z.lastIndex=0;for(r=0;n=Z.exec(t);++r){if(n.index)u.push(t.substring(s,o=n.index));a.push({i:u.length,x:n[0]});u.push(null);s=Z.lastIndex}if(s<t.length)u.push(t.substring(s));for(r=0,f=a.length;(n=Z.exec(e))&&r<f;++r){l=a[r];if(l.x==n[0]){if(l.i){if(u[l.i+1]==null){u[l.i-1]+=l.x;u.splice(l.i,1);for(i=r+1;i<f;++i)a[i].i--}else{u[l.i-1]+=l.x+u[l.i+1];u.splice(l.i,2);for(i=r+1;i<f;++i)a[i].i-=2}}else{if(u[l.i+1]==null){u[l.i]=l.x}else{u[l.i]=l.x+u[l.i+1];u.splice(l.i+1,1);for(i=r+1;i<f;++i)a[i].i--}}a.splice(r,1);f--;r--}else{l.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(l.x))}}while(r<f){l=a.pop();if(u[l.i+1]==null){u[l.i]=l.x}else{u[l.i]=l.x+u[l.i+1];u.splice(l.i+1,1)}f--}if(u.length===1){return u[0]==null?a[0].x:function(){return t}}return function(e){for(r=0;r<f;++r)u[(l=a[r]).i]=l.x(e);return u.join("")}};d3.interpolateTransform=function(e,t){var n=[],r=[],i,s=d3.transform(e),o=d3.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;if(u[0]!=a[0]||u[1]!=a[1]){n.push("translate(",null,",",null,")");r.push({i:1,x:d3.interpolateNumber(u[0],a[0])},{i:3,x:d3.interpolateNumber(u[1],a[1])})}else if(a[0]||a[1]){n.push("translate("+a+")")}else{n.push("")}if(f!=l){if(f-l>180)l+=360;else if(l-f>180)f+=360;r.push({i:n.push(n.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(f,l)})}else if(l){n.push(n.pop()+"rotate("+l+")")}if(c!=h){r.push({i:n.push(n.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(c,h)})}else if(h){n.push(n.pop()+"skewX("+h+")")}if(p[0]!=d[0]||p[1]!=d[1]){i=n.push(n.pop()+"scale(",null,",",null,")");r.push({i:i-4,x:d3.interpolateNumber(p[0],d[0])},{i:i-2,x:d3.interpolateNumber(p[1],d[1])})}else if(d[0]!=1||d[1]!=1){n.push(n.pop()+"scale("+d+")")}i=r.length;return function(e){var t=-1,s;while(++t<i)n[(s=r[t]).i]=s.x(e);return n.join("")}};d3.interpolateRgb=function(e,t){e=d3.rgb(e);t=d3.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+st(Math.round(n+s*e))+st(Math.round(r+o*e))+st(Math.round(i+u*e))}};d3.interpolateHsl=function(e,t){e=d3.hsl(e);t=d3.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;if(s>180)s-=360;else if(s<-180)s+=360;return function(e){return ht(n+s*e,r+o*e,i+u*e).toString()}};d3.interpolateArray=function(e,t){var n=[],r=[],i=e.length,s=t.length,o=Math.min(e.length,t.length),u;for(u=0;u<o;++u)n.push(d3.interpolate(e[u],t[u]));for(;u<i;++u)r[u]=e[u];for(;u<s;++u)r[u]=t[u];return function(e){for(u=0;u<o;++u)r[u]=n[u](e);return r}};d3.interpolateObject=function(e,t){var n={},r={},i;for(i in e){if(i in t){n[i]=et(i)(e[i],t[i])}else{r[i]=e[i]}}for(i in t){if(!(i in e)){r[i]=t[i]}}return function(e){for(i in n)r[i]=n[i](e);return r}};var Z=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(e,t){return t instanceof Array&&d3.interpolateArray(e,t)},function(e,t){return(typeof e==="string"||typeof t==="string")&&d3.interpolateString(e+"",t+"")},function(e,t){return(typeof t==="string"?ft.has(t)||/^(#|rgb\(|hsl\()/.test(t):t instanceof it||t instanceof ct)&&d3.interpolateRgb(e,t)},function(e,t){return!isNaN(e=+e)&&!isNaN(t=+t)&&d3.interpolateNumber(e,t)}];d3.rgb=function(e,t,n){return arguments.length===1?e instanceof it?rt(e.r,e.g,e.b):ot(""+e,rt,ht):rt(~~e,~~t,~~n)};it.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;if(!t&&!n&&!r)return rt(i,i,i);if(t&&t<i)t=i;if(n&&n<i)n=i;if(r&&r<i)r=i;return rt(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e)))};it.prototype.darker=function(e){e=Math.pow(.7,arguments.length?e:1);return rt(Math.floor(e*this.r),Math.floor(e*this.g),Math.floor(e*this.b))};it.prototype.hsl=function(){return ut(this.r,this.g,this.b)};it.prototype.toString=function(){return"#"+st(this.r)+st(this.g)+st(this.b)};var ft=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});ft.forEach(function(e,t){ft.set(e,ot(t,rt,ht))});d3.hsl=function(e,t,n){return arguments.length===1?e instanceof ct?lt(e.h,e.s,e.l):ot(""+e,ut,lt):lt(+e,+t,+n)};ct.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);return lt(this.h,this.s,this.l/e)};ct.prototype.darker=function(e){e=Math.pow(.7,arguments.length?e:1);return lt(this.h,this.s,e*this.l)};ct.prototype.rgb=function(){return ht(this.h,this.s,this.l)};ct.prototype.toString=function(){return this.rgb().toString()};var dt=function(e,t){return t.querySelector(e)},vt=function(e,t){return t.querySelectorAll(e)},mt=document.documentElement,gt=mt.matchesSelector||mt.webkitMatchesSelector||mt.mozMatchesSelector||mt.msMatchesSelector||mt.oMatchesSelector,yt=function(e,t){return gt.call(e,t)};if(typeof Sizzle==="function"){dt=function(e,t){return Sizzle(e,t)[0]||null};vt=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))};yt=Sizzle.matchesSelector}var bt=[];d3.selection=function(){return kt};d3.selection.prototype=bt;bt.select=function(e){var t=[],n,r,i,s;if(typeof e!=="function")e=wt(e);for(var o=-1,u=this.length;++o<u;){t.push(n=[]);n.parentNode=(i=this[o]).parentNode;for(var a=-1,f=i.length;++a<f;){if(s=i[a]){n.push(r=e.call(s,s.__data__,a));if(r&&"__data__"in s)r.__data__=s.__data__}else{n.push(null)}}}return pt(t)};bt.selectAll=function(e){var t=[],n,r;if(typeof e!=="function")e=Et(e);for(var s=-1,o=this.length;++s<o;){for(var u=this[s],a=-1,f=u.length;++a<f;){if(r=u[a]){t.push(n=i(e.call(r,r.__data__,a)));n.parentNode=r}}}return pt(t)};bt.attr=function(e,t){function r(){this.removeAttribute(e)}function i(){this.removeAttributeNS(e.space,e.local)}function s(){this.setAttribute(e,t)}function o(){this.setAttributeNS(e.space,e.local,t)}function u(){var n=t.apply(this,arguments);if(n==null)this.removeAttribute(e);else this.setAttribute(e,n)}function a(){var n=t.apply(this,arguments);if(n==null)this.removeAttributeNS(e.space,e.local);else this.setAttributeNS(e.space,e.local,n)}e=d3.ns.qualify(e);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each(t==null?e.local?i:r:typeof t==="function"?e.local?a:u:e.local?o:s)};bt.classed=function(e,t){var n=E(e).split(" "),r=n.length,i=-1;if(arguments.length>1){while(++i<r)St.call(this,n[i],t);return this}else{while(++i<r)if(!St.call(this,n[i]))return false;return true}};bt.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);if(r==null)this.style.removeProperty(e);else this.style.setProperty(e,r,n)}if(arguments.length<3)n="";if(arguments.length<2)return window.getComputedStyle(this.node(),null).getPropertyValue(e);return this.each(t==null?r:typeof t==="function"?s:i)};bt.property=function(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);if(n==null)delete this[e];else this[e]=n}if(arguments.length<2)return this.node()[e];return this.each(t==null?n:typeof t==="function"?i:r)};bt.text=function(e){return arguments.length<1?this.node().textContent:this.each(typeof e==="function"?function(){var t=e.apply(this,arguments);this.textContent=t==null?"":t}:e==null?function(){this.textContent=""}:function(){this.textContent=e})};bt.html=function(e){return arguments.length<1?this.node().innerHTML:this.each(typeof e==="function"?function(){var t=e.apply(this,arguments);this.innerHTML=t==null?"":t}:e==null?function(){this.innerHTML=""}:function(){this.innerHTML=e})};bt.append=function(e){function t(){return this.appendChild(document.createElementNS(this.namespaceURI,e))}function n(){return this.appendChild(document.createElementNS(e.space,e.local))}e=d3.ns.qualify(e);return this.select(e.local?n:t)};bt.insert=function(e,t){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,e),dt(t,this))}function r(){return this.insertBefore(document.createElementNS(e.space,e.local),dt(t,this))}e=d3.ns.qualify(e);return this.select(e.local?r:n)};bt.remove=function(){return this.each(function(){var e=this.parentNode;if(e)e.removeChild(this)})};bt.data=function(e,t){function o(e,n){var r,i=e.length,s=n.length,o=Math.min(i,s),c=Math.max(i,s),h=[],p=[],d=[],v,m;if(t){var g=new f,y=[],b,w=n.length;for(r=-1;++r<i;){b=t.call(v=e[r],v.__data__,r);if(g.has(b)){d[w++]=v}else{g.set(b,v)}y.push(b)}for(r=-1;++r<s;){b=t.call(n,m=n[r],r);if(g.has(b)){h[r]=v=g.get(b);v.__data__=m;p[r]=d[r]=null}else{p[r]=xt(m);h[r]=d[r]=null}g.remove(b)}for(r=-1;++r<i;){if(g.has(y[r])){d[r]=e[r]}}}else{for(r=-1;++r<o;){v=e[r];m=n[r];if(v){v.__data__=m;h[r]=v;p[r]=d[r]=null}else{p[r]=xt(m);h[r]=d[r]=null}}for(;r<s;++r){p[r]=xt(n[r]);h[r]=d[r]=null}for(;r<c;++r){d[r]=e[r];p[r]=h[r]=null}}p.update=h;p.parentNode=h.parentNode=d.parentNode=e.parentNode;u.push(p);a.push(h);l.push(d)}var n=-1,r=this.length,i,s;if(!arguments.length){e=new Array(r=(i=this[0]).length);while(++n<r){if(s=i[n]){e[n]=s.__data__}}return e}var u=Lt([]),a=pt([]),l=pt([]);if(typeof e==="function"){while(++n<r){o(i=this[n],e.call(i,i.parentNode.__data__,n))}}else{while(++n<r){o(i=this[n],e)}}a.enter=function(){return u};a.exit=function(){return l};return a};bt.datum=bt.map=function(e){return arguments.length<1?this.property("__data__"):this.property("__data__",e)};bt.filter=function(e){var t=[],n,r,i;if(typeof e!=="function")e=Tt(e);for(var s=0,o=this.length;s<o;s++){t.push(n=[]);n.parentNode=(r=this[s]).parentNode;for(var u=0,a=r.length;u<a;u++){if((i=r[u])&&e.call(i,i.__data__,u)){n.push(i)}}}return pt(t)};bt.order=function(){for(var e=-1,t=this.length;++e<t;){for(var n=this[e],r=n.length-1,i=n[r],s;--r>=0;){if(s=n[r]){if(i&&i!==s.nextSibling)i.parentNode.insertBefore(s,i);i=s}}}return this};bt.sort=function(e){e=Nt.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()};bt.on=function(e,t,n){if(arguments.length<3)n=false;var r="__on"+e,i=e.indexOf(".");if(i>0)e=e.substring(0,i);if(arguments.length<2)return(i=this.node()[r])&&i._;return this.each(function(i,s){function a(e){var n=d3.event;d3.event=e;try{t.call(o,o.__data__,s)}finally{d3.event=n}}var o=this,u=o[r];if(u){o.removeEventListener(e,u,u.$);delete o[r]}if(t){o.addEventListener(e,o[r]=a,a.$=n);a._=t}})};bt.each=function(e){return Ct(this,function(t,n,r){e.call(t,t.__data__,n,r)})};bt.call=function(e){e.apply(this,(arguments[0]=this,arguments));return this};bt.empty=function(){return!this.node()};bt.node=function(e){for(var t=0,n=this.length;t<n;t++){for(var r=this[t],i=0,s=r.length;i<s;i++){var o=r[i];if(o)return o}}return null};bt.transition=function(){var e=[],t,n;for(var r=-1,i=this.length;++r<i;){e.push(t=[]);for(var s=this[r],o=-1,u=s.length;++o<u;){t.push((n=s[o])?{node:n,delay:qt,duration:Rt}:null)}}return Ot(e,Bt||++Ht,Date.now())};var kt=pt([[document]]);kt[0].parentNode=mt;d3.select=function(e){return typeof e==="string"?kt.select(e):pt([[e]])};d3.selectAll=function(e){return typeof e==="string"?kt.selectAll(e):pt([i(e)])};var At=[];d3.selection.enter=Lt;d3.selection.enter.prototype=At;At.append=bt.append;At.insert=bt.insert;At.empty=bt.empty;At.node=bt.node;At.select=function(e){var t=[],n,r,i,s,o;for(var u=-1,a=this.length;++u<a;){i=(s=this[u]).update;t.push(n=[]);n.parentNode=s.parentNode;for(var f=-1,l=s.length;++f<l;){if(o=s[f]){n.push(i[f]=r=e.call(s.parentNode,o.__data__,f));r.__data__=o.__data__}else{n.push(null)}}}return pt(t)};var Mt={};var Pt=[],Ht=0,Bt=0,jt=0,Ft=250,It=d3.ease("cubic-in-out"),qt=jt,Rt=Ft,Ut=It;Pt.call=bt.call;d3.transition=function(e){return arguments.length?Bt?e.transition():e:kt.transition()};d3.transition.prototype=Pt;Pt.select=function(e){var t=[],n,r,i;if(typeof e!=="function")e=wt(e);for(var s=-1,o=this.length;++s<o;){t.push(n=[]);for(var u=this[s],a=-1,f=u.length;++a<f;){if((i=u[a])&&(r=e.call(i.node,i.node.__data__,a))){if("__data__"in i.node)r.__data__=i.node.__data__;n.push({node:r,delay:i.delay,duration:i.duration})}else{n.push(null)}}}return Ot(t,this.id,this.time).ease(this.ease())};Pt.selectAll=function(e){var t=[],n,r,i;if(typeof e!=="function")e=Et(e);for(var s=-1,o=this.length;++s<o;){for(var u=this[s],a=-1,f=u.length;++a<f;){if(i=u[a]){r=e.call(i.node,i.node.__data__,a);t.push(n=[]);for(var l=-1,c=r.length;++l<c;){n.push({node:r[l],delay:i.delay,duration:i.duration})}}}}return Ot(t,this.id,this.time).ease(this.ease())};Pt.attr=function(e,t){return this.attrTween(e,Dt(e,t))};Pt.attrTween=function(e,t){function r(e,r){var i=t.call(this,e,r,this.getAttribute(n));return i===Mt?(this.removeAttribute(n),null):i&&function(e){this.setAttribute(n,i(e))}}function i(e,r){var i=t.call(this,e,r,this.getAttributeNS(n.space,n.local));return i===Mt?(this.removeAttributeNS(n.space,n.local),null):i&&function(e){this.setAttributeNS(n.space,n.local,i(e))}}var n=d3.ns.qualify(e);return this.tween("attr."+e,n.local?i:r)};Pt.style=function(e,t,n){if(arguments.length<3)n="";return this.styleTween(e,Dt(e,t),n)};Pt.styleTween=function(e,t,n){if(arguments.length<3)n="";return this.tween("style."+e,function(r,i){var s=t.call(this,r,i,window.getComputedStyle(this,null).getPropertyValue(e));return s===Mt?(this.style.removeProperty(e),null):s&&function(t){this.style.setProperty(e,s(t),n)}})};Pt.text=function(e){return this.tween("text",function(t,n){this.textContent=typeof e==="function"?e.call(this,t,n):e})};Pt.remove=function(){return this.each("end.transition",function(){var e;if(!this.__transition__&&(e=this.parentNode))e.removeChild(this)})};Pt.delay=function(e){return Ct(this,typeof e==="function"?function(t,n,r){t.delay=e.call(t=t.node,t.__data__,n,r)|0}:(e=e|0,function(t){t.delay=e}))};Pt.duration=function(e){return Ct(this,typeof e==="function"?function(t,n,r){t.duration=Math.max(1,e.call(t=t.node,t.__data__,n,r)|0)}:(e=Math.max(1,e|0),function(t){t.duration=e}))};Pt.transition=function(){return this.select(p)};var Wt=null,Xt,Vt;d3.timer=function(e,t,n){var r=false,i,s=Wt;if(arguments.length<3){if(arguments.length<2)t=0;else if(!isFinite(t))return;n=Date.now()}while(s){if(s.callback===e){s.then=n;s.delay=t;r=true;break}i=s;s=s.next}if(!r)Wt={callback:e,then:n,delay:t,next:Wt};if(!Xt){Vt=clearTimeout(Vt);Xt=1;Kt($t)}};d3.timer.flush=function(){var e,t=Date.now(),n=Wt;while(n){e=t-n.then;if(!n.delay)n.flush=n.callback(e);n=n.next}Jt()};var Kt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,17)};d3.transform=function(e){var t=document.createElementNS(d3.ns.prefix.svg,"g"),n={a:1,b:0,c:0,d:1,e:0,f:0};return(d3.transform=function(e){t.setAttribute("transform",e);var r=t.transform.baseVal.consolidate();return new Qt(r?r.matrix:n)})(e)};Qt.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var en=180/Math.PI;d3.mouse=function(e){return nn(e,G())};var tn=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(e,t){if(arguments.length<2)t=G().touches;return t?i(t).map(function(t){var n=nn(e,t);n.identifier=t.identifier;return n}):[]};d3.scale={};d3.scale.linear=function(){return fn([0,1],[0,1],d3.interpolate,false)};d3.scale.log=function(){return gn(d3.scale.linear(),bn)};var yn=d3.format(".0e");bn.pow=function(e){return Math.pow(10,e)};wn.pow=function(e){return-Math.pow(10,-e)};d3.scale.pow=function(){return En(d3.scale.linear(),1)};d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)};d3.scale.ordinal=function(){return xn([],{t:"range",x:[]})};d3.scale.category10=function(){return d3.scale.ordinal().range(Tn)};d3.scale.category20=function(){return d3.scale.ordinal().range(Nn)};d3.scale.category20b=function(){return d3.scale.ordinal().range(Cn)};d3.scale.category20c=function(){return d3.scale.ordinal().range(kn)};var Tn=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];var Nn=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var Cn=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"];var kn=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return Ln([],[])};d3.scale.quantize=function(){return An(0,1,[0,1])};d3.scale.identity=function(){return On([0,1])};d3.svg={};d3.svg.arc=function(){function i(){var i=e.apply(this,arguments),s=t.apply(this,arguments),o=n.apply(this,arguments)+Mn,u=r.apply(this,arguments)+Mn,a=(u<o&&(a=o,o=u,u=a),u-o),f=a<Math.PI?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=_n?i?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+i+"A"+i+","+i+" 0 1,0 0,"+ -i+"A"+i+","+i+" 0 1,0 0,"+i+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":i?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+i*h+","+i*p+"A"+i+","+i+" 0 "+f+",0 "+i*l+","+i*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var e=Dn,t=Pn,n=Hn,r=Bn;i.innerRadius=function(t){if(!arguments.length)return e;e=v(t);return i};i.outerRadius=function(e){if(!arguments.length)return t;t=v(e);return i};i.startAngle=function(e){if(!arguments.length)return n;n=v(e);return i};i.endAngle=function(e){if(!arguments.length)return r;r=v(e);return i};i.centroid=function(){var i=(e.apply(this,arguments)+t.apply(this,arguments))/2,s=(n.apply(this,arguments)+r.apply(this,arguments))/2+Mn;return[Math.cos(s)*i,Math.sin(s)*i]};return i};var Mn=-Math.PI/2,_n=2*Math.PI-1e-6;d3.svg.line=function(){return jn(h)};var qn="linear";var Rn=d3.map({linear:Un,"step-before":zn,"step-after":Wn,basis:Qn,"basis-open":Gn,"basis-closed":Yn,bundle:Zn,cardinal:$n,"cardinal-open":Xn,"cardinal-closed":Vn,monotone:ar});var tr=[0,2/3,1/3,0],nr=[0,1/3,2/3,0],rr=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var e=jn(fr);e.radius=e.x,delete e.x;e.angle=e.y,delete e.y;return e};zn.reverse=Wn;Wn.reverse=zn;d3.svg.area=function(){return lr(Object)};d3.svg.area.radial=function(){var e=lr(fr);e.radius=e.x,delete e.x;e.innerRadius=e.x0,delete e.x0;e.outerRadius=e.x1,delete e.x1;e.angle=e.y,delete e.y;e.startAngle=e.y0,delete e.y0;e.endAngle=e.y1,delete e.y1;return e};d3.svg.chord=function(){function s(n,r){var i=o(this,e,n,r),s=o(this,t,n,r);return"M"+i.p0+a(i.r,i.p1,i.a1-i.a0)+(u(i,s)?f(i.r,i.p1,i.r,i.p0):f(i.r,i.p1,s.r,s.p0)+a(s.r,s.p1,s.a1-s.a0)+f(s.r,s.p1,i.r,i.p0))+"Z"}function o(e,t,s,o){var u=t.call(e,s,o),a=n.call(e,u,o),f=r.call(e,u,o)+Mn,l=i.call(e,u,o)+Mn;return{r:a,a0:f,a1:l,p0:[a*Math.cos(f),a*Math.sin(f)],p1:[a*Math.cos(l),a*Math.sin(l)]}}function u(e,t){return e.a0==t.a0&&e.a1==t.a1}function a(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Math.PI)+",1 "+t}function f(e,t,n,r){return"Q 0,0 "+r}var e=cr,t=hr,n=pr,r=Hn,i=Bn;s.radius=function(e){if(!arguments.length)return n;n=v(e);return s};s.source=function(t){if(!arguments.length)return e;e=v(t);return s};s.target=function(e){if(!arguments.length)return t;t=v(e);return s};s.startAngle=function(e){if(!arguments.length)return r;r=v(e);return s};s.endAngle=function(e){if(!arguments.length)return i;i=v(e);return s};return s};d3.svg.diagonal=function(){function r(r,i){var s=e.call(this,r,i),o=t.call(this,r,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];a=a.map(n);return"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var e=cr,t=hr,n=mr;r.source=function(t){if(!arguments.length)return e;e=v(t);return r};r.target=function(e){if(!arguments.length)return t;t=v(e);return r};r.projection=function(e){if(!arguments.length)return n;n=e;return r};return r};d3.svg.diagonal.radial=function(){var e=d3.svg.diagonal(),t=mr,n=e.projection;e.projection=function(e){return arguments.length?n(gr(t=e)):t};return e};d3.svg.mouse=d3.mouse;d3.svg.touches=d3.touches;d3.svg.symbol=function(){function n(n,r){return(Er.get(e.call(this,n,r))||wr)(t.call(this,n,r))}var e=br,t=yr;n.type=function(t){if(!arguments.length)return e;e=v(t);return n};n.size=function(e){if(!arguments.length)return t;t=v(e);return n};return n};var Er=d3.map({circle:wr,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*xr)),n=t*xr;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Sr),n=t*Sr/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Sr),n=t*Sr/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});d3.svg.symbolTypes=Er.keys();var Sr=Math.sqrt(3),xr=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function l(l){l.each(function(){var l=d3.select(this);var c=u==null?e.ticks?e.ticks.apply(e,o):e.domain():u,h=a==null?e.tickFormat?e.tickFormat.apply(e,o):String:a;var p=Cr(e,c,f),d=l.selectAll(".minor").data(p,String),v=d.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),m=d3.transition(d.exit()).style("opacity",1e-6).remove(),g=d3.transition(d).style("opacity",1);var y=l.selectAll("g").data(c,String),b=y.enter().insert("g","path").style("opacity",1e-6),w=d3.transition(y.exit()).style("opacity",1e-6).remove(),E=d3.transition(y).style("opacity",1),S;var x=on(e),T=l.selectAll(".domain").data([0]),N=T.enter().append("path").attr("class","domain"),C=d3.transition(T);var k=e.copy(),L=this.__chart__||k;this.__chart__=k;b.append("line").attr("class","tick");b.append("text");var A=b.select("line"),O=E.select("line"),M=y.select("text").text(h),_=b.select("text"),D=E.select("text");switch(t){case"bottom":{S=Tr;v.attr("y2",r);g.attr("x2",0).attr("y2",r);A.attr("y2",n);_.attr("y",Math.max(n,0)+s);O.attr("x2",0).attr("y2",n);D.attr("x",0).attr("y",Math.max(n,0)+s);M.attr("dy",".71em").attr("text-anchor","middle");C.attr("d","M"+x[0]+","+i+"V0H"+x[1]+"V"+i);break};case"top":{S=Tr;v.attr("y2",-r);g.attr("x2",0).attr("y2",-r);A.attr("y2",-n);_.attr("y",-(Math.max(n,0)+s));O.attr("x2",0).attr("y2",-n);D.attr("x",0).attr("y",-(Math.max(n,0)+s));M.attr("dy","0em").attr("text-anchor","middle");C.attr("d","M"+x[0]+","+ -i+"V0H"+x[1]+"V"+ -i);break};case"left":{S=Nr;v.attr("x2",-r);g.attr("x2",-r).attr("y2",0);A.attr("x2",-n);_.attr("x",-(Math.max(n,0)+s));O.attr("x2",-n).attr("y2",0);D.attr("x",-(Math.max(n,0)+s)).attr("y",0);M.attr("dy",".32em").attr("text-anchor","end");C.attr("d","M"+ -i+","+x[0]+"H0V"+x[1]+"H"+ -i);break};case"right":{S=Nr;v.attr("x2",r);g.attr("x2",r).attr("y2",0);A.attr("x2",n);_.attr("x",Math.max(n,0)+s);O.attr("x2",n).attr("y2",0);D.attr("x",Math.max(n,0)+s).attr("y",0);M.attr("dy",".32em").attr("text-anchor","start");C.attr("d","M"+i+","+x[0]+"H0V"+x[1]+"H"+i);break}}if(e.ticks){b.call(S,L);E.call(S,k);w.call(S,k);v.call(S,L);g.call(S,k);m.call(S,k)}else{var P=k.rangeBand()/2,H=function(e){return k(e)+P};b.call(S,H);E.call(S,H)}})}var e=d3.scale.linear(),t="bottom",n=6,r=6,i=6,s=3,o=[10],u=null,a,f=0;l.scale=function(t){if(!arguments.length)return e;e=t;return l};l.orient=function(e){if(!arguments.length)return t;t=e;return l};l.ticks=function(){if(!arguments.length)return o;o=arguments;return l};l.tickValues=function(e){if(!arguments.length)return u;u=e;return l};l.tickFormat=function(e){if(!arguments.length)return a;a=e;return l};l.tickSize=function(e,t,s){if(!arguments.length)return n;var o=arguments.length-1;n=+e;r=o>1?+t:n;i=o>0?+arguments[o]:n;return l};l.tickPadding=function(e){if(!arguments.length)return s;s=+e;return l};l.tickSubdivide=function(e){if(!arguments.length)return f;f=+e;return l};return l};d3.svg.brush=function(){function o(e){e.each(function(){var e=d3.select(this),i=e.selectAll(".background").data([0]),s=e.selectAll(".extent").data([0]),c=e.selectAll(".resize").data(r,String),h;e.style("pointer-events","all").on("mousedown.brush",l).on("touchstart.brush",l);i.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");s.enter().append("rect").attr("class","extent").style("cursor","move");c.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return kr[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");c.style("display",o.empty()?"none":null);c.exit().remove();if(t){h=on(t);i.attr("x",h[0]).attr("width",h[1]-h[0]);a(e)}if(n){h=on(n);i.attr("y",h[0]).attr("height",h[1]-h[0]);f(e)}u(e)})}function u(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+i[+/e$/.test(e)][0]+","+i[+/^s/.test(e)][1]+")"})}function a(e){e.select(".extent").attr("x",i[0][0]);e.selectAll(".extent,.n>rect,.s>rect").attr("width",i[1][0]-i[0][0])}function f(e){e.select(".extent").attr("y",i[0][1]);e.selectAll(".extent,.e>rect,.w>rect").attr("height",i[1][1]-i[0][1])}function l(){function x(){var e=d3.event.changedTouches;return e?d3.touches(r,e)[0]:d3.mouse(r)}function T(){if(d3.event.keyCode==32){if(!m){g=null;y[0]-=i[1][0];y[1]-=i[1][1];m=2}Q()}}function N(){if(d3.event.keyCode==32&&m==2){y[0]+=i[1][0];y[1]+=i[1][1];m=0;Q()}}function C(){var e=x(),r=false;if(b){e[0]+=b[0];e[1]+=b[1]}if(!m){if(d3.event.altKey){if(!g)g=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];y[0]=i[+(e[0]<g[0])][0];y[1]=i[+(e[1]<g[1])][1]}else g=null}if(d&&k(e,t,0)){a(h);r=true}if(v&&k(e,n,1)){f(h);r=true}if(r){u(h);c({type:"brush",mode:m?"move":"resize"})}}function k(e,t,n){var r=on(t),o=r[0],u=r[1],a=y[n],f=i[1][n]-i[0][n],l,c;if(m){o-=a;u-=f+a}l=Math.max(o,Math.min(u,e[n]));if(m){c=(l+=a)+f}else{if(g)a=Math.max(o,Math.min(u,2*g[n]-l));if(a<l){c=l;l=a}else{c=a}}if(i[0][n]!==l||i[1][n]!==c){s=null;i[0][n]=l;i[1][n]=c;return true}}function L(){C();h.style("pointer-events","all").selectAll(".resize").style("display",o.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);c({type:"brushend"});Q()}var r=this,l=d3.select(d3.event.target),c=e.of(r,arguments),h=d3.select(r),p=l.datum(),d=!/^(n|s)$/.test(p)&&t,v=!/^(e|w)$/.test(p)&&n,m=l.classed("extent"),g,y=x(),b;var w=d3.select(window).on("mousemove.brush",C).on("mouseup.brush",L).on("touchmove.brush",C).on("touchend.brush",L).on("keydown.brush",T).on("keyup.brush",N);if(m){y[0]=i[0][0]-y[0];y[1]=i[0][1]-y[1]}else if(p){var E=+/w$/.test(p),S=+/^n/.test(p);b=[i[1-E][0]-y[0],i[1-S][1]-y[1]];y[0]=i[E][0];y[1]=i[S][1]}else if(d3.event.altKey)g=y.slice();h.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",l.style("cursor"));c({type:"brushstart"});C();Q()}var e=Y(o,"brushstart","brush","brushend"),t=null,n=null,r=Lr[0],i=[[0,0],[0,0]],s;o.x=function(e){if(!arguments.length)return t;t=e;r=Lr[!t<<1|!n];return o};o.y=function(e){if(!arguments.length)return n;n=e;r=Lr[!t<<1|!n];return o};o.extent=function(e){var r,u,a,f,l;if(!arguments.length){e=s||i;if(t){r=e[0][0],u=e[1][0];if(!s){r=i[0][0],u=i[1][0];if(t.invert)r=t.invert(r),u=t.invert(u);if(u<r)l=r,r=u,u=l}}if(n){a=e[0][1],f=e[1][1];if(!s){a=i[0][1],f=i[1][1];if(n.invert)a=n.invert(a),f=n.invert(f);if(f<a)l=a,a=f,f=l}}return t&&n?[[r,a],[u,f]]:t?[r,u]:n&&[a,f]}s=[[0,0],[0,0]];if(t){r=e[0],u=e[1];if(n)r=r[0],u=u[0];s[0][0]=r,s[1][0]=u;if(t.invert)r=t(r),u=t(u);if(u<r)l=r,r=u,u=l;i[0][0]=r|0,i[1][0]=u|0}if(n){a=e[0],f=e[1];if(t)a=a[1],f=f[1];s[0][1]=a,s[1][1]=f;if(n.invert)a=n(a),f=n(f);if(f<a)l=a,a=f,f=l;i[0][1]=a|0,i[1][1]=f|0}return o};o.clear=function(){s=null;i[0][0]=i[0][1]=i[1][0]=i[1][1]=0;return o};o.empty=function(){return t&&i[0][0]===i[1][0]||n&&i[0][1]===i[1][1]};return d3.rebind(o,e,"on")};var kr={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var Lr=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={};d3.behavior.drag=function(){function n(){this.on("mousedown.drag",r).on("touchstart.drag",r)}function r(){function f(){var e=n.parentNode,t=d3.event.changedTouches;return t?d3.touches(e,t)[0]:d3.mouse(e)}function l(){if(!n.parentNode)return c();var e=f(),t=e[0]-o[0],i=e[1]-o[1];u|=t|i;o=e;Q();r({type:"drag",x:e[0]+s[0],y:e[1]+s[1],dx:t,dy:i})}function c(){r({type:"dragend"});if(u){Q();if(d3.event.target===i)a.on("click.drag",h,true)}a.on("mousemove.drag",null).on("touchmove.drag",null).on("mouseup.drag",null).on("touchend.drag",null)}function h(){Q();a.on("click.drag",null)}var n=this,r=e.of(n,arguments),i=d3.event.target,s,o=f(),u=0;var a=d3.select(window).on("mousemove.drag",l).on("touchmove.drag",l).on("mouseup.drag",c,true).on("touchend.drag",c,true);if(t){s=t.apply(n,arguments);s=[s.x-o[0],s.y-o[1]]}else{s=[0,0]}Q();r({type:"dragstart"})}var e=Y(n,"drag","dragstart","dragend"),t=null;n.origin=function(e){if(!arguments.length)return t;t=e;return n};return d3.rebind(n,e,"on")};d3.behavior.zoom=function(){function c(){this.on("mousedown.zoom",g).on("mousewheel.zoom",y).on("mousemove.zoom",b).on("DOMMouseScroll.zoom",y).on("dblclick.zoom",w).on("touchstart.zoom",E).on("touchmove.zoom",S).on("touchend.zoom",E)}function h(t){return[(t[0]-e[0])/n,(t[1]-e[1])/n]}function p(t){return[t[0]*n+e[0],t[1]*n+e[1]]}function d(e){n=Math.max(i[0],Math.min(i[1],e))}function v(t,n){n=p(n);e[0]+=t[0]-n[0];e[1]+=t[1]-n[1]}function m(t){if(u)u.domain(o.range().map(function(t){return(t-e[0])/n}).map(o.invert));if(f)f.domain(a.range().map(function(t){return(t-e[1])/n}).map(a.invert));d3.event.preventDefault();t({type:"zoom",scale:n,translate:e})}function g(){function u(){r=1;v(d3.mouse(e),o);m(t)}function a(){if(r)Q();i.on("mousemove.zoom",null).on("mouseup.zoom",null);if(r&&d3.event.target===n)i.on("click.zoom",f,true)}function f(){Q();i.on("click.zoom",null)}var e=this,t=s.of(e,arguments),n=d3.event.target,r=0,i=d3.select(window).on("mousemove.zoom",u).on("mouseup.zoom",a),o=h(d3.mouse(e));window.focus();Q()}function y(){if(!t)t=h(d3.mouse(this));d(Math.pow(2,Mr()*.002)*n);v(d3.mouse(this),t);m(s.of(this,arguments))}function b(){t=null}function w(){var e=d3.mouse(this),t=h(e);d(d3.event.shiftKey?n/2:n*2);v(e,t);m(s.of(this,arguments))}function E(){var e=d3.touches(this),i=Date.now();r=n;t={};e.forEach(function(e){t[e.identifier]=h(e)});Q();if(e.length===1&&i-l<500){var o=e[0],u=h(e[0]);d(n*2);v(o,u);m(s.of(this,arguments))}l=i}function S(){var e=d3.touches(this),n=e[0],i=t[n.identifier];if(o=e[1]){var o,u=t[o.identifier];n=[(n[0]+o[0])/2,(n[1]+o[1])/2];i=[(i[0]+u[0])/2,(i[1]+u[1])/2];d(d3.event.scale*r)}v(n,i);m(s.of(this,arguments))}var e=[0,0],t,n=1,r,i=Or,s=Y(c,"zoom"),o,u,a,f,l;c.translate=function(t){if(!arguments.length)return e;e=t.map(Number);return c};c.scale=function(e){if(!arguments.length)return n;n=+e;return c};c.scaleExtent=function(e){if(!arguments.length)return i;i=e==null?Or:e.map(Number);return c};c.x=function(e){if(!arguments.length)return u;u=e;o=e.copy();return c};c.y=function(e){if(!arguments.length)return f;f=e;a=e.copy();return c};return d3.rebind(c,s,"on")};var Ar,Or=[0,Infinity];d3.layout={};d3.layout.bundle=function(){return function(e){var t=[],n=-1,r=e.length;while(++n<r)t.push(_r(e[n]));return t}};d3.layout.chord=function(){function f(){var e={},f=[],c=d3.range(i),h=[],p,d,v,m,g;t=[];n=[];p=0,m=-1;while(++m<i){d=0,g=-1;while(++g<i){d+=r[m][g]}f.push(d);h.push(d3.range(i));p+=d}if(o){c.sort(function(e,t){return o(f[e],f[t])})}if(u){h.forEach(function(e,t){e.sort(function(e,n){return u(r[t][e],r[t][n])})})}p=(2*Math.PI-s*i)/p;d=0,m=-1;while(++m<i){v=d,g=-1;while(++g<i){var y=c[m],b=h[y][g],w=r[y][b],E=d,S=d+=w*p;e[y+"-"+b]={index:y,subindex:b,startAngle:E,endAngle:S,value:w}}n[y]={index:y,startAngle:v,endAngle:d,value:(d-v)/p};d+=s}m=-1;while(++m<i){g=m-1;while(++g<i){var x=e[m+"-"+g],T=e[g+"-"+m];if(x.value||T.value){t.push(x.value<T.value?{source:T,target:x}:{source:x,target:T})}}}if(a)l()}function l(){t.sort(function(e,t){return a((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var e={},t,n,r,i,s=0,o,u,a;e.matrix=function(s){if(!arguments.length)return r;i=(r=s)&&r.length;t=n=null;return e};e.padding=function(r){if(!arguments.length)return s;s=r;t=n=null;return e};e.sortGroups=function(r){if(!arguments.length)return o;o=r;t=n=null;return e};e.sortSubgroups=function(n){if(!arguments.length)return u;u=n;t=null;return e};e.sortChords=function(n){if(!arguments.length)return a;a=n;if(t)l();return e};e.chords=function(){if(!t)f();return t};e.groups=function(){if(!n)f();return n};return e};d3.layout.force=function(){function b(e){return function(t,n,r,i,s){if(t.point!==e){var o=t.cx-e.x,u=t.cy-e.y,a=1/Math.sqrt(o*o+u*u);if((i-n)*a<l){var f=t.charge*a*a;e.px-=o*f;e.py-=u*f;return true}if(t.point&&isFinite(a)){var f=t.pointCharge*a*a;e.px-=o*f;e.py-=u*f}}return!t.charge}}function w(t){jr(Br=t);Hr=e}var e={},t=d3.dispatch("start","tick","end"),n=[1,1],r,i,s=.9,o=Ur,u=zr,a=-30,f=.1,l=.8,c,p=[],d=[],m,g,y;e.tick=function(){if((i*=.99)<.005){t.end({type:"end",alpha:i=0});return true}var e=p.length,r=d.length,o,u,l,c,h,v,w,E,S;for(u=0;u<r;++u){l=d[u];c=l.source;h=l.target;E=h.x-c.x;S=h.y-c.y;if(v=E*E+S*S){v=i*g[u]*((v=Math.sqrt(v))-m[u])/v;E*=v;S*=v;h.x-=E*(w=c.weight/(h.weight+c.weight));h.y-=S*w;c.x+=E*(w=1-w);c.y+=S*w}}if(w=i*f){E=n[0]/2;S=n[1]/2;u=-1;if(w)while(++u<e){l=p[u];l.x+=(E-l.x)*w;l.y+=(S-l.y)*w}}if(a){Rr(o=d3.geom.quadtree(p),i,y);u=-1;while(++u<e){if(!(l=p[u]).fixed){o.visit(b(l))}}}u=-1;while(++u<e){l=p[u];if(l.fixed){l.x=l.px;l.y=l.py}else{l.x-=(l.px-(l.px=l.x))*s;l.y-=(l.py-(l.py=l.y))*s}}t.tick({type:"tick",alpha:i})};e.nodes=function(t){if(!arguments.length)return p;p=t;return e};e.links=function(t){if(!arguments.length)return d;d=t;return e};e.size=function(t){if(!arguments.length)return n;n=t;return e};e.linkDistance=function(t){if(!arguments.length)return o;o=v(t);return e};e.distance=e.linkDistance;e.linkStrength=function(t){if(!arguments.length)return u;u=v(t);return e};e.friction=function(t){if(!arguments.length)return s;s=t;return e};e.charge=function(t){if(!arguments.length)return a;a=typeof t==="function"?t:+t;return e};e.gravity=function(t){if(!arguments.length)return f;f=t;return e};e.theta=function(t){if(!arguments.length)return l;l=t;return e};e.alpha=function(n){if(!arguments.length)return i;if(i){if(n>0)i=n;else i=0}else if(n>0){t.start({type:"start",alpha:i=n});d3.timer(e.tick)}return e};e.start=function(){function v(e,n){var r=b(t),i=-1,s=r.length,o;while(++i<s)if(!isNaN(o=r[i][e]))return o;return Math.random()*n}function b(){if(!c){c=[];for(r=0;r<i;++r){c[r]=[]}for(r=0;r<s;++r){var e=d[r];c[e.source.index].push(e.target);c[e.target.index].push(e.source)}}return c[t]}var t,r,i=p.length,s=d.length,f=n[0],l=n[1],c,h;for(t=0;t<i;++t){(h=p[t]).index=t;h.weight=0}m=[];g=[];for(t=0;t<s;++t){h=d[t];if(typeof h.source=="number")h.source=p[h.source];if(typeof h.target=="number")h.target=p[h.target];m[t]=o.call(this,h,t);g[t]=u.call(this,h,t);++h.source.weight;++h.target.weight}for(t=0;t<i;++t){h=p[t];if(isNaN(h.x))h.x=v("x",f);if(isNaN(h.y))h.y=v("y",l);if(isNaN(h.px))h.px=h.x;if(isNaN(h.py))h.py=h.y}y=[];if(typeof a==="function"){for(t=0;t<i;++t){y[t]=+a.call(this,p[t],t)}}else{for(t=0;t<i;++t){y[t]=a}}return e.resume()};e.resume=function(){return e.alpha(.1)};e.stop=function(){return e.alpha(0)};e.drag=function(){if(!r)r=d3.behavior.drag().origin(h).on("dragstart",w).on("drag",qr).on("dragend",Ir);this.on("mouseover.force",jr).on("mouseout.force",Fr).call(r)};return d3.rebind(e,t,"on")};var Hr,Br;d3.layout.partition=function(){function n(e,t,r,i){var s=e.children;e.x=t;e.y=e.depth*i;e.dx=r;e.dy=i;if(s&&(u=s.length)){var o=-1,u,a,f;r=e.value?r/e.value:0;while(++o<u){n(a=s[o],t,f=a.value*r,i);t+=f}}}function r(e){var t=e.children,n=0;if(t&&(s=t.length)){var i=-1,s;while(++i<s)n=Math.max(n,r(t[i]))}return 1+n}function i(i,s){var o=e.call(this,i,s);n(o[0],0,t[0],t[1]/r(o[0]));return o}var e=d3.layout.hierarchy(),t=[1,1];i.size=function(e){if(!arguments.length)return t;t=e;return i};return ii(i,e)};d3.layout.pie=function(){function i(s,o){var u=s.map(function(t,n){return+e.call(i,t,n)});var a=+(typeof n==="function"?n.apply(this,arguments):n);var f=((typeof r==="function"?r.apply(this,arguments):r)-n)/d3.sum(u);var l=d3.range(s.length);if(t!=null)l.sort(t===Wr?function(e,t){return u[t]-u[e]}:function(e,n){return t(s[e],s[n])});var c=[];l.forEach(function(e){var t;c[e]={data:s[e],value:t=u[e],startAngle:a,endAngle:a+=t*f}});return c}var e=Number,t=Wr,n=0,r=2*Math.PI;i.value=function(t){if(!arguments.length)return e;e=t;return i};i.sort=function(e){if(!arguments.length)return t;t=e;return i};i.startAngle=function(e){if(!arguments.length)return n;n=e;return i};i.endAngle=function(e){if(!arguments.length)return r;r=e;return i};return i};var Wr={};d3.layout.stack=function(){function o(u,a){var f=u.map(function(t,n){return e.call(o,t,n)});var l=f.map(function(e,t){return e.map(function(e,t){return[i.call(o,e,t),s.call(o,e,t)]})});var c=t.call(o,l,a);f=d3.permute(f,c);l=d3.permute(l,c);var h=n.call(o,l,a);var p=f.length,d=f[0].length,v,m,g;for(m=0;m<d;++m){r.call(o,f[0][m],g=h[m],l[0][m][1]);for(v=1;v<p;++v){r.call(o,f[v][m],g+=l[v-1][m][1],l[v][m][1])}}return u}var e=h,t=Qr,n=Gr,r=$r,i=Xr,s=Vr;o.values=function(t){if(!arguments.length)return e;e=t;return o};o.order=function(e){if(!arguments.length)return t;t=typeof e==="function"?e:Jr.get(e)||Qr;return o};o.offset=function(e){if(!arguments.length)return n;n=typeof e==="function"?e:Kr.get(e)||Gr;return o};o.x=function(e){if(!arguments.length)return i;i=e;return o};o.y=function(e){if(!arguments.length)return s;s=e;return o};o.out=function(e){if(!arguments.length)return r;r=e;return o};return o};var Jr=d3.map({"inside-out":function(e){var t=e.length,n,r,i=e.map(Yr),s=e.map(Zr),o=d3.range(t).sort(function(e,t){return i[e]-i[t]}),u=0,a=0,f=[],l=[];for(n=0;n<t;++n){r=o[n];if(u<a){u+=s[r];f.push(r)}else{a+=s[r];l.push(r)}}return l.reverse().concat(f)},reverse:function(e){return d3.range(e.length).reverse()},"default":Qr});var Kr=d3.map({silhouette:function(e){var t=e.length,n=e[0].length,r=[],i=0,s,o,u,a=[];for(o=0;o<n;++o){for(s=0,u=0;s<t;s++)u+=e[s][o][1];if(u>i)i=u;r.push(u)}for(o=0;o<n;++o){a[o]=(i-r[o])/2}return a},wiggle:function(e){var t=e.length,n=e[0],r=n.length,i=0,s,o,u,a,f,l,c,h,p,d=[];d[0]=h=p=0;for(o=1;o<r;++o){for(s=0,a=0;s<t;++s)a+=e[s][o][1];for(s=0,f=0,c=n[o][0]-n[o-1][0];s<t;++s){for(u=0,l=(e[s][o][1]-e[s][o-1][1])/(2*c);u<s;++u){l+=(e[u][o][1]-e[u][o-1][1])/c}f+=l*e[s][o][1]}d[o]=h-=a?f/a*c:0;if(h<p)p=h}for(o=0;o<r;++o)d[o]-=p;return d},expand:function(e){var t=e.length,n=e[0].length,r=1/t,i,s,o,u=[];for(s=0;s<n;++s){for(i=0,o=0;i<t;i++)o+=e[i][s][1];if(o)for(i=0;i<t;i++)e[i][s][1]/=o;else for(i=0;i<t;i++)e[i][s][1]=r}for(s=0;s<n;++s)u[s]=0;return u},zero:Gr});d3.layout.histogram=function(){function i(i,s){var o=[],u=i.map(t,this),a=n.call(this,u,s),f=r.call(this,a,u,s),l,s=-1,c=u.length,h=f.length-1,p=e?1:1/c,d;while(++s<h){l=o[s]=[];l.dx=f[s+1]-(l.x=f[s]);l.y=0}if(h>0){s=-1;while(++s<c){d=u[s];if(d>=a[0]&&d<=a[1]){l=o[d3.bisect(f,d,1,h)-1];l.y+=p;l.push(i[s])}}}return o}var e=true,t=Number,n=ri,r=ti;i.value=function(e){if(!arguments.length)return t;t=e;return i};i.range=function(e){if(!arguments.length)return n;n=v(e);return i};i.bins=function(e){if(!arguments.length)return r;r=typeof e==="number"?function(t){return ni(t,e)}:v(e);return i};i.frequency=function(t){if(!arguments.length)return e;e=!!t;return i};return i};d3.layout.hierarchy=function(){function r(i,o,u){var a=t.call(s,i,o),f=fi?i:{data:i};f.depth=o;u.push(f);if(a&&(c=a.length)){var l=-1,c,h=f.children=[],p=0,d=o+1,v;while(++l<c){v=r(a[l],d,u);v.parent=f;h.push(v);p+=v.value}if(e)h.sort(e);if(n)f.value=p}else if(n){f.value=+n.call(s,i,o)||0}return f}function i(e,t){var r=e.children,o=0;if(r&&(a=r.length)){var u=-1,a,f=t+1;while(++u<a)o+=i(r[u],f)}else if(n){o=+n.call(s,fi?e:e.data,t)||0}if(n)e.value=o;return o}function s(e){var t=[];r(e,0,t);return t}var e=ui,t=si,n=oi;s.sort=function(t){if(!arguments.length)return e;e=t;return s};s.children=function(e){if(!arguments.length)return t;t=e;return s};s.value=function(e){if(!arguments.length)return n;n=e;return s};s.revalue=function(e){i(e,0);return e};return s};var fi=false;d3.layout.pack=function(){function n(n,r){var i=e.call(this,n,r),s=i[0];s.x=0;s.y=0;gi(s);var o=t[0],u=t[1],a=1/Math.max(2*s.r/o,2*s.r/u);yi(s,o/2,u/2,a);return i}var e=d3.layout.hierarchy().sort(li),t=[1,1];n.size=function(e){if(!arguments.length)return t;t=e;return n};return ii(n,e)};d3.layout.cluster=function(){function r(r,i){var s=e.call(this,r,i),o=s[0],u,a=0,f,l;Mi(o,function(e){var n=e.children;if(n&&n.length){e.x=Ei(n);e.y=wi(n)}else{e.x=u?a+=t(e,u):0;e.y=0;u=e}});var c=Si(o),h=xi(o),p=c.x-t(c,h)/2,d=h.x+t(h,c)/2;Mi(o,function(e){e.x=(e.x-p)/(d-p)*n[0];e.y=(1-(o.y?e.y/o.y:1))*n[1]});return s}var e=d3.layout.hierarchy().sort(null).value(null),t=Ti,n=[1,1];r.separation=function(e){if(!arguments.length)return t;t=e;return r};r.size=function(e){if(!arguments.length)return n;n=e;return r};return ii(r,e)};d3.layout.tree=function(){function r(r,i){function u(e,n){var r=e.children,i=e._tree;if(r&&(s=r.length)){var s,o=r[0],a,l=o,c,h=-1;while(++h<s){c=r[h];u(c,a);l=f(c,a,l);a=c}_i(e);var p=.5*(o._tree.prelim+c._tree.prelim);if(n){i.prelim=n._tree.prelim+t(e,n);i.mod=i.prelim-p}else{i.prelim=p}}else{if(n){i.prelim=n._tree.prelim+t(e,n)}}}function a(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var r=-1,i;t+=e._tree.mod;while(++r<i){a(n[r],t)}}}function f(e,n,r){if(n){var i=e,s=e,o=n,u=e.parent.children[0],a=i._tree.mod,f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h;while(o=Ci(o),i=Ni(i),o&&i){u=Ni(u);s=Ci(s);s._tree.ancestor=e;h=o._tree.prelim+l-i._tree.prelim-a+t(o,i);if(h>0){Di(Pi(o,e,r),e,h);a+=h;f+=h}l+=o._tree.mod;a+=i._tree.mod;c+=u._tree.mod;f+=s._tree.mod}if(o&&!Ci(s)){s._tree.thread=o;s._tree.mod+=l-f}if(i&&!Ni(u)){u._tree.thread=i;u._tree.mod+=a-c;r=e}}return r}var s=e.call(this,r,i),o=s[0];Mi(o,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}});u(o);a(o,-o._tree.prelim);var l=ki(o,Ai),c=ki(o,Li),h=ki(o,Oi),p=l.x-t(l,c)/2,d=c.x+t(c,l)/2,v=h.depth||1;Mi(o,function(e){e.x=(e.x-p)/(d-p)*n[0];e.y=e.depth/v*n[1];delete e._tree});return s}var e=d3.layout.hierarchy().sort(null).value(null),t=Ti,n=[1,1];r.separation=function(e){if(!arguments.length)return t;t=e;return r};r.size=function(e){if(!arguments.length)return n;n=e;return r};return ii(r,e)};d3.layout.treemap=function(){function a(e,t){var n=-1,r=e.length,i,s;while(++n<r){s=(i=e[n]).value*(t<0?0:t);i.area=isNaN(s)||s<=0?0:s}}function f(e){var t=e.children;if(t&&t.length){var n=i(e),r=[],s=t.slice(),o,u=Infinity,l,p=Math.min(n.dx,n.dy),d;a(s,n.dx*n.dy/e.value);r.area=0;while((d=s.length)>0){r.push(o=s[d-1]);r.area+=o.area;if((l=c(r,p))<=u){s.pop();u=l}else{r.area-=r.pop().area;h(r,p,n,false);p=Math.min(n.dx,n.dy);r.length=r.area=0;u=Infinity}}if(r.length){h(r,p,n,true);r.length=r.area=0}t.forEach(f)}}function l(e){var t=e.children;if(t&&t.length){var n=i(e),r=t.slice(),s,o=[];a(r,n.dx*n.dy/e.value);o.area=0;while(s=r.pop()){o.push(s);o.area+=s.area;if(s.z!=null){h(o,s.z?n.dx:n.dy,n,!r.length);o.length=o.area=0}}t.forEach(l)}}function c(e,t){var n=e.area,r,i=0,s=Infinity,o=-1,a=e.length;while(++o<a){if(!(r=e[o].area))continue;if(r<s)s=r;if(r>i)i=r}n*=n;t*=t;return n?Math.max(t*i*u/n,n/(t*s*u)):Infinity}function h(e,n,r,i){var s=-1,o=e.length,u=r.x,a=r.y,f=n?t(e.area/n):0,l;if(n==r.dx){if(i||f>r.dy)f=r.dy;while(++s<o){l=e[s];l.x=u;l.y=a;l.dy=f;u+=l.dx=Math.min(r.x+r.dx-u,f?t(l.area/f):0)}l.z=true;l.dx+=r.x+r.dx-u;r.y+=f;r.dy-=f}else{if(i||f>r.dx)f=r.dx;while(++s<o){l=e[s];l.x=u;l.y=a;l.dx=f;a+=l.dy=Math.min(r.y+r.dy-a,f?t(l.area/f):0)}l.z=false;l.dy+=r.y+r.dy-a;r.x+=f;r.dx-=f}}function p(t){var r=o||e(t),i=r[0];i.x=0;i.y=0;i.dx=n[0];i.dy=n[1];if(o)e.revalue(i);a([i],i.dx*i.dy/i.value);(o?l:f)(i);if(s)o=r;return r}var e=d3.layout.hierarchy(),t=Math.round,n=[1,1],r=null,i=Hi,s=false,o,u=.5*(1+Math.sqrt(5));p.size=function(e){if(!arguments.length)return n;n=e;return p};p.padding=function(e){function t(t){var n=e.call(p,t,t.depth);return n==null?Hi(t):Bi(t,typeof n==="number"?[n,n,n,n]:n)}function n(t){return Bi(t,e)}if(!arguments.length)return r;var s;i=(r=e)==null?Hi:(s=typeof e)==="function"?t:s==="number"?(e=[e,e,e,e],n):n;return p};p.round=function(e){if(!arguments.length)return t!=Number;t=e?Math.round:Number;return p};p.sticky=function(e){if(!arguments.length)return s;s=e;o=null;return p};p.ratio=function(e){if(!arguments.length)return u;u=e;return p};return ii(p,e)};d3.csv=function(e,t){d3.text(e,"text/csv",function(e){t(e&&d3.csv.parse(e))})};d3.csv.parse=function(e){var t;return d3.csv.parseRows(e,function(e,n){if(n){var r={},i=-1,s=t.length;while(++i<s)r[t[i]]=e[i];return r}else{t=e;return null}})};d3.csv.parseRows=function(e,t){function f(){if(s.lastIndex>=e.length)return r;if(a){a=false;return n}var t=s.lastIndex;if(e.charCodeAt(t)===34){var i=t;while(i++<e.length){if(e.charCodeAt(i)===34){if(e.charCodeAt(i+1)!==34)break;i++}}s.lastIndex=i+2;var o=e.charCodeAt(i+1);if(o===13){a=true;if(e.charCodeAt(i+2)===10)s.lastIndex++}else if(o===10){a=true}return e.substring(t+1,i).replace(/""/g,'"')}var u=s.exec(e);if(u){a=u[0].charCodeAt(0)!==44;return e.substring(t,u.index)}s.lastIndex=e.length;return e.substring(t)}var n={},r={},i=[],s=/\r\n|[,\r\n]/g,o=0,u,a;s.lastIndex=0;while((u=f())!==r){var l=[];while(u!==n&&u!==r){l.push(u);u=f()}if(t&&!(l=t(l,o++)))continue;i.push(l)}return i};d3.csv.format=function(e){return e.map(ji).join("\n")};d3.geo={};var Ii=Math.PI/180;d3.geo.azimuthal=function(){function a(t){var s=t[0]*Ii-i,a=t[1]*Ii,f=Math.cos(s),l=Math.sin(s),c=Math.cos(a),h=Math.sin(a),p=e!=="orthographic"?u*h+o*c*f:null,d,v=e==="stereographic"?1/(1+p):e==="gnomonic"?1/p:e==="equidistant"?(d=Math.acos(p),d?d/Math.sin(d):0):e==="equalarea"?Math.sqrt(2/(1+p)):1,m=v*c*l,g=v*(u*c*f-o*h);return[n*m+r[0],n*g+r[1]]}var e="orthographic",t,n=200,r=[480,250],i,s,o,u;a.invert=function(t){var s=(t[0]-r[0])/n,a=(t[1]-r[1])/n,f=Math.sqrt(s*s+a*a),l=e==="stereographic"?2*Math.atan(f):e==="gnomonic"?Math.atan(f):e==="equidistant"?f:e==="equalarea"?2*Math.asin(.5*f):Math.asin(f),c=Math.sin(l),h=Math.cos(l);return[(i+Math.atan2(s*c,f*o*h+a*u*c))/Ii,Math.asin(h*u-(f?a*c*o/f:0))/Ii]};a.mode=function(t){if(!arguments.length)return e;e=t+"";return a};a.origin=function(e){if(!arguments.length)return t;t=e;i=t[0]*Ii;s=t[1]*Ii;o=Math.cos(s);u=Math.sin(s);return a};a.scale=function(e){if(!arguments.length)return n;n=+e;return a};a.translate=function(e){if(!arguments.length)return r;r=[+e[0],+e[1]];return a};return a.origin([0,0])};d3.geo.albers=function(){function a(e){var t=s*(Ii*e[0]-i),a=Math.sqrt(o-2*s*Math.sin(Ii*e[1]))/s;return[n*a*Math.sin(t)+r[0],n*(a*Math.cos(t)-u)+r[1]]}function f(){var n=Ii*t[0],r=Ii*t[1],f=Ii*e[1],l=Math.sin(n),c=Math.cos(n);i=Ii*e[0];s=.5*(l+Math.sin(r));o=c*c+2*s*l;u=Math.sqrt(o-2*s*Math.sin(f))/s;return a}var e=[-98,38],t=[29.5,45.5],n=1e3,r=[480,250],i,s,o,u;a.invert=function(e){var t=(e[0]-r[0])/n,a=(e[1]-r[1])/n,f=u+a,l=Math.atan2(t,f),c=Math.sqrt(t*t+f*f);return[(i+l/s)/Ii,Math.asin((o-c*c*s*s)/(2*s))/Ii]};a.origin=function(t){if(!arguments.length)return e;e=[+t[0],+t[1]];return f()};a.parallels=function(e){if(!arguments.length)return t;t=[+e[0],+e[1]];return f()};a.scale=function(e){if(!arguments.length)return n;n=+e;return a};a.translate=function(e){if(!arguments.length)return r;r=[+e[0],+e[1]];return a};return f()};d3.geo.albersUsa=function(){function i(i){var s=i[0],o=i[1];return(o>50?t:s<-140?n:o<21?r:e)(i)}var e=d3.geo.albers();var t=d3.geo.albers().origin([-160,60]).parallels([55,65]);var n=d3.geo.albers().origin([-160,20]).parallels([8,18]);var r=d3.geo.albers().origin([-60,10]).parallels([8,18]);i.scale=function(s){if(!arguments.length)return e.scale();e.scale(s);t.scale(s*.6);n.scale(s);r.scale(s*1.5);return i.translate(e.translate())};i.translate=function(s){if(!arguments.length)return e.translate();var o=e.scale()/1e3,u=s[0],a=s[1];e.translate(s);t.translate([u-400*o,a+170*o]);n.translate([u-190*o,a+200*o]);r.translate([u+580*o,a+430*o]);return i};return i.scale(e.scale())};d3.geo.bonne=function(){function o(o){var u=o[0]*Ii-n,a=o[1]*Ii-r;if(i){var f=s+i-a,l=u*Math.cos(a)/f;u=f*Math.sin(l);a=f*Math.cos(l)-s}else{u*=Math.cos(a);a*=-1}return[e*u+t[0],e*a+t[1]]}var e=200,t=[480,250],n,r,i,s;o.invert=function(r){var o=(r[0]-t[0])/e,u=(r[1]-t[1])/e;if(i){var a=s+u,f=Math.sqrt(o*o+a*a);u=s+i-f;o=n+f*Math.atan2(o,a)/Math.cos(u)}else{u*=-1;o/=Math.cos(u)}return[o/Ii,u/Ii]};o.parallel=function(e){if(!arguments.length)return i/Ii;s=1/Math.tan(i=e*Ii);return o};o.origin=function(e){if(!arguments.length)return[n/Ii,r/Ii];n=e[0]*Ii;r=e[1]*Ii;return o};o.scale=function(t){if(!arguments.length)return e;e=+t;return o};o.translate=function(e){if(!arguments.length)return t;t=[+e[0],+e[1]];return o};return o.origin([0,0]).parallel(45)};d3.geo.equirectangular=function(){function n(n){var r=n[0]/360,i=-n[1]/360;return[e*r+t[0],e*i+t[1]]}var e=500,t=[480,250];n.invert=function(n){var r=(n[0]-t[0])/e,i=(n[1]-t[1])/e;return[360*r,-360*i]};n.scale=function(t){if(!arguments.length)return e;e=+t;return n};n.translate=function(e){if(!arguments.length)return t;t=[+e[0],+e[1]];return n};return n};d3.geo.mercator=function(){function n(n){var r=n[0]/360,i=-(Math.log(Math.tan(Math.PI/4+n[1]*Ii/2))/Ii)/360;return[e*r+t[0],e*Math.max(-.5,Math.min(.5,i))+t[1]]}var e=500,t=[480,250];n.invert=function(n){var r=(n[0]-t[0])/e,i=(n[1]-t[1])/e;return[360*r,2*Math.atan(Math.exp(-360*i*Ii))/Ii-90]};n.scale=function(t){if(!arguments.length)return e;e=+t;return n};n.translate=function(e){if(!arguments.length)return t;t=[+e[0],+e[1]];return n};return n};d3.geo.path=function(){function i(n,i){if(typeof e==="function")t=Ri(e.apply(this,arguments));o(n);var s=r.length?r.join(""):null;r=[];return s}function s(e){return n(e).join(",")}function a(e){var t=c(e[0]),n=0,r=e.length;while(++n<r)t-=c(e[n]);return t}function f(e){var t=d3.geom.polygon(e[0].map(n)),r=t.area(),i=t.centroid(r<0?(r*=-1,1):-1),s=i[0],o=i[1],u=r,a=0,f=e.length;while(++a<f){t=d3.geom.polygon(e[a].map(n));r=t.area();i=t.centroid(r<0?(r*=-1,1):-1);s-=i[0];o-=i[1];u-=r}return[s,o,6*u]}function c(e){return Math.abs(d3.geom.polygon(e.map(n)).area())}var e=4.5,t=Ri(e),n=d3.geo.albersUsa(),r=[];var o=qi({FeatureCollection:function(e){var t=e.features,n=-1,i=t.length;while(++n<i)r.push(o(t[n].geometry))},Feature:function(e){o(e.geometry)},Point:function(e){r.push("M",s(e.coordinates),t)},MultiPoint:function(e){var n=e.coordinates,i=-1,o=n.length;while(++i<o)r.push("M",s(n[i]),t)},LineString:function(e){var t=e.coordinates,n=-1,i=t.length;r.push("M");while(++n<i)r.push(s(t[n]),"L");r.pop()},MultiLineString:function(e){var t=e.coordinates,n=-1,i=t.length,o,u,a;while(++n<i){o=t[n];u=-1;a=o.length;r.push("M");while(++u<a)r.push(s(o[u]),"L");r.pop()}},Polygon:function(e){var t=e.coordinates,n=-1,i=t.length,o,u,a;while(++n<i){o=t[n];u=-1;if((a=o.length-1)>0){r.push("M");while(++u<a)r.push(s(o[u]),"L");r[r.length-1]="Z"}}},MultiPolygon:function(e){var t=e.coordinates,n=-1,i=t.length,o,u,a,f,l,c;while(++n<i){o=t[n];u=-1;a=o.length;while(++u<a){f=o[u];l=-1;if((c=f.length-1)>0){r.push("M");while(++l<c)r.push(s(f[l]),"L");r[r.length-1]="Z"}}}},GeometryCollection:function(e){var t=e.geometries,n=-1,i=t.length;while(++n<i)r.push(o(t[n]))}});var u=i.area=qi({FeatureCollection:function(e){var t=0,n=e.features,r=-1,i=n.length;while(++r<i)t+=u(n[r]);return t},Feature:function(e){return u(e.geometry)},Polygon:function(e){return a(e.coordinates)},MultiPolygon:function(e){var t=0,n=e.coordinates,r=-1,i=n.length;while(++r<i)t+=a(n[r]);return t},GeometryCollection:function(e){var t=0,n=e.geometries,r=-1,i=n.length;while(++r<i)t+=u(n[r]);return t}},0);var l=i.centroid=qi({Feature:function(e){return l(e.geometry)},Polygon:function(e){var t=f(e.coordinates);return[t[0]/t[2],t[1]/t[2]]},MultiPolygon:function(e){var t=0,n=e.coordinates,r,i=0,s=0,o=0,u=-1,a=n.length;while(++u<a){r=f(n[u]);i+=r[0];s+=r[1];o+=r[2]}return[i/o,s/o]}});i.projection=function(e){n=e;return i};i.pointRadius=function(n){if(typeof n==="function")e=n;else{e=+n;t=Ri(e)}return i};return i};d3.geo.bounds=function(e){var t=Infinity,n=Infinity,r=-Infinity,i=-Infinity;Ui(e,function(e,s){if(e<t)t=e;if(e>r)r=e;if(s<n)n=s;if(s>i)i=s});return[[t,n],[r,i]]};var zi={Feature:Wi,FeatureCollection:Xi,GeometryCollection:Vi,LineString:$i,MultiLineString:Ji,MultiPoint:$i,MultiPolygon:Ki,Point:Qi,Polygon:Gi};d3.geo.circle=function(){function i(){}function s(e){return r.distance(e)<n}function u(e){var t=-1,i=e.length,s=[],o,u,f,l,c;while(++t<i){c=r.distance(f=e[t]);if(c<n){if(u)s.push(ts(u,f)((l-n)/(l-c)));s.push(f);o=u=null}else{u=f;if(!o&&s.length){s.push(ts(s[s.length-1],u)((n-l)/(c-l)));o=u}}l=c}o=e[0];u=s[0];if(u&&f[0]===o[0]&&f[1]===o[1]&&!(f[0]===u[0]&&f[1]===u[1])){s.push(u)}return a(s)}function a(e){var t=0,n=e.length,i,s,o=n?[e[0]]:e,u,a=r.source();while(++t<n){u=r.source(e[t-1])(e[t]).coordinates;for(i=0,s=u.length;++i<s;)o.push(u[i])}r.source(a);return o}var e=[0,0],t=90-.01,n=t*Ii,r=d3.geo.greatArc().source(e).target(h);i.clip=function(t){if(typeof e==="function")r.source(e.apply(this,arguments));return o(t)||null};var o=qi({FeatureCollection:function(e){var t=e.features.map(o).filter(h);return t&&(e=Object.create(e),e.features=t,e)},Feature:function(e){var t=o(e.geometry);return t&&(e=Object.create(e),e.geometry=t,e)},Point:function(e){return s(e.coordinates)&&e},MultiPoint:function(e){var t=e.coordinates.filter(s);return t.length&&{type:e.type,coordinates:t}},LineString:function(e){var t=u(e.coordinates);return t.length&&(e=Object.create(e),e.coordinates=t,e)},MultiLineString:function(e){var t=e.coordinates.map(u).filter(function(e){return e.length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},Polygon:function(e){var t=e.coordinates.map(u);return t[0].length&&(e=Object.create(e),e.coordinates=t,e)},MultiPolygon:function(e){var t=e.coordinates.map(function(e){return e.map(u)}).filter(function(e){return e[0].length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},GeometryCollection:function(e){var t=e.geometries.map(o).filter(h);return t.length&&(e=Object.create(e),e.geometries=t,e)}});i.origin=function(t){if(!arguments.length)return e;e=t;if(typeof e!=="function")r.source(e);return i};i.angle=function(e){if(!arguments.length)return t;n=(t=+e)*Ii;return i};return d3.rebind(i,r,"precision")};d3.geo.greatArc=function(){function o(){var e=o.distance.apply(this,arguments),n=0,u=i/e,a=[t];while((n+=u)<1)a.push(s(n));a.push(r);return{type:"LineString",coordinates:a}}var e=Yi,t,n=Zi,r,i=6*Ii,s=es();o.distance=function(){if(typeof e==="function")s.source(t=e.apply(this,arguments));if(typeof n==="function")s.target(r=n.apply(this,arguments));return s.distance()};o.source=function(n){if(!arguments.length)return e;e=n;if(typeof e!=="function")s.source(t=e);return o};o.target=function(e){if(!arguments.length)return n;n=e;if(typeof n!=="function")s.target(r=n);return o};o.precision=function(e){if(!arguments.length)return i/Ii;i=e*Ii;return o};return o};d3.geo.greatCircle=d3.geo.circle;d3.geom={};d3.geom.contour=function(e,t){var n=t||is(e),r=[],i=n[0],s=n[1],o=0,u=0,a=NaN,f=NaN,l=0;do{l=0;if(e(i-1,s-1))l+=1;if(e(i,s-1))l+=2;if(e(i-1,s))l+=4;if(e(i,s))l+=8;if(l===6){o=f===-1?-1:1;u=0}else if(l===9){o=0;u=a===1?-1:1}else{o=ns[l];u=rs[l]}if(o!=a&&u!=f){r.push([i,s]);a=o;f=u}i+=o;s+=u}while(n[0]!=i||n[1]!=s);return r};var ns=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],rs=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];d3.geom.hull=function(e){if(e.length<3)return[];var t=e.length,n=t-1,r=[],i=[],s,o,u=0,a,f,l,c,h,p,d,v;for(s=1;s<t;++s){if(e[s][1]<e[u][1]){u=s}else if(e[s][1]==e[u][1]){u=e[s][0]<e[u][0]?s:u}}for(s=0;s<t;++s){if(s===u)continue;f=e[s][1]-e[u][1];a=e[s][0]-e[u][0];r.push({angle:Math.atan2(f,a),index:s})}r.sort(function(e,t){return e.angle-t.angle});d=r[0].angle;p=r[0].index;h=0;for(s=1;s<n;++s){o=r[s].index;if(d==r[s].angle){a=e[p][0]-e[u][0];f=e[p][1]-e[u][1];l=e[o][0]-e[u][0];c=e[o][1]-e[u][1];if(a*a+f*f>=l*l+c*c){r[s].index=-1}else{r[h].index=-1;d=r[s].angle;h=s;p=o}}else{d=r[s].angle;h=s;p=o}}i.push(u);for(s=0,o=0;s<2;++o){if(r[o].index!==-1){i.push(r[o].index);s++}}v=i.length;for(;o<n;++o){if(r[o].index===-1)continue;while(!ss(i[v-2],i[v-1],r[o].index,e)){--v}i[v++]=r[o].index}var m=[];for(s=0;s<v;++s){m.push(e[i[s]])}return m};d3.geom.polygon=function(e){e.area=function(){var t=0,n=e.length,r=e[n-1][0]*e[0][1],i=e[n-1][1]*e[0][0];while(++t<n){r+=e[t-1][0]*e[t][1];i+=e[t-1][1]*e[t][0]}return(i-r)*.5};e.centroid=function(t){var n=-1,r=e.length,i=0,s=0,o,u=e[r-1],a;if(!arguments.length)t=-1/(6*e.area());while(++n<r){o=u;u=e[n];a=o[0]*u[1]-u[0]*o[1];i+=(o[0]+u[0])*a;s+=(o[1]+u[1])*a}return[i*t,s*t]};e.clip=function(t){var n,r=-1,i=e.length,s,o,u=e[i-1],a,f,l;while(++r<i){n=t.slice();t.length=0;a=e[r];f=n[(o=n.length)-1];s=-1;while(++s<o){l=n[s];if(os(l,u,a)){if(!os(f,u,a)){t.push(us(f,l,u,a))}t.push(l)}else if(os(f,u,a)){t.push(us(f,l,u,a))}f=l}u=a}return t};return e};d3.geom.voronoi=function(e){var t=e.map(function(){return[]});fs(e,function(e){var n,r,i,s,o,u;if(e.a===1&&e.b>=0){n=e.ep.r;r=e.ep.l}else{n=e.ep.l;r=e.ep.r}if(e.a===1){o=n?n.y:-1e6;i=e.c-e.b*o;u=r?r.y:1e6;s=e.c-e.b*u}else{i=n?n.x:-1e6;o=e.c-e.a*i;s=r?r.x:1e6;u=e.c-e.a*s}var a=[i,o],f=[s,u];t[e.region.l.index].push(a,f);t[e.region.r.index].push(a,f)});return t.map(function(t,n){var r=e[n][0],i=e[n][1];t.forEach(function(e){e.angle=Math.atan2(e[0]-r,e[1]-i)});return t.sort(function(e,t){return e.angle-t.angle}).filter(function(e,n){return!n||e.angle-t[n-1].angle>1e-10})})};var as={l:"r",r:"l"};d3.geom.delaunay=function(e){var t=e.map(function(){return[]}),n=[];fs(e,function(n){t[n.region.l.index].push(e[n.region.r.index])});t.forEach(function(t,r){var i=e[r],s=i[0],o=i[1];t.forEach(function(e){e.angle=Math.atan2(e[0]-s,e[1]-o)});t.sort(function(e,t){return e.angle-t.angle});for(var u=0,a=t.length-1;u<a;u++){n.push([i,t[u],t[u+1]])}});return n};d3.geom.quadtree=function(e,t,n,r,i){function l(e,t,n,r,i,s){if(isNaN(t.x)||isNaN(t.y))return;if(e.leaf){var o=e.point;if(o){if(Math.abs(o.x-t.x)+Math.abs(o.y-t.y)<.01){c(e,t,n,r,i,s)}else{e.point=null;c(e,o,n,r,i,s);c(e,t,n,r,i,s)}}else{e.point=t}}else{c(e,t,n,r,i,s)}}function c(e,t,n,r,i,s){var o=(n+i)*.5,u=(r+s)*.5,a=t.x>=o,f=t.y>=u,c=(f<<1)+a;e.leaf=false;e=e.nodes[c]||(e.nodes[c]=ls());if(a)n=o;else i=o;if(f)r=u;else s=u;l(e,t,n,r,i,s)}var s,o=-1,u=e.length;if(u&&isNaN(e[0].x))e=e.map(hs);if(arguments.length<5){if(arguments.length===3){i=r=n;n=t}else{t=n=Infinity;r=i=-Infinity;while(++o<u){s=e[o];if(s.x<t)t=s.x;if(s.y<n)n=s.y;if(s.x>r)r=s.x;if(s.y>i)i=s.y}var a=r-t,f=i-n;if(a>f)i=n+a;else r=t+f}}var h=ls();h.add=function(e){l(h,e,t,n,r,i)};h.visit=function(e){cs(e,h,t,n,r,i)};e.forEach(h.add);return h};d3.time={};var ps=Date;ds.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){vs.setUTCDate.apply(this._,arguments)},setDay:function(){vs.setUTCDay.apply(this._,arguments)},setFullYear:function(){vs.setUTCFullYear.apply(this._,arguments)},setHours:function(){vs.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){vs.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){vs.setUTCMinutes.apply(this._,arguments)},setMonth:function(){vs.setUTCMonth.apply(this._,arguments)},setSeconds:function(){vs.setUTCSeconds.apply(this._,arguments)},setTime:function(){vs.setTime.apply(this._,arguments)}};var vs=Date.prototype;d3.time.format=function(e){function n(n){var r=[],i=-1,s=0,o,u;while(++i<t){if(e.charCodeAt(i)==37){r.push(e.substring(s,i),(u=Es[o=e.charAt(++i)])?u(n):o);s=i+1}}r.push(e.substring(s,i));return r.join("")}var t=e.length;n.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},r=ms(n,e,t,0);if(r!=t.length)return null;if("p"in n)n.H=n.H%12+n.p*12;var i=new ps;i.setFullYear(n.y,n.m,n.d);i.setHours(n.H,n.M,n.S,n.L);return i};n.toString=function(){return e};return n};var gs=d3.format("02d"),ys=d3.format("03d"),bs=d3.format("04d"),ws=d3.format("2d");var Es={a:function(e){return ks[e.getDay()].substring(0,3)},A:function(e){return ks[e.getDay()]},b:function(e){return Ds[e.getMonth()].substring(0,3)},B:function(e){return Ds[e.getMonth()]},c:d3.time.format("%a %b %e %H:%M:%S %Y"),d:function(e){return gs(e.getDate())},e:function(e){return ws(e.getDate())},H:function(e){return gs(e.getHours())},I:function(e){return gs(e.getHours()%12||12)},j:function(e){return ys(1+d3.time.dayOfYear(e))},L:function(e){return ys(e.getMilliseconds())},m:function(e){return gs(e.getMonth()+1)},M:function(e){return gs(e.getMinutes())},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e){return gs(e.getSeconds())},U:function(e){return gs(d3.time.sundayOfYear(e))},w:function(e){return e.getDay()},W:function(e){return gs(d3.time.mondayOfYear(e))},x:d3.time.format("%m/%d/%y"),X:d3.time.format("%H:%M:%S"),y:function(e){return gs(e.getFullYear()%100)},Y:function(e){return bs(e.getFullYear()%1e4)},Z:Ks,"%":function(e){return"%"}};var Ss={a:xs,A:Ts,b:Ls,B:Os,c:Ps,d:Rs,e:Rs,H:Us,I:Us,L:Xs,m:qs,M:zs,p:$s,S:Ws,x:Hs,X:Bs,y:Fs,Y:js};var Ns=/^(?:sun|mon|tue|wed|thu|fri|sat)/i,Cs=/^(?:Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i,ks=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var As=d3.map({jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11});var Ms=/^(?:January|February|March|April|May|June|July|August|September|October|November|December)/ig;var _s=d3.map({january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11});var Ds=["January","February","March","April","May","June","July","August","September","October","November","December"];var Vs=/\s*\d+/;var Js=d3.map({am:0,pm:1});d3.time.format.utc=function(e){function n(e){try{ps=ds;var n=new ps;n._=e;return t(n)}finally{ps=Date}}var t=d3.time.format(e);n.parse=function(e){try{ps=ds;var n=t.parse(e);return n&&n._}finally{ps=Date}};n.toString=t.toString;return n};var Qs=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?Gs:Qs;Gs.parse=function(e){var t=new Date(e);return isNaN(t)?null:t};Gs.toString=Qs.toString;d3.time.second=Ys(function(e){return new ps(Math.floor(e/1e3)*1e3)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*1e3)},function(e){return e.getSeconds()});d3.time.seconds=d3.time.second.range;d3.time.seconds.utc=d3.time.second.utc.range;d3.time.minute=Ys(function(e){return new ps(Math.floor(e/6e4)*6e4)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*6e4)},function(e){return e.getMinutes()});d3.time.minutes=d3.time.minute.range;d3.time.minutes.utc=d3.time.minute.utc.range;d3.time.hour=Ys(function(e){var t=e.getTimezoneOffset()/60;return new ps((Math.floor(e/36e5-t)+t)*36e5)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*36e5)},function(e){return e.getHours()});d3.time.hours=d3.time.hour.range;d3.time.hours.utc=d3.time.hour.utc.range;d3.time.day=Ys(function(e){return new ps(e.getFullYear(),e.getMonth(),e.getDate())},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1});d3.time.days=d3.time.day.range;d3.time.days.utc=d3.time.day.utc.range;d3.time.dayOfYear=function(e){var t=d3.time.year(e);return Math.floor((e-t)/864e5-(e.getTimezoneOffset()-t.getTimezoneOffset())/1440)};ks.forEach(function(e,t){e=e.toLowerCase();t=7-t;var n=d3.time[e]=Ys(function(e){(e=d3.time.day(e)).setDate(e.getDate()-(e.getDay()+t)%7);return e},function(e,t){e.setDate(e.getDate()+Math.floor(t)*7)},function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});d3.time[e+"s"]=n.range;d3.time[e+"s"].utc=n.utc.range;d3.time[e+"OfYear"]=function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)}});d3.time.week=d3.time.sunday;d3.time.weeks=d3.time.sunday.range;d3.time.weeks.utc=d3.time.sunday.utc.range;d3.time.weekOfYear=d3.time.sundayOfYear;d3.time.month=Ys(function(e){return new ps(e.getFullYear(),e.getMonth(),1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()});d3.time.months=d3.time.month.range;d3.time.months.utc=d3.time.month.utc.range;d3.time.year=Ys(function(e){return new ps(e.getFullYear(),0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()});d3.time.years=d3.time.year.range;d3.time.years.utc=d3.time.year.utc.range;var oo=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var uo=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]];var ao=[[d3.time.format("%Y"),function(e){return true}],[d3.time.format("%B"),function(e){return e.getMonth()}],[d3.time.format("%b %d"),function(e){return e.getDate()!=1}],[d3.time.format("%a %d"),function(e){return e.getDay()&&e.getDate()!=1}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]];var fo=d3.scale.linear(),lo=ro(ao);uo.year=function(e,t){return fo.domain(e.map(so)).ticks(t).map(io)};d3.time.scale=function(){return eo(d3.scale.linear(),uo,lo)};var co=uo.map(function(e){return[e[0].utc,e[1]]});var ho=[[d3.time.format.utc("%Y"),function(e){return true}],[d3.time.format.utc("%B"),function(e){return e.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(e){return e.getUTCDate()!=1}],[d3.time.format.utc("%a %d"),function(e){return e.getUTCDay()&&e.getUTCDate()!=1}],[d3.time.format.utc("%I %p"),function(e){return e.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(e){return e.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(e){return e.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(e){return e.getUTCMilliseconds()}]];var po=ro(ho);co.year=function(e,t){return fo.domain(e.map(mo)).ticks(t).map(vo)};d3.time.scale.utc=function(){return eo(d3.scale.linear(),co,po)}})();TAG.Util=function(){"use strict";function t(){var e=document.getElementsByTagName("iframe");if(e[0]){e[0].src=""}}function n(e,t){e.css("border-radius",t)}function r(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});return e}function i(e){function r(){var t=n.height()>e.height();return t}var t=e.html();var n=$(e.clone(true)).hide().css("position","absolute").css("overflow","visible").width(e.width()).height("auto");if(e.css("overflow")=="hidden"){e.parent().append(n);var i=r;while(t.length>0&&i()){t=t.substr(0,t.length-1);n.html(t+"...")}e.html(n.html());n.remove()}}function s(e,t,n){var r,i=n.center_h||false,s=n.center_v||false;var o=e,u=t;var a,f;if(n.max_height){a=Math.min(n.height*u,n.max_height)}else{a=n.height*u}if(n.max_width){f=Math.min(n.width*o,n.max_width)}else{f=n.width*o}var l,c;if(i){if(n.x_max_offset){l=.5*(o-f)+Math.min(n.x_offset*o,n.x_max_offset)}else{l=.5*(o-f)}}else{if(n.x_max_offset){if(n.align_right){l=o-Math.min(n.x_offset*o,n.x_max_offset)-f}else{l=Math.min(n.x_offset*o,n.x_max_offset)}}else{l=n.x_offset*o}}if(s){if(n.y_max_offset){c=.5*(u-a)+Math.min(n.y_offset*u,n.y_max_offset)}else{c=.5*(u-a)}}else{if(n.y_max_offset){if(n.align_bottom){c=u-Math.min(n.y_offset*u,n.y_max_offset)-a}else{c=Math.min(n.y_offset*u,n.y_max_offset)}}else{c=n.y_offset*u}}r={height:a,width:f,x:l,y:c};return r}function o(e,t,n,r){t.val(e);if(n){t.focus(function(){if(t.val()===e)t.val("").change()})}t.blur(function(){if(t.val()===""){t.val(e).change();u("",".artButton",r)}})}function u(e,t,n){$.each($(t),function(t,r){var i=$(r).data();var s=false;$.each(i,function(t,r){if($.inArray(t,n)!==-1)return;if(a(r,e)){s=true}});if(i.visible===false){s=false}if(s){$(r).show()}else{$(r).hide()}})}function a(e,t){if(e){return e.toLowerCase().indexOf(t.toLowerCase())!==-1}return true}function f(e){}function l(){return{_timer:null,_queue:[],add:function(e,t,n){var r=function(e,t){t._timer=setTimeout(function(){e=t.add();if(t._queue.length){r(e,t)}},e||2)};if(e){this._queue.push([e,t,n]);if(this._queue.length===1){r(n,this)}return}var i=this._queue.shift();if(!i){return 0}i[0].call(i[1]||window);return i[2]},clear:function(){clearTimeout(this._timer);this._queue=[]},isEmpty:function(){return this._queue.length===0}}}function c(e){e=e.replace("http://","");e=e.split(":")[0];return e}function h(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}e&&typeof e==="function"&&e.apply(null,t)}function p(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}return function(){e&&typeof e==="function"&&e.apply(null,t)}}function d(){var e=arguments;return function(){var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}var r;if(e&&e.length){for(var i=0;i<e.length;i++){r=[e[i]].concat(t);h.apply(null,r)}}}}function v(e,t){if(e&&e.indexOf){return e.indexOf(t)!==-1}return false}function m(e,t){var n=g(e);for(var r=0;r<n.length;r++){if(n[r].childNodes[0].textContent===t){var i=n[r].childNodes[1].childNodes[0];if(i)return i;n[r].childNodes[1].appendChild(e.createTextNode(""));return n[r].childNodes[1].childNodes[0]}}return null}function g(e){return e.getElementsByTagName("Metadata")[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0].childNodes}function y(e){var t=document.createElement("div");t.innerText=t.textContent=e;e=t.innerHTML;return e}function b(e){if(e)return e.replace(/\n/g,"<br>").replace(/&/g,"&").replace(/<(.|\n)*?>/g,"").replace(/\'/g,"&apos;").replace(/\"/g,"&quot;");else return""}function w(e,t,n){var r=setInterval(function(){if(H($(e))){$(e).fitText(t,n);clearInterval(r)}})}function E(e){var t,n=false,r,i,s,o,u,a,f,l,c=1e3*3600*24,h,p,d;if(e&&e.year){t=e.year;if(t.search(/bce?/i)>=0){n=true;t=t.replace(/bce?/gi,"")}t=t.replace(/ad/gi,"").replace(/ce(?!n)/gi,"").replace(/\s/g,"").replace(/,/g,"");if(t.search(/c.?/i)>=0||t.search(/century/i)>=0){t.replace(/[a-z]\w/gi,"").replace(/c.?/gi,"");r=parseInt(t)-1;t=r.toString()+"50"}i=parseInt(t);if(e.month){s=e.month;o={January:1,"February:":2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12};if(e.day){u=e.day}else{u=1}a=new Date(i,o[s],u);f=new Date(i,0,0);l=a-f;h=Math.round(l/c);(new Date(i,2,0)).getDate()===29?p=366:p=365;d=h/p;i=i+d}if(n){i=-i}return i}}function S(e){var t=$(e);var n=t.attr("src");var r=t.attr("id");var i=t.attr("class");var s=t.attr("style");$.get(n,function(e){var n=$(e).find("svg");if(typeof r!=="undefined"){n=n.attr("id",r)}if(typeof i!=="undefined"){n=n.attr("class",i)}if(typeof s!=="undefined"){n=n.attr("style",s)}n=n.removeAttr("xmlns:a");t.replaceWith(n);return t})}function x(e,t,n,r){var i={position:"absolute","z-index":"50",height:"auto",width:"10%",left:"50%",top:"50%"};if(n||r){i.top=n;i.left=r}var s="0px";var o="0px";if(t){i.width=t}var u=$(e).css("background-color");if(u&&u.indexOf("rgb")!==-1){var a=u.substring(u.indexOf("(")+1,u.lastIndexOf(")")).split(/, \s*/);var f="rgba("+a[0]+","+a[1]+","+a[2]+","+"0.5)";e.css({"background-color":f})}var l=C($(e),i,s,o,false)}function T(e){var t=$(e).css("background-color");if(t&&t.indexOf("rgb")!==-1){var n=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/, \s*/);var r="rgba("+n[0]+","+n[1]+","+n[2]+","+"1)";e.css({"background-color":r})}var i=e.find(".progressCircle");N(i)}function N(e){e.remove();e=null}function C(e,t,n,r,i){var s=$(document.createElement("img"));s.addClass("progressCircle");e.append(s);s.attr("src",tagPath+"images/icons/progress-circle.gif");s.css(t||{position:"absolute",left:"5%","z-index":"50",height:"auto",bottom:"10%",width:"10%"});if(i){s.css({top:r-.5*s.height(),left:n-.5*s.width()})}return s}function k(e){return e*(window.innerWidth/1920)+"%"}function L(e){var t=e.childNodes;var n;for(n in t){t[n].__data__=e.__data__;L(t[n])}}function A(e){var t=e.split("."),n=window,r="";var i=0;if(t[0]==="TAG"){TAG=TAG||{};n=TAG;i=1}else if(t[0]==="Worktop"){Worktop=Worktop||{};n=Worktop;i=1}for(var s=i,o=t.length;s<o;s++){r=t[s];n[r]=n[r]||{};n=n[r]}return n}function O(e,t){return $.extend({},t,e)}function M(e,t,n,r,i){if(!e){return}var s=$(document.createElement("div"));var o=$("#tagRoot");i=i||.1;var u=t;s.css({position:"absolute",visibility:"hidden","font-size":t+"em",height:"auto",width:"auto"});s.text(e);o.append(s);if(s.width()>=n||s.height()>=r){return t+"em"}while(s.width()<n&&s.height()<r){u+=i;s.css("font-size",u+"em")}s.remove();u-=i;return u+"em"}function _(e,t,n,r,i){var s=$(document.createElement("div"));i=i||.1;var o=t;s.css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","font-size":t+"em"});s.text(e);$("body").append(s);if(s.width()>=n||s.height()>=r){return t}while(s.width()<n&&s.height()<r){o+=i;s.css("font-size",o+"em")}s.remove();return o}function _(e,t,n,r,i){if(!e){return}var s=$(document.createElement("div"));var o=$("#tagRoot");i=i||.1;var u=t;s.css({position:"absolute",visibility:"hidden","font-size":t+"em",height:"auto",width:"auto"});s.text(e);o.append(s);if(s.width()>=n||s.height()>=r){return t+"em"}while(s.width()<n&&s.height()<r){u+=i;s.css("font-size",u+"em")}s.remove();return u}function D(){var e=new Windows.UI.Input.GestureRecognizer;e.gestureSettings=Windows.UI.Input.GestureSettings.manipulationRotate|Windows.UI.Input.GestureSettings.manipulationTranslateX|Windows.UI.Input.GestureSettings.manipulationTranslateY|Windows.UI.Input.GestureSettings.manipulationScale|Windows.UI.Input.GestureSettings.manipulationRotateInertia|Windows.UI.Input.GestureSettings.manipulationScaleInertia|Windows.UI.Input.GestureSettings.manipulationTranslateInertia|Windows.UI.Input.GestureSettings.hold|Windows.UI.Input.GestureSettings.holdWithMouse|Windows.UI.Input.GestureSettings.rightTap|Windows.UI.Input.GestureSettings.tap;return e}function P(e){if(!e){return}var t=new XMLHttpRequest;t.open("GET",e,false);t.send(null);if(false&&!t.getResponseHeader("Date")){var n=t;t=new XMLHttpRequest;var r=n.getResponseHeader("Last-Modified")||new Date(0);t.open("GET",e,false);t.setRequestHeader("If-Modified-Since",r);t.send("");if(t.status===304){t=n}}return t}function H(e){e=$(e)[0];while(e){if(e===document){return true}e=e.parentNode}return false}function B(e){e.attr("ondragstart","return false")}function j(e,t){return{_minComp:e,_maxComp:t,_maxheap:new binaryHeap(t),_minheap:new binaryHeap(e),add:function(e){this._maxheap.push(e);this._minheap.push(e);return e},getMin:function(){return this._minheap.peek()},getMax:function(){return this._maxheap.peek()},removeMin:function(){return this._minheap.pop()},removeMax:function(){return this._maxheap.pop()},remove:function(e){this._maxheap.remove(e);this._minheap.remove(e)},size:function(){return this._maxheap.size()},clear:function(){this._maxheap=new binaryHeap(this._maxComp);this._minheap=new binaryHeap(this._minComp)},find:function(e){return this._maxheap.find(e)}}}function F(e,t,n,r){function v(e){var n;if(e.gesture){L(e,true);var i={x:e.gesture.center.pageX-f.offset().left,y:e.gesture.center.pageY-f.offset().top};var s=e.gesture.rotation;if(!l.x&&l.x!==0){n={x:e.gesture.deltaX,y:e.gesture.deltaY}}else{n={x:e.gesture.center.pageX-l.x,y:e.gesture.center.pageY-l.y}}var o=e.gesture.scale-d;d=e.gesture.scale;l.x=e.gesture.center.pageX;l.y=e.gesture.center.pageY;c=e;if(typeof t.onManipulate==="function"){t.onManipulate({pivot:i,translation:n,rotation:s,scale:1+o,target:e.gesture.target,touches:e.gesture.touches,pointerType:e.gesture.pointerType,center:e.gesture.center,deltaTime:e.gesture.deltaTime,deltaX:e.gesture.deltaX,deltaY:e.gesture.deltaY,velocityX:e.gesture.velocityX,velocityY:e.gesture.velocityY,angle:e.gesture.angle,direction:e.gesture.direction,distance:e.gesture.distance,eventType:e.gesture.eventType,srcEvent:e.gesture.srcEvent,startEvent:e.gesture.startEvent},e)}clearTimeout(h);h=setTimeout(function(){var t=L(e);if(e.gesture.pointerType!=="mouse"&&!r)w(30*t.vx,30*t.vy,null,p)},5)}else{L(e,true);var i={x:e.pageX-f.offset().left,y:e.pageY-f.offset().top};if(false&&!l.x&&l.x!==0){n={x:e.gesture.deltaX,y:e.gesture.deltaY}}else{n={x:e.pageX-l.x,y:e.pageY-l.y};console.log("translation.y = "+n.y)}var o=e.gesture.scale-d;d=e.gesture.scale;l.x=e.pageX;l.y=e.pageY;c=e;if(typeof t.onManipulate==="function"){t.onManipulate({pivot:i,translation:n,rotation:s,scale:1+o,target:e.gesture.target,touches:e.gesture.touches,pointerType:e.gesture.pointerType,center:e.gesture.center,deltaTime:e.gesture.deltaTime,deltaX:e.gesture.deltaX,deltaY:e.gesture.deltaY,velocityX:e.gesture.velocityX,velocityY:e.gesture.velocityY,angle:e.gesture.angle,direction:e.gesture.direction,distance:e.gesture.distance,eventType:e.gesture.eventType,srcEvent:e.gesture.srcEvent,startEvent:e.gesture.startEvent},e)}clearTimeout(h);h=setTimeout(function(){var t=L(e);if(e.gesture.pointerType!=="mouse"&&!r)w(30*t.vx,30*t.vy,null,p)},5)}}function m(e){var n={x:e.gesture.center.pageX-f.offset().left,y:e.gesture.center.pageY-f.offset().top};var r=e.gesture.scale-d;var i=e.gesture.rotation;var s;if(!l.x&&l.x!==0){s={x:0,y:0}}else{s={x:e.gesture.center.pageX-l.x,y:e.gesture.center.pageY-l.y}}l.x=e.gesture.center.pageX;l.y=e.gesture.center.pageY;L(e,true);if(r!==d&&typeof t.onScroll==="function")t.onScroll(1+r,n);if(typeof t.onManipulate==="function")t.onManipulate({pivot:n,translation:s,rotation:i,target:e.gesture.target,touches:e.gesture.touches,pointerType:e.gesture.pointerType,center:e.gesture.center,deltaTime:e.gesture.deltaTime,deltaX:e.gesture.deltaX,deltaY:e.gesture.deltaY,velocityX:e.gesture.velocityX,velocityY:e.gesture.velocityY,angle:e.gesture.angle,direction:e.gesture.direction,distance:e.gesture.distance,eventType:e.gesture.eventType,srcEvent:e.gesture.srcEvent,startEvent:e.gesture.startEvent,scale:1},e);d=e.gesture.scale}function y(e){d=1;a=true;g=e.gesture.center;c=null;s=e.srcElement;p++;k();clearTimeout(h)}function b(e){v(e)}function w(e,n,r,i){if(!c)return;if(p!==i)return;if(Math.abs(e)<=4&&Math.abs(n)<=4){return}var s=f.offset();r=r||5;var o={x:c.gesture.center.pageX-s.left,y:c.gesture.center.pageY-s.top};var u=0;var a={x:e,y:n};var l=1;if(typeof t.onManipulate==="function")t.onManipulate({pivot:o,translation:a,rotation:u,scale:l},c);h=setTimeout(function(){w(e*.95,n*.95,r,i)},r)}function E(e){a=false;l={};var n=L(e);if(e.gesture.pointerType==="mouse"&&!r)w(30*n.vx,30*n.vy,null,p);if(typeof t.onRelease==="function")t.onRelease(e)}function k(){S=null;x=null;T=0;N=0;C=null}function L(e,t){if(!S){S=e;S.currentDir=S.gesture.deltaX/Math.abs(S.gesture.deltaX)||0;if(!C){C=e;return{vx:0,vy:0}}}else{if(e.gesture.deltaX>C.gesture.deltaX&&S.currentDir!==1){S=e;S.currentDir=1}else if(e.gesture.deltaX<C.gesture.deltaX&&S.currentDir!==-1){S=e;S.currentDir=-1}}if(!x){x=e;x.currentDir=x.gesture.deltaY/Math.abs(x.gesture.deltaY)||0}else{if(e.gesture.deltaY>C.gesture.deltaY&&x.currentDir!==1){x=e;x.currentDir=1}else if(e.gesture.deltaY<C.gesture.deltaY&&x.currentDir!==-1){x=e;x.currentDir=-1}}C=e;if(!t){return{vx:(e.gesture.deltaX-S.gesture.deltaX)/(e.gesture.timeStamp-S.gesture.timeStamp)||0,vy:(e.gesture.deltaY-x.gesture.deltaY)/(e.gesture.timeStamp-x.gesture.timeStamp)||0}}}function A(e){var n={x:e.clientX-f.offset().left,y:e.clientY-f.offset().top};console.log(e.detail);var r=-e.detail;if(r<0)r=1/1.1;else r=1.1;console.log("delta processed "+r);e.cancelBubble=true;if(typeof t.onScroll==="function"){t.onScroll(r,n)}}function O(e){var n={x:e.x-f.offset().left,y:e.y-f.offset().top};var r=e.wheelDelta;if(e.wheelDelta<0)r=1/1.1;else r=1.1;e.cancelBubble=true;if(typeof t.onScroll==="function")t.onScroll(r,n)}var i=new Hammer(e,{hold_threshold:3,drag_min_distance:9,drag_max_touches:10,hold_timeout:600,tap_max_distance:15,doubletap_distance:17,doubletap_interval:400,swipe:false});var s=null,o=this,u=false,a=false,f=$(e);var l={},c,h,p=0,d=1;var g;(function(){var e=0;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=Date.now();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();var S,x,T,N,C;i.on("touch",y);i.on("drag",function(e){b(e)});i.on("pinch",m);i.on("release",E);e.onmousewheel=O;e.addEventListener("DOMMouseScroll",A);var M,_;if(typeof t.onDoubleTapped==="function"){M=function(n){if(n.gesture.srcEvent.button>0||n.gesture.srcEvent.buttons==2){return}_={};_.position={};_.position.x=n.gesture.center.pageX-$(e).offset().left;_.position.y=n.gesture.center.pageY-$(e).offset().top;t.onDoubleTapped(_)};i.on("doubletap",M)}var D=null;if(typeof t.onTapped==="function"){D=function(n){if(n.gesture.srcEvent.button>0){n.stopPropagation();_={};_.gesture=n.gesture;_.position={};_.position.x=n.gesture.center.pageX-$(e).offset().left;_.position.y=n.gesture.center.pageY-$(e).offset().top;if(t.onTappedRight){t.onTappedRight(_)}return}_={};_.position={};_.button=n.button;_.gesture=n.gesture;_.position.x=n.gesture.center.pageX-$(e).offset().left;_.position.y=n.gesture.center.pageY-$(e).offset().top;t.onTapped(_)};i.on("tap",D)}var P=null;if(typeof t.onRelease==="function"){P=function(n){_={};_.position={};_.position.x=n.gesture.center.pageX-$(e).offset().left;_.position.y=n.gesture.center.pageY-$(e).offset().top;t.onRelease(_)};i.on("release",P)}var H=null;var B=null;var j=false;if(typeof t.onTappedRight==="function"){H=function(e){e.stopPropagation();j=true;_={};_.gesture=e.gesture;_.position={};_.position.x=e.gesture.center.pageX-f.offset().left;_.position.y=e.gesture.center.pageY-f.offset().top;t.onTappedRight(_)};B=function(e){e.stopPropagation();_={};_.button=e.button;_.gesture=e.gesture;_.position={};_.position.x=e.pageX-f.offset().left;_.position.y=e.pageY-f.offset().top;t.onTappedRight(_)};e.addEventListener("MSPointerEvent",function(e){console.log(e);if(j){console.log("STOPPING CLICK");e.stopPropagation();setTimeout(function(){j=false},1);return}},true);e.addEventListener("mouseup",function(e){console.log("CLICK");if(j){console.log("STOPPING CLICK");e.stopPropagation();setTimeout(function(){j=false},1);return}if(e.button===2){B(e)}},true);i.on("hold",H)}return{cancelAccel:function(){p++;clearTimeout(h)}}}function I(e,t,n){function u(e){if(e.delta){var n={x:e.position.x,y:e.position.y};var r=e.delta.rotation/180*Math.PI;var i={x:e.delta.translation.x,y:e.delta.translation.y};var s=e.delta.scale;if(typeof t.onManipulate==="function"){if(e.gesture){t.onManipulate({pivot:n,translation:i,rotation:r,target:e.gesture.target,touches:e.gesture.touches,pointerType:e.gesture.pointerType,center:e.gesture.center,deltaTime:e.gesture.deltaTime,deltaX:e.gesture.deltaX,deltaY:e.gesture.deltaY,velocityX:e.gesture.velocityX,velocityY:e.gesture.velocityY,angle:e.gesture.angle,direction:e.gesture.direction,distance:e.gesture.distance,eventType:e.gesture.eventType,srcEvent:e.gesture.srcEvent,startEvent:e.gesture.startEvent,scale:s})}else{t.onManipulate({pivot:n,translation:i,rotation:r,scale:s,grEvent:e})}}}}function a(){return o}function f(t){r=t.srcElement;var n=t.currentPoint;try{s.processDownEvent(n);e.msSetPointerCapture(t.pointerId);t.cancelBubble=true}catch(i){var o=i.message}}function l(t){if(n){if(t.x<0||t.y<0||t.x>$(e).width()||t.y>$(e).height()){return}}var r=t.intermediatePoints;try{s.processMoveEvents(r)}catch(i){var o=i.message}}function c(e){var t=e.currentPoint;try{s.processUpEvent(t)}catch(n){var r=n.message}}function h(e){var n={x:e.x,y:e.y};var r=e.wheelDelta;if(e.wheelDelta<0)r=1/1.1;else r=1.1;e.cancelBubble=true;if(typeof t.onScroll==="function")t.onScroll(r,n)}function p(e){o=true;u(e)}function d(e){u(e)}function v(e){o=false;u(e)}var r=null;var i=this;var s=TAG.Util.getGestureRecognizer();var o=false;e.addEventListener("MSPointerDown",f,false);e.addEventListener("MSPointerMove",l,false);e.addEventListener("MSPointerUp",c,false);e.onmousewheel=h;s.addEventListener("manipulationstarted",p);s.addEventListener("manipulationupdated",d);s.addEventListener("manipulationcompleted",v);var m=null;if(typeof t.onTapped==="function"){m=function(n){var i={};i.position={};if(n.position.x<50){i.position.x=$(r).offset().left-$(e).offset().left+n.position.x}else{i.position.x=n.position.x}i.position.y=$(r).offset().top-$(e).offset().top+n.position.y;t.onTapped(i)};s.addEventListener("tapped",m)}var g=null;if(typeof t.onTappedRight==="function"){g=function(e){var n={};n.position={};n.position.x=e.position.x;n.position.y=e.position.y;t.onTappedRight(n)};s.addEventListener("righttapped",g)}return s}function q(e){y(e||"");return e||""}function R(e){return e||""}function U(e){if(e.length>0){for(var t=0;t<e.length;t++){var n=e[t];var r=n.getMedia();var i=$(document.createElement("video"));i.attr("preload","metadata");var s=r.slice(8,r.length);TAG.Worktop.Database.getConvertedCheck(function(t,n,r,i){return function(t){if(t!=="False"){console.log("converted/ or not being written now");var r="/Images/"+t.substr(0,t.lastIndexOf("."))+".mp4";var s=TAG.Worktop.Database.fixPath(r);i.attr("src",s);i.on("loadedmetadata",function(){n.changeTrackColor("white");n.videoConverted(true);n.addDisplay(0,this.duration);e.remove(n)})}else{console.log("not converted: ")}}}(t,n,r,i),null,s)}}}function z(e,t,n){var r=$(document.createElement("div"));r.attr("id","leftLoading");r.css({position:"absolute",width:"80%",left:"10%",top:"40%",color:"white","text-align":"center"});var i=$(document.createElement("label"));i.text(e);i.css({height:"50%",width:"50%","font-size":"250%"});if(n){r.css({top:"1%"});i.css("background-color","black")}if(!t){var s=$(document.createElement("img"));s.attr("src",tagPath+"images/icons/progress-circle.gif");s.css({height:"50px",width:"auto",left:"45%",display:"block",position:"relative",top:"30%","margin-bottom":"5%"});if(n){s.css({height:"25px",top:"1%"})}r.append(s)}r.append(i);return r}function W(e,t,n){return function(r){var i="";switch(r.target.error.code){case r.target.error.MEDIA_ERR_ABORTED:i="Video playback aborted. Please see FAQs on the TAG website.";break;case r.target.error.MEDIA_ERR_NETWORK:i="Network error during video upload. Please see FAQs on the TAG website.";break;case r.target.error.MEDIA_ERR_DECODE:i="Error decoding video. Please see FAQs on the TAG website.";break;case r.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:if(n&&n==="False"){i="This video is being converted to compatible formats for different browsers"}else{i="Either the video format is not supported or a network or server error occurred. Please see FAQs on the TAG website."}break;default:i="Error: please see FAQs on the TAG website.";break}$("#videoErrorMsg").remove();$("#leftLoading").remove();if(n&&n==="False"){t.append(z(i))}else if(!document.getElementById("leftLoading")){var s=$(document.createElement("div"));s.attr("id","videoErrorMsg");s.css({position:"absolute",width:"80%",left:"10%",top:"50%",color:"white","text-align":"center","font-size":TAG.Util.getMaxFontSizeEM(i,2,t.width()*.8,t.height()*.2,.1)});s.text(i);t.append(s)}e.hide();e[0].onerror=function(e){}}}function X(e){var t;$.ajax({async:false,cache:false,url:e.match(/\//)?e:tagPath+"html/"+e,success:function(e){t=e},error:function(n){console.log("url = "+e);console.log("error: "+n.statusText);t=null},dataType:"html"});return t?IS_WINDOWS?$(toStaticHTML(t)):$(t):""}function V(e,t){localStorage.invisibleCollectionsTAG=localStorage.invisibleCollectionsTAG||"[]";var n,r;try{n=JSON.parse(localStorage.invisibleCollectionsTAG)}catch(i){localStorage.invisibleCollectionsTAG="[]";n=[]}r=n.indexOf(e);if(t&&t.visible){r>=0&&n.splice(r,1)}else if(t&&t.hasOwnProperty("visible")){r===-1&&n.push(e)}else{return r>=0?false:true}localStorage.invisibleCollectionsTAG=JSON.stringify(n)}function J(e,t){var n,r,i;t=t||3;e=e.replace(/\#/g,"");e=e.substring(0,6);n=Math.round(parseInt(e.substring(0,2),16)/t);r=Math.round(parseInt(e.substring(2,4),16)/t);i=Math.round(parseInt(e.substring(4,6),16)/t);return"rgb("+n+","+r+","+i+")"}function K(e,t){var n,r,i;e=e.replace(/\#/g,"");e=e.substring(0,6);n=parseInt(e.substring(0,2),16);r=parseInt(e.substring(2,4),16);i=parseInt(e.substring(4,6),16);return"rgba("+n+","+r+","+i+","+t+")"}function Q(){function o(){var e=$(document.createElement("img"));e.attr("src",tagPath+"images/icons/x.svg");e.text("X");e.css({height:"3%",width:"3%","margin-left":"39%","margin-bottom":"3.5%"});return e}function u(e,t){var n=$(document.createElement("div")).addClass("infoSection").css({display:"block",position:"relative",width:"100%","min-height":"1.5%","max-height":"4%","padding-bottom":"1.5%"});if(t){var i=$(document.createElement("div")).addClass("infoSectionIconHolder").css({display:"inline-block",position:"absolute",height:"80%",width:"10%",left:"0%",top:"0%","text-align":"center","vertical-align":"middle"});i.append($(document.createElement("img")).addClass("infoSectionIcon").attr("src",t).css({display:"block",position:"absolute","vertical-align":"middle",width:"100%","max-width":"45px",height:"auto","max-height":"45px"}));n.append(i)}n.append($(document.createElement("div")).addClass("infoSectionText").text(e).css({display:"inline-block",position:"relative",width:t?"85%":"100%",left:t?"12%":"0%"}));r.append(n)}var e=$("#tagRoot");var t=$(TAG.Util.UI.blockInteractionOverlay());var n=$(document.createElement("div")).addClass("infoBox");var r=$(document.createElement("div")).addClass("infoMain");var i=$(document.createElement("div")).addClass("infoTitle");var s=o().addClass("closeButton");n.css({"background-color":"black",color:"white",height:"55%",width:"50%","margin-top":"15%","margin-left":"25%"});i.css({"padding-top":"5%","padding-left":"8%","padding-right":"8%","background-color":"black",display:"block",color:"white","border-top-left-radius":"3.5px","border-top-right-radius":"3.5px","font-size":"1.5em"}).text("Welcome to Touch Art Gallery");r.css({"background-color":"black",display:"block",color:"white","font-size":"0.75em","margin-left":"8%","margin-top":"4%","margin-right":"8%"});s.css({height:"4%",width:"4%","min-height":"20px","min-width":"20px","margin-left":"0%","margin-bottom":"0%","margin-top":"1%","margin-right":"1%",top:"0%",display:"block","float":"right"});n.append(s);n.append(i);u("Click or tap on a tile to preview the item it represents, and click/tap on its thumbnail again to begin exploring it in full.");u("Tiles without icons are image artworks. Any media associated with the artwork will appear below the artwork in the previewer. You can explore the artwork with a specific media item by tapping on the item's thumbnail image.");u("Tiles with the play icon represent video artworks. Click or tap on the tile to view them in the video player.",tagPath+"images/video_icon.svg");u("Tiles with this icon represent interactive tours. Click or tap on the tile to open them in the tour player. Tours are like video narratives, but can be paused at any time via the controls, or by tapping anywhere in the player. While paused, you can freely manipulate all items that are currently onscreen.",tagPath+"images/tour_icon.svg");n.append(r);t.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);t.append(n);s.on("mousedown",function(){t.fadeOut()});e.append(t);t.fadeIn()}var e="tagRoot";return{makeNamespace:A,setToDefaults:O,getGestureRecognizer:D,makeXmlRequest:P,makeManipulatable:F,makeManipulatableWin:I,applyD3DataRec:L,elementInDocument:H,fitText:w,multiLineEllipsis:i,encodeText:y,disableDrag:B,getFontSize:k,parseDateToYear:E,showLoading:x,hideLoading:T,removeProgressCircle:N,showProgressCircle:C,createQueue:l,createDoubleEndedPQ:j,replaceSVGImg:S,getMaxFontSizeEM:M,getMaxFontSize:_,encodeXML:b,constrainAndPosition:s,getFieldValueFromMetadata:m,formatAddress:c,safeCall:h,safeCallHandler:p,multiFnHandler:d,contains:v,defaultVal:o,searchData:u,searchString:a,saveThumbnail:f,htmlEntityEncode:q,htmlEntityDecode:R,checkVideoConverted4Track:U,createConversionLoading:z,videoErrorHandler:W,getHtmlAjax:X,localVisibility:V,dimColor:J,hexToRGBA:K,IdCreator:r,makeBorderRadius:n,createTutorialPopup:Q,removeYoutubeVideo:t};that.createDoubleEndedPQ=j}();TAG.Util.UI=function(){"use strict";function o(){window.focus();window.addEventListener("keydown",u)}function u(e){e.stopPropagation();if(s&&s[0]&&s[0][e.which]){s[0][e.which](e)}}function a(){return s}function f(e){}function l(e){var t,n,r,i,s;var o=e.x,u=e.fadeIn,a=e.fadeOut,f=e.mainLength,l=e.fadeColor||"#ff7700",c=e.mainColor||"#81ad62",p=e.height||"100%",d=e.container;t=$(document.createElement("div"));t.addClass("inRect");t.css({position:"absolute",left:o+"px",top:"0px",width:u+"px",height:p,"border-left":"1px solid black","border-right":"1px solid black",background:"linear-gradient(to right,white, "+c+")"});n=$(document.createElement("div"));n.addClass("mainRect");n.css({position:"absolute",left:o+u+"px",top:"0px",width:f+"px",height:p,"background-color":c});r=$(document.createElement("div"));r.addClass("outRect");r.css({position:"absolute",left:o+u+f+"px",top:"0px",width:a+"px",height:p,"border-left":"1px solid black","border-right":"1px solid black",background:"linear-gradient(to right, "+c+",white)"});i=h(o,48,15,5,"#000000","#ffffff");i.addClass("inHandle");s=h(o+f+u+a,48,15,5,"#000000","#ffffff");s.addClass("outHandle");d&&d.append(n).append(t).append(r).append(i).append(s);return{inRect:t,mainRect:n,outRect:r,inHandle:i,outHandle:s}}function c(e){var t=e.x,n=e.y||48,r=e.container;var i=p(t);i.addClass("keyframeLine");var s=h(t,n);s.addClass("keyframeCirc");var o=h(t,n,17,0,"#ff0000","#ffffff");i.css("z-index",2);s.css("z-index",3);o.css("z-index",3);o.addClass("keyframeInnerCirc");r&&r.append(i);r&&r.append(s);r&&r.append(o);return{line:i,circ:s,innerCirc:o}}function h(e,t,n,r,i,s){var o=$(document.createElement("div"));n=n||21;r=r===0||r?r:5;i=i||"#296b2f";s=s||"#ffffff";o.css({border:r+"px solid "+i,"-webkit-border-radius":2*n+"px","-moz-border-radius":2*n+"px","border-radius":2*n+"px",width:2*n+"px",height:2*n+"px","background-color":s,position:"absolute",left:e-n-r+"px",top:t-n-r+"px"});return o}function p(e,t,n){var r=$(document.createElement("div"));t=t||3;n=n||"#296b2f";r.css({width:t+"px",height:"100%","background-color":n,position:"absolute",left:e-t/2+"px",top:"0px"});return r}function d(){function h(){var e=o.val();switch(e){case"tagunicorn":var t=$(document.createElement("img"));t.attr("src",tagPath+"images/unicorn.jpg");t.css({width:"100%",height:"100%","z-index":2147483647,display:"none",position:"absolute"});n.append(t);t.fadeIn(500);setTimeout(function(){$("img").attr("src",tagPath+"images/unicorn.jpg");$(".background").css("background-image","url("+tagPath+'"images/unicorn.jpg")');t.fadeOut(500,function(){t.remove()})},5e3);return;case"tagtest":e="tagtestserver.cloudapp.net";break;case"tagdemo":e="tagdemo.cloudapp.net";break;case"taglive":e="browntagserver.com";break;case"taglocal":e="10.116.71.58";break;case"sam":case"seattleartmuseum":e="tag.seattleartmuseum.org";break;default:break}c.hide();f.hide();l.html("Connecting...");l.show();TAG.Worktop.Database.changeServer(e,false,function(){TAG.Layout.StartPage(null,function(e){TAG.Util.UI.slidePageRight(e)})},function(){c.show();f.show();l.html("Could not connect to the specified address. Please try again.");l.css({"margin-top":"-3%"});l.show();s.css({"margin-bottom":"-3%"});r.css({width:"40%",height:"45%"});u.css({"margin-top":"13%",color:"white","text-align":"center"})})}var e=$(document.createElement("div"));var t=localStorage.ip;var n=$("#tagRoot");e.attr("id","serverDialogOverlay");e.css({display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":1e9+5});var r=$(document.createElement("div"));r.attr("id","serverDialog");var i=TAG.Util.constrainAndPosition($(n).width(),$(n).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:230});r.css({position:"absolute",left:"30%",top:"30%",width:"40%",height:"40%",border:"3px double white","text-align":"center","background-color":"black"});e.append(r);var s=$(document.createElement("div"));s.attr("id","dialogTitle");s.css({color:"white",width:"80%",height:"15%",left:"10%",top:"10%","font-size":"1.35em",position:"relative","text-align":"center"});s.text("TAG Server Address:");r.append(s);var o=$(document.createElement("input"));o.attr("id","serverDialogInput");o.css({display:"block",margin:"auto","margin-bottom":"1%",width:"60%",height:"10%",position:"relative",top:"15%","font-size":"100%"});o.val(localStorage.ip);o.focus(function(){o.select()});r.append(o);o.on("keydown",function(e){if(e.which===13&&r.length>0){e.stopPropagation();e.preventDefault();h()}});var u=$(document.createElement("div"));u.css({"margin-top":"10%",color:"white","text-align":"center"});if(!IS_WINDOWS){u.html("Contact us for server setup at:<br /><a href='mailto:brown.touchartgallery@outlook.com'>brown.touchartgallery@outlook.com</a>.")}else{u.html("Contact us for server setup at:<br />brown.touchartgallery@outlook.com.")}r.append(u);var a=$(document.createElement("div"));a.css({"margin-top":"5%"});r.append(a);var f=$(document.createElement("button"));f.css({padding:"1%",border:"1px solid white",width:"14%",height:"3%",position:"relative","margin-top":"1%","float":"left","margin-left":"7%","font-size":"90%",bottom:"1%"});f.text("Save");var l=$(document.createElement("div"));l.attr("id","serverErrorMessage");l.css({color:"white",left:"10%",width:"80%",height:"10%","text-align":"center",position:"relative"});a.append(l);l.hide();var c=$(document.createElement("button"));c.css({padding:"1%",border:"1px solid white",width:"14%",height:"3%",position:"relative","margin-top":"1%","float":"right","margin-right":"7%","font-size":"90%",bottom:"1%"});c.text("Cancel");c.attr("type","button");a.append(c);a.append(f);c.click(function(){$("#serverDialogOverlay").remove()});f.on("click",h);var p=$(document.createElement("img"));p.css({width:"20px",height:"auto",display:"none","margin-right":"3%","margin-top":"2.5%","float":"right"});p.attr("src",tagPath+"images/icons/progress-circle.gif");var d=$(document.createElement("div"));d.attr("id","serverPasswordErrorMessage");d.css({color:"white","font-size":"1.25em","margin-bottom":"10px"});d.html("Invalid authoring password entered. Please try again.");d.hide();n.append(e);o.focus()}function v(e,t){function c(){var i=typeof e==="function"?e():e;var s=typeof t==="function"?t():t;TAG.Worktop.Database.createFeedback($(a).val(),i,s);$(n).css({display:"none"});$(a).val("");var o=TAG.Util.UI.popUpMessage(null,"Your feedback has been submitted, thank you for your feedback.",null,null,null,true);r.append(o);$(o).css("z-index",1e6);$(o).show()}function p(){$(a).val("");$(n).css({display:"none"})}var n=$(document.createElement("div"));var r=$("#tagRoot");$(n).attr("id","dialogOverlay");$(n).css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":1e7});var i=$(document.createElement("div"));$(i).addClass("feedbackBox");var s=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:210});var o=($("#tagRoot").width()-s.width)*.5;$(i).css({position:"absolute",left:"20%",top:"25%",width:"62%",height:"45%",border:"3px double white","background-color":"black"});$(n).append(i);$(n).click(p);$(i).click(function(e){e.stopPropagation()});var u=$(document.createElement("label"));$(u).addClass("feedbackLabel");$(u).text("Send Feedback");$(u).css({left:"9%",top:"12.5%",width:"80%",height:"15%","text-align":"left",color:"white",position:"absolute","font-size":"100%"});var a=$(document.createElement("textarea"));$(a).addClass("commentBox");$(a).css({"border-color":"gray",color:"gray",position:"relative","min-width":0,left:"9%",top:"12%",width:"77%",height:"30%"});$(a).attr("placeholder","Questions or Comments");var f=$(document.createElement("div"));$(f).css({position:"relative",width:"80%",left:"10%",bottom:"-74%",display:"inline-block"});var l=$(document.createElement("button"));$(l).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","margin-left":"-2%",display:"inline-block"});$(l).text("Send ");$(l).on("click",c);var h=$(document.createElement("button"));$(h).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right","margin-right":"-2%",display:"inline-block"});$(h).text("Cancel");$(h).click(p);$(i).append(f);$(f).append(l);$(f).append(h);$(i).append(a);$(i).append(u);return n}function m(e){e=e||e===0?Math.max(Math.min(parseFloat(e),1),0):.6;var t=document.createElement("div");$(t).attr("id","blockInteractionOverlay");$(t).css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,"+e+")","z-index":"10000000"});return t}function g(e,t,n,r,i,o){function y(){if(e){e()}b()}function b(){if(r){$(u).hide();$(u).remove()}else{$(u).fadeOut(500,function(){$(u).remove()})}s[0]=h}var u,a;if(document.getElementById("popupblockInteractionOverlay")){u=$(document.getElementById("popupblockInteractionOverlay"))}else{u=m();a=true;$(u).attr("id","popupblockInteractionOverlay")}var f=document.createElement("div");var l=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:650,max_height:300});var c=($("#tagRoot").width()-l.width)*.5;var h=s[0];$(f).css({position:"absolute",left:c+"px",top:l.y+"px",width:l.width+"px",height:l.height+"px",border:"3px double white","background-color":"black"});if(o){$(u).click(b);$(f).click(function(e){e.stopPropagation()})}var p=document.createElement("div");$(p).css({color:"white",width:"80%",height:"30%",left:"10%",top:"12.5%","font-size":"1.20em",position:"relative","text-align":"center","word-wrap":"break-word"});var d=TAG.Util.getMaxFontSizeEM(t,1.5,$(p).width(),$(p).height());$(p).css("font-size",d);TAG.Util.multiLineEllipsis($(p));if(i){$(p).html(t)}else{$(p).text(t)}var v=document.createElement("div");$(v).addClass("optionButtonDiv");$(v).css({height:"10%",width:"100%",position:"absolute",bottom:"6%",right:"2%"});var g=document.createElement("button");$(g).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%","margin-top":"-1%",color:"white"}).css("border-radius","3.5px");n=!n||n===""?"OK":n;$(g).text(n);g.onclick=function(){if(e){e()}if(a){b()}else{$(f).remove()}};s[0]={13:y};$(v).append(g);$(f).append(p);$(f).append(v);$(u).append(f);return u}function y(e,t,n,r,i,o,u,a,f){function L(){A();e()}function A(){if(r){$(l).hide();$(l).remove()}else{$(l).fadeOut(500,function(){$(l).remove()})}s[0]=d}var l;var c;if(document.getElementById("popupblockInteractionOverlay")){l=$(document.getElementById("popupblockInteractionOverlay"))}else{c=true;l=m();$(l).attr("id","popupblockInteractionOverlay")}o=o||window;var h=document.createElement("div");var p={13:L};var d=s[0];s[0]=p;var v=600,g=300;if(f){v=$("body").width()*.45;g=$("body").height()*.33}var y=TAG.Util.constrainAndPosition($(o).width(),$(o).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:v,max_height:g});$(h).css({position:"absolute",left:y.x+"px",top:y.y+"px",width:y.width+"px",height:y.height+"px",border:"3px double white","background-color":"black"});var b=document.createElement("div");$(b).css({color:"white",width:"80%",height:"50%",left:"10%",top:"12.5%","font-size":"0.8em",overflow:"hidden",position:"relative","text-align":"center","text-overflow":"ellipsis","word-wrap":"break-word"});var w=TAG.Util.getMaxFontSizeEM(t,1,$(b).width(),$(b).height());if(f&&IS_WINDOWS){w=TAG.Util.getMaxFontSizeEM(t,.8,$(b).width(),$(b).height())}$(b).css("font-size",w);$(b).text(t).attr("id","popupmessage");$(h).append(b);TAG.Util.multiLineEllipsis($(b));var E=document.createElement("div");$(E).addClass("optionButtonDiv");$(E).css({height:"20%",width:"100%",position:"absolute",color:"white",bottom:"5%",right:"5%","text-align":"center"});$(h).append(E);$(l).append(h);var S=document.createElement("button");$(S).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"left","margin-left":"12%",color:"white","border-radius":"3.5px","margin-top":"1%"}).attr("id","popupConfirmButton");n=!n||n===""?"Confirm":n;$(S).text(n);S.onclick=function(){if(c){A()}else{$(h).remove()}e()};S.onkeydown=function(t){switch(t.which){case 13:A();e()}};$(E).append(S);var x=document.createElement("button");var T=$(x);T.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%",color:"white","margin-top":"1%","border-radius":"3.5px"}).attr("id","popupCancelButton");T.text("Cancel");$(E).append(x);if(a){T.text("Don't Save");$(E).css({right:"0%"});$(S).css({left:"12%",margin:"auto","margin-top":"1%"});var N=$(document.createElement("button"));N.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right",right:"12%",color:"white","margin-top":"1%","border-radius":"3.5px"}).text("Cancel");var C=$(x).width();var k=($(E).width()-C)/2;T.css({"float":"none",margin:"auto","margin-top":"1%"});$(E).append(N);N.click(function(){if(c){A()}else{$(h).remove()}})}x.onclick=function(){if(c){A()}else{$(h).remove()}i&&i()};if(f){T.text("No, I don't mind").css({"border-radius":"3.5px","background-color":"white",color:"black","font-weight":"bold"});$(S).css({"border-radius":"3.5px","font-weight":"bold"})}return l}function b(e){function y(){t.fadeOut(500,function(){t.remove()});s[0]=u}var t=$(m()),n=function(){e.cancelAction&&e.cancelAction();y()},r=function(){e.confirmAction&&e.confirmAction(h.val());y()},i={13:r},o=e.container||window,u=s[0],a=$(document.createElement("div")),f=TAG.Util.constrainAndPosition($(o).width(),$(o).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:200}),l=$(document.createElement("div")),c=$(document.createElement("div")),h=$(document.createElement("input")),p=e.message||"",d=$(document.createElement("button")),v=$(document.createElement("button")),g=e.confirmText||"";s[0]=i;a.css({position:"absolute",left:f.x+"px",top:f.y+"px",width:f.width+"px",height:f.height+"px",border:"3px double white","background-color":"black"});l.css({color:"white",width:"80%",height:"30%",left:"10%",top:"12.5%","font-size":"0.6em",position:"relative","text-align":"center","word-wrap":"break-word"});l.text(p);h.css({width:"60%",left:"20%",position:"relative"});h.attr({type:"text",placeholder:e.placeholder||"Paste URL here..."});c.addClass("optionButtonDiv");c.css({height:"20%",width:"100%",position:"absolute",bottom:"10%",right:"5%"});d.css({color:"white",padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"left","margin-left":"12%","margin-top":"-1%"});g=!g?"Confirm":g;d.text(g);d.on("click",r);d.on("keydown",function(e){switch(e.which){case 13:r()}});v.css({color:"white",padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%","margin-top":"-1%"});v.text("Cancel");v.on("click",n);c.append(v);c.append(d);a.append(l);a.append(h);a.append(c);t.append(a);return t}function w(e,t,n){switch(e){case"backButton":if(!n){$(t).css({"background-color":"gray","border-radius":"999px"})}else{$(t).css({"background-color":"transparent","border-radius":"999px"})}break;case"labelButton":$(t).css({"background-color":"white",color:"black"});break;case"forwardButton":$(t).css({"background-color":"gray"});break}}function E(e,t){e.on("mouseleave",function(){w("backButton",e,true)});e.on("mousedown",function(){w("backButton",e,false)});e.on("click",t)}function S(e,t,n){function f(){if(r&&i){if(n)n()}}var r=false,i=false,s=e.parent(),o=C(),u=C();var a=s.children();a.remove();a.appendTo($(o));$(o).css({left:"0%","float":"left"});$(u).append(t);$(u).css({left:"120%",display:"inline"});s.append(o);s.append(u);$(o).animate({left:"-120%"},1e3,"easeOutQuad",function(){$(o).remove();r=true;f()});$(u).animate({left:"0%"},1e3,"easeOutQuad",function(){$(u).detach();s.append(t);i=true;f()})}function x(e,t,n){function f(){if(r&&i){if(n)n()}}var r=false,i=false,s=e.parent(),o=C(),u=C(),a=s.children();a.detach();a.appendTo($(o));$(o).css({left:"0%","float":"left"});$(u).append(t);$(u).css({left:"-120%",display:"inline"});s.append(o);s.append(u);$(o).animate({left:"120%"},1e3,"easeOutQuad",function(){$(o).remove();r=true;f()});$(u).animate({left:"0%"},1e3,"easeOutQuad",function(){$(u).detach();s.append(t);i=true;f()})}function T(e,t){function a(){if(n&&r){if(t)t()}}var n=false;var r=false;var i=$("#tagRoot");var s=i.children();s.remove();var o=C();s.appendTo($(o));$(o).css({left:"0%","float":"left"});var u=C();$(u).append(e);$(u).css({left:"120%",display:"inline"});i.append(o);i.append(u);$(o).animate({left:"-120%"},1e3,"easeOutQuad",function(){$(o).remove();n=true;a()});$(u).animate({left:"0%"},1e3,"easeOutQuad",function(){$(u).detach();i.append(e);r=true;a()})}function N(e,t){function a(){if(n&&r){if(t)t()}}var n=false;var r=false;var i=$("#tagRoot");var s=i.children();s.remove();var o=C();s.appendTo($(o));$(o).css({left:"0%","float":"left"});var u=C();$(u).append(e);$(u).css({left:"-120%",display:"inline"});i.append(o);i.append(u);$(o).animate({left:"120%"},1e3,"easeOutQuad",function(){$(o).remove();n=true;a()});$(u).animate({left:"0%"},1e3,"easeOutQuad",function(){$(u).detach();i.append(e);r=true;a()})}function C(){var e=document.createElement("div");$(e).css({height:"100%",width:"100%",position:"absolute"});return e}function k(e){return"rgba("+L(e)+","+A(e)+","+O(e)+","}function L(e){return parseInt(M(e).substring(0,2),16)}function A(e){return parseInt(M(e).substring(2,4),16)}function O(e){return parseInt(M(e).substring(4,6),16)}function M(e){return e.charAt(0)==="#"?e.substring(1,7):e}function _(e,t){var n,r,i;e=e.replace(/\#/g,"");e=e.substring(0,6);n=parseInt(e.substring(0,2),16);r=parseInt(e.substring(2,4),16);i=parseInt(e.substring(4,6),16);return"rgba("+n+","+r+","+i+","+t+")"}function D(e){function n(e){var t=("0"+parseInt(e,10).toString(16)).toUpperCase();return t.slice(-2)}var t=e.match(/(rgb|rgba)\((\d+),\s*(\d+),\s*(\d+)\,*\s*((\d+\.\d+)|\d+)*\)$/);if(t!==null&&t!==undefined){return n(t[2])+n(t[3])+n(t[4])}else if(e==="transparent"){return"000000"}else{return"000000"}}function P(e,t){var n,r,i;t=t||3;e=e.replace(/\#/g,"");e=e.substring(0,6);n=Math.round(parseInt(e.substring(0,2),16)/t);r=Math.round(parseInt(e.substring(2,4),16)/t);i=Math.round(parseInt(e.substring(4,6),16)/t);return"rgb("+n+","+r+","+i+")"}function H(e,t,n){var r=parseInt(e.css("font-size"),10);if(parseInt(e.parent()[0].scrollHeight,10)>e.parent().height()){while(parseInt(e.parent()[0].scrollHeight,10)>e.parent().height()&&r>n){r--;e.css("font-size",r+"px")}}else if(parseInt(e.height(),10)<e.parent().height()){while(parseInt(e.height(),10)<e.parent().height()&&r<t){r++;e.css("font-size",r+"px");if(parseInt(e.parent()[0].scrollHeight,10)>e.parent().height()){r--;e.css("font-size",r);break}}}}function B(e,t){t.entities.clear();for(var n=0;n<e.length;n++){var r=e[n];var i;if(r.resource.latitude){i=r.resource}else{var s=r.resource.point.coordinates[0];var o=r.resource.point.coordinates[1];i=new Microsoft.Maps.Location(s,o)}var u={text:String(n+1),icon:tagPath+"images/icons/locationPin.png",width:20,height:30};var a=new Microsoft.Maps.Pushpin(i,u);a.location=r.address;a.description="";if(r.info){a.description=r.info}t.entities.push(a)}}function j(e,t){var n={text:String(t),icon:tagPath+"images/icons/locationPin.png",width:20,height:30};var r=new Microsoft.Maps.Pushpin(e.resource,n);r.location=e.address;r.description="";if(e.info){r.description=e.info}e.pushpin=r}function F(e,t){if(e.resource.latitude){j(e,t);return}var n=e.resource.point.coordinates[0];var r=e.resource.point.coordinates[1];var i=new Microsoft.Maps.Location(n,r);var s={text:String(t),icon:tagPath+"images/icons/locationPin.png",width:20,height:30};var o=new Microsoft.Maps.Pushpin(i,s);o.location=e.address;o.description="";if(e.info){o.description=e.info}e.pushpin=o}function I(e){var t;var n=e.RichLocationHistory||e.Location;try{t=JSON.parse(n)}catch(r){console.log("artwork location metadata cannot be parsed.");t=[];return t}if(t.locations){for(var i=0;i<t.locations.length;i++){var s=t.locations[i];if(s.date){if(s.date.getFullYear){var o=date.getUTCFullYear();var u=date.getUTCMonth();var a=date.getUTCDay();s.date={year:o,month:u,day:a}}}}return t.locations}else{for(var i=0;i<t.length;i++){var s=t[i];if(s.date){if(s.date.getFullYear){var o=date.getUTCFullYear();var u=date.getUTCMonth();var a=date.getUTCDay();s.date={year:o,month:u,day:a}}s.pushpin.date=s.date}}return t}}function R(e,i,o,u,a,f,l){function B(e){e.stopPropagation();e.preventDefault();if(b.is(":focus")){TAG.Util.searchData(b.val(),".compHolder",t)}else if(H.is(":disabled")){j.click()}else{P=TAG.Util.showProgressCircle(_,D);J();s[0]=A}}function F(e){return function(){L.clear();P=TAG.Util.showProgressCircle(_,D);b.attr("value","");b.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'});S.empty();$(".tab").css({"border-top":"1px solid black","border-right":"1px solid black","border-left":"1px solid black","border-bottom":"1px solid white"});$("#tab"+e).css({"border-top":"1px solid white","border-right":"1px solid white","border-left":"1px solid white","border-bottom":"1px solid black"});if(!k[e].cached){var t=(a[e].args||[]).concat([function(t){k[e].cached=true;k[e].comps=t;I(t)},q,R]);a[e].getObjs.apply(null,t)}else{I(k[e].comps)}}}function I(e){var t=[];for(var n=0;n<e.length;n++){if(!(u==="artwork"&&e[n].Metadata.Type==="VideoArtwork")){t.push(e[n])}}U(t,V);TAG.Util.removeProgressCircle(P)}function q(){console.log("ERROR IN TABHELPER")}function R(){q()}function U(e,t){if(e){x.length=0;T.length=0;N.length=0;e.sort(function(e,t){return e.Name.toLowerCase()<t.Name.toLowerCase()?-1:1});for(var n=0;n<e.length;n++){L.add(z(e[n],t),n)}}}function z(e,t,n){return function(){var r=$(document.createElement("div"));r.addClass("compHolder");r.attr("id",e.Identifier);r.data({type:e.Metadata.ContentType,guid:e.Identifier,name:e.Name,duration:e.Metadata.Duration,comp:e,year:e.Metadata.Year,artist:e.Metadata.Artist});var i=C.indexOf(e.Identifier)>=0;if(i){console.log("is selected")}r.data("selected",i);r.css({"float":"left",background:i?"#999":"#222",width:"15%",height:"35%",padding:"1%",margin:"1%","text-align":"center",border:"1px solid white",color:"white"});S.append(r);var s=$(document.createElement("div"));s.addClass("compHolderDiv");s.css({position:"relative",height:"75%",margin:"2%",width:"96%"});r.append(s);var o=$(document.createElement("img"));o.addClass("compHolderImage");var u=$(document.createElement("img"));u.addClass("typeIndicatorImage");var a=TAG.Worktop.Database.fixPath;var f=false;if(e.Metadata.ContentType==="Audio"){o.attr("src",tagPath+"images/audio_icon.svg")}else if(e.Metadata.ContentType==="Video"||e.Type==="Video"||e.Metadata.Type==="VideoArtwork"){o.attr("src",e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?a(e.Metadata.Thumbnail):tagPath+"images/video_icon.svg")}else if(e.Metadata.ContentType==="Image"||e.Type==="Image"){var l;if(e.Metadata.Thumbnail){l=a(e.Metadata.Thumbnail)}else if(e.Metadata.Source){l=a(e.Metadata.Source)}else{l=tagPath+"images/image_icon.svg"}o.attr("src",l)}else if(e.Metadata.ContentType==="iframe"){o.attr("src",tagPath+"images/video_icon.svg")}else if(e.Type==="Empty"||e.Metadata.ContentType==="Tour"){o.attr("src",e.Metadata.Thumbnail?a(e.Metadata.Thumbnail):tagPath+"images/icons/catalog_tour_icon.svg");f=true;u.attr("src",tagPath+"images/icons/catalog_tour_icon.svg")}else{o.attr("src",tagPath+"images/text_icon.svg")}o.css({"max-height":"100%",position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto",display:"block","max-width":"100%",width:"auto"});if(n<30){$(".compHolderImage").css({"max-height":"100%","max-width":"100%",width:"auto"})}s.append(o);if(f){u.css({position:"absolute",width:"20%",height:"auto",left:"75%",bottom:"5%","z-index":2});u.removeAttr("width");u.removeAttr("height");s.append(u)}var c=$(document.createElement("div"));c.addClass("compHolderText");var h=e.Name;c.text(h);c.css({"padding-left":"3%","font-size":"70%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",height:"22%",color:"white"});r.append(c);t(r)}}function W(e,t){var n=t.data("guid"),r=C.indexOf(n),i;if(t.data("selected")){t.data("selected",false);t.css("background","#222");if(r>=0){N.push(n)}else{i=x.indexOf(n);x.splice(i,1);T.splice(i,1)}}else{t.data("selected",true);t.css("background","#999");if(r>=0){N.remove(n)}else{x.push(n);T.push(t.data("comp"))}}}function X(e,t){var n=t.data("guid"),r=C.indexOf(n);t.css("background","#999");if(t.data("selected")!==true){if(r>=0){N.remove(n)}else{x.push(n);T.push(t.data("comp"))}t.data("selected",true)}J()}function V(e){e.click(function(t){var n=this;setTimeout(function(){var r=parseInt($(n).data("double"),10);if(r>0){$(n).data("double",r-1)}else{W.call(n,t,e)}},300)})}function J(){var e={};if(u==="artwork"&&o.type==="artwork"){for(var t=0;t<x.length;t++){if(r.indexOf(x[t])<0){r.push(x[t]);n.push(T[t])}}}if(x.length){e.AddIDs=x.join(",")}if(N.length){e.RemoveIDs=N.join(",")}if(x.length||N.length){if(u==="artwork"&&o.type==="artwork"){TAG.Worktop.Database.changeArtwork(o.comp.Identifier,e,function(){l();c.fadeOut();c.empty();c.remove()},function(e){console.log(e.message)},function(e){console.log(e.message)},function(e){console.log(e.message)})}else if(u==="artwork"&&o.type==="media"){TAG.Worktop.Database.changeHotspot(o.comp.Identifier,e,function(){l();c.fadeOut();c.empty();c.remove()},function(e){console.log(e.message)},function(e){console.log(e.message)},function(e){console.log(e.message)})}else if(u==="exhib"&&o.type==="exhib"){TAG.Worktop.Database.changeExhibition(o.comp.Identifier,e,function(){l();c.fadeOut();c.empty();c.remove()},function(e){console.log(e.message)},function(e){console.log(e.message)},function(e){console.log(e.message)})}}else{l();c.fadeOut();c.empty();c.remove()}if(u==="exhib"&&o.type==="exhib"){var i={position:"absolute",left:"40%",top:"40%","z-index":"50",height:"auto",width:"20%"};var s=$("#setViewViewer");var a=s.height()/2;var f=s.width()/2;var h=TAG.Util.showProgressCircle(s,i,f,a,true)}c.fadeOut();c.empty();c.remove()}var c,h,p,d,v,g,y,b,w,E,S,x=[],T=[],N=[],C=[],k=[],L=TAG.Util.createQueue(),A=s[0];s[0]={13:B};for(g=0;g<a.length;g++){k.push({cached:false,comps:[]})}var O=(f.args||[]).concat([function(e){for(g=0;g<e.length;g++){C.push(e[g].Identifier)}},q,R]);f.getObjs.apply(null,O);c=$(m());c.addClass("pickerOverlay");c.css("z-index",1e7);c.appendTo($(e));c.fadeIn();h=$(document.createElement("div"));h.addClass("picker");h.css({position:"absolute",width:"60%",height:"55%",padding:"1%","padding-left":"2%","background-color":"black",border:"3px double white",top:"22%",left:"20%"});c.append(h);p=$(document.createElement("div"));p.addClass("pickerHeading");p.text(i);p.css({width:"97%",color:"white","font-size":"120%",height:"7%","margin-bottom":"10px"});h.append(p);var M=TAG.Util.getMaxFontSizeEM(i,.7,p.width(),p.height());p.css("font-size",M);if(a.length>=2){d=$(document.createElement("div"));d.css({width:"100%",height:"8%",left:"5%"});d.attr("id","tabBanner");h.append(d);for(g=0;g<a.length;g++){v=$(document.createElement("div"));v.addClass("tab");v.attr("id","tab"+g);v.css({display:"inline-block","min-width":"18%",width:"auto","padding-left":"2%","padding-right":"2%","padding-top":"1%",height:"85%",color:"white","border-top":"1px solid "+(g===0?"white":"black"),"border-right":"1px solid "+(g===0?"white":"black"),"border-left":"1px solid "+(g===0?"white":"black"),"border-bottom":"1px solid "+(g===0?"black":"white"),"text-align":"center","font-size":"0.8em"});v.text(a[g].name);v.on("click",F(g));d.append(v)}v=$(document.createElement("div"));v.attr("id","extraSpaceAwwwwwYeahhhh");v.css({display:"inline-block",color:"black",width:90-20*a.length+"%",height:"100%","border-bottom":"1px solid white","border-left":"1px solid black"});v.text("_")}y=$(document.createElement("div"));y.attr("id","searchTab");y.css({height:"8%",width:"100%","margin-top":"2%",top:"13%"});h.append(y);b=$(document.createElement("input"));b.addClass("searchBar");b.attr("type","text");b.css({"margin-left":"1%",width:"20%",height:"55%"});b.keyup(function(e){e.stopPropagation();if(e.which===13){TAG.Util.searchData(b.val(),".compHolder",t)}});b.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")',"background-size":"auto 50%","background-repeat":"no-repeat","background-position":"8px center"});b.on("focus",function(){b.css({"background-image":"none"})});b.on("focusout",function(){if(!b.val()){b.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})}});y.append(b);b.on("keyup",function(){if(!b.val()){TAG.Util.searchData("",".compHolder",t)}});w=$(document.createElement("div"));w.attr("id","selectAllLabel");w.css({color:"#aaaaaa",display:"inline-block","margin-left":"5%","font-size":"0.8em"});w.text("Select All");w.on("click",function(){var e,t,n;H.prop("disabled",false);H.css("opacity","1");$.each($(".compHolder"),function(r,i){e=$(i);if(!e.data("selected")&&e.css("display")!=="none"){e.css("background","#999");e.data("selected",true);t=e.data("guid");n=C.indexOf(t);if(n>=0){N.remove(t)}else{x.push(t);T.push(e.data("comp"))}}})});y.append(w);E=$(document.createElement("div"));E.attr("id","deselectAllLabel");E.css({color:"#aaaaaa",display:"inline-block","margin-left":"5%","font-size":"0.8em"});E.text("Deselect All");E.on("click",function(){var e,t,n,r;H.prop("disabled",false);H.css("opacity","1");$.each($(".compHolder"),function(i,s){e=$(s);if(e.data("selected")&&e.css("display")!=="none"){e.css("background","#222");e.data("selected",false);t=e.data("guid");n=C.indexOf(t);if(n>=0){N.push(t)}else{r=x.indexOf(t);x.splice(r,1);T.splice(r,1)}}})});y.append(E);S=$(document.createElement("div"));S.attr("id","mainThumbnailContainer");S.css({"overflow-y":"scroll","margin-top":"10px",width:"100%"});h.append(S);S.css({height:h.height()-S.offset().top+h.offset().top-30+"px"});var _=$(document.createElement("div"));_.addClass("optionButtonDiv");_.css({height:"5%",width:"100%"});var D={left:"5%",top:"15px",width:"40px",height:"auto",position:"relative","z-index":50};var P;var H=$(document.createElement("button"));H.css({margin:"1%",border:"1px solid white",color:"white","padding-left":"1%","padding-right":"1%","background-color":"black",width:"auto",position:"relative","float":"right","border-radius":"3.5px"});H.text("Save");H.on("click",function(){H.attr("disabled",true).css({color:"rgba(255, 255, 255, 0.5)"});j.attr("disabled",true).css({color:"rgba(255, 255, 255, 0.5)"});$(".compHolder").off();P=TAG.Util.showProgressCircle(_,D);J();s[0]=A});var j=$(document.createElement("button")).css("border-radius","3.5px");j.css({margin:"1%",border:"1px solid white",width:"auto",color:"white","padding-left":"1%","padding-right":"1%","background-color":"black",position:"relative","float":"right","margin-right":"3%"});j.text("Cancel");j.on("click",function(){$(".compHolder").off();j.attr("disabled",true).css({color:"rgba(255, 255, 255, 0.5)"});H.attr("disabled",true).css({color:"rgba(255, 255, 255, 0.5)"});c.fadeOut(function(){c.empty();c.remove()});s[0]=A});_.append(j);_.append(H);h.append(_);F(0)();H.prop("disabled",true);H.css("opacity","0.4");$("#mainThumbnailContainer").on("click",function(e){H.prop("disabled",false);H.css("opacity","1")})}function U(e){e(n)}function z(e,t){function h(){n.fadeOut(500,function(){n.remove()})}var n=$(document.createElement("div")),r=$(document.createElement("div")),i=$(document.createElement("label")),s=$(document.createElement("input")),o=$(document.createElement("div")),u=$(document.createElement("button")),a=$("#tagRoot"),f=e.split(/#/)[0]+"#",l=0,c;t=t||{};n.attr("id","linkDialogOverlay");n.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":1e7});r.addClass("linkDialogContainer");r.css({position:"absolute",left:"20%",top:"25%",width:"62%",border:"3px double white","background-color":"black"});n.append(r);n.on("click",h);r.on("click",function(e){e.stopPropagation()});s.addClass("linkDialogInput");s.css({"border-color":"gray",color:"gray","font-size":"1.3em",position:"relative","margin-top":"20px","min-width":0,left:"10%",width:"80%"});s.attr("readonly",true);for(c in t){if(t.hasOwnProperty(c)&&(t[c]||t[c]===false)){f+=(l++>0?"&":"")+c+"="+t[c]}}if(!t.tagserver){f+=(l++>0?"&":"")+"tagserver="+localStorage.ip}s.attr({value:f,placeholder:"No page link available"});o.css({margin:"20px 0px 20px 0px",position:"relative",width:"80%",left:"10%","text-align":"center",display:"inline-block"});u.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","margin-right":"-2%",display:"inline-block"});u.text("Close");u.on("click",h);r.append(s);r.append(o);o.append(u);return n}var e="Search by Name, Artist, or Year...";var t=["visible","exhibits","selected","guid","url","comp"];var n=[];var r=[];var i="tagRoot";var s=[];return{slidePageLeftSplit:S,slidePageRightSplit:x,slidePageLeft:T,slidePageRight:N,hexToR:L,hexToG:A,hexToB:O,hexToRGB:k,hexToRGBA:_,colorToHex:D,dimColor:P,fitTextInDiv:H,drawPushpins:B,addPushpinToLoc:F,getLocationList:I,popUpMessage:g,PopUpConfirmation:y,popupInputBox:b,cgBackColor:w,setUpBackButton:E,blockInteractionOverlay:m,FeedbackBox:v,ChangeServerDialog:d,createAssociationPicker:R,getRecentlyAssociated:U,createCirc:h,createLine:p,createKeyframe:c,createDisplay:l,createTrack:f,getStack:a,initKeyHandler:o,keyHandler:u,showPageLink:z};var q={color:"#aaaaaa",display:"inline-block","margin-left":"20px"}}();TAG.Util.RLH=function(e){function z(){s=t.Metadata.RichLocationHistory?JSON.parse(unescape(t.Metadata.RichLocationHistory)):ot(t.Metadata.Location);c=s.locations||[];f=s.defaultMapShown;o=0;if(!IS_WINDOWS){var l=document.createElement("script");l.type="text/javascript";l.src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0&onscriptload=DrawMap";document.getElementsByTagName("head")[0].appendChild(l)}r=ut();i=at();w=false;b=false;E=$(document.createElement("div")).attr("id","locationHistoryOuterContainer").css({position:"absolute",top:"12%",left:e.authoring?"20%":"22%",width:"65%",height:"85%",display:"none","z-index":"51"}).appendTo(n);S=$(document.createElement("div")).attr("id","locationHistoryContainer").css({display:"inline-block",position:"relative",width:"100%",height:"100%",top:"0%",left:"0%","z-indez":99,"border-top-right-radius":"3.5px","border-bottom-right-radius":"3.5px","background-color":"rgba(0,0,0,0.75)"}).appendTo(E);x=$(document.createElement("div")).attr("id","locationHistoryTopRegion").css({position:"relative",width:"100%",height:"7%","font-size":".5em"}).appendTo(S);T=$(document.createElement("div")).attr("id","locationHistoryMetadataContainer").css({position:"absolute",width:"80%",height:"80%",top:"10%",left:"10%",display:"block"}).appendTo(x);if(e.authoring){N=$(document.createElement("input")).attr({id:"locationHistoryNameInput",placeholder:"Map name"}).css({position:"relative",width:"35%",height:"60%","max-height":"60px",top:"20%","font-size":"110%"}).appendTo(T);C=$(document.createElement("input")).attr({id:"locationHistoryAdditionalInfoInput",placeholder:"Date",maxlength:"15"}).css({position:"relative","margin-left":"10px",width:"20%",height:"60%","max-height":"60px",top:"20%","font-size":"110%"}).appendTo(T);k=$(document.createElement("button")).attr({id:"locationHistorySaveMapButton",type:"button"}).css({position:"relative","margin-left":"10px",top:"20%",height:"60%","max-height":"60px"}).text("Save").appendTo(T);k.on("click",K)}else{N=$(document.createElement("div")).attr({id:"locationHistoryNameHolder"}).css({"font-size":"2.5em",position:"absolute",top:"15%",height:"90%",width:"100%","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap",display:"block"}).appendTo(T);C=$(document.createElement("div")).attr({id:"locationHistoryAdditionalInfoHolder"}).css({"font-size":"2.5em",position:"absolute",top:"15%",right:"0%",height:"90%"}).appendTo(T)}L=$(document.createElement("div")).attr("id","locationHistoryMapRegion").css({position:"relative",width:"100%",height:"49%"}).appendTo(S);A=$(document.createElement("div")).attr("id","locationHistoryLeftArrowContainer").css({position:"absolute",width:"10%",height:"100%"}).appendTo(L);O=$(document.createElement("img")).attr("id","locationHistoryLeftArrowButton").attr("src",tagPath+"images/icons/Left.png").css({position:"absolute",width:"13px",height:"auto",right:"10%",top:"50%",cursor:"pointer"}).appendTo(A);M=$(document.createElement("div")).attr("id","locationHistoryMapContainer").css({top:"2%",position:"absolute",width:"80%",height:"100%",left:"10%",border:"1px solid white","background-color":"rgba(0,0,0,0.8)"}).appendTo(L);_=$(document.createElement("div")).attr("id","locationHistoryRightArrowContainer").css({position:"absolute",width:"10%",height:"100%",left:"90%"}).appendTo(L);D=$(document.createElement("img")).attr("id","locationHistoryRightArrowButton").attr("src",tagPath+"images/icons/Right.png").css({position:"absolute",width:"13px",height:"auto",left:"10%",top:"50%",cursor:"pointer"}).appendTo(_);m=$(document.createElement("div")).attr("id","defaultMapDisabledOverlay").css({"background-color":"rgba(0,0,0,0.85)",color:"white","font-size":"20px",height:"100%",position:"absolute","text-align":"center",top:"0%",width:"100%"}).text("Bing map is disabled.");g=$(document.createElement("div")).attr("id","importDisabledOverlay").css({"background-color":"rgba(0,0,0,0.5)",color:"white","font-size":"30px",height:"100%",position:"absolute","vertical-align":"middle","text-align":"center",top:"0%","z-index":"1000",display:"block",width:"100%",height:"100%",left:"0%"}).append($(document.createElement("div")).css({top:"30%",position:"relative"}).text("Loading..."));if(e.authoring){I=$(document.createElement("div")).attr("id","locationHistoryDotsContainer").css({"margin-left":"auto","margin-right":"auto","margin-top":"5px","margin-bottom":"5px",height:"30px",top:"100%","text-align":"center",display:"block"}).appendTo(S)}P=$(document.createElement("div")).attr("id","locationHistoryButtonsRegion").css({position:"relative",left:"10%",width:"80%",top:"0%",height:"6%","margin-bottom":"0%"}).appendTo(S);H=$(document.createElement("div")).attr("id","locationHistoryButtonsRegionDisabled").css({position:"absolute",left:"0",width:"100%",top:"0%",height:"100%","z-index":"100000",display:"none","background-color":"rgba(0,0,0,0.01)"}).appendTo(P);if(e.authoring){B=$(document.createElement("button")).attr({id:"locationHistoryAddLocationButton",type:"button"}).css({position:"relative","float":"left"}).appendTo(P).text("Add Location").css("border-radius","3.5px");j=$(document.createElement("button")).attr({id:"locationHistorySortLocationsByTitleButton",type:"button"}).css({position:"relative","margin-left":"10px","float":"left"}).appendTo(P).text("Sort By Title").css("border-radius","3.5px");F=$(document.createElement("button")).attr({id:"locationHistorySortLocationsByDateButton",type:"button"}).css({position:"relative","margin-left":"10px","float":"left"}).appendTo(P).text("Sort By Date").css("border-radius","3.5px");R=$(document.createElement("button")).attr({id:"locationHistoryImportMapButton",type:"button"}).css({position:"relative","float":"right"}).appendTo(P).text("Import Map").css("border-radius","3.5px");q=$(document.createElement("button")).attr({id:"locationHistoryDeleteButton",type:"button"}).css({position:"relative","margin-right":"10px","float":"right"}).text("Delete Map").appendTo(P).css("border-radius","3.5px");R.on("click",mt);q.on("click",function(e){var t=function(){if(u[o]){if(a[u[o]].Name.length>14){return"'"+a[u[o]].Name.substring(0,14)+"..."+"'"}else{return"'"+a[u[o]].Name+"'"}}else{return"Custom Map"}}();if(!(o===0)){var r=TAG.Util.UI.PopUpConfirmation(function(){dt()},"Are you sure you want to delete "+t+" and all locations associated with it?","Yes");n.append(r);$(r).show();e.stopPropagation()}else{dt()}});B.on("click",nt);j.on("click",it);F.on("click",st)}else{I=$(document.createElement("div")).attr("id","locationHistoryDotsContainer").css({position:"absolute",width:"40%",height:"50%",top:"50%",left:"30%","text-align":"center"}).appendTo(P)}U=$(document.createElement("div")).attr("id","locationHistoryLocationsRegion").css({top:"1%",position:"relative",width:"80%",left:"10%",height:"28%",color:"white","font-size":"11","font-weight":"300","overflow-y":"auto","overflow-x":"hidden"}).appendTo(S).text("No locations to display...");if(!e.authoring){U.css({top:"2%",height:"32%"})}O.on("click",function(){if(o-1>=0){Y(u[--o])}else{o=u.length-1;Y(u[o])}});D.on("click",function(){if(o+1<u.length){Y(u[++o])}else{o=0;Y(u[0])}});V();return E}function W(){N.css({visibility:"hidden"});C.css({visibility:"hidden"});k&&k.css({visibility:"hidden"});$(document.createElement("div")).attr({id:"bingMapNameHolder"}).css({"font-size":"2.5em","vertical-align":"middle",position:"absolute",top:"15%",height:"90%","z-index":"50",color:"white"}).text("Bing Map").appendTo(T);if(!e.authoring){$("#bingMapNameHolder").css({})}else{$("#bingMapNameHolder").css({})}}function X(){$("#bingMapNameHolder").remove();N.css({visibility:"visible"});C.css({visibility:"visible"});k&&k.css({visibility:"visible"})}function V(n){n=n||function(){if(!w){try{Y(u[o])}catch(e){Y(u[0])}}else{w=false;Y(u[u.length-1]);yt()}};u=f||e.authoring?[null]:[null];TAG.Worktop.Database.getMaps(t.Identifier,function(e){var t=e.length;if(t>0){for(var r=0;r<t;r++){a[e[r].Identifier]=e[r];u.push(e[r].Identifier)}}J(n);et()},function(){J(n);et()},function(){J(n);et()})}function J(e){var t,n,s,o,f={total:u.length,done:0},l,c;h={};M.empty();c=function(){e&&e();G()};for(t=0;t<u.length;t++){n=$(document.createElement("div")).addClass("locationHistoryMapHolder").css({position:"absolute",width:"100%",height:"100%",left:"0%",top:"0%","text-align":"center",display:"none"}).appendTo(M);h[u[t]]=n;l=u[t]?i:r;l.init({container:n,mapdoq:a[u[t]],progress:f,loadCallback:c})}}function K(){var e={left:"70%",top:"10px",width:"auto",height:"50%",position:"relative","z-index":50,display:"inline-block"};var t=TAG.Util.showProgressCircle(x,e);var n=o;if(u[n]){TAG.Worktop.Database.changeMap(a[u[n]],{Name:N.val()||"Custom Map",AdditionalInfo:C.val()},function(){var e=function(){if(N.val()){if(N.val().length>14){return"'"+N.val().substring(0,14)+"..."+"'"}else{return"'"+N.val()+"'"}}else{return"'Custom Map'"}}();q&&q.text("Delete "+e);TAG.Util.removeProgressCircle(t);TAG.Worktop.Database.getDoq(a[u[n]].Identifier,function(e){a[u[n]]=e})},TAG.Util.UI.errorContactingServerPopup,function(){TAG.Util.removeProgressCircle(t);TAG.Worktop.Database.getDoq(a[u[n]].Identifier,function(e){a[u[n]]=e})})}}function Q(t){var n,s;for(n=0;n<c.length;n++){if(!c[n].map&&!f&&!e.authoring){continue}s=c[n].map?i:r;if(!c[n].map||a[c[n].map]){s[t](c[n],a[c[n].map])}}}function G(){U.empty();Q("createLocationItem")}function Y(t){var n;X();o=u.indexOf(t);$(".locationHistoryMapDot").css("opacity","0.4");$("#dot-"+t).css("opacity","1");$(".locationHistoryMapHolder").css("display","none");h[t].css("display","block");if(e.authoring&&a[t]){N.attr("value",a[t].Name||"");C.attr("value",a[t].Metadata.AdditionalInfo||"")}else{N.text(a[t]?a[t].Name||"Custom Map":"Bing Map");C.text(a[t]?a[t].Metadata.AdditionalInfo||"":"")}if(!t){W();if(!f){h[null].append(m);q&&q.text("Show Bing Map")}else{q&&q.text("Hide Bing Map")}}else{var r=function(){if(a[t].Name){if(a[t].Name.length>14){return"'"+a[t].Name.substring(0,14)+"..."+"'"}else{return"'"+a[t].Name+"'"}}else{return"Custom Map"}}();q&&q.text("Delete "+r)}}function Z(e){var t=$(document.createElement("div"));t.css({color:"white","font-size":"20px",position:"relative","text-align":"center",width:"100%"});t.text(e||"Loading...");var n={left:"5%",top:"15px",width:"40px",height:"auto",position:"relative","z-index":50};var r=TAG.Util.showProgressCircle(t,n);U.empty();U.append(t)}function et(){var e,t;I.empty();for(e=0;e<u.length;e++){t=$(document.createElement("div")).addClass("locationHistoryMapDot").attr("id","dot-"+u[e]).css({display:"inline-block",cursor:"pointer","background-color":"white",border:"3px solid white","border-radius":"20px","border-color":"white",width:"6px",height:"6px","margin-left":"5px",opacity:"1"}).appendTo(I);t.on("click",tt(e))}}function tt(e){return function(){o=e;Y(u[e])}}function nt(){if(!y){y=true;var e=u[o],t=e?i:r,n=t.createLocationEditor();U.append(n.container);U.scrollTop(0);U.scrollTop(n.container.position().top+20)}}function rt(){y=false;$(".locationEditingContainer").remove()}function it(){var e;var n;if(!y){c.sort(function(e,t){return e.title.toLowerCase()<t.title.toLowerCase()?-1:1});for(e=0;e<d.entities.getLength();e++){d.entities.get(e).setOptions({visible:false})}for(n=0;n<v.length;n++){v[n].css({display:"none"})}G();TAG.Worktop.Database.changeArtwork(t.Identifier,{RichLocationHistory:ht()},r,i,i,i);function r(){}function i(){console.log("An error occured while saving.")}}}function st(){var e;var n;if(!y){c.sort(function(e,t){return e.date<t.date?-1:1});for(e=0;e<d.entities.getLength();e++){d.entities.get(e).setOptions({visible:false})}for(n=0;n<v.length;n++){v[n].css({display:"none"})}G();TAG.Worktop.Database.changeArtwork(t.Identifier,{RichLocationHistory:ht()},r,i,i,i);function r(){}function i(){console.log("An error occured while saving.")}}}function ot(e){var t=typeof e==="string"?JSON.parse(unescape(e)):e,n=[],r,i;for(i=0;i<t.length;i++){r=t[i];n.push({map:null,latitude:r.resource&&r.resource.point&&r.resource.point.coordinates&&r.resource.point.coordinates[0]?r.resource.point.coordinates[0]:0,longitude:r.resource&&r.resource.point&&r.resource.point.coordinates&&r.resource.point.coordinates[1]?r.resource.point.coordinates[1]:0,title:r.address||"",date:r.date==="string"?r.date:"",description:r.info||""})}return{defaultMapShown:true,locations:n}}function ut(){function n(e){function n(){var n={credentials:t,mapTypeID:Microsoft.Maps.MapTypeId.road,showScalebar:true,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showMapTypeSelector:false,zoom:2,center:new Microsoft.Maps.Location(20,0)};d=new Microsoft.Maps.Map(e.container[0],n);d.setView({mapTypeId:Microsoft.Maps.MapTypeId.road});if(++e.progress.done>=e.progress.total){e.loadCallback&&e.loadCallback()}}if(IS_WINDOWS){Microsoft.Maps.loadModule("Microsoft.Maps.Map",{callback:n})}else{Microsoft.Maps.loadModule("Microsoft.Maps.Themes.BingTheme",{callback:n})}}function r(e){function s(){if(!y){if(t.descContainer.css("display")==="block"){bt(t,i,false)}else{wt(t,i,false);U.scrollTop(0);U.scrollTop(i.container.position().top)}}}var t=e.location,n=e.editing,r=new Microsoft.Maps.Location(t.latitude,t.longitude),i;i=new Microsoft.Maps.Pushpin(r,{draggable:!!n,icon:tagPath+"images/icons/locationPin.svg",width:20,height:30});Microsoft.Maps.Events.addHandler(i,"click",s);d.entities.push(i);return i}function i(e){d.entities.remove(e.pushpin)}function s(e){function r(e){var t=$(document.createElement("div")).addClass("bingSearchResultContainer");t.css({position:"relative",width:"100%","padding-left":"10px","font-size":"20px"});t.text(e.address.formattedAddress);t.on("click",function(){$(".bingSearchResultContainer").css("background-color","rgba(0,0,0,0)");t.css("background-color","rgba(255,255,255,0.2)");if(!e.point||!e.point.coordinates||!e.point.coordinates.length){return}n.titleInput.attr("value",e.address.formattedAddress);n.pushpin.setLocation({latitude:e.point.coordinates[0],longitude:e.point.coordinates[1]});if(!e.bbox||!e.bbox.length){return}d.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(new Microsoft.Maps.Location(e.bbox[0],e.bbox[1]),new Microsoft.Maps.Location(e.bbox[2],e.bbox[3]))})});return t}function i(e,n,r){var i="http://dev.virtualearth.net/REST/v1/Locations?query="+encodeURI(e)+"&output=json&key="+t;$.ajax({url:i,success:n,error:r})}e=e||{};var n=lt({location:e.location,custom:false,mapguid:null,index:e.index,cancelClick:e.cancelClick});n.searchButton.on("click",function(){n.resultsDiv.css({"margin-bottom":"2%"});n.resultsDiv.empty();n.resultsDiv.text("Searching...");i(n.titleInput.val(),function(e){var t;if(!e||!e.resourceSets||!e.resourceSets[0]||!e.resourceSets[0].resources||!e.resourceSets[0].resources.length){n.resultsDiv.text("No results found.");return}n.resultsDiv.empty();for(t=0;t<e.resourceSets[0].resources.length;t++){n.resultsDiv.append(r(e.resourceSets[0].resources[t]))}$(".bingSearchResultContainer:eq(0)").click()},function(){n.resultsDiv.text("Error contacting Bing Maps. Please try again.")})});return n}function o(e){ft({location:e,custom:false})}var e,t="AkNHkEEn3eGC3msbfyjikl4yNwuy5Qt9oHKEnqh4BSqo5zGiMGOURNJALWUfhbmj";return{init:n,drawPushpin:r,removePushpin:i,createLocationEditor:s,createLocationItem:o}}function at(){function e(e){p={};var t=new TAG.AnnotatedImage({root:e.container,doq:e.mapdoq,callback:function(){t.openArtwork(e.mapdoq);p[e.mapdoq.Identifier]=t;t.initZoom();if(++e.progress.done>=e.progress.total){e.loadCallback&&e.loadCallback()}},noMedia:true,disableZoom:false})}function t(e){var t=e.location,n=e.mapdoq,r=e.editing,i=p[n.Identifier],s=$(document.createElement("img")),o;if(!i){return}s.attr({src:tagPath+"images/icons/locationPin.svg"});s.css({width:"20px",height:"30px","z-index":"1"});s.addClass("locationPushpin");v.push(s);if(r){s.attr({src:tagPath+"images/icons/locationPin2.svg"})}s.on("click",function(){if(!r){if(!y){if(t.descContainer.css("display")==="block"){bt(t,s,true)}else{wt(t,s,true);U.scrollTop(0);U.scrollTop(s.container.position().top)}}}});i.addOverlay(s[0],new Seadragon.Point(t.x,t.y),Seadragon.OverlayPlacement.BOTTOM);var u=true,a,f,l,c,d=parseFloat(s.css("width")),m=parseFloat(s.css("height"));TAG.Util.makeManipulatable(s[0],{onManipulate:function(e){if(r){if(u){i.pauseManip();u=false;l=s.css("top");c=s.css("left");i.removeOverlay(s[0]);s.appendTo(h[n.Identifier]);s.css({top:l,left:c,position:"absolute"})}if(i.isInViewportBounds(s)){l=parseFloat(s.css("top")),c=parseFloat(s.css("left"));s.css("top",l+e.translation.y+"px");s.css("left",c+e.translation.x+"px");a=c+e.translation.x+.5*d;f=l+e.translation.y+m;o=e.pivot}}},onRelease:function(e){if(r&&!u){u=true;if(!i.isInImageBounds(s)){var t=i.returnElementToBounds(s);s.css("top",t.y-m+"px");s.css("left",t.x-.5*d+"px");i.addOverlay(s[0],i.pointFromPixel(new Seadragon.Point(t.x,t.y)),Seadragon.OverlayPlacement.BOTTOM)}else{i.addOverlay(s[0],i.pointFromPixel(new Seadragon.Point(a,f)),Seadragon.OverlayPlacement.BOTTOM)}i.restartManip()}},onScroll:function(e,t){i.scroll(e,{x:d+parseFloat(s.css("left")),y:m+parseFloat(s.css("top"))})}},false,true);return s}function n(e){p[e.mapguid].removeOverlay(e.pushpin[0]);e.pushpin.remove()}function r(e){e=e||{};return lt({location:e.location,custom:true,mapguid:u[o],index:e.index,cancelClick:e.cancelClick})}function i(e,t){var n=ft({location:e,custom:true,mapguid:t.Identifier})}return{init:e,drawPushpin:t,removePushpin:n,createLocationEditor:r,createLocationItem:i}}function ft(t){var s=$(document.createElement("div")).addClass("locationItemContainer"),o=$(document.createElement("img")).addClass("locationItemDeleteButton"),u=$(document.createElement("img")).addClass("locationItemEditButton"),f=$(document.createElement("div")).addClass("locationItemTitle"),h=$(document.createElement("div")).addClass("locationItemDate"),v=$(document.createElement("div")).addClass("locationItemDesc"),m=t.location,g=t.custom,w=g?i:r,E=t.mapguid||null,S;m&&(m.descContainer=v);m&&(m.container=s);if(!m){console.log("please provide all options");return}S=w.drawPushpin({location:t.location,mapdoq:a[E],editing:false});S["container"]=s;s.css({margin:"0px 0px 10px 0px",position:"relative",width:"100%"});s.on("click",function(){if(!y){if(m.descContainer.css("display")==="block"){if(g){bt(m,S,true)}else{bt(m,S,false)}}else{if(g){p[E].panToPoint(S[0]);wt(m,S,true)}else{wt(m,S,false);if(!d.getBounds().contains(S.getLocation())){d.setView(new Microsoft.Maps.LocationRect.fromLocations(S.getLocation()))}}Y(E)}}});if(e.authoring){o.css({display:"inline-block",cursor:"pointer",height:"30px",margin:"2px",position:"relative","vertical-align":"middle",width:"30px"});o.attr("src",tagPath+"images/icons/delete.svg");o.on("click",function(e){var t=TAG.Util.UI.PopUpConfirmation(function(){index=c.indexOf(m);if(index>=0){c.splice(index,1);ct()}else{console.log("error")}},"Are you sure you want to delete this location?","Yes");n.append(t);$(t).show();e.stopPropagation()});u.css({display:"inline-block",cursor:"pointer",height:"30px",margin:"2px",position:"relative","vertical-align":"middle",width:"30px"});u.attr("src",tagPath+"images/icons/edit.png");u.on("click",function(e){if(!y){y=true;b=true;$(".locationItemDesc").css({display:"none"});$(".locationItemContainer").css("background-color","rgba(0,0,0,0)");$(".locationPushpin").attr("src",tagPath+"images/icons/locationPin.svg");for(l=0;l<d.entities.getLength();l++){d.entities.get(l).setOptions({icon:tagPath+"images/icons/locationPin.svg"})}if(g){S&&S.attr("src",tagPath+"images/icons/locationPin2.svg")}var n;Y(E);if(g){p[E].panToPoint(S[0])}else{if(!d.getBounds().contains(S.getLocation())){d.setView(new Microsoft.Maps.LocationRect.fromLocations(S.getLocation()))}}n=w.createLocationEditor({location:m,index:c.indexOf(m),cancelClick:function(){ft(t).insertAfter($(".locationEditingContainer"))}});s.after(n.container);s.detach();w.removePushpin({pushpin:S,mapguid:m.map});!g&&d.entities.get(d.entities.getLength()-1).setOptions({icon:tagPath+"images/icons/locationPin2.svg"});U.scrollTop(0);U.scrollTop(n.container.position().top+20)}})}f.css({display:"inline-block",margin:"0px 10px 0px 10px",position:"relative","vertical-align":"middle","max-font-size":"24px","min-font-size":"12px","font-size":n.height()/40});f.text(m.title?m.title+(m.date?",":""):m.date?"":"(Untitled Location)");!m.title&&f.css({margin:"0px 0px 0px 10px"});h.css({display:"inline-block",margin:"0px 0px 0px 0px",position:"relative","vertical-align":"middle","max-font-size":"24px","min-font-size":"12px","font-size":n.height()/40});h.text(m.date||"");v.css({display:"none",margin:"0px 0px 0px 80px",position:"relative","vertical-align":"middle","max-font-size":"24px","min-font-size":"12px","font-size":n.height()/50,"padding-right":"20px","font-style":"italic"});if(!e.authoring){v.css({margin:"0px 0px 0px 10px"})}v.text(m.description||"");if(v.text()===""){v.css("padding-bottom","0px")}else{v.css("padding-bottom","10px")}if(e.authoring){s.append(o);s.append(u)}s.append(f);s.append(h);s.append(v);U.append(s);return s}function lt(e){e=e||{};$(".locationItemContainer").css("background-color","rgba(0,0,0,0)");$(".locationItemDesc").css({display:"none"});$(".locationPushpin").attr("src",tagPath+"images/icons/locationPin.svg");for(var t=0;t<d.entities.getLength();t++){d.entities.get(t).setOptions({icon:tagPath+"images/icons/locationPin.svg"})}var s=$(document.createElement("div")).addClass("locationEditingContainer"),f=$(document.createElement("div")).addClass("locationOptionsContainer"),l=$(document.createElement("input")).addClass("locationTitleInput"),h=$(document.createElement("div")).addClass("locationLabel").text("Location Title"),v=$(document.createElement("div")).addClass("locationOptionsContainer"),m=$(document.createElement("input")).addClass("locationDateInput"),g=$(document.createElement("div")).addClass("locationLabel").text("Date"),w=$(document.createElement("div")).addClass("locationOptionsContainer"),E=$(document.createElement("textarea")).addClass("locationDescInput"),S=$(document.createElement("div")).addClass("locationLabel").text("Description"),x=$(document.createElement("div")).addClass("locationOptionsContainer"),T=$(document.createElement("button")).addClass("locationSaveButton"),N=$(document.createElement("button")).addClass("locationDeleteButton"),C=$(document.createElement("button")).addClass("locationCancelButton"),k,L,A=e.location,O=e.index,M=e.custom,_=e.mapguid,D=M?i:r,P,H=function(){y=false;e.cancelClick&&e.cancelClick();rt();D.removePushpin({pushpin:P,mapguid:_})};if(!M){if(!A||O<0||O>=c.length){var B=d.getBounds();var j=d.getCenter();A={latitude:j.latitude+.01*(B.getSouth()-B.getNorth()),longitude:j.longitude+.01*(B.getEast()-B.getWest())};O=c.length}}else{if(!A||O<0||O>=c.length){var F=p[_].createStartingPoint();A={x:F.x,y:F.y};O=c.length}}P=D.drawPushpin({location:A,mapdoq:a[_],editing:true});if(M){P.attr("src",tagPath+"images/icons/locationPin2.svg")}else{P.setOptions({icon:tagPath+"images/icons/locationPin2.svg"})}s.css({width:"100%",position:"relative",overflow:"auto",padding:"0px 4% 0px 0px","margin-bottom":"4%","margin-top":"2%"});h.css({width:"20%",display:"inline-block","vertical-align":"top","text-align":"right"});g.css({width:"20%",display:"inline-block","vertical-align":"top","text-align":"right"});S.css({width:"20%",display:"inline-block","vertical-align":"top","text-align":"right"});f.css({"margin-bottom":"2%"});v.css({"margin-bottom":"2%"});w.css({"margin-bottom":"2%"});l.css({position:"relative",width:"52%",left:"2%",display:"inline-block"});l.attr({placeholder:" Title",value:A.title?A.title:""});if(!M){l.css({width:"42%"});k=$(document.createElement("button")).addClass("locationEditorSearchButton").css("border-radius","3.5px");k.attr({type:"button"});k.text("Search");k.css({display:"inline-block","margin-left":"3.5%"});L=$(document.createElement("div")).addClass("locationEditorSearchResults");L.css({left:"22%","max-height":"200px","overflow-x":"hidden","overflow-y":"auto",position:"relative",width:"52.5%"})}l.on("keydown",function(e){e.stopPropagation();if(e.which===13&&k){e.preventDefault();k.click()}});m.css({position:"relative",width:"52%",left:"2%",display:"inline-block"});m.attr({placeholder:" Date",value:A.date?A.date:""});E.css({position:"relative",width:"49.75%",left:"2%",display:"inline-block"});E.attr({placeholder:" Description",rows:"3",value:A.description?A.description:""});x.css({display:"inline-block",position:"relative",left:"22%",width:"70%"});T.css({position:"relative","margin-right":"2%"}).css("border-radius","3.5px");T.text("Save Location");T.on("click",function(){var e,t,n=o;if(M){e=p[u[n]].getOverlayCoordinates(P[0]);t={map:u[n],title:l.val(),date:m.val(),description:E.val(),x:e.x,y:e.y}}else{e=P.getLocation();t={map:null,title:l.val(),date:m.val(),description:E.val(),latitude:e.latitude,longitude:e.longitude}}if(O>=0&&O<c.length){c[O]=t}else{c.push(t)}ct({callback:function(){Y(u[n])}});y=false});if(A){N.css({position:"relative","margin-right":"2%"});N.text("Delete").css("border-radius","3.5px");N.on("click",function(e){y=false;var t=TAG.Util.UI.PopUpConfirmation(function(){O=c.indexOf(A);if(O>=0&&O<c.length){c.splice(O,1)}ct()},"Are you sure you want to delete this location?","Yes");n.append(t);$(t).show();e.stopPropagation()})}C.css({position:"relative","margin-right":"2%"});C.text("Cancel").css("border-radius","3.5px");C.on("click",H);f.append(h);f.append(l);s.append(f);if(!M){f.append(k);s.append(L)}v.append(g);v.append(m);s.append(v);w.append(S);w.append(E);s.append(w);x.append(T);if(b){A&&x.append(N);b=false}x.append(C);s.append(x);if(M){return{container:s}}return{container:s,titleInput:l,searchButton:k,resultsDiv:L,pushpin:P}}function ct(e){function r(){TAG.Worktop.Database.getDoq(t.Identifier,function(n){if(n.Metadata){t=n}s=t.Metadata.RichLocationHistory?JSON.parse(unescape(t.Metadata.RichLocationHistory)):ot(t.Metadata.Location);c=s.locations||[];!e.noReload&&V(e.callback);St();if(f){m.remove()}else{m.text("Bing Map is disabled.")}},i,i)}function i(){console.log("An error occured while saving.");St();m.remove()}if($(".locationTitleInput").is(":focus")){return}Et();var n={RichLocationHistory:ht()};e=e||{};if(e.toadd){n.AddMaps=e.toadd}if(e.toremove){n.RemoveMaps=e.toremove}!e.noReload&&Z();TAG.Worktop.Database.changeArtwork(t.Identifier,n,r,i,i,i)}function ht(){return JSON.stringify({defaultMapShown:f,locations:c})}function pt(){f=!f;m.appendTo(h[null]);m.text("Loading...");q.text(f?"Hide Bing Map":"Show Bing Map")}function dt(){var e=u[o],t,n;if(e){vt(e);ct({toremove:e})}else{pt();ct({noReload:true})}}function vt(e){var t;for(t=c.length-1;t>=0;t--){if(c[t].map===e){c.splice(t,1)}}s={defaultMapShown:f,locations:c}}function mt(){y=false;w=true;var e,t;TAG.Authoring.FileUploader(n,TAG.Authoring.FileUploadTypes.Map,function(t){e=t},function(e){var t;if(!e.length&&e.length!==0){e=[e]}var t;try{t=new Worktop.Doq(e[0])}catch(n){console.log("error in uploading: "+n.message);return}u.push(t.Identifier);a[t.Identifier]=t;gt();ct({toadd:t.Identifier});J()},[".jpg",".png",".gif"],false,function(){n.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},false)}function gt(){S.append(g)}function yt(){g.remove()}function bt(e,t,n){e.descContainer.css({display:"none"});$(".locationItemContainer").css("background-color","rgba(0,0,0,0)");if(!n){t.setOptions({icon:tagPath+"images/icons/locationPin.svg"})}else{$(".locationPushpin").attr("src",tagPath+"images/icons/locationPin.svg")}}function wt(t,n,r){var i;$(".locationItemDesc").css({display:"none"});t.descContainer.css({display:"block"});$(".locationItemContainer").css("background-color","rgba(0,0,0,0)");n.container.css("background-color","rgba(255,255,255,0.2)");$(".locationPushpin").attr("src",tagPath+"images/icons/locationPin.svg");if(e.authoring||f){for(i=0;i<d.entities.getLength();i++){d.entities.get(i).setOptions({icon:tagPath+"images/icons/locationPin.svg"})}}if(!r){n.setOptions({icon:tagPath+"images/icons/locationPin2.svg"})}else{n&&n.attr("src",tagPath+"images/icons/locationPin2.svg")}}function Et(){H.css({display:"block"});$("#locationHistoryAddLocationButton").disabled=true;$("#locationHistoryAddLocationButton").css({color:"rgba(255, 255, 255, 0.5)"});$("#locationHistorySortLocationsByTitleButton").disabled=true;$("#locationHistorySortLocationsByTitleButton").css({color:"rgba(255, 255, 255, 0.5)"});$("#locationHistorySortLocationsByDateButton").disabled=true;$("#locationHistorySortLocationsByDateButton").css({color:"rgba(255, 255, 255, 0.5)"});$("#locationHistoryImportMapButton").disabled=true;$("#locationHistoryImportMapButton").css({color:"rgba(255, 255, 255, 0.5)"});$("#locationHistoryDeleteButton").disabled=true;$("#locationHistoryDeleteButton").css({color:"rgba(255, 255, 255, 0.5)"})}function St(){H.css({display:"none"});$("#locationHistoryAddLocationButton").disabled=false;$("#locationHistoryAddLocationButton").css({color:"rgba(255, 255, 255, 1.0)"});$("#locationHistorySortLocationsByTitleButton").disabled=false;$("#locationHistorySortLocationsByTitleButton").css({color:"rgba(255, 255, 255, 1.0)"});$("#locationHistorySortLocationsByDateButton").disabled=false;$("#locationHistorySortLocationsByDateButton").css({color:"rgba(255, 255, 255, 1.0)"});$("#locationHistoryImportMapButton").disabled=false;$("#locationHistoryImportMapButton").css({color:"rgba(255, 255, 255, 1.0)"});$("#locationHistoryDeleteButton").disabled=false;$("#locationHistoryDeleteButton").css({color:"rgba(255, 255, 255, 1.0)"})}var t=e.artwork,n=e.root,r,i,s,o,u=[],a={},f,c,h={},p={},d,v=[],m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U;if(!t||!n){console.log("need to provide input.artwork and input.root");return}return{init:z};Function.prototype.method=function(e,t){if(!this.prototype[e]){this.prototype[e]=t;return this}};Function.method("curry",function(){var e=Array.prototype.slice,t=e.apply(arguments),n=this;return function(){return n.apply(null,t.concat(e.apply(arguments)))}});Array.method("remove",function(e){var t=this.indexOf(e);if(t!==-1){this.splice(t,1);return true}else{return false}});Array.method("insert",function(e,t){var n;for(n=0;n<this.length;n++){if(t(this[n],e)){this.splice(n,0,e);return n}}this.push(e);return this.length-1});if(!Math.constrain){Math.constrain=function(e,t,n){return Math.min(n,Math.max(t,e))}}};TAG.Util.Artwork=function(){"use strict";function e(e){e=e||{};var t=e.title,n=e.year,r=e.handler,i=e.buttonClass,s=e.buttonID,o=e.src,u=e.width,a=e.height||.18*$("#tagRoot").height()+"px",f=$(document.createElement("div")).addClass("thumbnailButton"),l=$(document.createElement("div")).addClass("thumbnailHolderDiv"),c=$(document.createElement("div")).addClass("thumbnailButtonContainer"),h=$(document.createElement("div")).addClass("thumbnailButtonInnerContainer"),p=$(document.createElement("img")).addClass("thumbnailButtonImage"),d=$(document.createElement("div")).addClass("thumbnailButtonTitle"),v=$(document.createElement("div")).addClass("thumbnailButtonYear");i&&f.addClass(i);f.css("height",a);s&&f.attr("id",s);f.on("click",r);d.text(t);f.append(d);f.append(l);l.append(c);c.append(h);p.attr("src",o);p.removeAttr("width");p.removeAttr("height");if(i&&i==="assetHolder"){f.css({});d.css({margin:"1% 2% 0% 2%",top:"80%",height:"20%","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-align":"center","font-size":"75%",padding:"0% 3% 0% 3%"});l.css({height:"70%",position:"relative",width:"92%",margin:"-2% 4% 4% 4%",display:"block"});c.css({display:"block",position:"relative",width:"100%",height:"100%","margin-top":"5%"});h.css({display:"block",height:"100%",width:"100%","vertical-align":"middle","text-align":"center",position:"relative",top:"0%",left:"0%"});if(o.indexOf("svg")>-1){p.css({bottom:"0px",display:"block",height:"100%",left:"0px","margin-bottom":"auto","margin-left":"auto","margin-right":"auto","margin-top":"auto","max-height":"100%","max-width":"100%",position:"absolute",right:"0px",top:"0px",width:"auto"})}else{p.css({bottom:"0px",display:"block",height:"auto",left:"0px","margin-bottom":"auto","margin-left":"auto","margin-right":"auto","margin-top":"auto","max-height":"100%","max-width":"100%",position:"absolute",right:"0px",top:"0px",width:"auto"})}}else{p.css({bottom:"0px",height:"auto",left:"0px","margin-bottom":"auto","margin-left":"auto","margin-right":"auto","margin-top":"auto","max-height":"100%","max-width":"100%",position:"absolute",right:"0px",top:"0px",width:"auto"})}h.append(p);v.text(n);f.append(v);return f}return{createThumbnailButton:e}}();Function.prototype.method=function(e,t){if(!this.prototype[e]){this.prototype[e]=t;return this}};Function.method("curry",function(){var e=Array.prototype.slice,t=e.apply(arguments),n=this;return function(){return n.apply(null,t.concat(e.apply(arguments)))}});Array.method("remove",function(e){var t=this.indexOf(e);if(t!==-1){this.splice(t,1);return true}else{return false}});Array.method("insert",function(e,t){var n;for(n=0;n<this.length;n++){if(t(this[n],e)){this.splice(n,0,e);return n}}this.push(e);return this.length-1});if(!Math.constrain){Math.constrain=function(e,t,n){return Math.min(n,Math.max(t,e))}}Math.twoDecPlaces=function(e){return Math.floor(e*100)/100};(function(e,t,n){"use strict";function u(t){if(r.logging&&e.console&&e.console.log){e.console.log(t)}}function a(e){return{zindex:e,children:[]}}function f(e,t){var n=[];return{storage:n,width:e,height:t,fillRect:function(){n.push({type:"function",name:"fillRect",arguments:arguments})},drawImage:function(){n.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){n.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(e,t){n.push({type:"variable",name:e,arguments:t})}}}var r={},i,s,o;r.Util={};r.Util.backgroundImage=function(e){if(/data:image\/.*;base64,/i.test(e)||/^(-webkit|-moz|linear-gradient|-o-)/.test(e)){return e}if(e.toLowerCase().substr(0,5)==='url("'){e=e.substr(5);e=e.substr(0,e.length-2)}else{e=e.substr(4);e=e.substr(0,e.length-1)}return e};r.Util.Bounds=function(t){var n,r={};if(t.getBoundingClientRect){n=t.getBoundingClientRect();r.top=n.top;r.bottom=n.bottom||n.top+n.height;r.left=n.left;r.width=n.width||n.right-n.left;r.height=n.height||n.bottom-n.top;return r}};r.Util.getCSS=function(r,o){function a(e,t){var n=r.runtimeStyle&&r.runtimeStyle[e],i,s=r.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(t)&&/^-?\d/.test(t)){i=s.left;if(n){r.runtimeStyle.left=r.currentStyle.left}s.left=e==="fontSize"?"1em":t||0;t=s.pixelLeft+"px";s.left=i;if(n){r.runtimeStyle.left=n}}if(!/^(thin|medium|thick)$/i.test(t)){return Math.round(parseFloat(t))+"px"}return t}var u;if(e.getComputedStyle){if(i!==r){s=t.defaultView.getComputedStyle(r,null)}u=s[o];if(o==="backgroundPosition"){u=(u.split(",")[0]||"0 0").split(" ");u[0]=u[0].indexOf("%")===-1?a(o+"X",u[0]):u[0];u[1]=u[1]===n?u[0]:u[1];u[1]=u[1].indexOf("%")===-1?a(o+"Y",u[1]):u[1]}}else if(r.currentStyle){if(o==="backgroundPosition"){u=[a(o+"X",r.currentStyle[o+"X"]),a(o+"Y",r.currentStyle[o+"Y"])]}else{u=a(o,r.currentStyle[o]);if(/^(border)/i.test(o)&&/^(medium|thin|thick)$/i.test(u)){switch(u){case"thin":u="1px";break;case"medium":u="0px";break;case"thick":u="5px";break}}}}return u};r.Util.BackgroundPosition=function(e,t,n){var i=r.Util.getCSS(e,"backgroundPosition"),s,o,u,a;if(i.length===1){a=i;i=[];i[0]=a;i[1]=a}if(i[0].toString().indexOf("%")!==-1){u=parseFloat(i[0])/100;o=t.width*u-n.width*u}else{o=parseInt(i[0],10)}if(i[1].toString().indexOf("%")!==-1){u=parseFloat(i[1])/100;s=t.height*u-n.height*u}else{s=parseInt(i[1],10)}return{top:s,left:o}};r.Util.Extend=function(e,t){for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}return t};r.Util.Children=function(e){var t;try{t=e.nodeName&&e.nodeName.toUpperCase()==="IFRAME"?e.contentDocument||e.contentWindow.document:function(e){var t=[];if(e!==null){(function(e,t){var r=e.length,i=0;if(typeof t.length==="number"){for(var s=t.length;i<s;i++){e[r++]=t[i]}}else{while(t[i]!==n){e[r++]=t[i++]}}e.length=r;return e})(t,e)}return t}(e.childNodes)}catch(r){u("html2canvas.Util.Children failed with exception: "+r.message);t=[]}return t};(function(){r.Generate={};var e=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/];r.Generate.parseGradient=function(t,n){var r,i,s=e.length,o,u,a,f,l,c;for(i=0;i<s;i+=1){o=t.match(e[i]);if(o)break}if(o){switch(o[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":r={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};a=o[2].match(/\w+/g);if(a){f=a.length;for(i=0;i<f;i+=1){switch(a[i]){case"top":r.y0=0;r.y1=n.height;break;case"right":r.x0=n.width;r.x1=0;break;case"bottom":r.y0=n.height;r.y1=0;break;case"left":r.x0=0;r.x1=n.width;break}}}if(r.x0===null&&r.x1===null){r.x0=r.x1=n.width/2}if(r.y0===null&&r.y1===null){r.y0=r.y1=n.height/2}a=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(a){f=a.length;l=1/Math.max(f-1,1);for(i=0;i<f;i+=1){c=a[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(c[2]){u=parseFloat(c[2]);if(c[3]==="%"){u/=100}else{u/=n.width}}else{u=i*l}r.colorStops.push({color:c[1],stop:u})}}break;case"-webkit-gradient":r={type:o[2]==="radial"?"circle":o[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};a=o[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/);if(a){r.x0=a[1]*n.width/100;r.y0=a[2]*n.height/100;r.x1=a[3]*n.width/100;r.y1=a[4]*n.height/100}a=o[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g);if(a){f=a.length;for(i=0;i<f;i+=1){c=a[i].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/);u=parseFloat(c[2]);if(c[1]==="from")u=0;if(c[1]==="to")u=1;r.colorStops.push({color:c[3],stop:u})}}break;case"-moz-linear-gradient":r={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};a=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(a){r.x0=a[1]*n.width/100;r.y0=a[2]*n.height/100;r.x1=n.width-r.x0;r.y1=n.height-r.y0}a=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g);if(a){f=a.length;l=1/Math.max(f-1,1);for(i=0;i<f;i+=1){c=a[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/);if(c[2]){u=parseFloat(c[2]);if(c[3]){u/=100}}else{u=i*l}r.colorStops.push({color:c[1],stop:u})}}break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":r={type:"circle",x0:0,y0:0,x1:n.width,y1:n.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};a=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(a){r.cx=a[1]*n.width/100;r.cy=a[2]*n.height/100}a=o[3].match(/\w+/);c=o[4].match(/[a-z-]*/);if(a&&c){switch(c[0]){case"farthest-corner":case"cover":case"":var h=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.cy,2));var p=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.y1-r.cy,2));var d=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.y1-r.cy,2));var v=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.cy,2));r.rx=r.ry=Math.max(h,p,d,v);break;case"closest-corner":var h=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.cy,2));var p=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.y1-r.cy,2));var d=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.y1-r.cy,2));var v=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.cy,2));r.rx=r.ry=Math.min(h,p,d,v);break;case"farthest-side":if(a[0]==="circle"){r.rx=r.ry=Math.max(r.cx,r.cy,r.x1-r.cx,r.y1-r.cy)}else{r.type=a[0];r.rx=Math.max(r.cx,r.x1-r.cx);r.ry=Math.max(r.cy,r.y1-r.cy)}break;case"closest-side":case"contain":if(a[0]==="circle"){r.rx=r.ry=Math.min(r.cx,r.cy,r.x1-r.cx,r.y1-r.cy)}else{r.type=a[0];r.rx=Math.min(r.cx,r.x1-r.cx);r.ry=Math.min(r.cy,r.y1-r.cy)}break}}a=o[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(a){f=a.length;l=1/Math.max(f-1,1);for(i=0;i<f;i+=1){c=a[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(c[2]){u=parseFloat(c[2]);if(c[3]==="%"){u/=100}else{u/=n.width}}else{u=i*l}r.colorStops.push({color:c[1],stop:u})}}break}}return r};r.Generate.Gradient=function(e,n){var i=t.createElement("canvas"),s=i.getContext("2d"),o,a,f,l,c;i.width=n.width;i.height=n.height;o=r.Generate.parseGradient(e,n);c=new Image;if(o){if(o.type==="linear"){a=s.createLinearGradient(o.x0,o.y0,o.x1,o.y1);for(f=0,l=o.colorStops.length;f<l;f+=1){try{a.addColorStop(o.colorStops[f].stop,o.colorStops[f].color)}catch(h){u(["failed to add color stop: ",h,"; tried to add: ",o.colorStops[f],"; stop: ",f,"; in: ",e])}}s.fillStyle=a;s.fillRect(0,0,n.width,n.height);c.src=i.toDataURL()}else if(o.type==="circle"){a=s.createRadialGradient(o.cx,o.cy,0,o.cx,o.cy,o.rx);for(f=0,l=o.colorStops.length;f<l;f+=1){try{a.addColorStop(o.colorStops[f].stop,o.colorStops[f].color)}catch(h){u(["failed to add color stop: ",h,"; tried to add: ",o.colorStops[f],"; stop: ",f,"; in: ",e])}}s.fillStyle=a;s.fillRect(0,0,n.width,n.height);c.src=i.toDataURL()}else if(o.type==="ellipse"){var p=t.createElement("canvas"),d=p.getContext("2d"),v=Math.max(o.rx,o.ry),m=v*2,g;p.width=p.height=m;a=d.createRadialGradient(o.rx,o.ry,0,o.rx,o.ry,v);for(f=0,l=o.colorStops.length;f<l;f+=1){try{a.addColorStop(o.colorStops[f].stop,o.colorStops[f].color)}catch(h){u(["failed to add color stop: ",h,"; tried to add: ",o.colorStops[f],"; stop: ",f,"; in: ",e])}}d.fillStyle=a;d.fillRect(0,0,m,m);s.fillStyle=o.colorStops[f-1].color;s.fillRect(0,0,i.width,i.height);g=new Image;g.onload=function(){s.drawImage(g,o.cx-o.rx,o.cy-o.ry,2*o.rx,2*o.ry);c.src=i.toDataURL()};g.src=p.toDataURL()}}return c};r.Generate.ListAlpha=function(e){var t="",n;do{n=e%26;t=String.fromCharCode(n+64)+t;e=e/26}while(e*26>26);return t};r.Generate.ListRoman=function(e){var t=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],n=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],r="",i,s=t.length;if(e<=0||e>=4e3){return e}for(i=0;i<s;i+=1){while(e>=n[i]){e-=n[i];r+=t[i]}}return r}})();r.Parse=function(i,s){function k(){return{width:Math.max(Math.max(d.body.scrollWidth,d.documentElement.scrollWidth),Math.max(d.body.offsetWidth,d.documentElement.offsetWidth),Math.max(d.body.clientWidth,d.documentElement.clientWidth)),height:Math.max(Math.max(d.body.scrollHeight,d.documentElement.scrollHeight),Math.max(d.body.offsetHeight,d.documentElement.offsetHeight),Math.max(d.body.clientHeight,d.documentElement.clientHeight))}}function A(e,t){var n=parseInt(L(e,t),10);return isNaN(n)?0:n}function O(e,t,n,r,i,s){if(s!=="transparent"){e.setVariable("fillStyle",s);e.fillRect(t,n,r,i);h+=1}}function M(e,t){switch(t){case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(e,t,n){if(e.length>0){return t+n.toUpperCase()}});case"uppercase":return e.toUpperCase();default:return e}}function _(e){return e.replace(/^\s*/g,"").replace(/\s*$/g,"")}function D(e,t){if(p[e+"-"+t]!==n){return p[e+"-"+t]}var r=d.createElement("div"),i=d.createElement("img"),s=d.createElement("span"),o,u,a;r.style.visibility="hidden";r.style.fontFamily=e;r.style.fontSize=t;r.style.margin=0;r.style.padding=0;m.appendChild(r);i.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";i.width=1;i.height=1;i.style.margin=0;i.style.padding=0;i.style.verticalAlign="baseline";s.style.fontFamily=e;s.style.fontSize=t;s.style.margin=0;s.style.padding=0;s.appendChild(d.createTextNode("Hidden Text"));r.appendChild(s);r.appendChild(i);o=i.offsetTop-s.offsetTop+1;r.removeChild(s);r.appendChild(d.createTextNode("Hidden Text"));r.style.lineHeight="normal";i.style.verticalAlign="super";u=i.offsetTop-r.offsetTop+1;a={baseline:o,lineWidth:1,middle:u};p[e+"-"+t]=a;m.removeChild(r);return a}function P(e,t,n,r){if(_(e).length>0){r.fillText(e,t,n);h+=1}}function H(e,t,n){var i=n.ctx,u=L(e,"fontFamily"),a=L(e,"fontSize"),f=L(e,"color"),l=L(e,"textDecoration"),c=L(e,"textAlign"),h=L(e,"letterSpacing"),p,v,g,y,b,w=L(e,"fontWeight"),E=L(e,"fontStyle"),S=L(e,"fontVariant"),x=false,T,N,C=0,k,A,H,B,j,F;t.nodeValue=M(t.nodeValue,L(e,"textTransform"));v=_(t.nodeValue);if(v.length>0){if(l!=="none"){g=D(u,a)}c=c.replace(["-webkit-auto"],["auto"]);if(s.letterRendering===false&&/^(left|right|justify|auto)$/.test(c)&&/^(normal|none)$/.test(h)){y=t.nodeValue.split(/(\b| )/)}else{y=t.nodeValue.split("")}switch(parseInt(w,10)){case 401:w="bold";break;case 400:w="normal";break}i.setVariable("fillStyle",f);i.setVariable("font",E+" "+S+" "+w+" "+a+" "+u);if(x){i.setVariable("textAlign","right")}else{i.setVariable("textAlign","left")}k=t;for(A=0,b=y.length;A<b;A+=1){N=null;if(o.rangeBounds){if(l!=="none"||_(y[A]).length!==0){N=y[A];if(d.createRange){H=d.createRange();H.setStart(t,C);H.setEnd(t,C+N.length)}else{H=m.createTextRange()}if(H.getBoundingClientRect()){p=H.getBoundingClientRect()}else{p={}}}}else{if(typeof k.nodeValue!=="string"){continue}T=k.splitText(y[A].length);B=k.parentNode;j=d.createElement("wrapper");F=k.cloneNode(true);j.appendChild(k.cloneNode(true));B.replaceChild(j,k);p=r.Util.Bounds(j);N=k.nodeValue;k=T;B.replaceChild(F,j)}if(N!==null){P(N,p.left,p.bottom,i)}switch(l){case"underline":O(i,p.left,Math.round(p.top+g.baseline+g.lineWidth),p.width,1,f);break;case"overline":O(i,p.left,p.top,p.width,1,f);break;case"line-through":O(i,p.left,Math.ceil(p.top+g.middle+g.lineWidth),p.width,1,f);break}C+=y[A].length}}}function B(e,t){var n=d.createElement("boundelement"),i,s;n.style.display="inline";i=e.style.listStyleType;e.style.listStyleType="none";n.appendChild(d.createTextNode(t));e.insertBefore(n,e.firstChild);s=r.Util.Bounds(n);e.removeChild(n);e.style.listStyleType=i;return s}function j(e){var t=-1,n=1,r=e.parentNode.childNodes;if(e.parentNode){while(r[++t]!==e){if(r[t].nodeType===1){n++}}return n}else{return-1}}function F(e,t,n){var i=L(e,"listStylePosition"),s,o,u=L(e,"listStyleType"),a,f,l,c=L(e,"fontWeight");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(u)){a=j(e);switch(u){case"decimal":f=a;break;case"decimal-leading-zero":if(a.toString().length===1){f=a="0"+a.toString()}else{f=a.toString()}break;case"upper-roman":f=r.Generate.ListRoman(a);break;case"lower-roman":f=r.Generate.ListRoman(a).toLowerCase();break;case"lower-alpha":f=r.Generate.ListAlpha(a).toLowerCase();break;case"upper-alpha":f=r.Generate.ListAlpha(a);break}f+=". ";l=B(e,f);switch(c){case 401:c="bold";break;case 400:c="normal";break}S.setVariable("fillStyle",L(e,"color"));S.setVariable("font",L(e,"fontVariant")+" "+c+" "+L(e,"fontStyle")+" "+L(e,"fontSize")+" "+L(e,"fontFamily"));if(i==="inside"){S.setVariable("textAlign","left");s=n.left}else{return}o=l.bottom;P(f,s,o,S)}}function I(e){var t=i[e];if(t&&t.succeeded===true){return t.img}else{return false}}function q(e,t){var n=Math.max(e.left,t.left),r=Math.max(e.top,t.top),i=Math.min(e.left+e.width,t.left+t.width),s=Math.min(e.top+e.height,t.top+t.height);return{left:n,top:r,width:i-n,height:s-r}}function R(e,t){var n;if(!t){n=a(0);return n}if(e!=="auto"){c=true;n=a(e);t.children.push(n);return n}return t}function U(e,t,n,r){var i=n.left,s=n.top,o=n.width,u=n.height,a,f,l,c,h,p,d,v=function(e){var t=[],n=["Top","Right","Bottom","Left"],r;for(r=0;r<4;r+=1){t.push({width:A(e,"border"+n[r]+"Width"),color:L(e,"border"+n[r]+"Color")})}return t}(e);for(a=0;a<4;a+=1){f=v[a];if(f.width>0){l=i;c=s;h=o;p=u-v[2].width;switch(a){case 0:p=v[0].width;break;case 1:l=i+o-v[1].width;h=v[1].width;break;case 2:c=c+u-v[2].width;p=v[2].width;break;case 3:h=v[3].width;break}d={left:l,top:c,width:h,height:p};if(r){d=q(d,r)}if(d.width>0&&d.height>0){O(t,l,c,d.width,d.height,f.color)}}}return v}function z(e,t,n){var r=d.createElement("valuewrap"),i=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"],s,o,a,f,l;for(s=0,f=i.length;s<f;s+=1){l=i[s];try{r.style[l]=L(e,l)}catch(c){u("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}}r.style.borderColor="black";r.style.borderStyle="solid";r.style.display="block";r.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(e.type)||e.nodeName==="SELECT"){r.style.lineHeight=L(e,"height")}r.style.top=t.top+"px";r.style.left=t.left+"px";if(e.nodeName==="SELECT"){o=e.options[e.selectedIndex].text}else{o=e.value}a=d.createTextNode(o);r.appendChild(a);m.appendChild(r);H(e,a,n);m.removeChild(r)}function W(e,t,n,r,i,s,o,u,a,f){e.drawImage(t,n,r,i,s,o,u,a,f);h+=1}function X(e,t,n,r,i,s,o,u){var a=0,f=0;if(o-n>0){a=o-n}if(u-r>0){f=u-r}W(e,t,a,f,i-a,s-f,n+a,r+f,i-a,s-f)}function V(e,t,n,r,i,s,o){var u,a=Math.min(t.width,s),f;n.top=n.top-Math.ceil(n.top/t.height)*t.height;for(f=i+n.top;f<o+i;){if(Math.floor(f+t.height)>o+i){u=o+i-f}else{u=t.height}X(e,t,r+n.left,f,a,u,r,i);f=Math.floor(f+t.height)}}function $(e,t,n,r,i,s,o){var u=Math.min(t.height,o),a,f;n.left=n.left-Math.ceil(n.left/t.width)*t.width;for(f=r+n.left;f<s+r;){if(Math.floor(f+t.width)>s+r){a=s+r-f}else{a=t.width}X(e,t,f,i+n.top,a,u,r,i);f=Math.floor(f+t.width)}}function J(e,t,n){var i=L(e,"backgroundImage"),s=L(e,"backgroundRepeat").split(",")[0],o,a,f,l,c,h,p,d,v,m,g,y;if(!/data:image\/.*;base64,/i.test(i)&&!/^(-webkit|-moz|linear-gradient|-o-)/.test(i)){i=i.split(",")[0]}if(typeof i!=="undefined"&&/^(1|none)$/.test(i)===false){i=r.Util.backgroundImage(i);o=I(i);a=r.Util.BackgroundPosition(e,t,o);if(o){switch(s){case"repeat-x":$(n,o,a,t.left,t.top,t.width,t.height);break;case"repeat-y":V(n,o,a,t.left,t.top,t.width,t.height);break;case"no-repeat":l=t.width-a.left;v=t.height-a.top;c=a.left;h=a.top;p=a.left+t.left;d=a.top+t.top;if(c<0){c=Math.abs(c);p+=c;l=Math.min(t.width,o.width-c)}else{l=Math.min(l,o.width);c=0}if(h<0){h=Math.abs(h);d+=h;v=Math.min(t.height,o.height-h)}else{v=Math.min(v,o.height);h=0}if(v>0&&l>0){W(n,o,c,h,l,v,p,d,l,v)}break;default:a.top=a.top-Math.ceil(a.top/o.height)*o.height;for(f=t.top+a.top;f<t.height+t.top;){m=Math.min(o.height,t.height+t.top-f);if(Math.floor(f+o.height)>m+f){g=m+f-f}else{g=o.height}if(f<t.top){y=t.top-f;f=t.top}else{y=0}$(n,o,a,t.left,f,t.width,g);if(y>0){a.top+=y}f=Math.floor(f+o.height)-y}break}}else{u("html2canvas: Error loading background:"+i)}}}function K(e,t){var n=r.Util.Bounds(e),i=n.left,o=n.top,a=n.width,l=n.height,c,h=L(e,"backgroundColor"),p=L(e,"position"),d,m=L(e,"opacity"),g,y,b,w,E,S,T,N,C,M;if(!t){x=k();t={opacity:1}}else{x={}}d=R(L(e,"zIndex"),t.zIndex);g={ctx:f(x.width||a,x.height||l),zIndex:d,opacity:m*t.opacity,cssPosition:p};if(t.clip){g.clip=r.Util.Extend({},t.clip)}if(s.useOverflow===true&&/(hidden|scroll|auto)/.test(L(e,"overflow"))===true&&/(BODY)/i.test(e.nodeName)===false){if(g.clip){g.clip=q(g.clip,n)}else{g.clip=n}}y=d.children.push(g);w=d.children[y-1].ctx;w.setVariable("globalAlpha",g.opacity);b=U(e,w,n,false);g.borders=b;if(v.test(e.nodeName)&&s.iframeDefault!=="transparent"){if(s.iframeDefault==="default"){h="#efefef"}else{h=s.iframeDefault}}E={left:i+b[3].width,top:o+b[0].width,width:a-(b[1].width+b[3].width),height:l-(b[0].width+b[2].width)};if(g.clip){E=q(E,g.clip)}if(E.height>0&&E.width>0){O(w,E.left,E.top,E.width,E.height,h);J(e,E,w)}switch(e.nodeName){case"IMG":S=e.getAttribute("src");c=I(S);if(c){T=A(e,"paddingLeft");N=A(e,"paddingTop");C=A(e,"paddingRight");M=A(e,"paddingBottom");W(w,c,0,0,c.width,c.height,i+T+b[3].width,o+N+b[0].width,n.width-(b[1].width+b[3].width+T+C),n.height-(b[0].width+b[2].width+N+M))}else{u("html2canvas: Error loading <img>:"+S)}break;case"INPUT":if(/^(text|url|email|submit|button|reset)$/.test(e.type)&&e.value.length>0){z(e,n,g)}break;case"TEXTAREA":if(e.value.length>0){z(e,n,g)}break;case"SELECT":if(e.options.length>0){z(e,n,g)}break;case"LI":F(e,g,E);break;case"CANVAS":T=A(e,"paddingLeft");N=A(e,"paddingTop");C=A(e,"paddingRight");M=A(e,"paddingBottom");W(w,e,0,0,e.width,e.height,i+T+b[3].width,o+N+b[0].width,n.width-(b[1].width+b[3].width+T+C),n.height-(b[0].width+b[2].width+N+M));break}return d.children[y-1]}function Q(e,t){if(L(e,"display")!=="none"&&L(e,"visibility")!=="hidden"){t=K(e,t)||t;S=t.ctx;if(!v.test(e.nodeName)){var n=r.Util.Children(e),i,s,o;for(i=0,o=n.length;i<o;i+=1){s=n[i];if(s.nodeType===1){Q(s,t)}else if(s.nodeType===3){H(e,s,t)}}}}}e.scroll(0,0);var o={rangeBounds:false,svgRendering:s.svgRendering&&function(){var e=new Image,r=t.createElement("canvas"),i=r.getContext===n?false:r.getContext("2d");if(i===false){return false}r.width=r.height=10;e.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{i.drawImage(e,0,0);r.toDataURL()}catch(s){return false}u("html2canvas: Parse: SVG powered rendering available");return true}()},l=s.elements===n?t.body:s.elements[0],c=false,h=0,p={},d=l.ownerDocument,v=new RegExp("("+s.ignoreElements+")"),m=d.body,g,y,b,w,E,S,x,T,N,C;i=i||{};if(d.createRange){g=d.createRange();if(g.getBoundingClientRect){y=d.createElement("boundtest");y.style.height="123px";y.style.display="block";m.appendChild(y);g.selectNode(y);b=g.getBoundingClientRect();w=b.height;if(w===123){o.rangeBounds=true}m.removeChild(y)}}var L=r.Util.getCSS;E=K(l,null);if(o.svgRendering){(function(e){function s(e){var t=r.Util.Children(e),n=t.length,o,u,a,f,l;for(l=0;l<n;l+=1){f=t[l];if(f.nodeType===3){i+=f.nodeValue.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}else if(f.nodeType===1){if(!/^(script|meta|title)$/.test(f.nodeName.toLowerCase())){i+="<"+f.nodeName.toLowerCase();if(f.hasAttributes()){o=f.attributes;a=o.length;for(u=0;u<a;u+=1){i+=" "+o[u].name+'="'+o[u].value+'"'}}i+=">";s(f);i+="</"+f.nodeName.toLowerCase()+">"}}}}var t=new Image,n=k(),i="";s(e);t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+n.width+"' height='"+n.height+"'>","<foreignObject width='"+n.width+"' height='"+n.height+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",i.replace(/\#/g,"%23"),"</html>","</foreignObject>","</svg>"].join("");t.onload=function(){E.svgRender=t}})(t.documentElement)}for(T=0,N=l.children,C=N.length;T<C;T+=1){Q(N[T],E)}E.backgroundColor=L(t.documentElement,"backgroundColor");return E};r.Preload=function(i){function y(e){v.href=e;v.href=v.href;var t=v.protocol+v.host;return t===o}function b(){u("html2canvas: start: images: "+s.numLoaded+" / "+s.numTotal+" (failed: "+s.numFailed+")");if(!s.firstRun&&s.numLoaded>=s.numTotal){u("Finished loading images: # "+s.numTotal+" (failed: "+s.numFailed+")");if(typeof i.complete==="function"){i.complete(s)}}}function w(t,r,o){var u,a=i.proxy,f;v.href=t;t=v.href;u="html2canvas_"+l++;o.callbackname=u;if(a.indexOf("?")>-1){a+="&"}else{a+="?"}a+="url="+encodeURIComponent(t)+"&callback="+u;f=h.createElement("script");e[u]=function(t){if(t.substring(0,6)==="error:"){o.succeeded=false;s.numLoaded++;s.numFailed++;b()}else{S(r,o);r.src=t}e[u]=n;try{delete e[u]}catch(i){}f.parentNode.removeChild(f);f=null;delete o.script;delete o.callbackname};f.setAttribute("type","text/javascript");f.setAttribute("src",a);o.script=f;e.document.body.appendChild(f)}function E(e){var t=r.Util.Children(e),i,o,f,l,c=false;try{var h=t.length;for(i=0;i<h;i+=1){E(t[i])}}catch(p){}try{c=e.nodeType}catch(d){c=false;u("html2canvas: failed to access some element's nodeType - Exception: "+d.message)}if(c===1||c===n){try{o=r.Util.getCSS(e,"backgroundImage")}catch(p){u("html2canvas: failed to get background-image - Exception: "+p.message)}if(o&&o!=="1"&&o!=="none"){if(/^(-webkit|-o|-moz|-ms|linear)-/.test(o)){l=r.Generate.Gradient(o,r.Util.Bounds(e));if(l!==n){s[o]={img:l,succeeded:true};s.numTotal++;s.numLoaded++;b()}}else{f=r.Util.backgroundImage(o.match(/data:image\/.*;base64,/i)?o:o.split(",")[0]);a.loadImage(f)}}}}function S(t,r){t.onload=function(){if(r.timer!==n){e.clearTimeout(r.timer)}s.numLoaded++;r.succeeded=true;t.onerror=t.onload=null;b()};t.onerror=function(){if(t.crossOrigin==="anonymous"){e.clearTimeout(r.timer);if(i.proxy){var n=t.src;t=new Image;r.img=t;t.src=n;w(t.src,t,r);return}}s.numLoaded++;s.numFailed++;r.succeeded=false;t.onerror=t.onload=null;b()}}var s={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:false},o,a,f,l=0,c=i.elements[0]||t.body,h=c.ownerDocument,p=h.images,d=p.length,v=h.createElement("a"),m=function(e){return e.crossOrigin!==n}(new Image),g;v.href=e.location.href;o=v.protocol+v.host;a={loadImage:function(t){var r,o;if(t&&s[t]===n){r=new Image;if(t.match(/data:image\/.*;base64,/i)){r.src=t.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,"");o=s[t]={img:r};s.numTotal++;S(r,o)}else if(y(t)||i.allowTaint===true){o=s[t]={img:r};s.numTotal++;S(r,o);r.src=t}else if(m&&!i.allowTaint&&i.useCORS){r.crossOrigin="anonymous";o=s[t]={img:r};s.numTotal++;S(r,o);r.src=t;r.customComplete=function(){if(!this.img.complete){this.timer=e.setTimeout(this.img.customComplete,100)}else{this.img.onerror()}}.bind(o);r.customComplete()}else if(i.proxy){o=s[t]={img:r};s.numTotal++;w(t,r,o)}}},cleanupDOM:function(r){var o,a;if(!s.cleanupDone){if(r&&typeof r==="string"){u("html2canvas: Cleanup because: "+r)}else{u("html2canvas: Cleanup after timeout: "+i.timeout+" ms.")}for(a in s){if(s.hasOwnProperty(a)){o=s[a];if(typeof o==="object"&&o.callbackname&&o.succeeded===n){e[o.callbackname]=n;try{delete e[o.callbackname]}catch(f){}if(o.script&&o.script.parentNode){o.script.setAttribute("src","about:blank");o.script.parentNode.removeChild(o.script)}s.numLoaded++;s.numFailed++;u("html2canvas: Cleaned up failed img: '"+a+"' Steps: "+s.numLoaded+" / "+s.numTotal)}}}if(e.stop!==n){e.stop()}else if(t.execCommand!==n){t.execCommand("Stop",false)}if(t.close!==n){t.close()}s.cleanupDone=true;if(!(r&&typeof r==="string")){b()}}},renderingDone:function(){if(g){e.clearTimeout(g)}}};if(i.timeout>0){g=e.setTimeout(a.cleanupDOM,i.timeout)}u("html2canvas: Preload starts: finding background-images");s.firstRun=true;E(c);u("html2canvas: Preload: Finding images");for(f=0;f<d;f+=1){a.loadImage(p[f].getAttribute("src"))}s.firstRun=false;u("html2canvas: Preload: Done.");if(s.numTotal===s.numLoaded){b()}return a};r.Renderer=function(e,n){function s(e){var t=[],n=[],r=e.children,o,u,a,f,l,c,h,p;for(o=0,l=r.length;o<l;o+=1){c=r[o];if(c.children&&c.children.length>0){t.push(c);n.push(c.zindex)}else{i.push(c)}}n.sort(function(e,t){return e-t});for(u=0,a=n.length;u<a;u+=1){f=n[u];for(h=0,p=t.length;h<=p;h+=1){if(t[h].zindex===f){c=t.splice(h,1);s(c[0]);break}}}}var i=[];s(e.zIndex);if(typeof n._renderer._create!=="function"){throw new Error("Invalid renderer defined")}return n._renderer._create(e,n,t,i,r)};o=function(t,i){var s,o,a={logging:false,elements:t,proxy:"http://html2canvas.appspot.com/",timeout:0,useCORS:false,allowTaint:false,svgRendering:false,iframeDefault:"default",ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:true,letterRendering:false,flashcanvas:n,width:null,height:null,taintTest:true,renderer:"Canvas"},f;a=r.Util.Extend(i,a);if(typeof a.renderer==="string"&&r.Renderer[a.renderer]!==n){a._renderer=r.Renderer[a.renderer](a)}else if(typeof a.renderer==="function"){a._renderer=a.renderer(a)}else{throw"Unknown renderer"}r.logging=a.logging;a.complete=function(e){if(typeof a.onpreloaded==="function"){if(a.onpreloaded(e)===false){return}}s=r.Parse(e,a);if(typeof a.onparsed==="function"){if(a.onparsed(s)===false){return}}o=r.Renderer(s,a);if(typeof a.onrendered==="function"){a.onrendered(o)}};e.setTimeout(function(){r.Preload(a)},0);return{render:function(e,t){return r.Renderer(e,r.Util.Extend(t,a))},parse:function(e,t){return r.Parse(e,r.Util.Extend(t,a))},preload:function(e){return r.Preload(r.Util.Extend(e,a))},log:u}};o.log=u;o.Renderer={Canvas:n};r.Renderer.Canvas=function(r){r=r||{};var i=t,s=r.canvas||i.createElement("canvas"),o=false,a=false,f=false,l,c=2880;if(s.getContext){u("html2canvas: Renderer: using canvas renderer");f=true}else if(r.flashcanvas!==n){o=true;u("html2canvas: Renderer: canvas not available, using flashcanvas");var h=i.createElement("script");h.src=r.flashcanvas;h.onload=function(t,r){var i;if(t.onload===n){if(t.onreadystatechange!==n){i=function(){if(t.readyState!=="loaded"&&t.readyState!=="complete"){e.setTimeout(i,250)}else{r()}};e.setTimeout(i,250)}else{u("html2canvas: Renderer: Can't track when flashcanvas is loaded")}}else{return r}}(h,function(){if(typeof e.FlashCanvas!=="undefined"){u("html2canvas: Renderer: Flashcanvas initialized");e.FlashCanvas.initElement(s);f=true;if(a!==false){l._create.apply(null,a)}}});i.body.appendChild(h)}l={_create:function(e,r,i,l,h){if(!f){a=arguments;return s}var p=s.getContext("2d"),d,v,m,g,y,b,w=t.createElement("canvas"),E=w.getContext!==n,S,x,T=E?w.getContext("2d"):{},N=[],C;s.width=s.style.width=!o?r.width||e.ctx.width:Math.min(c,r.width||e.ctx.width);s.height=s.style.height=!o?r.height||e.ctx.height:Math.min(c,r.height||e.ctx.height);C=p.fillStyle;p.fillStyle=e.backgroundColor;p.fillRect(0,0,s.width,s.height);p.fillStyle=C;if(r.svgRendering&&e.svgRender!==n){p.drawImage(e.svgRender,0,0)}else{for(v=0,m=l.length;v<m;v+=1){d=l.splice(0,1)[0];d.canvasPosition=d.canvasPosition||{};p.textBaseline="bottom";if(d.clip){p.save();p.beginPath();p.rect(d.clip.left,d.clip.top,d.clip.width,d.clip.height);p.clip()}if(d.ctx.storage){for(g=0,S=d.ctx.storage.length;g<S;g+=1){x=d.ctx.storage[g];switch(x.type){case"variable":p[x.name]=x["arguments"];break;case"function":if(x.name==="fillRect"){if(!o||x["arguments"][0]+x["arguments"][2]<c&&x["arguments"][1]+x["arguments"][3]<c){p.fillRect.apply(p,x["arguments"])}}else if(x.name==="fillText"){if(!o||x["arguments"][1]<c&&x["arguments"][2]<c){p.fillText.apply(p,x["arguments"])}}else if(x.name==="drawImage"){if(x["arguments"][8]>0&&x["arguments"][7]){if(E&&r.taintTest){if(N.indexOf(x["arguments"][0].src)===-1){T.drawImage(x["arguments"][0],0,0);try{T.getImageData(0,0,1,1)}catch(k){w=i.createElement("canvas");T=w.getContext("2d");continue}N.push(x["arguments"][0].src)}}p.drawImage.apply(p,x["arguments"])}}break;default:}}}if(d.clip){p.restore()}}}u("html2canvas: Renderer: Canvas renderer done - returning canvas obj");m=r.elements.length;if(m===1){if(typeof r.elements[0]==="object"&&r.elements[0].nodeName!=="BODY"&&o===false){b=h.Util.Bounds(r.elements[0]);y=i.createElement("canvas");y.width=b.width;y.height=b.height;p=y.getContext("2d");p.drawImage(s,b.left,b.top,b.width,b.height,0,0,b.width,b.height);s=null;return y}}return s}};return l};e.html2canvas=o})(window,document);(function(e){e.extend(e.fn,{livequery:function(t,n,r){var i=this,s;if(e.isFunction(t))r=n,n=t,t=undefined;e.each(e.livequery.queries,function(e,o){if(i.selector==o.selector&&i.context==o.context&&t==o.type&&(!n||n.$lqguid==o.fn.$lqguid)&&(!r||r.$lqguid==o.fn2.$lqguid))return(s=o)&&false});s=s||new e.livequery(this.selector,this.context,t,n,r);s.stopped=false;s.run();return this},expire:function(t,n,r){var i=this;if(e.isFunction(t))r=n,n=t,t=undefined;e.each(e.livequery.queries,function(s,o){if(i.selector==o.selector&&i.context==o.context&&(!t||t==o.type)&&(!n||n.$lqguid==o.fn.$lqguid)&&(!r||r.$lqguid==o.fn2.$lqguid)&&!this.stopped)e.livequery.stop(o.id)});return this}});e.livequery=function(t,n,r,i,s){this.selector=t;this.context=n;this.type=r;this.fn=i;this.fn2=s;this.elements=[];this.stopped=false;this.id=e.livequery.queries.push(this)-1;i.$lqguid=i.$lqguid||e.livequery.guid++;if(s)s.$lqguid=s.$lqguid||e.livequery.guid++;return this};e.livequery.prototype={stop:function(){var e=this;if(this.type)this.elements.unbind(this.type,this.fn);else if(this.fn2)this.elements.each(function(t,n){e.fn2.apply(n)});this.elements=[];this.stopped=true},run:function(){if(this.stopped)return;var t=this;var n=this.elements,r=e(this.selector,this.context),i=r.not(n);this.elements=r;if(this.type){i.bind(this.type,this.fn);if(n.length>0)e.each(n,function(n,i){if(e.inArray(i,r)<0)e.event.remove(i,t.type,t.fn)})}else{i.each(function(){t.fn.apply(this)});if(this.fn2&&n.length>0)e.each(n,function(n,i){if(e.inArray(i,r)<0)t.fn2.apply(i)})}}};e.extend(e.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(e.livequery.running&&e.livequery.queue.length){var t=e.livequery.queue.length;while(t--)e.livequery.queries[e.livequery.queue.shift()].run()}},pause:function(){e.livequery.running=false},play:function(){e.livequery.running=true;e.livequery.run()},registerPlugin:function(){e.each(arguments,function(t,n){if(!e.fn[n])return;var r=e.fn[n];e.fn[n]=function(){var t=r.apply(this,arguments);e.livequery.run();return t}})},run:function(t){if(t!=undefined){if(e.inArray(t,e.livequery.queue)<0)e.livequery.queue.push(t)}else e.each(e.livequery.queries,function(t){if(e.inArray(t,e.livequery.queue)<0)e.livequery.queue.push(t)});if(e.livequery.timeout)clearTimeout(e.livequery.timeout);e.livequery.timeout=setTimeout(e.livequery.checkQueue,20)},stop:function(t){if(t!=undefined)e.livequery.queries[t].stop();else e.each(e.livequery.queries,function(t){e.livequery.queries[t].stop()})}});e.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html");e(function(){e.livequery.play()})})(jQuery);var Autolinker={htmlRegex:/<(\/)?(\w+)(?:(?:\s+\w+(?:\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)\/?>/g,prefixRegex:/^(https?:\/\/)?(www\.)?/,link:function(e,t){function v(e){e=e.replace(r,function(e,t,n,r,l,c){var h=t,p=n,d=r,v=l,m=c,g="",y="",b=[];var w=e.charAt(e.length-1);if(w===")"){var E=e.match(/\(/g),S=e.match(/\)/g),x=E&&E.length||0,T=S&&S.length||0;if(x<T){e=e.substr(0,e.length-1);y=")"}}var N=e,C=e;if(h&&!u||v&&!a||m&&!f){return g+C+y}if(h){g=p;N="https://twitter.com/"+d;C="@"+d}else if(v){N="mailto:"+v;C=v}else if(!/^[A-Za-z]{3,9}:/i.test(N)){N="http://"+N}if(s){C=C.replace(Autolinker.prefixRegex,"")}if(C.charAt(C.length-1)==="/"){C=C.slice(0,-1)}b.push('href="'+N+'"');if(i){b.push('target="_blank"')}if(o&&C.length>o){C=C.substring(0,o-2)+".."}return g+"<a "+b.join(" ")+">"+C+"</a>"+y});return e}t=t||{};var n=Autolinker.htmlRegex,r=Autolinker.matcherRegex,i="newWindow"in t?t.newWindow:true,s="stripPrefix"in t?t.stripPrefix:true,o=t.truncate,u="twitter"in t?t.twitter:true,a="email"in t?t.email:true,f="urls"in t?t.urls:true,l,c=0,h,p="",d=0;while((l=n.exec(e))!==null){var m=l[0],g=l[2],y=!!l[1];h=e.substring(c,l.index);c=l.index+m.length;if(g==="a"){if(!y){d++;p+=v(h)}else{d--;if(d===0){p+=h}}}else if(d===0){p+=v(h)}p+=m}if(c<e.length){p+=v(e.substring(c))}return p}};Autolinker.matcherRegex=/((^|\s)@(\w{1,15}))|((?:[\-;:&=\+\$,\w\.]+@)[A-Za-z0-9\.\-]*[A-Za-z0-9\-]\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b)|((?:(?:(?:[A-Za-z]{3,9}:(?:\/\/)?)[A-Za-z0-9\.\-]*[A-Za-z0-9\-])|(?:(?:www\.)[A-Za-z0-9\.\-]*[A-Za-z0-9\-])|(?:[A-Za-z0-9\.\-]*[A-Za-z0-9\-]\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b))(?:[-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#\/%=~_()|])?)/g;TAG.Util.makeNamespace("TAG.TourAuthoring.Constants");TAG.TourAuthoring.Constants=function(){"use strict";return{aboveRinZIndex:1e8,keyframeSize:21,innerKeyframeSize:17,keyframeStrokeW:5,keyframeLineW:3,fadeBtnSize:15,rinBorder:2,minZoom:1,maxZoom:100,handleColor:"#DAD9CC",keyframeColor:"#296B2F",audioKeyframeColor:"#283F53",selectedKeyframeColor:"#6B293F",displayColor:"#81AD62",inkDisplayColor:"#AAAAAA",selectedDisplayColor:"#143417",selectedInkDisplayColor:"#2E2E2E",inkDragHandleRadius:20,doubleTap:400,trackHeight:96,minimizedTrackHeight:36,esOffset:.05,timeRulerSize:54,defaultVolume:.8,epsilon:.01,menuDecimals:2,maxTourLength:15*60,minMediaLength:5,inkTrackOffset:0,defaultFade:.5,displayEpsilon:.5}}();TAG.Util.makeNamespace("TAG.Util.Constants");TAG.Util.Constants=function(e){"use strict";function r(e,n){return t[e]||n}function i(e,n){t[e]=n}var t={};var n={START_PAGE:0,COLLECTIONS_PAGE:1,ARTWORK_VIEWER:2,VIDEO_PLAYER:3,TOUR_PLAYER:4,AUTHORING_HUB:5,ARTWORK_EDITOR:6,TOUR_AUTHORING:7};return{pages:n,get:r,set:i}}();TAG.Util.makeNamespace("TAG.Util.Splitscreen");TAG.Util.Splitscreen=function(){"use strict";function r(){return e}function i(t){e=t}function s(e,r){if(e.data("split")==="L"){t=r.viewer}if(e.data("split")==="R"){n=r.viewer}}function o(t,n){function l(e){var t=$(document.createElement("img"));t.attr("src",tagPath+"images/icons/x.svg");t.css({cursor:"pointer",position:"absolute",top:"94%",width:"115%",height:"auto"});t.on("click",function(){u(e)});return t}e=true;var r=$(document.createElement("div")),i=$(document.createElement("div")),s=$(document.createElement("div")),o=$(document.createElement("img"));r.attr("id","metascreen-L");r.append(t);r.css({position:"absolute",left:"0%",top:"0%",width:"49.5%",height:"100%","z-index":"999",overflow:"hidden"});if(t.attr("id")==="newCatalogRoot"){t.find(".bottomButton").css("float","left")}i.attr("id","metascreen-R");i.append(n);i.css({position:"absolute",left:"50.5%",top:"0%",width:"49.5%",height:"100%","z-index":"998",overflow:"hidden"});s.attr("id","splitbar");s.css({position:"absolute",left:"49.5%",top:"0%",width:"1%",height:"100%","z-index":"1000","background-color":"#191915"});var a=l("R"),f=l("L");a.css({left:"-350%",width:"300%"});f.css({right:"-350%",width:"300%"});s.append(a).append(f);$("#tagRoot").append(r).append(s).append(i)}function u(r){function u(){if(o.attr("id")==="artmodeRoot"){var e=o.find("#sideBar"),t=o.find("#toggler"),n=o.find("#togglerImage"),r=o.find("#splitscreenContainer"),i=o.find("#seadragonManipContainer"),s=o.find(".splitscreen-icon"),u=o.find("#locationHistory");u.css({color:"#"+TAG.Worktop.Database.getMuseumPrimaryFontColor()});e.css({left:"0%",right:"auto"});t.css({position:"absolute",left:"auto",right:"-12%",borderTopRightRadius:"10px",borderBottomRightRadius:"10px",borderTopLeftRadius:"0px",borderBottomLeftRadius:"0px"});n.attr("src",tagPath+"images/icons/Close.svg").css({left:"0%",right:"auto"});i.css({right:"0%",left:"auto"});r.css("display","block")}else if(o.attr("id")==="newCatalogRoot"){o.find(".bottomButton").css({"float":"right",display:"block"});o.find(".nextPrevCollection").css({width:(.95*o.find("#collectionArea").width()-o.find(".mainCollection").width())/2-o.find(".arrow").width()});o.find("#infoButton").show();if(o.find("#infoDiv").width()!==0){o.find("#infoDiv").css("width","25%");o.find("#tileDiv").css({"margin-left":"0%",left:o.find("#infoDiv").width()})}o.find("#toggleRow").css("width","20%")}else if(o.hasClass("videoPlayer")){o.find("#playPauseButton").attr("src","images/icons/PlayWhite.svg")}else if(o.hasClass("exhibition")){o.find(".leftbar-header").css({height:"5%"});o.find(".exhibition-label").css({width:"50%"});o.find(".videos-label").css({width:"50%"});o.find(".selectExhibition").css({"font-size":"1.5em","letter-spacing":"inherit"});o.find(".exhibition-title").css({"font-size":"5.7em","letter-spacing":"inherit"});o.find(".exhibition-subtitle-1").css({"font-size":"3em","letter-spacing":"inherit"});o.find(".exhibition-subtitle-2").css({"font-size":"2em","letter-spacing":"inherit"});o.find("#catalogBackButton").css({display:"block"});o.find(".feedback-icon").css({display:"inline"});o.find("#exhibition-label").css({display:"block"});o.find("#tutorialButton").show();o.find("#infoButton").show();var a=.096*.45*$(window).height();var f=LADS.Util.getMaxFontSizeEM("W",.25,9999,a*.85,.1);$(".exhibition-selection .exhibition-title").css({"font-size":f});o.find("#exhibition-label").css("font-size",LADS.Util.getMaxFontSizeEM("Collections",1,$(window).width()*.1,1e3));o.find(".exhibition-name-div").css("font-size",LADS.Util.getMaxFontSizeEM(o.find(".exhibition-name-div").text(),1.5,$(window).width()*.75*.8,.2*o.find(".exhibition-info").height()));var l=.4*$(".contentdiv").width();var c=l/1.4;o.find(".img-container").css({height:c+"px",width:l+"px"});o.find(".explore-text").css("font-size",LADS.Util.getMaxFontSizeEM("Explore",.5,.5*o.find(".explore-tab").width(),.7*o.find(".explore-tab").height()))}}var i,s=$("#metascreen-"+r).detach(),o=$(s.children(".rootPage")[0]);e=false;o.data("split","L");if(r==="L"){$("#metascreen-R").remove();if(t){$(t.container).css({width:"100%",height:"100%"});t.scheduleUpdate()}n=null}else{$("#metascreen-L").remove();if(n){$(n.container).css({width:"100%",height:"100%"});n.scheduleUpdate()}t=null}$("#splitbar").remove();$("#tagRoot").append(o);u();if(t){}if(n){}t=null;n=null}var e=false,t=null,n=null;return{init:o,exit:u,isOn:r,setOn:i,setViewers:s}}();var TAG=TAG||{};TAG.Util.IdleTimer=function(){function r(e,r){function p(){if(idleDuration!==0){l=setTimeout(y,i);h=true}}function d(){l&&clearTimeout(l);c&&clearTimeout(c);n&&clearInterval(n);h=false}function v(){return h}function m(){l&&clearTimeout(l);c&&clearTimeout(c);n&&clearInterval(n);p()}function g(e,r){clearTimeout(l);clearTimeout(c);i=e.duration;u=e.callback;a=r.duration;f=r.callback;l=null;c=null;t=a;h=false;n&&clearInterval(n)}function y(){u();c=setTimeout(b,a)}function b(){f();h=false}e=e||{};r=r||{};var i=e.duration||idleDuration||12e4,u=e.callback||s,a=r.duration||1e4,f=r.callback||o,l=null,c=null,h=false;t=a;return{start:p,kill:d,isStopped:v,restart:m,reinitialize:g,s1d:i}}function i(e,t){return{duration:e,callback:t}}function s(){return u()}function o(){return f()}function u(){var r=$(document.createElement("div")).addClass("idleTimerTextRegion"),i=$(document.createElement("div")).addClass("idleTimerClock"),s=0,o=new Date,u=o.getTime(),f;e=$(TAG.Util.UI.blockInteractionOverlay(.8));e.css({"text-align":"center"});r.css({"font-size":"2em",left:"10%",position:"absolute","text-align":"center",top:"30%",width:"80%"});i.css({"background-color":"white",border:"2px solid #ffffff","border-radius":"50%",display:"block",left:"45%",position:"absolute",top:"50%",width:"10%"});r.html("Starting a new session when the timer below expires.<br />Tap anywhere to continue exploring.");e.append(r);e.append(i);$("#tagRoot").append(e);e.fadeIn();f=i.width();i.css("height",f+"px");e.on("click",function(){e.off("click");idleTimer&&idleTimer.restart();a()});n=setInterval(function(){var e,r,o=new Date;s=o.getTime()-u;e=Math.min(s/t,1);r=e<=.5?"linear-gradient("+(90+360*e)+"deg, transparent 50%, black 50%), linear-gradient(90deg, black 50%, transparent 50%)":"linear-gradient("+(90+360*(e-.5))+"deg, transparent 50%, white 50%), linear-gradient(90deg, black 50%, transparent 50%)";i.css("background-image",r);if(e>=1){clearInterval(n)}},10)}function a(){e&&e.fadeOut(e.remove)}function f(){TAG.Util.Splitscreen.setOn(false);TELEMETRY_SESSION_ID=TAG.Util.IdCreator();if(currentPage.name!==TAG.Util.Constants.pages.COLLECTIONS_PAGE||!currentPage.obj||!currentPage.obj.loadFirstCollection){catalog=new TAG.Layout.CollectionsPage;TAG.Util.UI.slidePageRight(catalog.getRoot())}else{a();currentPage.obj.loadFirstCollection()}}function l(){idleTimer&&idleTimer.restart()}var e,t,n;return{TwoStageTimer:r,timerPair:i,restartTimer:l,removeIdleOverlay:a}}();var TAG=TAG||LADS||{},LADS=LADS||TAG||{};TAG.Util.makeNamespace("Worktop.Database");Worktop.Database=function(e){function h(e){R("Exhibitions",Q("exhibs","doqs"),Q("exhibs","count"),e)}function p(e){R("Artworks",Q("artworks","doqs"),Q("artworks","count"),e)}function d(e){R("Tours",Q("tours","doqs"),Q("tours","count"),e)}function v(e,t,n){R("AddSortOptions",Q("doqs",e),Q(false,false,"doqs",e,"Metadata","Count"),t,{Guid:e})}function m(e){R("AllAssociatedMedia",Q("media","doqs"),Q("media","count"),e)}function g(e){R("Feedback",Q("feedback","doqs"),Q("feedback","count"),e)}function y(e,t){R("Doq",Q("doqs",e),Q("doqs",e,"Metadata","Count"),t,{Guid:e})}function b(e){R("Main",Q("main"),Q(true,false,"main","Metadata","MainCount"),e)}function w(e,t){R("AssociatedMedia",Q("doqMedia",e,"doqs"),Q("doqMedia",e,"LinqCount"),t,{Guid:e})}function E(e,t){R("ArtworksAssociated",Q("doqMedia",e,"doqs"),Q("doqMedia",e,"LinqCount"),t,{Guid:e})}function S(e,t,n){R("Linq",Q("linqs",e,t,"linq"),Q(false,false,"linqs",e,t,"Count"),n,{Guid1:e,Guid2:t})}function x(e,t){R("Maps",Q("doqMaps",e,"doqs"),Q("doqMaps",e,"MapCount"),t,{Guid:e})}function T(e,t){R("ArtworksIn",Q("artIn",e,"art"),Q("artIn",e,"Count"),t,{Guid:e})}function N(e,t){R("AssocMediaIn",Q("assocMediaIn",e,"assocMedia"),Q("assocMediaIn",e,"Count"),t,{Guid:e})}function C(e,t,n,r){t=t||{};var i=V(t,f.params.tour,"ChangeTour",r);i.urlOptions.Guid=e;X("ChangeTour",n,i.urlOptions,i.bodyOptions,true)}function k(e,t,n,r){t=t||{};var i=V(t,f.params.exhibition,"ChangeExhibition",r);i.urlOptions.Guid=e;X("ChangeExhibition",n,i.urlOptions,i.bodyOptions,true)}function L(e,t,n,r){t=t||{};var i=V(t,f.params.artwork,"ChangeArtwork",r);i.urlOptions.Guid=e;X("ChangeArtwork",n,i.urlOptions,i.bodyOptions,true)}function A(e,t,n,r){t=t||{};var i=V(t,f.params.map,"ChangeMap",r);i.urlOptions.Guid=e;X("ChangeMap",n,i.urlOptions,i.bodyOptions,true)}function O(e,t,n,r){t=t||{};var i=V(t,f.params.hotspot,"ChangeHotspot",r);i.urlOptions.Guid=e;X("ChangeAssociatedMedia",n,i.urlOptions,i.bodyOptions,true)}function M(e,t,n){e=e||{};var r=V(e,f.params.hotspot,"CreateIframeAssocMedia",n);X("CreateIframeAssocMedia",t,r.urlOptions,r.bodyOptions,true)}function _(e,t,n){e=e||{};var r=V(e,f.params.main,"ChangeMain",n);X("Main",t,r.urlOptions,r.bodyOptions,true,Q("main","Metadata","MainCount").get())}function D(e,t,n,r){e=e||{};var i=V(e,f.params.tour,"CreateTour",r);z("CreateTour",t,i.urlOptions,i.bodyOptions,n,true)}function P(e,t,n,r){e=e||{};var i=V(e,f.params.exhibition,"CreateExhibition",r);z("CreateExhibition",t,i.urlOptions,i.bodyOptions,n,true)}function H(e,t,n,r){e=e||{};var i=V(e,f.params.feedback,"CreateFeedback",r);z("CreateFeedback",t,i.urlOptions,i.bodyOptions,n)}function B(e,t,n,r){e=e||{};var i=V(e,f.params.artwork,"CreateArtwork",r);z("CreateArtwork",t,i.urlOptions,i.bodyOptions,n,true)}function j(e,t,n,r){e=e||{};var i=V(e,f.params.artwork,"CreateArtwork",r);z("CreateMap",t,i.urlOptions,i.bodyOptions,n,true)}function F(e,t,n,r){e=e||{};var i=V(e,f.params.hotspot,"CreateHotspot",r);z("CreateHotspot",t,i.urlOptions,i.bodyOptions,n,true)}function I(e,t){W("Doq",t,{Guid:e},true)}function q(e,t){W("Linq",t,{Guid:e},true)}function R(e,t,n,r,i,s,o){r=r||{};i=i||{};var s=s||G(t,n);var u=-1;if(typeof n.get==="function"){u=n.get();if(!u&&u!==0){u=-1}}i.Count=u;var a={200:f.convertToDocHandler(l.multiFnHandler(r.success,s,K),r.error),304:l.safeCallHandler(r.success,t.get()),401:J(r.unauth),error:l.multiFnHandler(r.error,U(r.errorCache,t.get()))};f.asyncRequest("GET",e,i,null,a,o)}function U(e,t){if(t){return l.safeCallHandler(e,t)}else{return function(){}}}function z(e,t,n,r,i,s){t=t||{};n=n||{};n.Token=LADS.Auth.getToken();n.ReturnDoq=i;var o={200:i&&f.convertToDocHandler(t.success,t.error)||t.success,401:J(t.unauth),error:t.error};f.asyncRequest("PUT",e,n,r,o,s)}function W(e,t,n,r){t=t||{};n=n||{};n.Token=LADS.Auth.getToken();n.Count=Q("doqs",n.Guid).get().Metadata.Count||0;var i={200:t.success,401:J(t.unauth),409:t.conflict,error:t.error};f.asyncRequest("DELETE",e,n,null,i,r)}function X(e,t,n,r,i,s){t=t||{};n=n||{};n.Token=LADS.Auth.getToken();var o=Q("doqs",n.Guid).get();if(s!==0){s=s||o&&o.Metadata&&Q("doqs",n.Guid).get().Metadata.Count||0}n.Count=s;var u={200:t.success,401:J(t.unauth),409:t.conflict,error:t.error};f.asyncRequest("POST",e,n,r,u,i)}function V(e,t,n,r){var i={};var s={};$.each(e,function(e,o){if(!l.contains(t.url,e)&&!l.contains(t.body,e)){if(r){throw"'"+e+"' is not a valid request parameter for "+n}else{console.log("Warning: '"+e+"' is not a valid request parameter for "+n)}}if(l.contains(t.body,e)){s[e]=o}else{i[e]=o}});return{bodyOptions:s,urlOptions:i}}function J(e){return function(t,n){LADS.Auth.authenticate(function(){n.setToken(LADS.Auth.getToken()).call()},e)}}function K(e){if(e&&e[0]){$.each(e,function(e,t){Q("doqs",t.Identifier).set(t)})}else if(e){Q("doqs",e.Identifier).set(e)}}function Q(e,t){var n,r;var s=0;if(typeof t==="boolean"){r=!t;n=!e;s=2}else if(typeof e==="boolean"){n=!e;s=1}var o=[];for(var u=s;u<arguments.length;u++){o[u-s]=arguments[u]}return{set:function(e){if(r)return;var t=a;for(var n=0;n<o.length-1;n++){if(!t[o[n]]){t[o[n]]={}}t=t[o[n]]}t[o[n]]=e;c()},get:function(){if(n)return;var e=a;for(var t=0;t<o.length-1;t++){if(!e[o[t]]){e[o[t]]={}}e=e[o[t]]}return e[o[t]]}};return current[arguments[i]]}function G(e,t){return function(n,r){e.set(n);t.set(parseInt(r.statusText))}}function Y(e){s=e}function Z(e){s=e}function et(){return"http://"+s+":"+t}function tt(){var e=LADS.Worktop.Database.checkSetting("UseHTTPS");if(e&&e.toLowerCase()==="true"){return"https://"+s+":"+n}else{return"http://"+s+":"+t}}function nt(){return"http://"+s+":"+r}var t=LADS.Worktop.Database.HTTP_PORT;var n=LADS.Worktop.Database.HTTPS_PORT;var r=LADS.Worktop.Database.FILE_PORT;if(localStorage.ip==="137.117.37.220")localStorage.ip="browntagserver.com";var s=localStorage.ip?localStorage.ip:"browntagserver.com";localStorage.ip=s;var o=true;var u="tag_cache.";var a;if(localStorage[u+s]){a=JSON.parse(localStorage[u+s])}else{var a={main:null,tours:null,exhibs:null,artworks:null,feedback:null,media:null,doqs:{},doqMedia:{},doqMaps:{},linqs:{}}}if(e&&a.main&&a.main.Identifier){if(e!==a.main.Identifier)a={}}var f=LADS.Worktop.Database;var l=LADS.Util;var c=$.debounce(250,function(){});return{getURL:et,getFileURL:nt,getSecureURL:tt,setURL:Z,setBaseURL:Y,getExhibitions:h,getArtworks:p,getTours:d,getAssocMedia:m,getDoq:y,getFeedback:g,getMain:b,getAssocMediaTo:w,getArtworksAssocTo:E,getLinq:S,getArtworksIn:T,getAssocMediaIn:N,getMaps:x,putTour:D,putExhibition:P,putFeedback:H,putArtwork:B,putMap:j,putHotspot:F,postTour:C,postExhibition:k,postArtwork:L,postHotspot:O,postIframeAssocMedia:M,postMap:A,postMain:_,addSortOptions:v,deleteDoq:I,deleteLinq:q}};var TAG=TAG||LADS||{};TAG.Util.makeNamespace("Worktop.Doq");Worktop.Doq=function(e){function r(e){if(e!=undefined){if(!e.Metadata)return null;var t={};var n=e.Metadata.Dicts["KeyValueOfguidMetadataDictionaryYwP_PEBe9"]?e.Metadata.Dicts["KeyValueOfguidMetadataDictionaryYwP_PEBe9"].Value.Dict.KeyValueOfstringanyType:[];if(!n.length){var r=n["Key"];var i=n["Value"];t[r]=i}else{$.each(n,function(e){var r=n[e].Key;var i=n[e].Value.text;t[r]=i})}e.Metadata=t;if(e.Metadata&&typeof e.Metadata.InfoFields==="string"){try{e.Metadata.InfoFields=JSON.parse(e.Metadata.InfoFields)}catch(s){e.Metadata.InfoFields={}}}}}function i(e){if(e!=undefined&&e._Folders){e.Folders=e._Folders.FolderData}}var t=$.parseXML(e);var n=$.xml2json(t);if(n.DoqData){var s=[];if(n.DoqData[0]){$.each(n.DoqData,function(e){r(this);i(this);s.push(this)})}else{r(n.DoqData);i(n.DoqData);s.push(n.DoqData)}return s}else if(n.LinqData){var o=[];if(n.LinqData[0]){$.each(n.LinqData,function(e){r(this);o.push(this)})}else{r(n.LinqData);o.push(n.LinqData)}return o}else{r(n);i(n);return n}};var TAG=TAG||LADS||{};TAG.Util.makeNamespace("TAG.Worktop.Database");TAG.Worktop.Database=function(){function a(e,t,n){Y("HEAD","ClearToken",{Token:e},null,{success:t,error:n},true)}function f(e,t,n,r){Y("HEAD","CheckToken",{Token:e},null,{success:t,401:n,error:r},true)}function l(t,n,r){e=e||new Worktop.Database;e.getExhibitions({success:t,error:n,errorCache:r})}function c(t,n,r){e=e||new Worktop.Database;e.getFeedback({success:t,error:n,errorCache:r})}function h(t,n,r){e=e||new Worktop.Database;e.getArtworks({success:t,error:n,errorCache:r})}function p(t,n,r){e=e||new Worktop.Database;e.getTours({success:t,error:n,errorCache:r})}function d(e,t,n){var r=[];h(function(i){r=i;p(function(t){e(r.concat(t))},t,n)},t,n)}function v(t,n,r,i){e=e||new Worktop.Database;e.getDoq(t,{success:n,error:r,errorCache:i})}function m(n,r,i){e=e||new Worktop.Database;e.getMain({success:function(e){t=e;n&&n(e)},error:r,errorCache:i})}function g(t,n,r){e=e||new Worktop.Database;e.getAssocMedia({success:t,error:n,errorCache:r})}function y(t,n,r,i,s){e=e||new Worktop.Database;e.getLinq(t,n,{success:r,error:i,errorCache:s})}function b(t,n,r,i){e=e||new Worktop.Database;e.getAssocMediaTo(t,{success:n,error:r,errorCache:i})}function w(t,n,r,i){e=e||new Worktop.Database;e.getArtworksAssocTo(t,{success:n,error:r,errorCache:i})}function E(t,n,r,i){e=e||new Worktop.Database;e.getArtworksIn(t,{success:n,error:r,errorCache:i})}function S(t,n,r,i){e=e||new Worktop.Database;e.getAssocMediaIn(t,{success:n,error:r,errorCache:i})}function x(t,n,r,i){e=e||new Worktop.Database;e.getMaps(t,{success:n,error:r,errorCache:i})}function T(e,t){Y("GET","Salt",null,null,{success:Q(e),error:t},true)}function N(e,t,n,r,i){Y("GET","Auth",{Hash:TAG.Auth.hashPass(e,t)},null,{success:Q(n),401:r,error:i},true)}function C(t,n){e=e||new Worktop.Database;Y("GET","CheckVersion",null,null,{success:G(t),error:n})}function k(e,t,n,r,i,s){Y("POST","ChangePassword",{OldHash:TAG.Auth.hashPass(e,t),NewPass:n},null,{success:Q(r),unauth:i,error:s},true)}function L(e,t,n,r){Y("GET","ConvertedCheck",{FileName:n,BaseFileName:r},null,{success:Q(e),error:t})}function A(e,t,n){Y("GET","ConvertedVideoCheck",{guid:n},null,{success:G(e),error:t})}function O(e,t,n,r,i,s,o){Y("POST","ConvertVideo",{FileName:n,Extension:r,BaseFileName:i,Identifier:s,ForTour:o},null,{success:Q(e),error:t},true)}function M(t,n,r,i,s){e=e||new Worktop.Database;e.putTour(t,{success:n,error:i,unauth:r},s,o)}function _(t,n,r,i,s){e=e||new Worktop.Database;e.putExhibition(t,{success:n,error:i,unauth:r},s,o)}function D(t,n,r,i,s){e=e||new Worktop.Database;t=t||"No Text";e.putFeedback({SourceID:r,SourceType:n,Description:t},{success:i,error:s},false,o)}function P(t,n,r,i,s){e=e||new Worktop.Database;e.putArtwork(t,{success:n,error:i,unauth:r},s,o)}function H(t,n,r,i,s){e=e||new Worktop.Database;e.putHotspot(t,{success:n,error:i,unauth:r},s,o)}function B(t,n,r,i,s){e=e||new Worktop.Database;e.putMap(t,{success:n,error:i,unauth:r},s,o)}function j(t,n,r,i,s,u){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.postTour(t,n,{success:r,unauth:i,conflict:s,error:u},o)}function F(t,n,r,i,s,u){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.postExhibition(t,n,{success:r,unauth:i,conflict:s,error:u},o)}function I(t,n,r,i,s){e=e||new Worktop.Database;e.addSortOptions(t,{success:n,unauth:r,conflict:i,error:s},o)}function q(t,n,r,i,s,u){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.postArtwork(t,n,{success:r,unauth:i,conflict:s,error:u},o)}function R(t,n,r,i,s,u){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.postHotspot(t,n,{success:r,unauth:i,conflict:s,error:u},o)}function U(t,n,r,i,s){e=e||new Worktop.Database;e.postIframeAssocMedia(t,{success:n,unauth:r,conflict:i,error:s},o)}function z(t,n,r,i,s,u){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.postMap(t,n,{success:r,unauth:i,conflict:s,error:u},o)}function W(t,n,r,i,s){e=e||new Worktop.Database;e.postMain(t,{success:n,unauth:r,conflict:i,error:s},o)}function X(e,t,n,r){Y("POST","FileUploadDataURL",{Token:TAG.Auth.getToken()},null,{success:Q(t),unauth:n,error:r},true,e)}function V(t,n,r,i,s){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.deleteDoq(t,{success:n,error:s,unauth:r,conflict:i})}function J(t,n,r,i,s){e=e||new Worktop.Database;if(typeof t!=="string"&&t&&t.Identifier)t=t.Identifier;e.deleteLinq(t,{success:n,error:s,unauth:r,conflict:i})}function K(e,t){return function(n,r){var i;try{i=new Worktop.Doq(n.responseText)}catch(o){s.safeCall(t,n,r)}if(i&&(i.Name||i.Offset)){s.safeCall(e,i,n)}else if(i&&i[0]){s.safeCall(e,i,n)}else if(i){s.safeCall(e,[],n)}}}function Q(e){return function(t,n){s.safeCall(e,t.responseText)}}function G(e){return function(t,n){s.safeCall(e,t.statusText)}}function Y(t,n,r,i,o,u,a,f){if(!n)return false;o=o||{};r=r||{};i=i||{};r.Force="true";var l=(f?f:u?e.getSecureURL():e.getURL())+"/?Type="+n;$.each(r,function(e,t){l=l+"&"+e+"="+escape(t)});var c,h;if(Object.keys(i).length){c=et(i);h="Boundary:"+c;c="\r\n"+c+"\r\n";$.each(i,function(e,t){h=h+c+e+":"+escape(t)})}var p={call:function(){$.ajax({type:t,url:l,cache:false,dataType:"text",async:true,processData:false,data:a||h,success:function(e,t,n){if(!o[n.status])s.safeCall(o.success,n,p);s.safeCall(o[n.status],n,p)},error:function(e,t,n){if(!o[e.status])s.safeCall(o.error,e,p);s.safeCall(o[e.status],e,p)}})},force:function(){l=l+"&Force=true";p.call()},setToken:function(e){l=Z(l);l=l+"&Token="+e;return p}};p.call()}function Z(e){var t=e.indexOf("&Token=");var n=e.indexOf("&",t+1);var r=e.substring(t,n);return e.replace(r,"")}function et(e){var t="----";var n=false;do{n=false;t=t+"-";$.each(e,function(e,r){if(TAG.Util.contains(e,t)){n=true;return false}if(TAG.Util.contains(r,t)){n=true;return false}})}while(n);return t}function tt(n,r,i){if(!e)e=new Worktop.Database(n);e.getMain({success:function(e){t=e;r(e)},error:i})}function nt(n){if(n){var r;var i="Main";var s;if(e.useServer)s=e.getURL()+"/?Type=Doq&Name="+i;else s="testXML/"+i+".xml";var o=$.ajax({url:s,cache:false,dataType:"text",async:true,success:function(e){if(o.responseText){t=new Worktop.Doq(o.responseText);n()}else{}},error:function(e){return}})}else{t=e.getDoqByName("Main")}}function rt(n,r){if(r){e.getMain({success:function(e){r(e.Metadata["Setting_"+n])}})}else{return t.Metadata["Setting_"+n]}}function it(){return _exhibitionDirty}function st(e){_exhibitionDirty=e}function ot(){return t.Metadata["MuseumName"]}function ut(){return t.Metadata["Locked"]}function at(){return t.Metadata["OverlayColor"]||"000000"}function ft(){return t.Metadata["OverlayTransparency"]}function lt(){return t.Metadata["MuseumLoc"]}function ct(){return t.Metadata["MuseumInfo"]}function ht(){return t.Metadata["BackgroundColor"]||"000000"}function pt(){return t.Metadata["BackgroundOpacity"]||"70"}function dt(){return t.Metadata["PrimaryFontColor"]||"#FFFFFF"}function vt(){return t.Metadata["SecondaryFontColor"]||"#FFFFFF"}function mt(){return t.Metadata["FontFamily"]||"Segoe UI Light"}function gt(){return TAG.Worktop.Database.fixFontFilePath(t.Metadata["Font"])}function yt(){return t.Metadata["OptionalFeatures"]}function bt(){return t.Metadata["BaseFontSize"]||"1.77"}function wt(){return TAG.Worktop.Database.fixPath(t.Metadata["BackgroundImage"])}function Et(){return TAG.Worktop.Database.fixPath(t.Metadata["Icon"])}function St(){return t.Metadata["IconColor"]}function xt(){return t.Metadata["OverlayColor"]}function Tt(){return t.Metadata["OverlayTransparency"]}function Nt(){return t.Metadata["IdleTimerDuration"]||"2"}function Ct(){return t.Identifier}function kt(){}function Lt(t,n){if(n){e.getDoqByGUID(t,function(){n(Ut(t))})}else{e.getDoqByGUID(t);return Ut(t)}}function At(t,n){if(n){e.getDoqLinqsByGUID(t,n)}else return e.getDoqLinqsByGUID(t)}function Ot(t,n){if(n){var r;if(e.useServer)url=e.getURL()+"/?Type=Linq&Guid="+t;else url="testXML/"+t+".xml";var i=$.ajax({url:url,dataType:"text",cache:false,async:true,success:function(){if(i.responseText){try{new Worktop.Doq(i.responseText);var e=Ut(t);var r=$.parseXML(e);n(false,r)}catch(s){console.log("error in getLinqXML: "+s);Ot(t,n)}}}});i.fail(function(e,t){console.log(t)})}else{e.getLinqByGUID(t);return Ut(t)}}function Mt(e){e.sort(function(e,t){if(e.Name<t.Name){return-1}else if(e.Name>t.Name){return 1}else{return 0}})}function _t(t,n,r,i,s){var o=e.getSecureURL()+"/?Type=Linq&Guid="+t+"&token="+TAG.Auth.getToken();var u=$.ajax({type:"DELETE",url:o,async:true,success:function(a){o=e.getSecureURL()+"/?Type=Doq&Guid="+n+"&token="+TAG.Auth.getToken();$.ajax({type:"DELETE",url:o,async:true,success:function(e){r&&r()},error:function(){if(u.statusText==="Unauthorized")Yt(function(){_t(t,n,r,i,s)},i);else s&&s()}})},error:function(){if(u.statusText==="Unauthorized")Yt(function(){_t(t,n,r,i,s)},i);else s&&s()}})}function Dt(){return e.getURL()}function Pt(){return e.getSecureURL()}function Ht(){return e.getFileURL()}function Bt(t){e.setURL(t)}function jt(t,n,r){_exhibitionDirty=true;if(t){var i=$.ajax({url:e.getSecureURL()+"/?Type=CreateExhibition&Guid="+TAG.Worktop.Database.getCreatorID()+"&token="+TAG.Auth.getToken(),type:"PUT",dataType:"text",async:true,success:function(e){var s;if(i.responseText){try{s=new Worktop.Doq(i.responseText);t&&t(s)}catch(o){r&&r()}}else{Yt(function(){jt(t,n,r)},n)}},error:function(){if(i.statusText==="Unauthorized")Yt(function(){jt(t,n,r)},n);else r&&r()}})}else{e.createNewExhibition()}}function Ft(t){e.getArtworks({success:t});return;_artworkDirty=true;if(t){if(!e.isUseServer()){var n=$.ajax({url:"testXML/AllArtworks.xml",dataType:"text",cache:false,async:true,success:function(){if(n.responseText){_artworks=new Worktop.Doq(n.responseText);t(_artworks)}},error:function(e){}})}if(_artworkDirty){var r;var i=Dt()+"/?Type=DoqsInFolder&Name=Artworks";var n=$.ajax({url:i,dataType:"text",cache:false,async:true,success:function(){if(n.responseText){_artworks=new Worktop.Doq(n.responseText);_artworkDirty=false;t(_artworks)}},error:function(e){}})}else{t(_artworks)}}else{if(!e.isUseServer()){var n=$.ajax({url:"testXML/AllArtworks.xml",dataType:"text",cache:false,async:false,error:function(e){return}});if(n.responseText){try{_artworks=new Worktop.Doq(n.responseText)}catch(s){console.log("error in getAllArtworks: "+s);Ft(t)}}return _artworks}if(_artworkDirty){var r;var i=Dt()+"/?Type=DoqsInFolder&Name=Artworks";var n=$.ajax({url:i,dataType:"text",cache:false,async:false,error:function(e){return}});if(n.responseText){try{_artworks=new Worktop.Doq(n.responseText)}catch(s){console.log("error in getAllArtworks: "+s.message);Ft(t)}}_artworkDirty=false}return _artworks}}function It(t,n,r,i){if(r){var s;if(e.useServer)s=e.getURL()+"/?Type=Doq&Guid="+t;else s="testXML/"+t+".xml";var o=$.ajax({url:s,dataType:"text",cache:false,async:true,success:function(){if(o.responseText){var e=new Worktop.Doq(o.responseText);r(e,n)}},error:function(e){console.log(e);i&&i()}})}else return e.getDoqByGUID(t)}function qt(t){return e.getDoqByName(t)}function Rt(e,t){_cacheXML[e]=t}function Ut(e){return _cacheXML[e]}function zt(t,n,r,i,s,o){sn(r);var u="";if(typeof t=="string"){u=t}else{u=Xt(t.childNodes[0],u)}var a=e.getSecureURL()+"/?Type=Doq&Guid="+n+"&token="+TAG.Auth.getToken();var f=!!i;$.ajax({type:"POST",url:a,data:u,async:f,success:function(){i&&i()},error:function(e,u,a){if($("#dialogOverlay").length>0){$("#dialogOverlay").hide()}if(a==="Unauthorized"){Yt(function(){zt(t,n,r,i,s,o)},s)}else o&&o()},dataType:"text"})}function Wt(t,n,r,i,s,o){sn(r);var u="";if(typeof t=="string"){u=t}else{u=Xt(t.childNodes[0],u)}var a=e.getSecureURL()+"/?Type=Linq&Guid="+n+"&token="+TAG.Auth.getToken();$.ajax({type:"POST",url:a,data:u,async:false,success:function(){i&&i()},error:function(e,u,a){if(a==="Unauthorized")Yt(function(){Wt(t,n,r,i,s,o)},s);else o&&o()},dataType:"text"})}function Xt(e,t){if(e.tagName){t=t.concat("<"+e.tagName);for(var n=e.attributes.length-1;n>=0;n--){t=t.concat(" "+e.attributes[n].nodeName+'="'+e.attributes[n].nodeValue+'"')}t=t.concat(">");for(var n=0;n<e.childNodes.length;n++){t=Xt(e.childNodes[n],t)}t=t.concat("</"+e.tagName+">")}else{t=t.concat(e.data)}return t}function Vt(n){return e.createEmptyDoq(t.CreatorID)}function $t(t,n){return e.createLinq()}function Jt(){return t.CreatorID}function Kt(t,n){var r=e.getURL()+"/?Type=AddParent&Guid="+t+"&Guid2="+n;$.ajax({type:"POST",url:r,dataType:"text"});sn("Artwork")}function Qt(){_artworkDirty=true}function Gt(){return _artworkDirty}function Yt(e,t){TAG.Auth.authenticate(e,t)}function Zt(t){e.getTours({success:t});return;_tourDirty=true;if(_tourDirty){if(t){var n="Tour";var r,i;_tours=[];var s=e.getURL()+"/?Type=DoqsInFolder&Name="+n;var o=$.ajax({url:s,dataType:"text",cache:false,async:true,success:function(e){_tours=[];if(o.responseText){try{i=new Worktop.Doq(o.responseText);if(i&&i[0]){$.each(i,function(e,t){_tours.push(t)});_tourDirty=false}else{_tourDirty=true}Mt(_tours);t(_tours)}catch(n){t([])}}},error:function(e){console.log("ajax fail in getAlltours")}})}else{_tours=[];var i=e.getDoqsInFolderByName("Tour");if(i&&i[0]){$.each(i,function(e,t){_tours.push(t)})}Mt(_tours);return _tours}}else{if(t){t(_tours)}else{return _tours}}}function en(t,n){e.getFeedback({success:t,error:n});return;var r=e.getURL()+"/?Type=DoqsInFolder&Name=Feedback";var i=$.ajax({url:r,dataType:"text",cache:false,async:true,success:function(e){if(i.responseText){try{feedback=new Worktop.Doq(i.responseText);t(feedback[0]?feedback:[])}catch(r){console.log(r.message);n&&n()}}},error:function(e){console.log("ajax fail in getAllFeedback");n&&n()}})}function tn(t,n){var r="Tour";var i,s;_tours=[];var o=e.getURL()+"/?Type=DoqsInFolder&Name="+r;var u=$.ajax({url:o,dataType:"text",cache:false,async:true,success:function(e){t()},error:function(e){n()}})}function nn(t,n,r){var i=e.getURL()+"/?Type=IP&Name="+t;var s=$.ajax({type:"HEAD",url:i,async:true,password:password,success:function(){if(s.statusText==="Authorized"){n()}else{r()}},error:function(e){if(s.statusText==="Authorized"){n()}else{r()}}})}function rn(t,n,r,i){function s(){function o(i,o){if(!s){clearTimeout(n);var u=i.statusText;var a=i.responseText;localStorage.ip=t;e=new Worktop.Database(a);r&&r()}}function u(){if(!s){clearTimeout(n);i&&i()}}var n,s;Y("GET","CheckVersion",null,null,{success:o,error:u},false,null,"http://"+t+":8080");n=setTimeout(function(){s=true;i&&i()},1e4)}t=TAG.Util.formatAddress(t);if(n){T(function(e){N(n,e,s,i,i)},i)}else{s()}}function sn(e){switch(e){case"Exhibition":case"Exhibitions":_exhibitionDirty=true;break;case"Artwork":_artworkDirty=true;break;case"Tour":_tourDirty=true;break}}function on(e){return((65535&e)<<16)+((4294901760&e)>>16)}function un(t){if(t){if(t.indexOf("blob:")!==-1){return t}else if(t.indexOf("http")!==-1){t=t.replace(/http.?.?\/\/[^\/]*/,"")}if(t.indexOf("/")!==0){t="/"+t}return e.getFileURL()+t}}function an(e){if(e){if(e.indexOf("/")!==0)e="/"+e;return e}}function fn(e){var t="";try{t=e.toString().split("function ")[1].split("(")[0].trim()+" "}catch(n){console.log(n)}return function(){console.log("Warning: Call to deprecated function "+t+"in TAG.Worktop.Database");var n=[];for(var r=0;r<arguments.length;r++){n[r]=arguments[r]}return e.apply(null,n)}}var e,t,n="8080",r="9001",i="8086";var s=TAG.Util;var o=true;var u={exhibition:{url:["Name","Sub1","Sub2","Background","Img1","Img2","Private","Font","SortOptions","Timeline","AssocMediaView","AddSortOptions"],body:["Description","AddIDs","RemoveIDs"]},artwork:{url:["Name","Title","Artist","Year","Month","Day","TimelineYear","TimelineMonth","TimelineDay","Preview","Thumbnail","Deepzoom","Source","Duration","Converted","Locked"],body:["Description","Location","AddIDs","RemoveIDs","InfoFields","Duration","RichLocationHistory","AddMaps","RemoveMaps"]},tour:{url:["Name","Thumbnail","Private"],body:["Description","Content","RelatedArtworks"]},hotspot:{url:["Name","Year","Month","Day","TimelineYear","TimelineMonth","TimelineDay","ContentType","Duration","Source","LinqTo","X","Y","W","H","LinqType","Thumbnail","Converted"],body:["Description","AddIDs","RemoveIDs"]},map:{url:["Name","Thumbnail","Source"],body:["AdditionalInfo","Description"]},feedback:{url:["SourceID","SourceType"],body:["Description"]},main:{url:["Name","OverlayColor","OverlayTrans","Location","Background","Icon","IconColor","BackgroundColor","BackgroundOpacity","FontFamily","PrimaryFontColor","SecondaryFontColor","BaseFontSize","Font","IdleTimerDuration"],body:["Info"]}};return{HTTP_PORT:n,HTTPS_PORT:r,FILE_PORT:i,getURL:Dt,getSecureURL:Pt,setURL:Bt,getFileURL:Ht,fixPath:un,fixFontFilePath:an,checkAuth:Yt,changeServer:rn,checkSetting:rt,getMuseumName:ot,getMuseumLoc:lt,getMuseumInfo:ct,getStartPageBackground:wt,getMuseumLogo:Et,getMuseumOverlayColor:at,getMuseumOverlayTransparency:ft,getLogoBackgroundColor:St,getMuseumBackgroundColor:ht,getBackgroundColor:ht,getMuseumBackgroundOpacity:pt,getBackgroundOpacity:pt,getMuseumFontFamily:mt,getFontFamily:mt,getMuseumPrimaryFontColor:dt,getPrimaryFontColor:dt,getMuseumSecondaryFontColor:vt,getSecondaryFontColor:vt,getBaseFontSize:bt,getOptionalFeatures:yt,getCustomFont:gt,getIdleTimerDuration:Nt,getLocked:ut,asyncRequest:Y,convertToDocHandler:K,params:u,convertToTextHandler:Q,clearToken:a,checkToken:f,getExhibitions:l,getFeedback:c,getArtworks:h,getTours:p,getArtworksAndTours:d,getMain:m,getAssocMedia:g,getLinq:y,getAssocMediaTo:b,getArtworksAssocTo:w,getArtworksIn:E,getAssocMediaIn:S,getMaps:x,getSalt:T,getAuth:N,getVersion:C,getDoq:v,changePass:k,getConvertedCheck:L,getConvertedVideoCheck:A,convertVideo:O,deleteDoq:V,deleteLinq:J,createTour:M,createExhibition:_,createFeedback:D,createArtwork:P,createHotspot:H,createIframeAssocMedia:U,createMap:B,changeTour:j,changeExhibition:F,changeArtwork:q,changeHotspot:R,changeMap:z,changeMain:W,addSortOptions:I,uploadImage:X}}();TAG.Util.makeNamespace("TAG.AnnotatedImage");TAG.AnnotatedImage=function(e){"use strict";function S(){return a}function x(){return c}function T(){return u}function N(e){if(!b||!e||!e.Metadata||!e.Metadata.DeepZoom){console.log("ERROR IN openDZI");return false}b.openDzi(s(e.Metadata.DeepZoom));return true}function C(e,t){var n=$(e),r=parseFloat(n.css("top")),i=parseFloat(n.css("left"));if(r&&i){b.drawer.updateOverlay(e,b.viewport.pointFromPixel(new Seadragon.Point(i,r)),t)}}function k(e,t,n){if(!b.isOpen()){b.addEventListener("open",function(){b.drawer.addOverlay(e,t,n);b.drawer.updateOverlay(e,t,n)})}else{b.drawer.addOverlay(e,t,n);b.drawer.updateOverlay(e,t,n)}}function L(e){if(!b.isOpen()){b.addEventListener("open",function(){b.drawer.removeOverlay(e)})}else{b.drawer.removeOverlay(e)}}function A(){b&&b.unload()}function O(){c={x:t.width()/2,y:t.height()/2};a=M;TAG.Util.IdleTimer.restartTimer()}function M(e){if(g){return}var t=e.scale,n=e.translation,r=e.pivot;O();if(!d){var i=b.viewport.pointFromPixel(new Seadragon.Point(r.x,r.y));var s={x:i.x,y:i.y};var o=b.viewport.deltaPointsFromPixels(new Seadragon.Point(n.x,n.y));if(E){if(t!==1){b.viewport.zoomBy(t,s,false)}else{b.viewport.panBy(o,false)}}else{b.viewport.zoomBy(t,i,false);b.viewport.panBy(o,false)}b.viewport.applyConstraints()}}function _(){d=true}function D(){d=false}function P(e,t){if(!g){M({scale:e,translation:{x:0,y:0},pivot:t})}}function H(e){b.viewport&&function(){var t=parseFloat($(e).css("top"))+parseFloat($(e).css("height"));var n=parseFloat($(e).css("left"))+.5*parseFloat($(e).css("width"));var r=b.viewport.pointFromPixel(new Seadragon.Point(n,t));var i=b.viewport.getBounds();if(!(r.x<i.getBottomRight().x&&r.x>i.getTopLeft().x&&r.y<i.getBottomRight().y&&r.y>i.getTopLeft().y)){b.viewport.panTo(b.viewport.getHomeCenter());b.viewport.zoomTo(.8*b.viewport.getHomeZoom())}}()}function B(){if(!g){y&&function(){y.on("dblclick",function(){j()})}()}}function j(){b.viewport.zoomBy(2)}function F(e){var t=b.viewport.getBounds(),n=false,r=parseFloat($(e).css("height")),i=parseFloat($(e).css("width")),s=parseFloat($(e).css("top")),o=parseFloat($(e).css("left"));var u=W(new Seadragon.Point(1,s-10)).y,a=W(new Seadragon.Point(1,s+r+10)).y,f=W(new Seadragon.Point(o-10,1)).x,l=W(new Seadragon.Point(o+i+10,1)).x;if(l<t.getBottomRight().x&&f>t.getTopLeft().x&&a<t.getBottomRight().y&&u>t.getTopLeft().y){n=true}return n}function I(e){var t=false;var n=R(e);if(n.x<1.05&&n.x>-.05&&n.y>-.05&&n.y<1/p+.05){t=true}return t}function q(e){var t=R(e);var n=b.viewport.getBounds();if(t.x<=0&&t.y<=0){return b.viewport.pixelFromPoint(new Seadragon.Point(0,0))}if(t.y<=0&&t.x>=1){return b.viewport.pixelFromPoint(new Seadragon.Point(1,0))}if(t.x<=0&&t.y>=1/p+0){return b.viewport.pixelFromPoint(new Seadragon.Point(0,1/p))}if(t.x>=1&&t.y>=1/p+0){return b.viewport.pixelFromPoint(new Seadragon.Point(1,1/p))}if(t.x<=-.05){return b.viewport.pixelFromPoint(new Seadragon.Point(0,t.y))}if(t.x>=1.05){return b.viewport.pixelFromPoint(new Seadragon.Point(1,t.y))}if(t.y<=-.05){return b.viewport.pixelFromPoint(new Seadragon.Point(t.x,0))}if(t.y>=1/p+.05){return b.viewport.pixelFromPoint(new Seadragon.Point(t.x,1/p))}}function R(e){var t;b.viewport&&e&&function(){var n=parseFloat($(e).css("top"))+parseFloat($(e).css("height"));var r=parseFloat($(e).css("left"))+.5*parseFloat($(e).css("width"));t=b.viewport.pointFromPixel(new Seadragon.Point(r,n))}();return t}function U(e){var t=b.viewport.pixelFromPoint(b.viewport.getCenter());$(e).css({top:t.y,left:t.x})}function z(e){var t=parseFloat($(e).css("top"))+$(e).height(),n=parseFloat($(e).css("left"))+$(e).width()/2;return b.viewport.pointFromPixel(new Seadragon.Point(n,t))}function W(e){return b.viewport.pointFromPixel(e)}function X(){var e=b.viewport.getCenter();var t=b.viewport.getBounds();return new Seadragon.Point(e.x+.01*(t.getBottomRight().x-t.getTopLeft().x),e.y+.01*(t.getBottomRight().y-t.getTopLeft().y))}function V(e,t){M({scale:e,translation:{x:0,y:0},pivot:{x:t.x,y:t.y}})}function J(){h=false}function K(){h=true}function Q(){var e;if(Seadragon.Config){Seadragon.Config.visibilityRatio=.8}y=$(document.createElement("div"));y.attr("id","annotatedImageViewer");y.on("mousedown scroll click mousemove resize",function(e){e.preventDefault()});t.append(y);b=new Seadragon.Viewer(y[0]);b.setMouseNavEnabled(false);b.clearControls();e=$(b.canvas);e.addClass("artworkCanvasTesting");if(IS_WINDOWS){TAG.Util.makeManipulatableWin(e[0],{onScroll:function(e,t){P(e,t)},onManipulate:function(e){if(h){e.translation.x=-e.translation.x;e.translation.y=-e.translation.y;M(e)}}},null,true)}else{TAG.Util.makeManipulatable(e[0],{onScroll:function(e,t){P(e,t)},onManipulate:function(e){if(h){e.translation.x=-e.translation.x;e.translation.y=-e.translation.y;M(e)}}},null,true)}w=$(document.createElement("div"));w.attr("id","annotatedImageAssetCanvas");t.append(w);i?setTimeout(function(){r&&r()},1):Y(r)}function G(e){b.addEventListener("animation",e)}function Y(e){function i(t){var i;r=t?t.length:0;if(r>0){for(i=0;i<t.length;i++){TAG.Worktop.Database.getLinq(n.Identifier,t[i].Identifier,s(t[i]),null,s(t[i]))}}else{e&&e(u)}}function s(n){return function(i){u[n.Identifier]=Z(n,i);u.guids.push(n.Identifier);if(++t>=r&&e){e(u)}}}var t=0,r;u={guids:[]};TAG.Worktop.Database.getAssocMediaTo(n.Identifier,i,null,i)}function Z(e,n){function Q(){if(h&&n.Offset&&n.Dimensions){r.css({border:"1px solid rgba(255,255,255,0.4)",background:"rgba(0,0,0,0)",width:parseFloat(parseInt(n.Dimensions._x)||50),height:parseFloat(parseInt(n.Dimensions._y)||50),position:"absolute"});w.append(r);r.hide()}else{r.css("width",.29*t.width()+"px");i.css("backgroundColor","rgba(0,0,0,0.65)");U&&U.remove();U=$(document.createElement("div"));var e="20px";if(IS_WINDOWS){e="40px"}U.css({display:"block",height:e,position:"relative","margin-bottom":"5px",width:"100%"});W=$(document.createElement("div"));W.addClass("annotatedImageMediaTitle");U.append(W);var s=LADS.Util.getMaxFontSizeEM("WWWWW",.6,999999,parseInt(e)+1,.025);if(S){W.text(S)}else{W.text("Untitled")}W.css({width:r.width()-65+"px","font-size":s});z=s;var a=st();a.on("click",function(e){e.stopPropagation();ut()});U.append(a[0]);i.append(U);i.append(o);if(A){}r.append(i);w.append(r);r.hide();if(u){F=$(document.createElement("img"));F.attr("src",tagPath+"images/icons/hotspot_circle.svg");F.addClass("annotatedImageHotspotCircle");F.click(function(){ft(true)});t.append(F)}TAG.Util.disableDrag(r);r.on("click mousedown",function(e){e.stopPropagation();e.preventDefault();TAG.Util.IdleTimer.restartTimer();et();r.startLocation={x:r.position().left,y:r.position().top};console.log("startin location is getting set");r.manipulationOffset={x:e.clientX-r.position().left,y:e.clientY-r.position().top}});if(IS_WINDOWS){TAG.Util.makeManipulatableWin(r[0],{onManipulate:tt,onScroll:nt},null)}else{TAG.Util.makeManipulatable(r[0],{onManipulate:rt,onScroll:it},null,true)}}}function G(){var t=q,n=$(t),r=$(document.createElement("div")),i=$(document.createElement("div")).addClass("annotatedImageMediaControlPanel"),s=$(document.createElement("img")).addClass("mediaVolButton"),u=$(document.createElement("div")).addClass("mediaTimeContainer"),a=$(document.createElement("div")).addClass("mediaTimeDisplay"),f=$(document.createElement("div")).addClass("mediaPlayHolder"),l=$(document.createElement("div")).addClass("mediaVolHolder"),c=$(document.createElement("div")).addClass("mediaSliderContainer"),h=$(document.createElement("div")).addClass("mediaSliderPoint");i.attr("id","media-control-panel-"+e.Identifier);K=$(document.createElement("img")).addClass("mediaPlayButton");K.attr("src",tagPath+"images/icons/PlayWhite.svg");s.attr("src",tagPath+"images/icons/VolumeUpWhite.svg");a.text("00:00");r.css({width:"100%",margin:"0 auto"});K.css({position:"absolute",height:"100%",width:"auto"});f.css({position:"absolute",height:"35px",width:"auto",display:"block",margin:"4px 1% 0px 1%"});c.css({position:"absolute",display:"block",height:"17px",width:"475px","max-width":"600px",left:"55px",top:"13px"});h.css({position:"absolute",height:"100%","background-color":"#3cf",width:"0%",left:"0%","max-width":"100%"});s.css({position:"absolute",height:"100%",width:"auto",right:"0%"});l.css({height:"30px",position:"absolute",display:"block",width:"auto",right:"2%",top:"6px"});u.css({height:"45px",width:"15%","max-width":"70px",right:"56px",display:"block",position:"absolute"});var p=LADS.Util.getMaxFontSizeEM("00:00",.6,70,40,.025);a.css({top:"1px",height:"40px",position:"absolute","font-size":p,"vertical-align":"middle","text-align":"center"});f.append(K);c.append(h);l.append(s);K.on("click",function(){if(t.paused){t.play();K.attr("src",tagPath+"images/icons/PauseWhite.svg")}else{t.pause();K.attr("src",tagPath+"images/icons/PlayWhite.svg")}});s.on("click",function(){if(t.muted){t.muted=false;s.attr("src",tagPath+"images/icons/VolumeUpWhite.svg")}else{t.muted=true;s.attr("src",tagPath+"images/icons/VolumeDownWhite.svg")}});n.on("ended",function(){t.pause();K.attr("src",tagPath+"images/icons/PlayWhite.svg")});c.on("mousedown",function(e){var n=t.duration*((e.pageX-$(e.target).offset().left)/c.width()),r=e.pageX,i=t.duration/c.width(),s=Math.max(0,Math.min(t.duration,t.currentTime)),o=n,u=s/i,f=Math.floor(s/60),l=Math.floor(s%60),p=f<10?"0"+f:f,d=l<10?"0"+l:l;e.stopPropagation();if(!isNaN(n)){a.text(p+":"+d);t.currentTime=n;h.css("width",100*(u/c.width())+"%")}c.on("mousemove.seek",function(e){var n=e.pageX,v=(n-r)*i;s=Math.max(0,Math.min(t.duration,o+v));u=s/i;f=Math.floor(s/60);l=Math.floor(s%60);p=f<10?"0"+f:f;d=l<10?"0"+l:l;if(!isNaN(s)){a.text(p+":"+d);t.currentTime=s;h.css("width",100*(u/c.width())+"%")}});$("body").on("mouseup.seek mouseleave.seek",function(){c.off("mouseup.seek mouseleave.seek mousemove.seek")})});n.on("timeupdate",function(){var e=100*t.currentTime/t.duration,n=t.duration/c.width(),r=t.currentTime/n,i=Math.floor(t.currentTime/60),s=Math.floor(t.currentTime%60),o=i<10?"0"+i:i,u=s<10?"0"+s:s;if(!isNaN(t.currentTime)){a.text(o+":"+u);h.css("width",100*(r/c.width())+"%")}});o.append(t);o.append(i);i.append(r);r.append(f);r.append(c);u.append(a);r.append(u);r.append(l);R=i}function Y(){var e=q,t=$(e),n=$(R.find(".mediaVolButton")[0]),r=$(R.find(".mediaTimeContainer")[0]),i=$(R.find(".mediaTimeDisplay")[0]),s=$(R.find(".mediaSliderContainer")[0]),o=$(R.find(".mediaSliderPoint")[0]),u=$(R.find(".mediaPlayButton")[0]);u.on("click",function(){if(e.paused){e.play();u.attr("src",tagPath+"images/icons/PauseWhite.svg")}else{e.pause();u.attr("src",tagPath+"images/icons/PlayWhite.svg")}});n.on("click",function(){if(e.muted){e.muted=false;n.attr("src",tagPath+"images/icons/VolumeUpWhite.svg")}else{e.muted=true;n.attr("src",tagPath+"images/icons/VolumeDownWhite.svg")}});t.on("ended",function(){e.pause();u.attr("src",tagPath+"images/icons/PlayWhite.svg")});s.on("mousedown",function(t){var n=e.duration*((t.pageX-$(t.target).offset().left)/s.width()),r=t.pageX,u=e.duration/s.width(),a=Math.max(0,Math.min(e.duration,e.currentTime)),f=n,l=a/u,c=Math.floor(a/60),h=Math.floor(a%60),p=c<10?"0"+c:c,d=h<10?"0"+h:h;t.stopPropagation();if(!isNaN(n)){i.text(p+":"+d);e.currentTime=n;o.css("width",100*(l/s.width())+"%")}s.on("mousemove.seek",function(t){var n=t.pageX,v=(n-r)*u;a=Math.max(0,Math.min(e.duration,f+v));l=a/u;c=Math.floor(a/60);h=Math.floor(a%60);p=c<10?"0"+c:c;d=h<10?"0"+h:h;if(!isNaN(a)){i.text(p+":"+d);e.currentTime=a;o.css("width",100*(l/s.width())+"%")}});$("body").on("mouseup.seek mouseleave.seek",function(){s.off("mouseup.seek mouseleave.seek mousemove.seek")})});t.on("timeupdate",function(){var t=100*e.currentTime/e.duration,n=e.duration/s.width(),r=e.currentTime/n,u=Math.floor(e.currentTime/60),a=Math.floor(e.currentTime%60),f=u<10?"0"+u:u,l=a<10?"0"+a:a;if(!isNaN(e.currentTime)){i.text(f+":"+l);o.css("width",100*(r/s.width())+"%")}})}function Z(){var e,t,u,a,f,l,c;if(!I){I=true}else{if(_){Q();if(h){r.css({"pointer-events":"none "})}else{if(x==="Image"){r.css("min-width","")}else if(x==="Video"){r.css({width:"675px",height:"auto"});Y()}else if(x==="Audio"){r.css({width:"675px",height:"auto"});Y()}else if(x==="iframe"){r.css({width:"30%"});if(X){r.css("height",r.width()*1.15)}else{r.css("height",r.width()*.89)}i.css({height:"100%"});var p;N?p="85%":p="100%";o.css({height:p});if(!IS_WINDOWS){var d=$(document.createElement("div")).addClass("interactionOverlay");d.css({height:"100%",width:"100%",position:"absolute",left:0,top:0});r.on("mousedown",function(){d.css("pointer-events","auto")});$("body").on("mouseup",function(){d&&d.css("pointer-events","none")});o.append(d)}}if(N){X=$(document.createElement("div"));X.addClass("annotatedImageMediaDescription");X.css({"font-size":z});X.html(Autolinker.link(N,{email:false,twitter:false}));if(IS_WINDOWS){var m=X.find("a");m.each(function(e,t){$(t).replaceWith(function(){return $.text([this])})})}X.mouseover(function(){v=true});X.mouseleave(function(){v=false});r.append(X)}return}}else{return}}if(h){e=$(document.createElement("img")).addClass("xfadeImg");e.attr({src:s(T)});e.css({height:"100%",position:"absolute",width:"100%"});r.append(e);r.css({"pointer-events":"none "});a=parseFloat(n.Offset._x||0);f=parseFloat(n.Offset._y||0);l=parseFloat(n.Dimensions._x||50);c=parseFloat(n.Dimensions._y||50);E={x:a,y:f};y=new Seadragon.Rect(a,f,l,c);b.drawer.addOverlay(r[0],y)}else{if(x==="Image"){t=document.createElement("img");t.src=s(T);$(t).css({position:"relative",width:"100%",height:"auto"});o.append(t);r.css("min-width","")}else if(x==="Video"){q=document.createElement("video");e=$(q);e.attr({preload:"none",poster:C&&!C.match(/.mp4/)?s(C):"",src:s(T),type:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',controls:false});r.css({width:"675px",height:"auto"});e.css({position:"relative",width:"100%"});G(q)}else if(x==="Audio"){q=document.createElement("audio");e=$(q);e.attr({preload:"none",type:"audio/mp3",src:s(T),controls:false});G(q);e.on("error",function(){console.log("Here's an error ")});r.css({width:"675px",height:"auto"})}else if(x==="iframe"){r.css({width:"30%"});if(X){r.css("height",r.width()*1.15)}else{r.css("height",r.width()*.89)}i.css({height:"100%"});var p;N?p="85%":p="100%";o.css({height:p});u=$(document.createElement("iframe"));u.attr({src:T+"?modestbranding=1&showinfo=0&fs=0",frameborder:"0"});u.css({width:"100%",height:"100%"});o.append(u);if(!IS_WINDOWS){var d=$(document.createElement("div"));d.css({height:"100%",width:"100%",position:"absolute",left:0,top:0});r.on("mousedown",function(){d.css("pointer-events","auto")});$("body").on("mouseup",function(){d&&d.css("pointer-events","none")});o.append(d)}}if(N){X=$(document.createElement("div"));X.addClass("annotatedImageMediaDescription");X.css({"font-size":z});X.html(Autolinker.link(N,{email:false,twitter:false}));if(IS_WINDOWS){var m=X.find("a");m.each(function(e,t){$(t).replaceWith(function(){return $.text([this])})})}X.mouseover(function(){v=true});X.mouseleave(function(){v=false});r.append(X)}}}function et(){var e=r.width(),t=r.height();c={x:e/2,y:t/2};if(h){a=M}else{a=rt;$(".mediaOuterContainer").css("z-index",1e3);r.css("z-index",1001)}TAG.Util.IdleTimer.restartTimer()}function tt(e){function p(){var e=!IS_WINDOWS?t.width()/8:0;var n={x:parseInt(r.css("left")),y:parseInt(r.css("top"))};var i={w:parseInt(r.css("width")),h:parseInt(r.css("height"))};if(!(0<n.y+i.h-e&&n.y+e<t.height()&&0<n.x+i.w-e&&n.x+e<t.width())){ut();ht();return;IS_WINDOWS&&(r.manipulationOffset=null)}}var n=r.css("top");var i=r.css("left");var s=r.css("width");var o=r.css("height");var u=parseFloat(s)*e.scale;var a;if(x==="Video"||x==="Audio"){a=450}else{a=200}var c;if(u>=a&&u<=800){if(0<parseFloat(n)+parseFloat(o)&&parseFloat(n)<f&&0<parseFloat(i)+parseFloat(s)&&parseFloat(i)<l&&e){r.css("top",parseFloat(n)+e.translation.y+(1-e.scale)*e.pivot.y+"px");r.css("left",parseFloat(i)+e.translation.x+(1-e.scale)*e.pivot.x+"px")}}else{if(0<parseFloat(n)+parseFloat(o)&&parseFloat(n)<f&&0<parseFloat(i)+parseFloat(s)&&parseFloat(i)<l&&e){r.css("top",parseFloat(n)+e.translation.y+"px");r.css("left",parseFloat(i)+e.translation.x+"px");u=Math.min(Math.max(u,a),800)}}r.css("width",u+"px");if(x==="Audio"){r.css("height","auto")}else{var h=u*o/s;r.css("height",h+"px")}r.find(".annotatedImageMediaTitle").css({width:u-65+"px"});if(x==="Video"){r.find(".mediaSliderContainer").css({width:u-200+"px"})}et();p()}function nt(e,n){rt({scale:e,translation:{x:0,y:0},pivot:{x:n.x+t.offset().left,y:n.y+t.offset().top}})}function rt(e,n,i){function l(){var e=!IS_WINDOWS?t.width()/8:0;if(!(0<f.y+a-e&&f.y+e<t.height()&&0<f.x+u-e&&f.x+e<t.width())){ut();ht();return;IS_WINDOWS&&(r.manipulationOffset=null)}}e&&e.grEvent&&(e.grEvent.target.autoProcessInertia=false);if(v===true){return}if(e.scale!==1){it(e.scale,e.pivot);return}var s=r.position().top,o=r.position().left,u=r.width(),a=r.height(),f;if(i){f={x:o+e.translation.x,y:s+e.translation.y}}else if(IS_WINDOWS){if(!r.manipulationOffset)return;f={x:o+e.pivot.x+t.offset().left-r.manipulationOffset.x,y:s+e.pivot.y+t.offset().top-r.manipulationOffset.y}}else{f={x:e.center.pageX-e.startEvent.center.pageX+r.startLocation.x,y:e.center.pageY-e.startEvent.center.pageY+r.startLocation.y}}r.stop();if(IS_WINDOWS){r.css({top:f.y,left:f.x});l()}else{r.animate({top:f.y,left:f.x},300,function(){l()})}}function it(e,t){if(v===true){return}else if(x==="Audio"){return}var n=r.position().top,i=r.position().left,s=r.width(),o=r.height(),u=s*e,a,f,c,h,p;m=true;if(x==="Video"){c=450;f=800}else{c=250;f=800}if(x==="iframe"){c=parseInt(l*.33);f=parseInt(l*.75)}if(u<c||u>f){u=Math.min(f,Math.max(c,u))}e=u/s;a=o*e;h=i+t.x*(1-e);p=n+t.y*(1-e);r.stop();r.css({top:p,left:h,width:u,height:a});r.find(".annotatedImageMediaTitle").css({width:u-65+"px"});if(x==="Video"){r.find(".mediaSliderContainer").css({width:u-200+"px"})}setTimeout(function(){m=false},100)}function st(){var e=$(document.createElement("img"));e.attr("src",tagPath+"images/icons/x.svg");e.text("X");var t=IS_WINDOWS?"30px":"15px";e.css({position:"absolute",width:t,height:t,"min-width":"30px","z-index":"1",right:"1.5%","margin-top":"7px"});return e}function ot(n){var i,s,o=r.height(),a=r.width(),f=0;r&&r.detach();if(!b.viewport){console.log("[DIAGNOSTIC] viewer or viewer.viewport is null in showMediaObject() call for "+(S?S:"untitled")+"asset");return}if(h){r.show();t.find(".xfadeImg").css("opacity",t.find("#xfadeSliderPoint").width()/t.find("#xfadeSlider").width());b.viewport.fitBounds(y,false);b.viewport.applyConstraints()}else{if(u){if(!n){F.css("visibility","visible");k(F[0],g,Seadragon.OverlayPlacement.CENTER)}b.viewport.panTo(g,false);b.viewport.applyConstraints();i=b.viewport.pixelFromPoint(g).y-o/2+j/2;s=b.viewport.pixelFromPoint(g).x+j}else{t.data("split")==="R"&&(f=-t.find("#sideBar").width());t.data("split")==="L"&&(f=t.find("#sideBar").width());i=t.height()*1/10+Math.random()*t.height()*2/10;s=(t.width()+f)/3+(.5-Math.random())*t.width()/8}r.css({top:i+"px",left:s+"px",position:"absolute","z-index":1e3,"pointer-events":"all"});w.append(r);r.show()}_=false;if(D){D=false}var l="#thumbnailButton-"+e.Identifier;if(r.parents("#metascreen-R").length){l+="R"}if(!V){V=$(l)}V.css({color:"black","background-color":"rgba(255,255,255, 0.3)"})}function ut(t){r.stop();var n="#thumbnailButton-"+e.Identifier;if(r.parents("#metascreen-R").length){n+="R"}if(!V){V=$(n)}if(!t){V.css({color:"white","background-color":""});_=true}else{D=true}TAG.Util.IdleTimer.restartTimer();O();if(h){r.hide()}else{ht();if(!t){u&&L(F[0]);r.remove();r=$(document.createElement("div"))}else{r.hide()}}}function at(){Z();ot();ut()}function ft(e){if(D){ot(e)}else{_?ot(e):ut(e)}P=_}function lt(){return!_}function ct(){if(P){r.show();P=false}else{r.hide();P=true}}function ht(){if(!q||q.readyState<4){return}q.currentTime=0;q.pause();K.attr("src",tagPath+"images/icons/PlayWhite.svg")}console.log("CREATING MEDIA OBJECTS");var r=$(document.createElement("div")).addClass("mediaOuterContainer"),i=$(document.createElement("div")).addClass("mediaInnerContainer"),o=$(document.createElement("div")).addClass("mediaMediaContainer"),u=n.Metadata.Type?n.Metadata.Type==="Hotspot":false,h=false,p=parseFloat(n.Offset._x),d=parseFloat(n.Offset._y),g=new Seadragon.Point(p,d),y,S=unescape(TAG.Util.htmlEntityDecode(e.Name)),x=e.Metadata.ContentType,T=e.Metadata.Source,N=unescape(TAG.Util.htmlEntityDecode(e.Metadata.Description)),C=e.Metadata.Thumbnail,A=false,_=true,D=true,P=true,H=false,B=[],j=60,F,g,I,q,R,U,z,W,X,V,J,K;Q();return{doq:e,linq:n,show:ot,hide:ut,create:Z,pauseReset:ht,toggle:ft,showHotspot:at,createMediaElements:Z,isVisible:lt,mediaManipPreprocessing:et}}var t=e.root,n=e.doq,r=e.callback,i=e.noMedia,s=TAG.Worktop.Database.fixPath,o=n.Name,u={guids:[]},a=M,f=$("#tagRoot").height(),l=$("#tagRoot").width(),c={x:f/2,y:l/2},h=true,p=1,d=false,v=false,m=false,g=e.disableZoom,y,b,w;var E;Q();return{getAssociatedMedia:T,unload:A,dzManip:M,dzScroll:P,openArtwork:N,addAnimateHandler:G,getToManip:S,getMediaPivot:x,dzManipPreprocessing:O,viewer:b,panToPoint:H,isInViewportBounds:F,isInImageBounds:I,returnElementToBounds:q,locationOf:R,centerElement:U,pointFromPixel:W,createStartingPoint:X,scroll:V,pauseManip:J,restartManip:K,updateOverlay:C,addOverlay:k,removeOverlay:L,loadAssociatedMedia:Y,getOverlayCoordinates:z,freezeArtwork:_,unfreezeArtwork:D,initZoom:B};};var TAG=TAG||{};TAG.Auth=function(){"use strict";function r(){return TAG.AuthToken||null}function i(){TAG.Worktop.Database.clearToken(TAG.AuthToken);TAG.AuthToken=null}function s(e,t){var n=e+t;var r=CryptoJS.SHA256(n);for(var i=0;i<1023;i++){r=CryptoJS.SHA256(r)}return r}function o(e,t,n,r){TAG.Worktop.Database.getSalt(function(i){TAG.Worktop.Database.getAuth(e,i,function(e){TAG.AuthToken=e;t()},n,r)},r)}function u(e,t,n,r,i){if(!a(t)){r("Password must contain at least 8 characters with 3 of the following types:<br>Lowercase letter<br>Uppercase letter<br>Number<br>Symbol");return}TAG.Worktop.Database.getSalt(function(s){TAG.Worktop.Database.changePass(e,s,t,function(e){TAG.AuthToken=e;n()},r,i)})}function a(e){if(e&&e.length>=8){var t=0;if(e.match(/(?=.*[a-z])/)){t++}if(e.match(/(?=.*[A-Z])/)){t++}if(e.match(/(?=.*[\d])/)){t++}if(e.match(/(?=.*[\W])/)){t++}if(t>=3){return true}}return false}function f(e,n){function r(){$("#tagRoot").append(TAG.AuthOverlay);TAG.AuthInput.val("");TAG.AuthOverlay.fadeIn(500);TAG.AuthInput.focus();TAG.AuthSubmit.show();TAG.AuthCancel.show();TAG.AuthCancel.click(function(){TAG.AuthError.hide();TAG.AuthCircle.hide();TAG.AuthOverlay.fadeOut(500,function(){TAG.AuthOverlay.remove();if(n){n()}})});TAG.AuthSubmit.click(function(){TAG.AuthError.hide();TAG.AuthCircle.show();TAG.AuthSubmit.hide();TAG.AuthCancel.hide();o(TAG.AuthInput.val(),function(){TAG.AuthError.hide();TAG.AuthCircle.hide();TAG.AuthOverlay.remove();e()},function(){TAG.AuthError.html("Invalid Password. Please try again...");TAG.AuthError.show();TAG.AuthCircle.hide();TAG.AuthSubmit.show();TAG.AuthCancel.show()},function(){TAG.AuthError.html("There was an error contacting the server. Contact a server administrator if this error persists.");TAG.AuthError.show();TAG.AuthError.css({bottom:"30%"});TAG.AuthCircle.hide();TAG.AuthSubmit.show();TAG.AuthCancel.show()})});TAG.AuthInput.keypress(function(t){if(t.which===13){TAG.AuthError.hide();TAG.AuthCircle.show();TAG.AuthSubmit.hide();TAG.AuthCancel.hide();o(TAG.AuthInput.val(),function(){TAG.AuthError.hide();TAG.AuthCircle.hide();TAG.AuthOverlay.remove();e()},function(){TAG.AuthError.html("Invalid Password. Please try again...");TAG.AuthError.show();TAG.AuthCircle.hide();TAG.AuthSubmit.show();TAG.AuthCancel.show()},function(){TAG.AuthError.html("There was an error contacting the server. Contact a server administrator if this error persists.");TAG.AuthError.show();TAG.AuthError.css({bottom:"30%"});TAG.AuthCircle.hide();TAG.AuthSubmit.show();TAG.AuthCancel.show()})}})}t=e;if(TAG.AuthToken){TAG.Worktop.Database.checkToken(TAG.AuthToken,e,r,r)}else{r()}}function l(e,t){var r=$(document.createElement("div"));r.attr("id","loginOverlay");var i=$(document.createElement("div"));i.attr("id","loginDialog");n=i;r.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":100000002});var s=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:210});i.css({position:"absolute",top:s.y+"px",width:s.width-200+"px",height:s.height-55+"px",left:s.x+"px",border:"3px double white","background-color":"black"});r.append(i);var o=$(document.createElement("div"));o.attr("id","dialogTitle");o.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"50%",position:"relative","text-align":"center"});o.text("Please enter authoring mode password.");var u=$(document.createElement("input"));u.attr({type:"password",id:"password",name:"password",placeholder:"password"});u.css({display:"block",position:"relative",margin:"auto","margin-top":"8%","margin-bottom":"4%"});var a=$(document.createElement("div"));a.attr("id","errorMessage");a.css({color:"white","margin-bottom":"10px",left:"10%",width:"80%","font-size":"50%","text-align":"center",bottom:"25%",position:"absolute"});a.html("Invalid Password. Please try again...");a.hide();var f=$(document.createElement("div"));f.css({position:"relative",display:"block",width:"70%",left:"10%",bottom:"-6%"});var l=$(document.createElement("button"));l.css({border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","margin-left":"-7%",display:"inline-block"});var c=$(document.createElement("img"));c.css({width:"20px",height:"auto",display:"none","margin-right":"3%","margin-top":"2.5%","float":"right"});c.attr("src",tagPath+"/images/icons/progress-circle.gif");l.text("Submit");var h=function(){a.show();c.hide()};var p=function(){a.hide();c.show()};var d=$(document.createElement("button"));d.attr("type","button");d.css({border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right","margin-right":"-21%",display:"inline-block"});d.text("Cancel");i.append(o);i.append(u);i.append(a);i.append(f);f.append(d);f.append(l);f.append(c);return{overlay:r,input:u,submit:l,cancel:d,error:a,circle:c}}if(!TAG.AuthOverlay){var e=l();TAG.AuthOverlay=e.overlay;TAG.AuthSubmit=e.submit;TAG.AuthCancel=e.cancel;TAG.AuthInput=e.input;TAG.AuthError=e.error;TAG.AuthCircle=e.circle;var t;var n}return{getToken:r,clearToken:i,authenticate:f,hashPass:s,checkPassword:o,changePassword:u}}();TAG.Util.makeNamespace("TAG.Layout.StartPage");TAG.Layout.StartPage=function(e,t){"use strict";function g(){function n(e){var t=.1;if($(e).height()>$(e).parent().height()||$(e).width()>$(e).parent().width()){$(e).css("font-size",$(e).css("font-size").substr(0,2)-t+"px").css("line-height",$(e).css("font-size").substr(0,2)+"px");n(e)}}var e=$("#tagRoot");var t=$(TAG.Util.UI.PopUpConfirmation(function(){TELEMETRY_SWITCH="off";localStorage.tagTelemetry="off"},"To improve the Touch Art Gallery experience, we're trying to collect more information about how users like you use our application. Do you mind us collecting information on your usage?","Yes, I mind",null,function(){TELEMETRY_SWITCH="on";localStorage.tagTelemetry="on"},e,null,null,true));r.append(t);t.show();n(document.getElementById("popupmessage"))}function y(e){var t=e&&e.internetURL||"http://www.google.com/",n,r;$.ajax({url:c,dataType:"text",async:true,cache:false,success:function(){if(!r){clearTimeout(n);b()}},error:function(e){if(!r){clearTimeout(n);$.ajax({url:t,dataType:"text",async:false,cache:false,success:function(){if(!r){clearTimeout(n);h.empty();h.append((new TAG.Layout.InternetFailurePage("Server Down")).getRoot())}},error:function(e){if(!r){clearTimeout(n);h.empty();h.append((new TAG.Layout.InternetFailurePage("No Internet")).getRoot())}}})}}});n=setTimeout(function(){r=true;h.empty();h.append((new TAG.Layout.InternetFailurePage("Server Down")).getRoot())},1e4)}function b(){TAG.Worktop.Database.getVersion(function(e){if(parseFloat(e)<1.5){h.empty();h.append((new TAG.Layout.InternetFailurePage("Old Server")).getRoot())}else{TAG.Worktop.Database.getMain(N,function(){h.empty();h.append((new TAG.Layout.InternetFailurePage("Server Down")).getRoot())})}},function(){h.empty();h.append((new TAG.Layout.InternetFailurePage("Server Down")).getRoot())})}function N(e){function n(){var e;i.off("click");e=TAG.Layout.CollectionsPage();TAG.Util.UI.slidePageLeft(e.getRoot());currentPage.name=2;currentPage.obj=e}d=e;v=d.Metadata["PrimaryFontColor"];m=d.Metadata["SecondaryFontColor"];if(m[0]!=="#"){m="#"+m}if(v[0]!=="#"){v="#"+v}if(t){t(r)}TAG.Util.Constants.set("START_PAGE_SPLASH",tagPath+"images/birdtextile.jpg");if(TAG.Worktop.Database.getLocked()!=undefined&&TAG.Worktop.Database.getLocked()!="undefined"){i.text("Go to Artwork")}i.on("click",function(){if(TAG.Worktop.Database.getLocked()){TAG.Worktop.Database.getArtworks(function(e){$.each(e,function(e,t){if(t.Identifier===TAG.Worktop.Database.getLocked()){if(t.Metadata.Type==="VideoArtwork"){var n=TAG.Layout.VideoPlayer(t);TAG.Util.UI.slidePageLeftSplit(r,n.getRoot());currentPage.name=TAG.Util.Constants.pages.VIDEO_PLAYER;currentPage.obj=n}else{var i=TAG.Layout.ArtworkViewer({doq:t});var s=i.getRoot();s.data("split",r.data("split")==="R"?"R":"L");TAG.Util.UI.slidePageLeftSplit(r,s);currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER;currentPage.obj=i}}})});return false}else{n()}});H(e);B();j(e);F(e);P();q();if(!O()){_()}}function L(){l.on("click",k);l.on("mousedown",function(){l.css({"background-color":v,color:"black"})});o.keypress(function(e){if(e.which===13){e.preventDefault();e.stopPropagation();TAG.Auth.checkPassword(o.val(),function(){R()},function(){a.html("Invalid Password. Please try again...");a.css({visibility:"visible"})},function(){a.html("There was an error contacting the server. Contact a server administrator if this error persists.");a.css({visibility:"visible"})})}})}function O(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("android")>=0||e.indexOf("iphone")>=0||e.indexOf("ipad")>=0||e.indexOf("ipod")>=0){if(e.indexOf("android")>=0){console.log("Detected Android Device. Unsupported browser.")}else if(e.indexOf("iphone")>=0){console.log("Detected iPhone. Unsupported browser.")}else if(e.indexOf("ipad")>=0){console.log("Detected iPad. Unsupported browser.")}else if(e.indexOf("ipod")>=0){console.log("Detected iPod. Unsupported browser.")}return false}else{var t=M();t=t.toLowerCase();var n=0;if(t.indexOf("opera")>=0||e.indexOf("opr")>=0){console.log("Detected Opera. Unsupported browser.");return false}else if(t.indexOf("chrome")>=0){n=t.substring(t.indexOf(" ")+1,t.indexOf("."));console.log("Detected Chrome Version: "+n);return n>=31}else if(t.indexOf("safari")>=0){var r=t.substring(t.indexOf(" ",t.indexOf(" ")+1)+1);n=r.substring(0,r.indexOf("."));console.log("Detected Safari Version: "+n);return n>=7}else if(t.indexOf("firefox")>=0){n=t.substring(t.indexOf(" ")+1,t.indexOf("."));console.log("Detected Firefox Version: "+n);return n>=28}else if(t.indexOf("msie")>=0||t.indexOf("ie")>=0){n=t.substring(t.indexOf(" ")+1,t.indexOf("."));return n>=10}else{console.log("Unsupported browser.");return false}}}function M(){var e=navigator.userAgent,t,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(n[1])){t=/\brv[ :]+(\d+(\.\d+)?)/g.exec(e)||[];return"IE "+(t[1]||"")}n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"];if((t=e.match(/version\/([\.\d]+)/i))!=null)n[2]=t[1];return n.join(" ")}function _(){var e=$("#tagRoot");var t=$(document.createElement("div"));t.attr("id","browserDialogOverlay");t.addClass("dialogBoxOverlay");e.prepend(t);var n=$(document.createElement("div"));n.attr("id","browserDialogContainer");n.addClass("dialogBoxContainer");t.append(n);var r=$(document.createElement("div"));r.attr("id","browserDialog");r.addClass("dialogBox");n.append(r);var i=$(document.createElement("p"));i.attr("id","dialogBoxPara");i.text("Touch Art Gallery is not supported in your browser. Please download or update to a newer browser.");r.append(i);var s=$(document.createElement("div"));s.attr("id","browserIcons");r.append(s);var o=$(document.createElement("a")).attr("href","http://windows.microsoft.com/ie");var u=$(document.createElement("a")).attr("href","https://www.google.com/chrome");var a=$(document.createElement("a")).attr("href","http://www.firefox.com");var f=$(document.createElement("a")).attr("href","http://www.apple.com/safari");var l=[o,u,a,f];for(var c=0;c<l.length;c++){var h=l[c];h.attr("target","_blank");h.addClass("browserIconLink")}s.append(o,u,a,f);var p=$(document.createElement("img")).attr("title","Internet Explorer").attr("src",tagPath+"images/icons/browserIcons/ie.png");var d=$(document.createElement("img")).attr("title","Google Chrome").attr("src",tagPath+"images/icons/browserIcons/chrome.png");var v=$(document.createElement("img")).attr("title","Firefox").attr("src",tagPath+"images/icons/browserIcons/firefox.png");var m=$(document.createElement("img")).attr("title","Safari").attr("src",tagPath+"images/icons/browserIcons/safari.png");o.append(p);u.append(d);a.append(v);f.append(m);$("#browserIcons a img").addClass("browserIcon")}function D(){var e,t,n,r;if(TAG.Util.elementInDocument(museumName)){r=parseInt($(museumLoc).css("font-size"),10);e=$(museumName).height();n=$(museumName).height();var i=document.getElementById("museumNameSpan");$(i).css("height",t)}}function P(){S.on("click",function(e){e.stopPropagation()});i.css({border:"1px solid #fff"});i.on("click","a",function(e){var t=$(this).attr("href");e.stopPropagation()});i.on("mousedown",function(){i.css({"background-color":"transparent",color:"white"})})}function H(e){var t,n,i,s,o;t=r.find("#innerContainer");t.css("background-image","url("+TAG.Worktop.Database.fixPath(e.Metadata["BackgroundImage"])+")");n=e.Metadata["OverlayColor"];i=e.Metadata["OverlayTransparency"];E=TAG.Util.UI.hexToRGB(n)+i+")";s="#"+e.Metadata["IconColor"];S=r.find("#logoRow");S.css({"background-color":"transparent"})}function B(){var e,t,n,i,s,o,u,a,f,l;f=r.find("#msLogo");f.attr("src",tagPath+"images/microsoft_logo_transparent.png");l=r.find("#brownLogo");l.attr("src",tagPath+"images/brown_logo_transparent.png")}function j(e){}function F(e){var t="#"+e.Metadata["PrimaryFontColor"];$(".primaryFont").css({color:t});s.css({"border-color":t,color:t});f.css({"border-color":t});o.css({"border-color":t,color:t});l.css({"border-color":t});u.css({color:t});a.css({color:t})}function I(e){}function q(){L();if(localStorage.ip==="tagtestserver.cloudapp.net"){$("#authoringInput").attr("value","Test1234")}else if(localStorage.ip==="localhost"){$("#authoringInput").attr("value","admin")}}function R(){i.on("click",function(){});var e=new TAG.Authoring.SettingsView;TAG.Util.UI.slidePageLeft(e.getRoot())}function U(){return r}var n;e&&function(){n=e.isPreview}();e=TAG.Util.setToDefaults(e,TAG.Layout.StartPage.default_options);e.tagContainer=$("#tagRoot");var r=TAG.Util.getHtmlAjax("SplashScreenOverlay.html"),i=r.find("#goToCollectionsButton"),s=r.find("#serverInput"),o=r.find("#passwordInput"),u=r.find("#serverError"),a=r.find("#passwordError"),f=r.find("#serverSubmit"),l=r.find("#passwordSubmit"),c,h,p=e.newUser,d,v,m;s.attr("placeholder",localStorage.ip);s.attr("value",localStorage.ip);n&&function(){s.css({"min-height":"0px","min-width":"0px"});f.css({"min-height":"0px","min-width":"0px"});o.css({"min-height":"0px","min-width":"0px"});l.css({"min-height":"0px","min-width":"0px"})}();if(localStorage.ip&&localStorage.ip.indexOf(":")!==-1){localStorage.ip=localStorage.ip.split(":")[0]}c="http://"+(localStorage.ip?localStorage.ip+":8080":"browntagserver.com:8080");h=e.tagContainer||$("body");if(!IS_WINDOWS){o.prop("disabled",true);o.css("opacity","0.5");l.css("opacity","0.5")}y();if(p){g()}var w={};var E,S,x,T;var C=$.debounce(500,false,function(e){var t=s.val();switch(t){case"tagunicorn":var n=$(document.createElement("img"));n.attr("src",tagPath+"images/unicorn.jpg");n.css({width:"100%",height:"100%","z-index":2147483647,display:"none",position:"absolute"});h.append(n);n.fadeIn(500);setTimeout(function(){$("img").attr("src",tagPath+"images/unicorn.jpg");$(".background").css("background-image","url("+tagPath+'"images/unicorn.jpg")');n.fadeOut(500,function(){n.remove()})},5e3);return;case"tagtest":case"tagtestserver.cloudapp.net":t="tagtestserver.cloudapp.net";break;case"tagdemo":case"tagdemo.cloudapp.net":t="tagdemo.cloudapp.net";break;case"taglive":case"browntagserver.com":t="browntagserver.com";break;case"taglocal":case"10.116.71.58":t="10.116.71.58";break;case"sam":case"seattleartmuseum":case"tag.seattleartmuseum.org":t="tag.seattleartmuseum.org";break;default:break}u.html("Connecting...");u.css({visibility:"visible"});TAG.Worktop.Database.changeServer(t,false,function(){TAG.Layout.StartPage(null,function(e){TAG.Util.UI.slidePageRight(e)})},function(){u.html("Server connection failed. Contact the server administrator.");u.css({visibility:"visible"})})});f.on("click",C);s.keypress(function(e){if(e.which===13){C()}});f.on("mousedown",function(){f.css({"background-color":v,color:"black"})});l.on("mouseleave",function(){l.css({"background-color":"transparent",color:v})});i.on("mouseleave",function(){i.css({"background-color":"white",color:"black"})});s.focusout(function(){if(!s.val()){s.attr("value",localStorage.ip)}});var k=$.debounce(500,false,function(e){e.preventDefault();e.stopPropagation();if(IS_WINDOWS){TAG.Auth.checkPassword(o.val(),function(){R()},function(){a.html("Invalid Password. Please try again...");a.css({visibility:"visible"})},function(){a.html("There was an error contacting the server. Contact a server administrator if this error persists.");a.css({visibility:"visible",color:"rgba(255, 255, 255)"})})}else{a.html("Authoring mode is only accessible from the Windows 8 app");a.css({visibility:"visible"});a.css({color:"rgba(255, 255, 255, 1)"})}});var A=$(document.createElement("img"));A.css({width:"20px",height:"auto",display:"none","margin-right":"3%","margin-top":"2.5%","float":"right"});A.attr("src",tagPath+"images/icons/progress-circle.gif");w.getRoot=U;return w};TAG.Layout.StartPage.default_options={repository:"http://cs.brown.edu/research/lads/LADS2.0Data/repository.xml"};TAG.Util.makeNamespace("TAG.Layout.ArtworkViewer");TAG.Layout.ArtworkViewer=function(e,t){"use strict";function J(){var e,t,r;if(!idleTimer&&!M){idleTimer=TAG.Util.IdleTimer.TwoStageTimer();idleTimer.start()}if(idleTimer&&M){idleTimer.kill()}if(y===x.Identifier){idleTimer.kill()}var i={position:"absolute","z-index":"50",height:"auto",width:"5%",left:"47.5%",top:"42.5%"};TAG.Util.showProgressCircle(l,i,"0px","0px",false);var s=$(document.createElement("label"));s.css({position:"absolute",left:"40%",top:"55%","font-size":"200%",color:"white",opacity:"1"});s.text("Loading Viewer");l.append(s);e=document.getElementsByTagName("head").item(0);t=document.createElement("script");t.charset="UTF-8";t.type="text/javascript";t.src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0";e.appendChild(t);r=document.createElement("meta");r.httpEquiv="Content-Type";r.content="text/html; charset=utf-8";e.appendChild(r);R=TAG.Util.UI.getLocationList(x.Metadata);W=TAG.AnnotatedImage({root:n,doq:x,callback:function(){X=W.getAssociatedMedia();X.guids.sort(function(e,t){return X[e].doq.Name.toLowerCase()<X[t].doq.Name.toLowerCase()?-1:1});try{W.openArtwork(x)}catch(e){debugger;console.log(e)}TAG.Util.Splitscreen.setViewers(n,W);K();Q();TAG.Worktop.Database.getMaps(x.Identifier,function(e){U=e.length;G()});l.hide()},noMedia:false})}function K(){var e=$(document.createElement("div")),t=$(document.createElement("img"));e.attr("id","splitscreenContainer");e.css({"background-color":"rgba(0,0,0,0.6)","border-top-left-radius":"3.5px",height:"10%",position:"absolute",right:"0%","text-align":"center",top:"90%","vertical-align":"center",width:"10%","z-index":"500"});t.attr({id:"splitscreen-icon",src:tagPath+"images/SplitWhite_dotted.svg"});t.css({height:"50%",left:"2%",opacity:"0.6","margin-top":"8%",width:"75%"});e.on("click",function(){var t,r;if(!TAG.Util.Splitscreen.isOn()){if(m){p.animate({width:"0%"},350,function(){c.text("Maps");c.css({color:TAG.Util.UI.dimColor(w,1.7)});h.css({"background-color":"transparent"});p.hide();d.hide();v.attr("src",tagPath+"images/icons/plus.svg");m=false;i.show();t=TAG.Layout.CollectionsPage();r=t.getRoot();r.data("split","R");e.css("display","none");TAG.Util.Splitscreen.init(n,r);W.viewer.scheduleUpdate();TAG.Util.Splitscreen.setViewers(n,W)})}else{c.css({color:TAG.Util.UI.dimColor(w,1.7)});t=TAG.Layout.CollectionsPage();t.getRoot().find("#mainCollection").css("width","60%");r=t.getRoot();r.data("split","R");e.css("display","none");TAG.Util.Splitscreen.init(n,r);W.viewer.scheduleUpdate();TAG.Util.Splitscreen.setViewers(n,W)}}});e.append(t);var r=$(document.createElement("div")).css({"font-size":"40%",bottom:"0%","margin-top":"-2%"}).text("Splitscreen").appendTo(e);n.append(e);if(TAG.Util.Splitscreen.isOn()){e.css("display","none")}}function Q(){function y(e,t,n,r){var i=$(document.createElement("img"));i.attr({src:t,id:e});i.removeAttr("width");i.removeAttr("height");i.css({left:n+"px",top:r+"px"});if(e==="leftControl"||e==="rightControl"){i.addClass("seadragonManipButtonLR")}else if(e==="upControl"||e==="downControl"){i.addClass("seadragonManipButtonUD")}else if(e==="zinControl"||e==="zoutControl"){i.addClass("seadragonManipButtoninout")}return i}function b(e,t){e.preventDefault();clearInterval(f);E(e,t)}function w(e,t){E(e,t);clearInterval(f);f=setInterval(function(){E(e,t)},100)}function E(e,t){var n=W.getMediaPivot();V=W.getToManip();if(t==="left"){V({pivot:n,translation:{x:-o,y:0},scale:1},null,true)}else if(t==="up"){V({pivot:n,translation:{x:0,y:-o},scale:1},null,true)}else if(t==="right"){V({pivot:n,translation:{x:o,y:0},scale:1},null,true)}else if(t==="down"){V({pivot:n,translation:{x:0,y:o},scale:1},null,true)}else if(t==="in"){V({pivot:n,translation:{x:0,y:0},scale:u})}else if(t==="out"){V({pivot:n,translation:{x:0,y:0},scale:1/u})}}var e=n.find("#seadragonManipContainer"),t=n.find("#seadragonManipSlideButton"),r=$("#tagRoot"),i=0,s=0,o=20,u=1.1,a=true,f;if(n.data("split")==="R"&&TAG.Util.Splitscreen.isOn()){e.css({right:"auto",left:"0%"});t.css({"border-bottom-left-radius":"0px","border-bottom-right-radius":"3.5px"})}if(M){return}e.css("width",Math.max(160,Math.min($("#tagRoot").width()*.19,400)));var l=e.width()*(111/163);e.css({height:l+"px",top:"-"+l+"px","min-width":e.width()});t.css({"padding-top":.05*e.width()+"px","padding-bottom":.05*e.width()+"px"});t.on("click",function(){s=1-s;e.animate({top:i});if(s===0){i="0px";t.html("Show Controls")}else{i="-"+l+"px";t.html("Hide Controls")}});TAG.Telemetry.register(t,"click","seadragon_button_panel_toggled",function(e){e.custom_1=CryptoJS.SHA1(x.Name).toString(CryptoJS.enc.Base64);e.mode="Kiosk"});e.append(t);var c=y("leftControl",tagPath+"images/icons/zoom_left.svg"),h=y("rightControl",tagPath+"images/icons/zoom_right.svg"),p=y("upControl",tagPath+"images/icons/zoom_up.svg"),d=y("downControl",tagPath+"images/icons/zoom_down.svg");e.append(d);e.append(p);if(d.width()){console.log("got valid height"+d.height());c.css("height",d.width());h.css("height",d.width())}e.append(c);e.append(h);var v=(h.position().left-c.position().left+h.width())/2;var m=c.position().top+c.height()/2;e.append(y("zinControl",tagPath+"images/icons/zoom_plus.svg"));e.append(y("zoutControl",tagPath+"images/icons/zoom_minus.svg"));var g=$(document.createElement("input")).attr({id:"crossfadeSlider",type:"range",value:1,min:0,max:1,step:.05});g.on("change mousemove",function(){$(".mediaOuterContainer").css("opacity",g.val())});g.on("touchmove",function(e){e.preventDefault();$(".mediaOuterContainer").css("opacity",g.val())});TAG.Telemetry.register(n.find("#leftControl,#rightControl,#downControl,#upControl,#zoutControl,#zinControl"),"click","seadragon_control_clicked",function(e){e.custom_1=CryptoJS.SHA1(x.Name).toString(CryptoJS.enc.Base64);e.mode="Kiosk"});$("#tagContainer").attr("tabindex",-1);$("[tabindex='-1']").focus();$("[tabindex='-1']").css("outline","none");$("[tabindex='-1']").on("click",function(){$("[tabindex='-1']").focus();a=true;W.dzManipPreprocessing()});$("[tabindex='-1']").focus(function(){a=true});$("[tabindex='-1']").focusout(function(){a=false});$(document).on("keydown",function(e){if(a){switch(e.which){case 37:b(e,"left");break;case 38:b(e,"up");break;case 39:b(e,"right");break;case 40:b(e,"down");break;case 187:case 61:b(e,"in");break;case 189:case 173:b(e,"out");break}}});$(document).keyup(function(e){clearInterval(f)});n.find("#seadragonManipContainer").on("click",function(e){e.stopPropagation();e.preventDefault();TAG.Util.IdleTimer.restartTimer()});n.find("#leftControl").on("mousedown",function(e){w(e,"left")});n.find("#upControl").on("mousedown",function(e){w(e,"up")});n.find("#rightControl").on("mousedown",function(e){w(e,"right")});n.find("#downControl").on("mousedown",function(e){w(e,"down")});n.find("#zinControl").on("mousedown",function(e){w(e,"in")});n.find("#zoutControl").on("mousedown",function(e){w(e,"out")});n.find(".seadragonManipButtonLR").on("mouseup mouseleave",function(){clearInterval(f)});n.find(".seadragonManipButtonUD").on("mouseup mouseleave",function(){clearInterval(f)});n.find(".seadragonManipButtoninout").on("mouseup mouseleave",function(){clearInterval(f)});TAG.Telemetry.register($("[tabindex='-1']"),"keydown","seadragon_key_pressed",function(e){if(a===false){return true}e.custom_1=CryptoJS.SHA1(x.Name).toString(CryptoJS.enc.Base64);e.mode="Kiosk"})}function G(t){function it(){TAG.Util.removeYoutubeVideo();var e,t;o.off("click");W&&W.unload();e=TAG.Layout.CollectionsPage({backScroll:N,backPreviewPos:O,backArtwork:A,backCollection:C,backTag:k,backMult:L,wasOnAssocMediaView:D,splitscreen:n.data("split")});t=e.getRoot();t.data("split",n.data("split")==="R"?"R":"L");TAG.Util.UI.slidePageRightSplit(n,t,function(){if(!IS_WINDOWS){if(e.getState().exhibition===C){e.showArtwork(A,L&&L)()}}});currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE;currentPage.obj=e}function ut(e,t){return function(){e.append(TAG.Util.Artwork.createThumbnailButton({title:TAG.Util.htmlEntityDecode(t.Name),year:TAG.Util.htmlEntityDecode(t.Year||""),handler:lt(t),buttonClass:"tourButton",src:t.Metadata.Thumbnail?b(t.Metadata.Thumbnail):tagPath+"images/tour_icon.svg"}))}}function at(e,t){return function(){var n="",r=t.doq.Metadata,i=r.Thumbnail;switch(r.ContentType){case"Audio":n=tagPath+"images/audio_icon.svg";break;case"Video":n=i&&!i.match(/.mp4/)?b(i):tagPath+"images/video_icon.svg";break;case"Image":n=i?b(i):b(r.Source);break;case"iframe":n=tagPath+"images/video_icon.svg";break;default:n=tagPath+"images/text_icon.svg";break}var s=TAG.Util.Artwork.createThumbnailButton({title:TAG.Util.htmlEntityDecode(t.doq.Name),year:TAG.Util.htmlEntityDecode(t.doq.Year||""),handler:ft(t),buttonClass:"mediaButton",buttonID:"thumbnailButton-"+t.doq.Identifier,src:n});e.append(s);if(s.parents("#metascreen-R").length){s.attr("id",s.attr("id")+"R")}}}function ft(e){return function(t){t&&t.stopPropagation();P=true;e.create();e.toggle();TAG.Util.IdleTimer.restartTimer();e.mediaManipPreprocessing();e.pauseReset()}}function lt(t){return function(){TAG.Util.removeYoutubeVideo();var r,i,s,o,u;if(TAG.Util.Splitscreen.isOn()){u=$(TAG.Util.UI.PopUpConfirmation(function(){TAG.Util.Splitscreen.exit(n.data("split")||"L");lt(t)();TAG.Util.multiLineEllipsis($($($(u).children()[0]).children()[0]))},"By opening this tour, you will exit splitscreen mode. Would you like to continue?","Continue",false,function(){u.remove()},n));u.css({"z-index":10001,"font-size":"60%"});n.append(u);u.show()}else{W.unload();s={artworkPrev:"artmode",prevScroll:N,prevTag:k};r=JSON.parse(unescape(t.Metadata.Content));o=new TAG.Layout.TourPlayer(r,C,s,e,t);TAG.Util.UI.slidePageLeftSplit(n,o.getRoot(),o.startPlayback)}}}function wt(){if(vt)return;vt=true;bt=n.find("#minimap");bt.attr("src",TAG.Worktop.Database.fixPath(x.URL));bt.mousedown(function(){return false});mt=dt.naturalWidth/dt.naturalHeight;var e=dt.naturalHeight/$(ct).height();var t=dt.naturalWidth/$(ct).width();if(e>t){bt.removeAttr("height");bt.removeAttr("width");bt.css({height:"100%"})}else{bt.removeAttr("height");bt.removeAttr("width");bt.css({width:"100%"})}if(IS_WINDOWS){var r=TAG.Util.makeManipulatableWin(bt[0],{onManipulate:St,onScroll:Tt,onTapped:Ct},false)}else{var r=TAG.Util.makeManipulatable(bt[0],{onManipulate:Et,onScroll:xt,onTapped:Nt},true)}var i=bt.height();var s=bt.width();var o=ct.height()/2-bt.height()/2;var u=ct.width()/2-bt.width()/2;pt.css({width:s-1+"px",height:i-1+"px",top:o+"px",left:u-1+"px"})}function Et(e){var t=bt.height();var n=bt.width();var r=bt.position().top;var i=parseFloat(bt.css("marginLeft"));var s=e.pivot.x+(bt.offset().left-ct.offset().left);var o=e.pivot.y+(bt.offset().top-ct.offset().top);var u=e.translation.x;var a=e.translation.y;var f=s+u;var l=o+a;f=(f-i)/n;l=(l-r)/t;l=l/mt;f=Math.max(0,Math.min(f,1));l=Math.max(0,Math.min(l,1/mt));var c=1+(1-e.scale);if(c)W.viewer.viewport.zoomBy(c,false);W.viewer.viewport.panTo(new Seadragon.Point(f,l),true);W.viewer.viewport.applyConstraints()}function St(e){var t=bt.height();var n=bt.width();var r=bt.position().top;var i=parseFloat(bt.css("marginLeft"));var s=e.pivot.x;var o=e.pivot.y;var u=e.translation.x;var a=e.translation.y;var f=s+u;var l=o+a;f=(f-i)/n;l=(l-r)/t;l=l/mt;f=Math.max(0,Math.min(f,1));l=Math.max(0,Math.min(l,1/mt));var c=1+(1-e.scale);if(c){W.viewer.viewport.zoomBy(c,false)}W.viewer.viewport.panTo(new Seadragon.Point(f,l),true);W.viewer.viewport.applyConstraints()}function xt(e,t){Et({scale:e,translation:{x:0,y:0},pivot:t})}function Tt(e,t){W.viewer.viewport.zoomBy(e,W.viewer.viewport.pointFromPixel(new Seadragon.Point(t.x,t.y)));W.viewer.viewport.applyConstraints()}function Nt(e){var t=bt.height();var n=bt.width();var r=bt.position().top;var i=parseFloat(bt.css("marginLeft"));var s=e.position.x;var o=e.position.y;var u=(s-i)/n;var a=(o-r)/t;a=a/mt;u=Math.max(0,Math.min(u,1));a=Math.max(0,Math.min(a,1/mt));var f=1;if(f)W.viewer.viewport.zoomBy(f,false);W.viewer.viewport.panTo(new Seadragon.Point(u,a),true);W.viewer.viewport.applyConstraints()}function Ct(e){var t=bt.height();var n=bt.width();var r=bt.position().top;var i=parseFloat(bt.css("marginLeft"));var s=e.position.x;var o=e.position.y;var u=(s-i)/n;var a=(o-r)/t;a=a/mt;u=Math.max(0,Math.min(u,1));a=Math.max(0,Math.min(a,1/mt));var f=1;if(f){W.viewer.viewport.zoomBy(f,false)}W.viewer.viewport.panTo(new Seadragon.Point(u,a),true);W.viewer.viewport.applyConstraints()}function kt(e){var t=bt.height();var n=bt.width();var r=ct.height()/2-bt.height()/2;var i=ct.width()/2-bt.width()/2;var s=e.viewport;var o=s.getBounds(true);var u=o.getTopLeft();var a=o.getBottomRight();var f=u.x;var l=u.y;var c=a.x;var h=a.y;if(f<0)f=0;if(l<0)l=0;if(c>1)c=1;if(h>1/mt)h=1/mt;l=l*mt;h=h*mt;h=h-l;c=c-f;f=i+f*n;l=r+l*t;c=c*n;h=h*t;pt.css({width:c-1+"px",height:h-1+"px",top:l+"px",left:f-1+"px"})}var l=n.find("#backBttnContainer"),h=n.find("#sideBarSections"),p=n.find("#sideBarInfo"),d=n.find("#infoTitle"),v=n.find("#infoArtist"),m=n.find("#infoYear"),g=n.find("#assetContainer"),E=true,S=0,T,H,B,j,F,z,V,J,K,Q,G,et,tt,nt,rt=false;p.css({height:h.height()-25+"px"});if(y!==x.Identifier){o.attr("src",tagPath+"images/icons/Back.svg")}else{o.hide()}s.attr("src",tagPath+"images/icons/Close.svg");d.text(x.Name);v.text(x.Metadata.Artist);m.text(x.Metadata.Year);d.css({color:"#"+w});v.css({color:"#"+w});m.css({color:"#"+w});c&&c.css({color:"#"+w});if(n.data("split")==="R"&&TAG.Util.Splitscreen.isOn()){r.css({left:"auto",right:"0%"});i.css({left:"-12%","border-top-left-radius":"3.5px","border-top-right-radius":"0px","border-bottom-right-radius":"0px","border-bottom-left-radius":"3.5px"});s.attr("src",tagPath+"images/icons/Open.svg").css("right","0%")}else{s.css("left","0%")}if(!M){r.css("min-width",.22*q)}i.on("click",function(){var e={},t=n.data("split")==="L";if(t){e.left=E?"-"+.22*q+"px":"0%"}else{e.right=E?"-"+.22*q+"px":"0%"}E=!E;r.animate(e,1e3,function(){s.attr("src",tagPath+"images/icons/"+(!!E^!t?"Close.svg":"Open.svg"))})});TAG.Util.UI.setUpBackButton(o,it);TAG.Telemetry.register(o,"click","artwork_to_collections",function(e){e.custom_1=CryptoJS.SHA1(x.Name).toString(CryptoJS.enc.Base64);e.mode="Kiosk"});if(IS_WEBAPP&&!y){u.attr("src",tagPath+"images/link.svg");u.on("click",function(){var e=TAG.Util.UI.showPageLink(urlToParse,{tagpagename:"artwork",tagguid:x.Identifier,prevpage:C.Identifier});n.append(e);e.fadeIn(500,function(){e.find(".linkDialogInput").select()})})}else{a.remove()}for(T in x.Metadata.InfoFields){if(x.Metadata.InfoFields.hasOwnProperty(T)){H=T;B=x.Metadata.InfoFields[T];j=$(document.createElement("div"));j.addClass("infoCustom");j.text(H+": "+B);j.css({color:"#"+w});j.appendTo(f)}}TAG.Util.fitText(f,1.1);if(x.Metadata.Description){J=Z("Description");J.contents.html(Autolinker.link(x.Metadata.Description.replace(/\n/g,"<br />"),{email:false,twitter:false}));if(IS_WINDOWS){var st=J.find("a");st.each(function(e,t){$(t).replaceWith(function(){return $.text([this])})})}g.append(J);S=J.height()}if(U>0||R.length>0){Q=Y();g.append(Q);S+=Q.height()}else{n.find("#locationHistoryContainer").remove()}var ot=null;if(X.guids.length>0){for(F=0;F<X.guids.length;F++){z=X[X.guids[F]];if(!G){G=Z("Associated Media",null,_);if(G.drawerToggle){ot=G.drawerToggle}}I.add(at(G.contents,z))}if(G){g.append(G);S+=G.height()}if(et){g.append(et);S+=et.height()}if(ot&&typeof ot==="function"){I.add(ot)}}TAG.Worktop.Database.getTours(function(e){var t,r;t=e.filter(function(e){var t;if(!e.Metadata||!e.Metadata.RelatedArtworks||e.Metadata.Private==="true"){return false}t=JSON.parse(e.Metadata.RelatedArtworks);if(!t||!t.length){return false}return t.indexOf(x.Identifier)>=0});if(t.length>0){K=Z("Tours");g.append(K);S+=K.height();K.contents.text("");for(F=0;F<t.length;F++){I.add(ut(K.contents,t[F]))}}r=Math.max(1,g.height()-S);n.find(".drawerContents").css({"max-height":r*.75+"px"})});var ct=n.find("#minimapContainer");f.css({"overflow-y":"auto","max-height":r.height()*2/5-(f.offset().top-r.offset().top)+"px"});var ht=$(document.createElement("div")).addClass("minimapDescription").css({"font-size":"80%","margin-top":"-13%","text-align":"center"}).text("Navigation");ct.append(ht);g.css({"max-height":p.height()-f.height()+(f.offset().top-r.offset().top)+"px"});h.append(ct);var pt=n.find("#minimaprect");var dt=new Image;var vt=false;var mt=1;var gt=1;var yt=1;var bt;dt.onload=wt;dt.src=TAG.Worktop.Database.fixPath(x.URL);if(dt.complete){wt()}W.addAnimateHandler(kt);_&&I.add(ft(X[_.Identifier]))}function Y(){function s(){m?u():o()}function o(){if(!m){if(!TAG.Util.Splitscreen.isOn()){n.find(".drawerPlusToggle").attr({src:tagPath+"images/icons/plus.svg",expanded:false});n.find(".drawerContents").slideUp();p.css({display:"inline"});v.attr("src",tagPath+"images/icons/minus.svg");m=true;i.hide();p.show();p.animate({width:"65%"},350,function(){d.show()})}}}function u(){if(m){v.attr("src",tagPath+"images/icons/plus.svg");c.text("Maps");h.css({"background-color":"transparent"});m=false;p.animate({width:"0%"},350,function(){p.hide();d.hide();i.show()})}}var e,t=$(document.createElement("div")).addClass("drawerToggleContainer");m=false;v=$(document.createElement("img")).addClass("drawerPlusToggle").attr("src",tagPath+"images/icons/plus.svg");h.on("click",function(){s()});t.append(v);h.append(t);e=TAG.Util.RLH({artwork:x,root:n,authoring:false});p=e.init();p.css({width:"0%"});d=$(document.createElement("div")).attr("id","locHistoryToggle").css({left:"100%","border-top-right-radius":"10px","border-bottom-right-radius":"10px","background-color":"rgba(0,0,0,0.7)",top:"43%",width:"4%",height:"14%","z-index":"100",position:"relative"});var r=$(document.createElement("img")).attr("src",tagPath+"images/icons/Close.svg").attr("id","locHistoryToggleImage").css({left:"0%",position:"absolute",top:"30%",width:"72%",height:"42%"});p.append(d);d.append(r);d.on("click",function(){s()});if(TAG.Util.Splitscreen.isOn()){c.css({color:TAG.Util.UI.dimColor(w,1.7)})}g.locationClose=u;return h}function Z(e,t,r){var i=$(document.createElement("div")).addClass("drawer"),s=$(document.createElement("div")).addClass("drawerHeader"),o=$(document.createElement("div")).addClass("drawerLabel"),u=$(document.createElement("div")).addClass("drawerToggleContainer"),a=$(document.createElement("img")).addClass("drawerPlusToggle"),f=$(document.createElement("div")).addClass("drawerContents"),l;o.addClass("primaryFont");o.text(e);o.css({color:"#"+w});a.attr({src:tagPath+"images/icons/plus.svg",expanded:false});i.append(s);s.append(o);s.append(u);u.append(a);i.append(f);t&&f.append(t);var c=function(e){if(a.attr("expanded")!=="true"){n.find(".drawerPlusToggle").attr({src:tagPath+"images/icons/plus.svg",expanded:false});n.find(".drawerContents").slideUp();a.attr({src:tagPath+"images/icons/minus.svg",expanded:true})}else{a.attr({src:tagPath+"images/icons/plus.svg",expanded:false})}f.slideToggle();m&&g.locationClose()};s.on("click",c);i.contents=f;if(r&&e==="Associated Media"){i.drawerToggle=c}return i}function et(){return n}function tt(e){var t,n;t={credentials:"AkNHkEEn3eGC3msbfyjikl4yNwuy5Qt9oHKEnqh4BSqo5zGiMGOURNJALWUfhbmj",mapTypeID:Microsoft.Maps.MapTypeId.road,showScalebar:true,enableClickableLogo:false,enableSearchLogo:false,showDashboard:true,showMapTypeSelector:false,zoom:2,center:new Microsoft.Maps.Location(20,0)};n={mapTypeId:Microsoft.Maps.MapTypeId.road};z=new Microsoft.Maps.Map(document.getElementById("lpMapDiv"),t);z.setView(n);e&&e()}e=e||{};var n=TAG.Util.getHtmlAjax("Artmode.html"),r=n.find("#sideBar"),i=n.find("#toggler"),s=n.find("#togglerImage"),o=n.find("#backButton"),u=n.find("#linkButton"),a=n.find("#linkContainer"),f=n.find("#info"),l=n.find("#loadingArea"),c=n.find("#locationHistory"),h=n.find("#locationHistoryContainer"),p=null,d=null,v=null,m=false,g=this,y=TAG.Worktop.Database.getLocked(),b=TAG.Worktop.Database.fixPath,w=e.primaryFontColor?e.primaryFontColor:TAG.Worktop.Database.getMuseumPrimaryFontColor(),E=e.secondaryFontColor?e.secondaryFontColor:TAG.Worktop.Database.getMuseumSecondaryFontColor(),S=TAG.Worktop.Database.getMuseumFontFamily(),x=e.doq,T=e.prevPage,N=e.prevScroll||0,C=e.prevCollection,k=e.prevTag,L=e.prevMult,A=e.prevPreview,O=e.prevPreviewPos,M=e.previewing,_=e.assocMediaToShow,D=e.onAssocMediaView,P=false,H=false,B=false,j=[],F=[],I=TAG.Util.createQueue(),q=$("#tagRoot").width(),R,U,z,W,X,V;x&&J();return{getRoot:et};n.attr("unselectable","on");n.css({"-moz-user-select":"-moz-none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"});n.bind("selectstart",function(){return false});r.disableSelection();r.attr("unselectable","on");r.css({"-moz-user-select":"-moz-none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"});r.bind("selectstart",function(){return false})};TAG.Layout.ArtworkViewer.default_options={catalogState:{},doq:null,split:"L"};TAG.Util.makeNamespace("TAG.Layout.CollectionsPage");TAG.Layout.CollectionsPage=function(e){"use strict";function qt(){if(q&&idleTimer){idleTimer.kill()}var e,n,r;It=null;e={position:"absolute","z-index":"50",height:"auto",width:"5%",left:"47.5%",top:"42.5%"};n=TAG.Util.showProgressCircle(C,e,"0px","0px",false);var i=$(document.createElement("div"));i.css({position:"absolute",left:"37%",top:"55%","font-size":"200%",color:"white",opacity:"1"});i.text("Loading Collections");C.append(i);$("#tagContainer").off();g.on("keyup",function(e){if(!g.val()){y.text("");en(K,F,0,false)}else if(e.which===13){Yt()}});g.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")',"background-size":"auto 50%","background-repeat":"no-repeat","background-position":"8px center"});g.on("focusin",function(){g.css({"background-image":"none"})});g.on("focusout",function(){if(!g.val()){g.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})}});k.attr("src",tagPath+"images/icons/info.svg").addClass("bottomButton");k.on("mousedown",function(){Rt()});L.attr("src",tagPath+"images/icons/question_mark.svg").addClass("bottomButton").on("mousedown",function(){TAG.Util.createTutorialPopup()});if(IS_WEBAPP){A.attr("src",tagPath+"images/link.svg").addClass("bottomButton").on("mousedown",function(){var e=TAG.Util.UI.showPageLink(urlToParse,{tagpagename:"collections",tagcollectionid:B.Identifier,tagartworkid:j?j.Identifier:""});t.append(e);e.fadeIn(500,function(){e.find(".linkDialogInput").select()})})}else{A.remove()}if(t.data("split")==="R"&&TAG.Util.Splitscreen.isOn()){$(".mainCollection").css("width","60%")}if(t.data("split")==="L"&&TAG.Util.Splitscreen.isOn()){k.hide();L.hide();A.css("float","left");t.find("#mainCollection").css("width","60%")}if(p[0].addEventListener){p[0].addEventListener("mousewheel",function(){j&&cn(j)()},false);p[0].addEventListener("DOMMouseScroll",function(){j&&cn(j)()},false)}else{p[0].attachEvent("onmousewheel",function(){j&&cn(j)()},false)}var e={position:"absolute","float":"left",left:"40%","z-index":"50",height:"10%",width:"auto",top:"22%"};TAG.Worktop.Database.getExhibitions(Xt,null,Xt);Vt()}function Rt(){var e=$(TAG.Util.UI.blockInteractionOverlay());var n=$(document.createElement("div"));var r=$(document.createElement("div"));var i=$(document.createElement("div"));var s=$(document.createElement("div"));var o=$(document.createElement("div"));var u=$(document.createElement("div"));var a=$(document.createElement("div"));var f=$(document.createElement("div"));var l=$(document.createElement("div"));var c=$(document.createElement("div"));var h=$(document.createElement("img"));var p=$(document.createElement("img"));var d=zt();var v="cs.brown.edu/research/ptc/tag";h.attr("src",tagPath+"images/microsoft_logo_transparent.png");p.attr("src",tagPath+"images/brown_logo_transparent.png");l.css({background:"transparent",width:"25%","min-width":"120px",height:"100%","float":"right",display:"inline-block"});c.css({background:"transparent",width:"10%","min-width":"40px",height:"100%","float":"right",display:"inline-block"});h.css({height:"auto",width:"100%","min-width":"120px","margin-top":"4%"});p.css({height:"auto",width:"80%","min-width":"40px","margin-top":"-16%"});e.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);e.append(n);n.css({"background-color":"black",color:"white",height:"50%",width:"50%","margin-top":"15%","margin-left":"25%"});r.css({"background-color":"black",margin:"0%",display:"block",color:"white","border-top-left-radius":"3.5px","border-top-right-radius":"3.5px"});r.append(o);r.append(u);d.css({height:"4%",width:"4%","min-height":"20px","min-width":"20px","margin-left":"0%","margin-bottom":"0%","margin-top":"1%","margin-right":"1%",top:"0%",display:"block","float":"right"});n.append(d);o.css({color:"white","background-color":"black",display:"inline-block","font-weight":"bold","font-size":"2em","margin-left":"5%","margin-top":"2%"});o.text("TAG");u.css({color:"white","background-color":"black",display:"inline-block","font-size":"1.5em","margin-left":"3%"});u.text("Touch Art Gallery");i.css({"background-color":"black",display:"block",color:"white"});a.css({color:"white",background:"black",display:"block","font-size":"0.75em","margin-left":"5%","margin-top":"3%","margin-right":"6%"});f.css({color:"white",background:"black",display:"block","font-size":"0.65em","margin-left":"5%","margin-top":"3%","margin-right":"6%"});a.text("Touch Art Gallery is a free webapp and Win8 application, funded by Microsoft Reasearch and created by the Graphics Lab at Brown University. You can learn more about this project at http://cs.brown.edu/research/ptc/tag.");f.text("Andy van Dam, Alex Hills, Yudi Fu, Benjamin LeVeque, Karthik Battula, Karishma Bhatia, Gregory Chatzinoff, John Connuck, David  Correa, Mohsan Elahi, Aisha Ferrazares, Jessica Fu, Kaijan Gao, Jessica Herron, Ardra Hren, Hak Rim Kim, Lucy van Kleunen, Inna Komarovsky, Ryan Lester, Josh Lewis, Jinqing Li, Jeffery Lu, Xiaoyi Mao, Ria Mirchandani, Julie Mond, Ben Most, Jonathan Poon, Dhruv Rawat, Emily Reif, Surbhi Madan, Tanay Padhi, Jacob Rosenfeld, Qingyun Wan, Jing Wang, David Weinberger, Anqi Wen, Dan Zhang, Libby Zorn");i.append(a);i.append(f);s.css({"background-color":"black",display:"block",color:"white",height:"17%",padding:"5%","border-bottom-right-radius":"3.5px","border-bottom-left-radius":"3.5px"});s.append(c);s.append(l);c.append(p);l.append(h);n.append(r);n.append(i);n.append(s);t.append(e);e.fadeIn();d.on("mousedown",function(){e.fadeOut()})}function Ut(){st=false;F=null;j=null;B=null;R.clear();Ht=false;r.empty();Ft.show();if(It)It()}function zt(){var e=$(document.createElement("img"));e.attr("src",tagPath+"images/icons/x.svg");e.text("X");e.css({height:"3%",width:"3%","margin-left":"39%","margin-bottom":"3.5%"});return e}function Wt(e){if(j.Type==="Empty"){if(j.Metadata.ContentType==="iframe"){return"iframe"}else{return"tour"}}else if(j.Metadata.Type==="VideoArtwork"){return"video"}return"artwork"}function Xt(e){var n,r,i,s,o,u,a,f=false;for(n=0;n<e.length;n++){i=e[n];r=i.Metadata.Private?/^true$/i.test(i.Metadata.Private):false;if(!r&&TAG.Util.localVisibility(i.Identifier)){f=f?f:true;kt=kt||i;z.push(e[n])}}if(!f&&!q){var l=$(document.createElement("div"));l.text("No collections to display");l.css({color:"white","text-align":"center","font-size":"200%","margin-top":"20%"});t.append(l);$("#catalogDivContainer").hide();TAG.Util.hideLoading(p)}c.empty();var h=document.createDocumentFragment();for(n=0;n<z.length;n++){if(z.length<=2){o=null;u=null}else{o=z.length-1;u=0}z[n].prevCollectionIndex=z[n-1]?n-1:o;z[n].nextCollectionIndex=z[n+1]?n+1:u;if(q){ht=t.width()/120}a=$(document.createElement("div")).addClass("collectionDot").css({width:ht,height:ht,"border-radius":ht/2,margin:ht/4}).on("click",function(e){return function(){Ut();$t(z[e])()}}(n));h.appendChild(a[0]);W[z[n].Identifier]=a}c.append($(h));if(B){for(n=0;n<z.length;n++){if(B.Identifier===z[n].Identifier){B=z[n]}}if(z.indexOf(B)===-1){if(q){$t(B,null,j)()}else{Jt()}}else{$t(B,null,j)()}}else if(kt){Jt()}C.hide();g.show()}function Vt(){var e=TAG.Util.UI.dimColor(bt,yt);$(".primaryFont").css({color:bt});$(".secondaryFont").css({color:wt});$(".nextPrevCollection").css({color:e})}function $t(e,i,l){return function(i){var p=false;E.css({color:TAG.Util.UI.dimColor(wt,yt)});E.attr("disabled","disabled");w.css({color:TAG.Util.UI.dimColor(wt,yt)});w.attr("disabled","disabled");var v,m=TAG.Util.htmlEntityDecode(e.Name),N,C,k=t.find("#mainCollection"),L=t.find(".collection-title"),A=[],O=0,M,P=$(document.createElement("div")),H,F=TAG.Util.UI.dimColor(wt,yt),I,R=e.Metadata&&e.Metadata.Description?TAG.Util.htmlEntityDecode(e.Metadata.Description):""+"\n\n   ",U={position:"absolute","float":"left",left:"12%","z-index":"50",height:"20%",width:"auto",top:"22%"};rt=false;if(!idleTimer&&i&&!q){idleTimer=TAG.Util.IdleTimer.TwoStageTimer();idleTimer.start()}if(e.Metadata.BackgroundImage){h.css("background-image","url("+ft(e.Metadata.BackgroundImage)+")")}if(e.Metadata.Timeline==="true"||e.Metadata.Timeline==="false"){e.Metadata.Timeline==="true"?it=true:it=false}else{it=true}if(st&&e.collectionMediaMinYear===Infinity){it=false}b.empty();if(e.Metadata.AssocMediaView&&e.Metadata.AssocMediaView==="true"){TAG.Worktop.Database.getAssocMediaIn(e.Identifier,function(t){if(p)return;for(v=0;v<t.length;v++){A.push(t[v])}e.collectionMedia=A;if(yn(A,true).min()){e.collectionMediaMinYear=yn(A,true).min().yearKey}})}y.text("");g.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'});d.empty();d.stop();if(!W[e.Identifier]){H=$(document.createElement("div")).addClass("collectionDot").css({width:ht,height:ht,"border-radius":ht/2,margin:ht/4,"background-color":"white"});c.append(H);o.css("display","none")}else{for(v=0;v<z.length;v++){W[z[v].Identifier].css("background-color","rgb(170,170,170)")}W[e.Identifier].css("background-color","white")}k.addClass("mainCollection");L.addClass("collection-title primaryFont").html(m);var X=document.createDocumentFragment();if(e.prevCollectionIndex||e.prevCollectionIndex===0){C=TAG.Util.htmlEntityDecode(z[e.prevCollectionIndex].Name);o.addClass("arrowArea");o.css("left","0%").off().on("mousedown",function(e){return function(){Ut();$t(z[e.prevCollectionIndex])()}}(e));u.attr("src",tagPath+"images/icons/Close.svg");u.addClass("arrow");o.show();D.addClass("nextPrevCollection").addClass("primaryFont").css("left","3%").html(C).off().on("mousedown",function(e){return function(){Ut();$t(z[e.prevCollectionIndex])()}}(e));X.appendChild(D[0]);D.show();TAG.Telemetry.register(o,"mousedown","collection_title",function(e){e.custom_1=CryptoJS.SHA1(C).toString(CryptoJS.enc.Base64);e.mode="Kiosk"});TAG.Telemetry.register(D,"mousedown","collection_title",function(e){e.custom_1=CryptoJS.SHA1(C).toString(CryptoJS.enc.Base64);e.mode="Kiosk"})}if(D){D.css("width",(.95*s.width()-k.width())/2-o.width())}if(e.nextCollectionIndex||e.nextCollectionIndex===0){N=TAG.Util.htmlEntityDecode(z[e.nextCollectionIndex].Name);a.addClass("arrowArea");a.css({right:"0%"}).off().on("mousedown",function(e){return function(){Ut();$t(z[e.nextCollectionIndex])()}}(e));a.show();f.attr("src",tagPath+"images/icons/Open.svg");f.addClass("arrow");_.addClass("nextPrevCollection").addClass("primaryFont").html(N).css({right:0+a.width()/2,width:(.95*s.width()-k.width())/2-a.width()}).off().on("mousedown",function(e){return function(){Ut();$t(z[e.nextCollectionIndex])()}}(e));_.show();TAG.Telemetry.register(a,"mousedown","collection_title",function(e){e.custom_1=CryptoJS.SHA1(N).toString(CryptoJS.enc.Base64);e.mode="Kiosk"});TAG.Telemetry.register(_,"mousedown","collection_title",function(e){e.custom_1=CryptoJS.SHA1(N).toString(CryptoJS.enc.Base64);e.mode="Kiosk"});X.appendChild(_[0])}s.append($(X));if(e.prevCollectionIndex===null&&!e.nextCollectionIndex===null){o.hide();a.hide()}else if(e.prevCollectionIndex===null){o.hide();D.hide()}else if(e.nextCollectionIndex===null){a.hide();_.hide()}P.attr("id","collectionDescription");P.addClass("secondaryFont");P.css({"word-wrap":"break-word",height:"98%",color:wt});I=e.Metadata.Description?e.Metadata.Description.replace(/\n\r?/g,"<br />"):"";P.css({"font-size":.2*TAG.Util.getMaxFontSizeEM(I,1.5,.55*$(n).width(),.915*$(n).height(),.1)});P.html(Autolinker.link(I,{email:false,twitter:false}));if(IS_WINDOWS){if(P){var V=P.find("a");V.each(function(e,t){$(t).replaceWith(function(){return $.text([this])})})}}if(e.Metadata.Description&&!st){n.css("width","25%")}else{n.css("width","0%")}x.css("display","none");r.empty();d.append(r);n.empty();n.append(P);d.append(n);T.empty();nn();Ft=TAG.Util.showProgressCircle(d,U,d.width()/2,d.height()/2,true);d.append(Ft);if(e.Metadata.AssocMediaView&&e.Metadata.AssocMediaView==="true"){S.css({display:"block"});if(TAG.Util.Splitscreen.isOn()){S.css("width","40%")}w.off().on("mousedown",function(){w.css("color",wt);E.css("color",F);if(st){rt=false;st=false;$t(B)()}});E.off().on("mousedown",function(){w.css("color",F);E.css("color",wt);if(!st){j&&cn(j)();st=true;$t(B)()}})}else{S.css("display","none")}B=e;j=l||null;Vt();if(!st||!B.collectionMedia){Qt(B,null,function(){return p})}else{if(st&&ut.length==0){TAG.Worktop.Database.getArtworksIn(e.Identifier,function(e){ut=[];for(var t=0;t<e.length;t++){ut.push(e[t].Identifier)}Zt(B.collectionMedia);Kt(B,B.collectionMedia);Gt(B.collectionMedia)},null,null)}else{Zt(B.collectionMedia);Kt(B,B.collectionMedia);Gt(B.collectionMedia)}}It=function(){p=true}}}function Jt(){$t(kt,null,j&&j)()}function Kt(e,t){function u(){var e,t;b.empty();var s=document.createDocumentFragment();for(e=0;e<n.length;e++){r=$(document.createElement("div"));s.appendChild(r[0]);n[e]==="Tour"?t="Tours":t=n[e];r.addClass("secondaryFont");r.addClass("rowButton").text(t).attr("id",n[e].toLowerCase()+"Button").off().on("mousedown",function(){Sn(K,i[$(this).attr("id")])});i[r.attr("id")]=n[e];TAG.Telemetry.register(r,"mousedown","",function(e){e.ttype="sort_by_"+i[$(r).attr("id")].toLowerCase();e.mode="Kiosk"})}b.append($(s));if(!Ht||!F){if(it&&n.indexOf("Date")>=0){F="Date";Ct="Date"}else if(n.indexOf("Title")>=0){F="Title";Ct="Title"}else{n[0]?F=n[0]:F=null;Ct=F}}En(F)}var n=[],r,i={};if(!st&&e.Metadata.SortOptions){var s=JSON.parse(e.Metadata.SortOptions||"{}");for(var o in s){if(s[o]===true){n.push(o)}}u()}else if(st){n=["Date","Title"];u()}else{n=["Date","Title","Artist"];u()}}function Qt(e,t,n){function r(r){ut=[];for(var i=0;i<r.length;i++){ut.push(r[i].Identifier)}if(!r.length){var s=$(document.createElement("div"));s.addClass("primaryFont");s.text("There are no artworks in this collection at present.");s.css({"text-align":"center","margin-top":"20%",color:bt});d.append(s)}if(n&&n())return;Kt(e,r);Zt(r,n);Gt(r);t&&t()}TAG.Worktop.Database.getArtworksIn(e.Identifier,r,null,r)}function Gt(e){var t,n,r;g[0].value="";Q=[];$.each(e,function(e,n){if(!n){return false}t=(n.Name?n.Name:"")+" "+(n.Metadata.Artist?n.Metadata.Artist:"")+" "+(n.Metadata.Year?n.Metadata.Year:"")+" "+(n.Metadata.Description?n.Metadata.Description:"")+" "+(n.Metadata.Type?n.Metadata.Type:"");if(n.Metadata.InfoFields){$.each(n.Metadata.InfoFields,function(e,n){t+=" "+e;t+=" "+n})}Q.push({id:e,keys:t.toLowerCase()})})}function Yt(){var e=g.val().toLowerCase(),t=[],n=[],r;if(!e){y.text("");en(K,F,0,false);return}for(r=0;r<Q.length;r++){if(Q[r].keys.indexOf(e)>-1){t.push(K[r])}else{n.push(K[r])}}en(t,F,0,true);en(n,F,t.length,false)}function Zt(e,t){K=e;F&&En(F);en(K,F,0,null,t)}function en(e,t,i,s){function o(){var o,u,a,f,l,c,h,p,v,m,g;if(!e||e.length===0){Ft.hide();if(st){E.css({color:wt});w.css({color:TAG.Util.UI.dimColor(wt,yt)})}else{E.css({color:TAG.Util.UI.dimColor(wt,yt)});w.css({color:wt})}E.removeAttr("disabled");w.removeAttr("disabled");return}if(t){o=gn(e,t);u=o.min();a=u?u.artwork:null;f=o.getContents()}else{f=e;a=e[0]}p=i;v=d.height()*.48;m=v*1.4;r.empty();nt=r.height();for(g=0;g<f.length;g++){if(t){R.add(sn(f[g].artwork,t,s,p+g,g===f.length-1))}else{R.add(sn(f[g],null,s,p+g,g===f.length-1))}}if(f.length==0){if(st){E.css({color:wt});w.css({color:TAG.Util.UI.dimColor(wt,yt)})}else{E.css({color:TAG.Util.UI.dimColor(wt,yt)});w.css({color:wt})}E.removeAttr("disabled");w.removeAttr("disabled")}R.add(function(){if(f.length>0){c=$(document.createElement("div")).css({height:"100%",width:dt,"pointer-events":"none",position:"absolute",margin:"none",left:r.children().eq(-1).position().left+r.children().eq(-1).width()});r.append(c)}});R.add(function(){Ft.hide()});if(IS_WINDOWS){R.add(function(){dn(j,I&&I)()})}r.css({left:n.width()});if(n.width()===0){r.css({"margin-left":"2%"})}else{r.css({"margin-left":"0%"})}d.append(r);tn(e)}if(!B){return}if(i===0){R.clear();o()}else{o()}}function tn(e){G=[];Y=[];Z=[];et={};T.empty();if(Tt){Tt.stop(true,true);j=null}if(Nt){Nt.stop(true,true)}if(it&&e){if(st){var t;setTimeout(function(){un(e)},1e3)}else{un(e)}}nn()}function nn(){if(it){p.css({height:"69%",top:"25%","z-index":""});x.css({height:"110%",bottom:"-5%"})}else{p.css({height:"79%",top:"15%","z-index":"100005"});x.css({height:"100%",bottom:"-4%"})}}function sn(e,t,n,s,o){return function(){function m(){return function(){if(e.Metadata.Type==="Artwork"||e.Metadata.ContentType==="tour"||e.Metadata.Type==="VideoArtwork"){if(ot===u){Nn(e,null,pn(e,false))()}else{ot=u;setTimeout(function(){ot=null},1e3)}}else{TAG.Worktop.Database.getArtworksAssocTo(e.Identifier,function(t){if(ot===u){Nn(t[0],e,pn(e,false))()}else{ot=u;setTimeout(function(){ot=null},1e3)}},function(){},function(){})}}()}var u=$(document.createElement("div")),a=$(document.createElement("div")),f=$(document.createElement("div")),l=$(document.createElement("img")),c=$(document.createElement("div")),h,p,d,v=true;V[e.Identifier]=u;u.addClass("tile");l.addClass("tileImage");a.addClass("artTitle");f.addClass("artText");f.addClass("secondaryFont");f.css({color:wt});c.addClass("yearTextBox");c.addClass("secondaryFont");c.css({color:wt});u.on("click",function(){m();if(!idleTimer&&!q){idleTimer=TAG.Util.IdleTimer.TwoStageTimer();idleTimer.start()}setTimeout(function(){dn(e,false)()},10);fn(X[e.Identifier]);Pt=true});TAG.Telemetry.register(u,"click","",function(t){var n;t.ttype="artwork_tile";t.custom_1=CryptoJS.SHA1(e.Name).toString(CryptoJS.enc.Base64);t.mode="Kiosk";Pt=false});if(e.Metadata.Thumbnail&&e.Metadata.ContentType!=="Audio"){u.css("overflow","hidden");l.attr("src",ft(e.Metadata.Thumbnail));var y,b;$("<img/>").attr("src",l.attr("src")).load(function(){y=this.width;b=this.height;var e=l.height();var t=l.width();if(t/e<y/b){e=l.height();var n=y/b*e;l.css({height:e,width:n})}else{t=l.width();var r=b/y*t;l.css({width:t,height:r})}})}else if(e.Metadata.ContentType==="Audio"){l.css("background-color","black");l.attr("src",tagPath+"images/audio_thumbnail.svg")}else if(e.Metadata.Medium==="Video"||e.Metadata.ContentType==="Video"||e.Metadata.ContentType==="iframe"){v=false;l.css("background-color","black");l.attr("src",tagPath+"images/video_thumbnail.svg")}else if(e.Metadata.ContentType==="Image"){if(e.Metadata.Thumbnail){l.attr("src",ft(e.Metadata.Thumbnail))}else if(e.Metadata.Source){l.attr("src",ft(e.Metadata.Source))}else{l.attr("src",tagPath+"images/image_icon.svg")}}else if(e.Type==="Empty"||e.Type==="Tour"||e.Metadata.Type==="Tour"||e.Metadata.ContentType==="Tour"){l.css("background-color","black");if(e.Metadata.Thumbnail){l.attr("src",ft(e.Metadata.Thumbnail))}else{l.attr("src",ft("/Images/default.jpg"))}}else{l.attr("src",tagPath+"images/no_thumbnail.svg")}if(t==="Title"){f.text(TAG.Util.htmlEntityDecode(e.Name))}else if(t==="Artist"){f.text(TAG.Util.htmlEntityDecode(e.Name));c.css("visibility","visible");h=e.Metadata.Artist;if(!h){c.text("").css("visibility","hidden")}else{c.text(h)}}else if(t==="Date"){c.css("visibility","visible");h=wn(bn(e,true));if(e.Type==="Empty"||!h){c.text("").css("visibility","hidden")}else{c.text(h)}var S=TAG.Util.htmlEntityDecode(e.Name);f.text(S)}else if(t==="Tours"){f.text(TAG.Util.htmlEntityDecode(e.Name))}else if(t){f.text(TAG.Util.htmlEntityDecode(e.Name));c.css("visibility","visible");h=e.Metadata.InfoFields[t];if(!h){c.text("").css("visibility","hidden")}else{c.text(h)}}else{f.text(TAG.Util.htmlEntityDecode(e.Name))}a.append(f);if(!n&&g.val()!==""){u.css({opacity:"0.2"});u.css("border","1px solid black")}else if(n){l.css({opacity:"1.0"});u.css("border","1px solid rgba(255, 255, 255, 0.5)")}u.append(l).append(a).append(c);if(e.Type==="Empty"&&e.Metadata.ContentType!=="iframe"&&e.Metadata.Type!=="VideoArtwork"){p=$(document.createElement("img")).addClass("tourLabel").attr("src",tagPath+"images/icons/catalog_tour_icon.svg");u.append(p)}else if(e.Metadata.Medium==="Video"||e.Metadata.ContentType==="Video"){if(v){d=$(document.createElement("img")).addClass("videoLabel").attr("src",tagPath+"images/icons/catalog_video_icon.svg");u.append(d)}}r.append(u);var x=.45*nt;u.css({height:.45*nt});u.css({width:x/vt*mt});u.css({left:Math.floor(s/2)*(u.width()+dt),top:Math.floor(s%2)*(u.height()+dt)});if(o){if(st){E.css({color:wt});w.css({color:TAG.Util.UI.dimColor(wt,yt)})}else{E.css({color:TAG.Util.UI.dimColor(wt,yt)});w.css({color:wt})}E.removeAttr("disabled");w.removeAttr("disabled");i.append($(rn))}if(rt){u.css({opacity:.5})}}}function on(e,n){if(q){ct=t.width()/40}if(n){e.css({height:ct*3/2,width:ct*3/2,"border-radius":ct*3/4,top:-ct*3/4,opacity:"1"});e.timelineDateLabel.css({visibility:"visible",color:"white","font-size":"110%",bottom:"100%",left:e.width()/2-e.timelineDateLabel.width()*1.1/2})}else{e.css({height:ct,width:ct,"border-radius":ct/2,top:-ct/2,opacity:.5});e.timelineDateLabel.css({color:"rgb(170,170,170)","font-size":"100%",bottom:"100%",left:ct/2-e.timelineDateLabel.width()/2})}}function un(e){function o(e,t){var n=$(document.createElement("div")),r,i=t-e,s=101,o;n.addClass("timeline");T.append(n);for(r=0;r<s;r++){o=$(document.createElement("div"));o.addClass("timelineTick");o.css({left:r/(s-1)*100-.05+"%"});o.Offset=r/s;n.append(o);Y.push(o)}return n}function u(e,t,n){function b(e){var t=.5,n=G[G.indexOf(e)+1],r=G[G.indexOf(e)-1],i=G[G.length-1],s=G[0],o=.05;d=1;v=t-e.Offset;if(w(i)-t<t){d=t/(i.Offset-e.Offset)}if(t-w(s)<t){d=t/(s.Offset-e.Offset)}if(Math.abs(d)===Infinity){d=1}if(n&&w(n)-t<o&&w(n)-t>0){d=o/(n.Offset-e.Offset)}if(r&&t-w(r)<o&&t-w(r)>0){d=o/(r.Offset-e.Offset)}return Math.abs(d)}function w(e){return(v+e.Offset-.5)*Math.abs(d)+.5}var r,i,s,o,u,a=$(document.createElement("div")),f,l,c,h,p,d=1,v;var m=document.createDocumentFragment();i=n-t;a.addClass("timelineCircleArea");T.append(a);r=e.min();s=r.artwork;while(r&&r.yearKey!==Number.POSITIVE_INFINITY){if(!isNaN(r.yearKey)){o=100*(r.yearKey-t)/i;var g=o-1.25;u=$(document.createElement("div"));m.appendChild(u[0]);u.addClass("timelineEventCircle").css("left",g+"%").on("click",function(e,t){return function(){if(rt===true&&j===e){cn(e)();rt=false}else{if(!V[e.Identifier]){return}fn(t);dn(e,true)();rt=true}}}(s,u));f=wn(bn(r.artwork,true));l=$(document.createElement("div")).text(f).addClass("timelineDateLabel");u.append(l);u.yearKey=r.yearKey;u.timelineDateLabel=l;u.Offset=o/100;u.artwork=s;G.push(u);X[r.artwork.Identifier]=u;an(u);if(!et[f]){et[f]=[r.artwork]}else{et[f].push(r.artwork)}}r=e.findNext(r);if(r){s=r.artwork}}a.append($(m));for(var y=0;y<G.length;y++){G[y].zoomLevel=b(G[y]);on(G[y],false);an(G[y]);if(y===G.length-1){an(G[y],null,y)}}return a}var t,n,r,i,s;if(!e||e.length===0){return}t=yn(e,true);n=t.max();if(t.min().yearKey===Number.POSITIVE_INFINITY){it=false;tn();if(!Ht){if($("#titleButton")){F="Title"}else{F=Ct||null}}Sn(e,F);En(F);return}while(n.yearKey===Number.POSITIVE_INFINITY){n=t.findPrevious(n)}r=parseInt(n.yearKey);i=parseInt(t.min().yearKey);xt=r;St=i;Tt=o(i,r);Nt=u(t,i,r);setTimeout(function(){j&&fn(X[j.Identifier])},100);}function an(e,t,n){var r,i,s=e.timelineDateLabel,o=G[G.indexOf(e)+1],u=G[G.indexOf(e)-1];if(e===G[0]){s.css("visibility","visible")}if(u){while(G[G.indexOf(u)-1]&&u.timelineDateLabel.css("visibility")!=="visible"){u=G[G.indexOf(u)-1]}i=ln(u.position().left,e.position().left,u.timelineDateLabel.width());if(u&&!i){s.css("visibility","visible")}else{s.css("visibility","hidden");if(n&&G.indexOf(e)===n){s.css("visibility","visible");u.timelineDateLabel.css("visibility","hidden")}}}if(t&&e.yearKey===t.yearKey){if(e===t){s.css("visibility","visible")}else{s.css("visibility","hidden")}return}}function fn(e){function c(e){var t=(u+e.Offset-o)*a+o;return t}var t,n,r,i,s,o=.5,u=e?o-e.Offset:0,a=e?e.zoomLevel:1,f,l;for(t=0;t<G.length;t++){l=G[t];f=c(l);l.stop();l.css({"transition-property":"left","transition-duration":"1s","transition-timing-function":"ease-in-out"});l.css({"-webkit-transition-property":"left","-webkit-transition-duration":"1s","-webkit-transition-timing-function":"ease-in-out"});l.css({left:parseInt(f*l.parent().width())-ct*15/20});if(t===G.length-1){l.on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){for(r=0;r<G.length;r++){an(G[r],e);if(r===G.length-1){an(G[r],null,r)}}});if(l.position().left===parseInt(f*l.parent().width())-ct*15/20){setTimeout(function(){for(r=0;r<G.length;r++){an(G[r],e);if(r===G.length-1){an(G[r],null,r)}}},1100)}}}for(n=0;n<Y.length;n++){i=Y[n];s=c(i);i.stop();i.css({"transition-property":"left","transition-duration":"1s","transition-timing-function":"ease-in-out"});i.css({"-webkit-transition-property":"left","-webkit-transition-duration":"1s","-webkit-transition-timing-function":"ease-in-out"});i.css({left:s*100+"%"})}}function ln(e,t,n){return Math.round(e)+n*1.4>t}function cn(e){return function(){var n;j=null;if(!e){return}x.animate({opacity:0},gt/5,function(){x.css("display","none")});t.find(".tile").css("opacity","1");if(X[e.Identifier]){on(X[e.Identifier],false)}fn();d.stop(true,false);rt=false}}function hn(e,t){var n,r,i;r=X[e.Identifier]&&et[X[e.Identifier].timelineDateLabel.text()];n=.38*$("#tagRoot").width();if(t&&r){i=Math.min($("#tagRoot").width()*.8,r.length*n)}else{i=n}return i||0}function pn(e,i){var s,o,u,a,f,l,c;s=t.width();o=n.width();if(Ht&&H){c=H}else{if(V[e.Identifier]){u=V[e.Identifier].width();a=V[e.Identifier].position().left}f=(hn(e,i)-u)/2;l=parseFloat(r.css("margin-left"))+a+o-d.scrollLeft();if(l<f){f=0}if(i&&X[e.Identifier]&&et[X[e.Identifier].timelineDateLabel.text()].length>=3){x.css("overflow-x","scroll");l=p.width()/10;f=0}if(Math.ceil(l+u+dt)>=s){f=f*2+dt}c=l-f}return c||0}function dn(e,r){return function(){function N(){d.stop(true,false);i=t.width();s=n.width();if(Ht&&P){l=P;c=gt/5}else{if(V[e.Identifier]){o=V[e.Identifier].width();E=V[e.Identifier].position().left}c=gt/3;l=E-i/2+s+o/2-dt}if(l<0){l=0}if(parseInt(l)===d.scrollLeft()){c=0}d.animate({scrollLeft:l},c,"easeInOutQuint",function(){C();x.css({width:hn(e,r),left:pn(e,r),display:"inline",opacity:1});if(r&&X[e.Identifier]&&et[X[e.Identifier].timelineDateLabel.text()].length>=3){x.css({"overflow-x":"scroll"})}if(x[0].addEventListener){x[0].addEventListener("mousewheel",function(e){e.stopPropagation()},false);x[0].addEventListener("DOMMouseScroll",function(e){e.stopPropagation()},false)}else{x[0].attachEvent("onmousewheel",function(e){e.stopPropagation()},false)}P=E;Ht=false})}function C(){u=.38*$("#tagRoot").width();x.empty();w=$(document.createElement("img"));w.attr("src",tagPath+"images/icons/x.svg");w.text("X");w.css({position:"absolute",top:"1.5%",width:"4%",height:"4%","min-height":"15px","min-width":"15px","background-color":"",left:"1.5%"});w.on("mousedown",function(){cn(j)()});b=X[e.Identifier]&&et[X[e.Identifier].timelineDateLabel.text()];if(r&&b){for(S=0;S<b.length;S++){h=k(b[S],S);h.css({left:S*u+"px",width:u});if(S===0){h.append(w)}}a=Math.min($("#tagRoot").width()*.8,b.length*u)}else{h=k(e,0);h.css("left","0%");h.append(w);a=u}}function k(e,n){function A(e){var t;if(e===0){N.hide();c.css({height:"92%"});TAG.Util.removeProgressCircle(y)}else{c.css({height:"33%"});i.text(st?"Artworks":"Associated Media");t=N.height()/10;if(e*(N.height()+t)-t>N.width()){f=$(document.createElement("img")).addClass("miniTilesArrow").attr("src",tagPath+"images/icons/Close.svg").on("mousedown",function(){N.stop();N.animate({scrollLeft:N.scrollLeft()-50},gt/2)});l=$(document.createElement("img")).addClass("miniTilesArrow").attr("src",tagPath+"images/icons/Open.svg").css("left","94%").on("mousedown",function(){N.stop();N.animate({scrollLeft:N.scrollLeft()+50},gt/2)});o.append(f);o.append(l)}}}function O(t){var n,r,i;M=t.length;var s=0;for(S=0;S<t.length;S++){if(st&&ut.indexOf(t[S].Identifier)==-1){continue}n="";r=t[S].Metadata;i=r.Thumbnail;!st&&(t[S].artwork=e);C=$(document.createElement("img")).addClass("miniTile").css({width:.35*.45*x.height()}).on("mousedown",st?Nn(t[S],e):Nn(e,t[S]));C.css("left",s*(C.width()+N.height()/10));switch(r.ContentType){case"Audio":n=tagPath+"images/audio_icon.svg";break;case"Video":n=i&&!i.match(/.mp4/)?ft(i):tagPath+"images/video_icon.svg";break;case"iframe":n=tagPath+"images/video_icon.svg";break;case"Image":if(i){n=ft(i)}else if(r.Source){n=ft(r.Source)}else{n=tagPath+"images/no_thumbnail.svg"}break;case"Text":n=tagPath+"images/text_icon.svg";default:if(i){n=ft(i)}else if(r.Source){n=ft(r.Source)}else{n=tagPath+"images/no_thumbnail.svg"}break}if(st&&r.Type==="Artwork"){if(i){n=ft(i)}else if(r.Source){n=ft(r.Source)}else{n=tagPath+"images/no_thumbnail.svg"}}C.attr("src",n);N.append(C);s++}A(M);TAG.Util.removeProgressCircle(y);if(st){h.on("mousedown",Nn(t[0],e,pn(e,false)));T.on("mousedown",Nn(t[0],e,pn(e,false)))}}var r,i,s,o,u,a,f,l,c,h,p,d,m,g,b,w,E,N,C;var k=document.createDocumentFragment();r=$(document.createElement("div")).addClass("previewTile");k.appendChild(r[0]);s=$(document.createElement("div")).addClass("tileTop");u=$(document.createElement("div")).addClass("titleSpan").text(TAG.Util.htmlEntityDecode(e.Name)).css({color:wt});a=$(document.createElement("div")).addClass("imgDiv");h=$(document.createElement("div")).addClass("exploreTab");if(!st){h.on("mousedown",Nn(e))}p=$(document.createElement("div")).addClass("exploreText").css("font-size",at*2/3+"em").text(st?"Select an Associated Artwork Below":"Tap to Explore");h.append(p);T=$(document.createElement("img")).addClass("currentThumbnail");if(e.Metadata.Thumbnail&&e.Metadata.ContentType!=="Audio"){T=$(document.createElement("div"));T.css({background:"url("+ft(e.Metadata.Thumbnail+") no-repeat center"),"background-size":"contain",height:"100%"})}else if(e.Metadata.ContentType==="Audio"){T.css("background-color","black");T.attr("src",tagPath+"images/audio_thumbnail.svg")}else if(e.Metadata.Medium==="Video"||e.Metadata.ContentType==="Video"||e.Metadata.ContentType==="iframe"){T.css("background-color","black");T.attr("src",tagPath+"images/video_thumbnail.svg")}else if(e.Metadata.ContentType==="Image"){if(e.Metadata.Thumbnail){T.attr("src",ft(e.Metadata.Thumbnail))}else if(e.Metadata.Source){T.attr("src",ft(e.Metadata.Source))}else{T.attr("src",tagPath+"images/image_icon.svg")}}else if(e.Type==="Empty"||e.Type==="Tour"||e.Metadata.Type==="Tour"||e.Metadata.ContentType==="Tour"){T.css("background-color","black");if(e.Metadata.Thumbnail){T.attr("src",ft(e.Metadata.Thumbnail))}else{T.attr("src",ft("/Images/default.jpg"))}}else{T.attr("src",tagPath+"images/no_thumbnail.svg")}!st&&T.on("mousedown",Nn(e));TAG.Telemetry.register($("#currentThumbnail,#exploreTab"),"mousedown","",function(t){if(!e||!U){return true}t.custom_1=CryptoJS.SHA1(e.Name).toString(CryptoJS.enc.Base64);t.ttype="collection_to_"+Wt(e);t.mode="Kiosk"});m=$(document.createElement("div")).addClass("infoText");g=$(document.createElement("div")).addClass("artistInfo").css({"font-size":11*at/30+"em",color:wt,"font-style":"italic"});w=$(document.createElement("div")).addClass("yearInfo").css({"font-size":11*at/30+"em",color:wt,"font-style":"italic"});if(e.Type!=="Empty"){e.Metadata.Artist?b=""+e.Metadata.Artist:b=" ";g.text(b);w.text(wn(bn(e,false))||" ")}else{g.text("(Interactive Tour)");w.text(" ")}o=$(document.createElement("div")).addClass("tileBottom");n===0?c=v:c=$(document.createElement("div"));c.addClass("descSpan");E=$(document.createElement("div")).addClass("descText secondaryFontColor").html(Autolinker.link(e.Metadata.Description?e.Metadata.Description.replace(/\n/g,"<br />"):"",{email:false,twitter:false})).css({color:wt,"font-size":"80%"});if(IS_WINDOWS){if(E){var L=E.find("a");L.each(function(e,t){$(t).replaceWith(function(){return $.text([this])})})}}m.append(g).append(w);a.append(T).append(h).append(m);s.append(a).append(u).append(m);c.append(E);o.append(c);i=$(document.createElement("div")).addClass("miniTilesLabel");N=$(document.createElement("div")).addClass("miniTilesHolder");o.append(N).append(i);r.append(s).append(o);x.append($(k));t.find(".tile").css("opacity","0.5");var M=0;var _=TAG.Util.createQueue();_.add(function(){st&&TAG.Worktop.Database.getArtworksAssocTo(e.Identifier,O,null,O);!st&&TAG.Worktop.Database.getAssocMediaTo(e.Identifier,O,null,O)});return r}var i,s,o,u,a,f,l,c,h,p,v=$(document.createElement("div")),m,g,y,b,w,E,S,T;if(!e){return}x.off();if(rt){x.animate({opacity:0},0,function(){N()})}else{N()}j=e;U=true;rt=true;I=r;t.on("mouseup",function(e){var t=x;if(e.target.id!=t.attr("id")&&!$(e.target).hasClass("tileImage")&&!$(e.target).hasClass("timelineEventCircle")&&!t.has(e.target).length){if(rt){cn(j)()}}});for(S=0;S<G.length;S++){on(G[S],false)}if(X[e.Identifier]){on(X[e.Identifier],true)}m={position:"absolute","float":"left",left:"35%","z-index":"50",height:"60%",width:"auto",top:"15%"};var L=$(".miniTilesHolder");y=TAG.Util.showProgressCircle(L,m,"0px","0px",false)}}function vn(e,t){return function(n,r){var i,s;if(n[e]<r[e]){return-1}else if(n[e]>r[e]){return 1}else{i=t?n[t]:n.artwork.Identifier;s=t?r[t]:r.artwork.Identifier;if(i<s){return-1}else if(i>s){return 1}else{return 0}}}}function mn(e){return function(t,n){if(!n){return null}else if(t<n[e]){return-1}else if(t>n[e]){return 1}else{return 0}}}function gn(e,t){var n,r,i,s,o;if(t==="Title"){var u;n=vn("nameKey");r=mn("nameKey");i=new AVLTree(n,r);i.clear();for(o=0;o<e.length;o++){if(e[o].Name){u=e[o].Name.toLowerCase()}else{u="~~~~"}s={artwork:e[o],nameKey:u};i.add(s)}return i}else if(t==="Artist"){var a;n=vn("artistKey");r=mn("artistKey");i=new AVLTree(n,r);for(o=0;o<e.length;o++){if(e[o].Metadata.Artist){a=e[o].Metadata.Artist.toLowerCase()}else{a="~~~~"}s={artwork:e[o],artistKey:e[o].Type==="Empty"?"~~~~":a};i.add(s)}return i}else if(t==="Date"){return yn(e,true)}else if(t==="Tours"){var f;n=vn("nameKey");r=mn("nameKey");i=new AVLTree(n,r);for(o=0;o<e.length;o++){if(e[o].Type==="Empty"){if(e[o].Name){f=e[o].Name.toLowerCase()}else{f=""}}else{f="~~~~~~"}s={artwork:e[o],nameKey:f};i.add(s)}return i}else if(t){var l;n=vn("sortKey");r=mn("sortKey");i=new AVLTree(n,r);i.clear();for(o=0;o<e.length;o++){if(e[o].Metadata.InfoFields&&e[o].Metadata.InfoFields[t]){l=e[o].Metadata.InfoFields[t].toLowerCase()}else{l=null}s={artwork:e[o],sortKey:l};if(s.sortKey){i.add(s)}}return i}return null}function yn(e,t){var n,r,i,s,o,u,a,f;n=vn("yearKey","nameKey");r=mn("yearKey");i=new AVLTree(n,r);for(f=0;f<e.length;f++){if(t){o=bn(e[f],true)}else{o=bn(e[f],false)}if(e[f].Name){a=e[f].Name.toLowerCase()}else{a="~~~~"}u=TAG.Util.parseDateToYear(o);if(!isNaN(u)){s={artwork:e[f],nameKey:a,yearKey:e[f].Type==="Empty"?Number.POSITIVE_INFINITY:u}}else{s={artwork:e[f],nameKey:a,yearKey:Number.POSITIVE_INFINITY}}i.add(s)}return i}function bn(e,t){var n;if(t&&(e.Metadata.TimelineYear||e.Metadata.TimelineYear==="")){n={year:e.Metadata.TimelineYear,month:e.Metadata.TimelineMonth,day:e.Metadata.TimelineDay}}else{n={year:e.Metadata.Year,month:e.Metadata.Month,day:e.Metadata.Day}}return n}function wn(e){var t,n=false,r,i,s,o,u;t=TAG.Util.parseDateToYear({year:e.year});if(t<0){t=-t;n=true}u=t;r={January:1,"February:":2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12};if(e.month){i=e.month;s=r[i];if(e.day){o=e.day;u=s+"/"+o+"/"+u}else{u=s+"/"+u}}if(n){u=u+" BCE"}return u}function En(e){var t=TAG.Util.UI.dimColor(wt,yt);$(".rowButton").css("color",t);if(e){$("#"+e.toLowerCase()+"Button").css("color",wt)}}function Sn(e,t){var n=[],r=[],i=[],s=[],o=[],u;j&&cn(j)();F=t;En(F);en(e,F,0,false);Yt()}function xn(e,n){var r,i,s,o,u,a;if(TAG.Util.Splitscreen.isOn()){confirmationBox=$(TAG.Util.UI.PopUpConfirmation(function(){TAG.Util.Splitscreen.exit(t.data("split")||"L");tourClicked(e)();TAG.Util.multiLineEllipsis($($($(confirmationBox).children()[0]).children()[0]))},"By opening this tour, you will exit splitscreen mode. Would you like to continue?","Continue",false,function(){confirmationBox.remove()},t));confirmationBox.css("z-index",10000001);t.append(confirmationBox);confirmationBox.show()}r=JSON.parse(unescape(e.Metadata.Content));if(!r||!r.data){o=$(TAG.Util.UI.popUpMessage(null,"Cannot play empty tour.",null));o.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+7);t.append(o);o.fadeIn(500);return}u={prevScroll:d.scrollLeft(),prevPreviewPos:n||x.position().left,backCollection:B,prevTag:F,backArtwork:e,prevMult:I};i=TAG.Layout.TourPlayer(r,B,u,null,e);TAG.Util.UI.slidePageLeftSplit(t,i.getRoot(),i.startPlayback);currentPage.name=TAG.Util.Constants.pages.TOUR_PLAYER;currentPage.obj=i}function Tn(e,n){var r,i;r={artworkPrev:null,prevScroll:d.scrollLeft(),prevPreviewPos:n||x.position().left,prevTag:F,prevMult:I};i=TAG.Layout.VideoPlayer(e,B,r);TAG.Util.UI.slidePageLeftSplit(t,i.getRoot());currentPage.name=TAG.Util.Constants.pages.VIDEO_PLAYER;currentPage.obj=i}function Nn(e,n,r){return function(){var i,s,o="L",u=Cn(),a,f;if(!e||!U){return}if(e.Type==="Empty"&&e.Metadata.Type!=="VideoArtwork"&&e.Metadata.ContentType!=="iframe"){if(TAG.Util.Splitscreen.isOn()){a=$(TAG.Util.UI.PopUpConfirmation(function(){TAG.Util.Splitscreen.exit(t.data("split")||"L");xn(e);TAG.Util.multiLineEllipsis($($($(a).children()[0]).children()[0]))},"By opening this tour, you will exit split screen mode. Would you like to continue?","Continue",false,function(){a.remove()},t));a.css("z-index",1000000001);t.append(a);a.show()}else{xn(e,r)}}else if(e.Metadata.Type==="VideoArtwork"){if(TAG.Util.Splitscreen.isOn()){a=$(TAG.Util.UI.PopUpConfirmation(function(){TAG.Util.Splitscreen.exit(t.data("split")||"L");Tn(e);TAG.Util.multiLineEllipsis($($($(a).children()[0]).children()[0]))},"By opening this video, you will exit split screen mode. Would you like to continue?","Continue",false,function(){a.remove()},t));a.css("z-index",100000001);t.append(a);a.show()}else{Tn(e,r)}}else{i=TAG.Layout.ArtworkViewer({doq:e,prevPreview:j,prevTag:F,prevScroll:d.scrollLeft(),prevPreviewPos:r||x.position().left,prevCollection:B,prevPage:"catalog",prevMult:I,assocMediaToShow:n,onAssocMediaView:st});s=i.getRoot();s.data("split",t.data("split")==="R"?"R":"L");TAG.Util.UI.slidePageLeftSplit(t,s);currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER;currentPage.obj=i}t.css({"overflow-x":"hidden"})}}function Cn(){return{exhibition:B,currentTag:F,currentImage:j}}function kn(){return t}e=e||{};var t=TAG.Util.getHtmlAjax("NewCatalog.html"),n=t.find("#infoDiv"),r=$(document.createElement("div")).attr("id","tileDiv"),i=t.find("#displayArea"),s=t.find("#collectionArea"),o=t.find("#backArrowArea"),u=t.find("#backArrow"),a=t.find("#nextArrowArea"),f=t.find("#nextArrow"),l=t.find("#collectionHeader"),c=t.find("#collectionDotHolder"),h=t.find("#bgimage"),p=t.find("#bottomContainer"),d=t.find("#catalogDiv"),v=t.find("#infoTilesContainer"),m=t.find("#sortRow"),g=t.find("#searchInput"),y=t.find("#searchTxt"),b=t.find("#buttonRow"),w=t.find("#artworksButton"),E=t.find("#assocMediaButton"),S=t.find("#toggleRow"),x=t.find("#selectedArtworkContainer"),T=t.find("#timelineArea"),N=t.find("#topBar"),C=t.find("#loadingArea"),k=t.find("#infoButton"),L=t.find("#tutorialButton"),A=t.find("#linkButton"),O=t.find("#overlay"),M=t.find("#tileLoadingArea"),_=$(document.createElement("div")).attr("id","nextCollection"),D=$(document.createElement("div")).attr("id","prevCollection"),P=e.backScroll||null,H=e.backPreviewPos||null,B=e.backCollection,j=e.backArtwork,F=e.backTag,I=e.backMult,q=e.previewing||false,R=TAG.Util.createQueue(),U=false,z=[],W={},X={},V={},J=true,K=[],Q=[],G=[],Y=[],Z=[],et={},tt=false,nt=0,rt=false,it=true,st=e.wasOnAssocMediaView||false,ot=null,ut=[],at=TAG.Worktop.Database.getBaseFontSize(),ft=TAG.Worktop.Database.fixPath,lt=(new Date).getFullYear(),ct=Math.min(30,Math.max(20,$("#tagRoot").width()/50)),ht=Math.max(7,$("#tagRoot").width()/120),pt=9,dt=$("#tagRoot").width()/100,vt=200,mt=255,gt=800,yt=1.7,bt=e.primaryFontColor?e.primaryFontColor:TAG.Worktop.Database.getMuseumPrimaryFontColor(),wt=e.secondaryFontColor?e.secondaryFontColor:TAG.Worktop.Database.getMuseumSecondaryFontColor(),Et=TAG.Worktop.Database.getMuseumFontFamily(),St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,C,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft;if(wt[0]!=="#"){wt="#"+wt}if(bt[0]!=="#"){bt="#"+bt}t[0].collectionsPage=this;t.data("split",e.splitscreen);e.backCollection?Ht=true:Ht=false;var It=null;qt();this.loadCollection=$t;var rn=document.createDocumentFragment();rn.appendChild(r[0]);this.showArtwork=dn;return{getRoot:kn,loadCollection:$t,loadFirstCollection:Jt,showArtwork:dn,getState:Cn}};TAG.Layout.CollectionsPage.default_options={};TAG.Util.makeNamespace("TAG.Layout.InternetFailurePage");TAG.Util.makeNamespace("TAG.Layout.InternetFailure");TAG.Layout.InternetFailure.lastOverlay={};TAG.Layout.InternetFailurePage=function(e,t){"use strict";function l(){function m(e){if(e==o)return"The server is currently unavailable. Please contact the museum administrator for further information.";else if(e==u)return"No internet connection was detected. The TAG application requires internet connectivity. Please ensure that you are connected to the internet and try again.";else if(e===a)return"Internet connection lost. The TAG application requires internet connectivity. Please ensure that you are connected to the internet and try again.";else if(e===f)return"The server you are trying to connect to is not compatible with this version of the Touch Art Gallery client";else if(e===s)return'We have detected that you are on a limited data connection. TAG downloads large images, audio, and videos that can significantly increase your data usage.  By clicking "I Agree" you agree to allow TAG to download images, audio, and videos.  Clicking "I Disagree" will exit TAG.';return""}n=TAG.Util.getHtmlAjax("InternetFailurePage.html");n.css("width",$("#tagRoot").width());n.css("height",$("#tagRoot").height());r=n.find("#mainPanel");r.css("width",$("#tagRoot").width());r.css("height",$("#tagRoot").height());var i=n.find("#sadFace");var l=n.find("#noticeBox");var c=n.find("#noticeLabel");var h=m(e);c.text(h);l.append(c).append("<br>");var p=n.find("#reconnectButton");var d=n.find("#changeServerButton");d.text("Change Server");d.on("click",TAG.Util.UI.ChangeServerDialog);if(e===s){p.text("I Agree");var v=$(document.createElement("button"));v.text("I Disagree");v.css({"font-size":"150%",position:"relative",left:"45%",top:"5%"});l.append(v);v.click(function(){window.close()});p.click(function(){localStorage.acceptDataUsage="true";if(!t){TAG.Layout.StartPage(null,function(e){TAG.Util.Splitscreen.setOn(false);TAG.Util.UI.slidePageRight(e)},true)}else{n.remove()}})}else if(e===o){p.text("Reconnect")}else if(e===f){p.hide()}else{p.text("Reconnect")}if(e!==s){p.click(function(){var r,s;c.text("Reconnecting...");p.hide();i.hide();setTimeout(function(){$.ajax({url:"http://"+localStorage.ip+":8080",dataType:"text",async:false,cache:false,success:function(){if(!s){clearTimeout(r);if(!t){TAG.Layout.StartPage(null,function(e){TAG.Util.Splitscreen.setOn(false);TAG.Util.UI.slidePageRight(e)},true)}else{n.remove()}}},error:function(t){if(!s){clearTimeout(r);$.ajax({url:"http://google.com",dataType:"text",async:true,cache:false,success:function(){if(!s){clearTimeout(r);c.text(m("Server Down"));p.show()}},error:function(t){if(!s){clearTimeout(r);c.text(m(e==="Internet Lost"?"Internet Lost":"No Internet"));p.show()}}})}}})},100);r=setTimeout(function(){s=true;c.text(m("Server Down"));p.show()},10100)})}var g=$(document.createElement("button"));g.text("Exit");g.click(function(){});l.append(d);l.append(p);r.append(i);r.append(l);n.append(r);TAG.Layout.InternetFailure.lastOverlay.root=n;TAG.Layout.InternetFailure.lastOverlay.type=e}this.getRoot=function(){return n};var n,r,i=false,s="Data Limit",o="Server Down",u="No Internet",a="Internet Lost",f="Old Server";l()};TAG.Util.makeNamespace("TAG.Layout.MetroSplitscreenMessage");TAG.Layout.MetroSplitscreenMessage=function(){"use strict";this.getRoot=function(){return e};var e=$(document.createElement("div"));e.css({position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%","background-color":"rgb(50,75,107)",color:"white","z-index":"1000000000"});var t=$(document.createElement("label"));t.css({"font-size":"380%",position:"relative",display:"block","text-align":"center",top:"25%"});t.text("TAG");var n=$(document.createElement("label"));n.css({"font-size":"120%",position:"relative",top:"45%",display:"block","text-align":"center"});n.text("TAG must be run in full screen mode");e.append(t).append("<br>").append(n)};TAG.Util.makeNamespace("TAG.Layout.TourPlayer");TAG.Layout.TourPlayer=function(e,t,n,r,i){"use strict";function L(){x.remove();$(".rin_PlayPauseContainer").find("input").trigger("click");if(!pageToLoad.onlytour){y.css("display","block");w.css("display","block")}}function A(){var e,n;if(v){v.pause();v.screenplayEnded.unsubscribe();v.unload()}if(!v||g.children().length===0){return}b.off("click");if(r){e=new TAG.Layout.ArtworkViewer(r);TAG.Util.UI.slidePageRightSplit(m,e.getRoot());currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER;currentPage.obj=e}else{var a={backArtwork:i,backScroll:o};n=new TAG.Layout.CollectionsPage({backScroll:o,backArtwork:i,backCollection:t,backTag:f,backMult:l,backPreviewPos:u});TAG.Util.UI.slidePageRightSplit(m,n.getRoot(),function(){s="catalog";if(!IS_WINDOWS){if(n.getState().exhibition===t){n.showArtwork(i,l&&l)()}}});currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE;currentPage.obj=n}}var s;var o=n.prevScroll;var u=n.prevPreviewPos;var a=t;var f=n.prevTag;var l=n.prevMult;var c;var h=IS_WINDOWS?tagPath+"js/WIN8_RIN/web":tagPath+"js/RIN/web";var p=pageToLoad&&pageToLoad.pagename==="tour";var d=$("#tagRoot");var v,m=TAG.Util.getHtmlAjax("TourPlayer.html"),g=m.find("#rinPlayer"),y=m.find("#backButtonContainer"),b=m.find("#backButton"),w=m.find("#linkContainer"),E=m.find("#linkButton"),S=m.find("#overlayOnRoot"),x=m.find("#bigThumbnailContainer"),T=m.find("#bigThumbnail"),N=m.find("#bigPlayButton"),C=$("#tagRoot").width(),k=$("#tagRoot").height();if(k*16/9<C){m.css({width:k*16/9+"px",left:(C-k*16/9)/2+"px"})}else if(C*9/16<k){m.css({height:C*9/16+"px",top:(k-C*9/16)/2+"px"})}idleTimer&&idleTimer.kill();idleTimer=null;b.attr("src",tagPath+"images/Back_wshadow.svg");b.on("mousedown",function(){TAG.Util.UI.cgBackColor("backButton",b,false)});b.on("mouseleave",function(){TAG.Util.UI.cgBackColor("backButton",b,true)});b.on("click",A);if(IS_WEBAPP){E.attr("src",tagPath+"images/link.svg");E.on("click",function(){var e=TAG.Util.UI.showPageLink(urlToParse,{tagpagename:"tour",tagguid:i.Identifier,prevpage:a.Identifier,tagonlytour:false});m.append(e);e.fadeIn(500,function(){e.find(".linkDialogInput").select()})})}else{w.remove()}if(p){pageToLoad.pagename="";if(pageToLoad.onlytour){y.remove();w.remove()}else{y.css("display","none");w.css("display","none")}if(i&&i.Metadata&&i.Metadata.Thumbnail){T.attr("src",TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail));N.attr("src",tagPath+"images/icons/Play.svg");x.css("display","block");N.on("click",L);T.on("click",L)}}return{getRoot:function(){return m},startPlayback:function(){rin.processAll(null,h).then(function(){var t="systemRootUrl="+h+"/&autoplay="+(p?"false":"true")+"&loop=false";v=rin.createPlayerControl(g[0],t);for(var n in e.resources){if(e.resources.hasOwnProperty(n)){if(typeof e.resources[n].uriReference==="string"){e.resources[n].uriReference=TAG.Worktop.Database.fixPath(e.resources[n].uriReference)}}}v.loadData(e,function(){});if(!p){v.screenplayEnded.subscribe(function(){setTimeout(A,1e3)})}})}}};TAG.Util.makeNamespace("TAG.Layout.VideoPlayer");TAG.Layout.VideoPlayer=function(e,t,n){"use strict";function D(){v.pause();c.attr("src","");var n={backArtwork:e,backScroll:i};var a=TAG.Layout.CollectionsPage({backScroll:i,backArtwork:e,backCollection:t,backTag:s,backMult:o,backPreviewPos:u});TAG.Util.UI.slidePageRightSplit(l,a.getRoot(),function(){r="catalog";if(!IS_WINDOWS){if(a.getState().exhibition===t){a.showArtwork(e,o&&o)()}}});currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE;currentPage.obj=a}function E(){}function P(){if(v.currentTime!==0){v.currentTime=0;v.pause()}b.attr("src",tagPath+"js/rin/web/systemResources/themeresources/images/play.png")}function H(){v.play();y.css("display","none");b.attr("src",tagPath+"js/rin/web/systemResources/themeresources/images/pause.png")}function B(){v.pause();y.css("display","inline");b.attr("src",tagPath+"js/rin/web/systemResources/themeresources/images/play.png")}function j(){v.paused?H():B()}function F(){c.on("loadedmetadata",I);b.attr("src",tagPath+"js/rin/web/systemResources/themeresources/images/play.png");b.on("click",j);w.attr("src",tagPath+"js/rin/web/systemResources/themeresources/images/volume.png");$(w).on("click",function(){v.muted=!v.muted;w.css("opacity",v.muted?".5":"1")});c.on("ended",function(){setTimeout(D,300)});E.on("click",function(){});c.on("timeupdate",function(){var e,t,n,r;e=$("#sliderContainer").width()/v.duration*v.currentTime;S.css("width",e);t=Math.floor(v.currentTime/60);n=Math.floor(v.currentTime%60);if(String(t).length<2){r="0"+t}else{r=t}A.text(r+":"+(n<10?"0":"")+n)});if(!IS_WEBAPP){g.css({height:"7%","background-color":"rgba(0, 0, 0, .5)"});S.css("background-color","white");x.css({border:"1px solid rgb(250,250,250)",width:"70%",left:"15%",height:"20%",bottom:"40%"})}}function I(){x.on("mousedown",function(e){var t=v.duration*(e.offsetX/$("#sliderContainer").width());if(!isNaN(t)){v.currentTime=t}});x.on("mousedown",function(e){e.stopPropagation();var t=e.pageX,n=v.currentTime,r=m/x.width(),i,s,o;T=Math.max(0,Math.min(m,n));i=T/r;s=Math.floor(T/60);o=Math.floor(T%60);if((""+s).length<2){s="0"+s}$("body").on("mousemove.seek",function(e){var u=e.pageX,a=(u-t)*r;T=Math.max(0,Math.min(m,n+a));i=T/r;s=Math.floor(T/60);o=Math.floor(T%60);if((""+s).length<2){s="0"+s}if(!isNaN(T)){$("#currentTimeDisplay").text(s+":"+(o<10?"0":"")+o);v.currentTime=T;S.css("width",i)}});$("body").on("mouseup.seek mouseleave.seek",function(){$("body").off("mousemove.seek");$("body").off("mouseup.seek");$("body").off("mouseleave.seek");$("#currentTimeDisplay").text(s+":"+(o<10?"0":"")+o);v.currentTime=T;S.css("width",i)})})}function q(){idleTimer&&idleTimer.kill();idleTimer=null;c.attr({poster:N,controls:false,preload:"metadata"});h=L+".mp4";p=L+".webm";d=L+".ogg";v.innerHTML='<source src="'+h+'" type='+"'"+'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'+"'"+">";v.innerHTML+='<source src="'+p+'" type='+"'"+'video/webm; codecs="vorbis, vp8"'+"'"+">";v.innerHTML+='<source src="'+d+'" type='+"'"+'video/ogg; codecs="theora, vorbis"'+"'"+">";A.text("00:00");if(k!==e.Identifier){O.attr("src",tagPath+"images/icons/Back.svg")}else{O.hide()}O.on("mousedown",function(){TAG.Util.UI.cgBackColor("backButton",O,false)});O.on("mouseleave",function(){TAG.Util.UI.cgBackColor("backButton",O,true)});O.on("click",D);g.css({});if(IS_WEBAPP){M.attr("src",tagPath+"images/link.svg");M.on("click",function(){var t=TAG.Util.UI.showPageLink(urlToParse,{tagpagename:"video",tagguid:e.Identifier,prevpage:a.Identifier});l.append(t);t.fadeIn(500,function(){t.find(".linkDialogInput").select()})})}else{_.remove()}}function R(){return l}var r,i=0,s,o,u,a=t;if(n){r=n.artworkPrev,i=n.prevScroll||0,o=n.prevMult,s=n.prevTag,u=n.prevPreviewPos}var f={};var l=TAG.Util.getHtmlAjax("VideoPlayer.html"),c=l.find("#video"),h,p,d,v=c[0],m=parseFloat(e.Metadata.Duration),g=l.find("#bottomBar"),y=l.find("#topBar"),b=l.find("#playPauseButton"),w=l.find("#videoControlsButton"),E=l.find("#loopButton"),S=l.find("#sliderPoint"),x=l.find("#sliderContainer"),T,N=e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):"",C=TAG.Worktop.Database.fixPath(e.Metadata.Source),k=TAG.Worktop.Database.getLocked(),L=C.substring(0,C.lastIndexOf(".")),A=l.find("#currentTimeDisplay"),O=l.find("#backButton"),M=l.find("#linkButton"),_=l.find("#linkContainer");q();P();F();f.getRoot=R;return f};TAG.Util.makeNamespace("TAG.Layout.ArtworkEditor");TAG.Layout.ArtworkEditor=function(e){"use strict";function N(){t.css({"background-color":"rgb(219,217,204)",color:"black",width:"100%",height:"100%"});r.css({width:"100%",height:100-c+"%"}).addClass("mainPanel");if(e){m=new TAG.AnnotatedImage({root:t,doq:e,callback:function(){if(!m.openArtwork(e)){var n=TAG.Util.UI.popUpMessage(function(){TAG.Authoring.SettingsView("Artworks",function(e){TAG.Util.UI.slidePageRight(e.getRoot())},null,e.Identifier)},"There was an error loading the image.","Go Back",true);t.append(n);$(n).show()}C()},noMedia:true})}else{C()}}function C(){k();t.append(r);_();h.init();d.init();p.init();v.init()}function k(){var r=$(document.createElement("img")),s=$(document.createElement("div")),o=TAG.Util.constrainAndPosition($(window).width(),$(window).height()*.08,{width:.4,height:.9}),u,a;n.css({"background-color":"rgb(63,55,53)",color:"rgb(175,200,178)",width:"100%",height:c+"%",position:"relative","z-index":1}).addClass("topbar");r.attr("src",tagPath+"images/icons/Back.svg");r.css({height:"63%","margin-left":"1.2%","float":"left",width:"auto",top:"18.5%",position:"relative"});n.append(r);r.on("mousedown",function(){TAG.Util.UI.cgBackColor("backButton",r,false)});r.on("click",function(){TAG.Util.removeYoutubeVideo();var t;var n=$(TAG.Util.UI.blockInteractionOverlay(.6));$("#tagRoot").append(n);var i=$("#tagRoot").height()/2;var s=$("#tagRoot").width()/2;var o={position:"absolute","z-index":"50",height:"auto",width:$("#tagRoot").width()*.1+"px"};var u=TAG.Util.showProgressCircle(n,o,s,i,true);n.show();v.close();r.off("click");if(I){q()}else{var t=new LADS.Authoring.SettingsView("Artworks",null,null,e.Identifier);TAG.Util.UI.slidePageRight(t.getRoot())}});s.css({"margin-right":"2%","margin-top":8*.045+"%",color:"white",position:"absolute","text-align":"right",right:"0px",top:"0px",height:o.height+"px",width:o.width+"px"});a=TAG.Util.getMaxFontSizeEM("Artwork Editor",.5,o.width,o.height*.8);s.css({"font-size":a});s.text("Artwork Editor");u=TAG.Util.constrainAndPosition($(window).width(),$(window).height()*.08,{center_v:true,width:.55,height:.5,x_offset:.05,x_max_offset:60});i.text(e.Name);i.css({"margin-left":"3.25%",position:"absolute",color:"white","font-size":a,"margin-top":8*.045+"%",left:u.x+"px",width:u.width+"px",height:o.height+"px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"});i.attr("id","titleArea");n.append(i);n.append(s);t.append(n);TAG.Telemetry.register(t.find(".artworkInfoLabel"),"click","artworkeditor_info",function(e){e.mode="artwork editor"});TAG.Telemetry.register(t.find(".addRemoveMedia"),"click","artworkeditor_media_addremove",function(e){e.mode="artwork editor"});TAG.Telemetry.register(t.find("#locationHistoryAddLocationButton"),"click","artworkeditor_addlocation",function(e){e.mode="artwork editor"});TAG.Telemetry.register(t.find("#locationHistorySortLocationsByTitleButton"),"click","artworkeditor_sort_title",function(e){e.mode="artwork editor"});TAG.Telemetry.register(t.find("#locationHistorySortLocationsByDateButton"),"click","artworkeditor_sort_date",function(e){e.mode="artwork editor"});TAG.Telemetry.register(t.find("#locationHistoryDeleteButton"),"click","artworkeditor_sort_title",function(e){e.mode="artwork editor"});TAG.Telemetry.register(t.find("#locationHistoryImportMapButton"),"click","artworkeditor_sort_title",function(e){e.mode="artwork editor"})}function L(e){m.loadAssociatedMedia(function(t){var n=$("#"+e);t=m.getAssociatedMedia();for(var r=0;r<t.guids.length;r++){var i=t[t.guids[r]].doq;if(i.Identifier==e){l.add(A(n,i));n.on("click",M(t[t.guids[r]]))}}})}function A(e,t){return function(){var n=e;var r=n.find(".thumbnailButtonTitle");r.text(LADS.Util.htmlEntityDecode(t.Name))}}function O(e){TAG.Util.showLoading(e||$(".assetContainer"),"20%","40%","40%");m.loadAssociatedMedia(function(t){e=e||$(".assetContainer");e.empty();t=m.getAssociatedMedia();var n,r;t.guids.sort(function(e,n){return t[e].doq.Name<t[n].doq.Name?-1:1});for(n=0;n<t.guids.length;n++){var i=t[t.guids[n]].doq;switch(i.Metadata.ContentType){case"Audio":r=tagPath+"images/audio_icon.svg";break;case"Video":r=i.Metadata.Thumbnail&&!i.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail):tagPath+"images/video_icon.svg";break;case"Image":if(i.Metadata.Thumbnail){r=TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail)}else if(i.Metadata.Source){r=TAG.Worktop.Database.fixPath(i.Metadata.Source)}else{r=tagPath+"images/image_icon.svg"}break;case"iframe":r=tagPath+"images/video_icon.svg";break;default:r=tagPath+"images/text_icon.svg";break}l.add(function(n){var s=TAG.Util.Artwork.createThumbnailButton({title:i.Name,handler:M(t[t.guids[n]]),buttonClass:"assetHolder",src:r});s.attr("id",i.Identifier);e.append(s)}(n))}TAG.Util.hideLoading(e)})}function M(e){return function(t){if(!($(document.getElementById(e.doq.Identifier)).css("background-color")==="rgba(255, 255, 255, 0.4)")){H();v.open(e,v.createMediaWrapper(e),function(){$(".addbutton").prop("disabled",true);$(".addbutton").css("opacity","0.4");$(".assetHolder").css("background-color","");$(document.getElementById(e.doq.Identifier)).css({"background-color":"rgba(255, 255, 255, 0.4)"})})}else{}}}function _(){function M(){TAG.Util.UI.createAssociationPicker(t,"Choose the media you wish to associate with this artwork",{comp:e,type:"artwork"},"artwork",[{name:"all media",getObjs:TAG.Worktop.Database.getAssocMedia},{name:"currently associated",getObjs:TAG.Worktop.Database.getAssocMediaTo,args:[e.Identifier]}],{getObjs:TAG.Worktop.Database.getAssocMediaTo,args:[e.Identifier]},function(){$(".assetContainer").empty();O($(".assetContainer"))})}var n,i,s,o,u,a,f,l,c,v,m,g,N,C,k,L,A=true;u={"margin-top":"2%","margin-bottom":"3%",width:"81%",position:"relative"};a={"margin-top":"1%","margin-bottom":"1.5%",width:"100%",height:t.height()*.06,color:"white",position:"relative"};f=TAG.Util.getMaxFontSizeEM("Edit Maps",1,t.width()*.11,.5*t.height()*.07);l=TAG.Util.getMaxFontSizeEM("Artwork Properties",1,t.width()*.15,t.height()*.07);i=$(document.createElement("div"));i.addClass("sidebar");i.css({width:"20%",height:"100%",position:"relative",left:"0%","float":"left","background-color":"rgba(0,0,0,0.85)","z-index":100});s=$(document.createElement("div"));s.attr("class","buttonContainer");s.css({position:"relative","margin-top":"4%","text-align":"center"});i.append(s);o=$(document.createElement("div"));o.addClass("artworkInfoLabel");o.text("Artwork Properties");o.css({color:"white","font-size":l,"margin-top":"2%","margin-bottom":"3%","font-weight":"bold",height:a.height*.6});s.append(o);b=$(document.createElement("img"));b.attr("src",tagPath+"images/icons/Right.png");b.css({position:"absolute",right:"5%",top:"30%",width:"auto",height:"40%"});y=$(document.createElement("div")).css(a);y.append(b);c=$(document.createElement("label"));c.text("Metadata  ");c.css({width:"100%",height:"100%","text-align":"center","line-height":y.height()+"px","font-size":f});y.append(c);s.append(y);x=$(document.createElement("img"));x.attr("src",tagPath+"images/icons/Right.png");x.css({position:"absolute",right:"5%",top:"30%",width:"auto",height:"40%"});v=$(document.createElement("label"));v.text("Edit Maps  ");v.css({width:"100%",height:"100%","line-height":"100%","text-align":"center"});S=$(document.createElement("div"));S.css(a);s.append(S);S.append(x);S.append(v);v.css({"line-height":S.height()+"px","font-size":f});m=$(document.createElement("label"));m.text("Capture Thumbnail  ");m.css({width:"100%",height:"100%","line-height":"100%","text-align":"center"});E=$(document.createElement("img"));E.attr("src",tagPath+"images/icons/Right.png");E.css({position:"absolute",right:"5%",top:"30%",width:"auto",height:"40%"});w=$(document.createElement("div"));w.addClass("editThumbnailButton");w.attr("type","button");w.css(a);s.append(w);w.append(E);w.append(m);m.css({"line-height":S.height()+"px","font-size":f});y.on("click",function(){h.toggle()});S.on("click",function(){d.toggle()});w.on("click",function(){p.toggle()});g=$(document.createElement("div"));g.addClass("assocMediaLabel");g.text("Associated Media");g.css({color:"white","font-size":l,"margin-top":"6%","margin-bottom":"2%","font-weight":"bold"});s.append(g);N=$(document.createElement("button"));N.addClass("addRemoveMedia");N.text("Add/Remove").css("border-radius","3.5px");N.attr("type","button");N.css(u);N.css({"font-size":TAG.Util.getMaxFontSizeEM("Add/Remove Media",.5,t.width()*.1,.5*a.height)});s.append(N);N.on("click",M);N.on("mousedown",function(){N.css({"background-color":"white",color:"black"})});N.on("mouseleave",function(){N.css({"background-color":"transparent",color:"white"})});C=$(document.createElement("div"));C.attr("class","buttonContainer");C.css({position:"relative",top:"0%,","margin-top":"2%",padding:"0px 8% 0px 4%",width:"82%",left:"5%","overflow-x":"hidden","overflow-y":"auto","text-overflow":"ellipsis","word-wrap":"break-word",height:"54%"});C.addClass("assetContainer");i.append(C);O(C);T=$(document.createElement("div"));T.addClass("sidebarHideButtonContainer");T.css({top:"0%",right:"0%",position:"relative",width:"2%",height:"100%","float":"left","z-index":1e3});k=$(document.createElement("div"));k.css({top:"45%",right:"0%",position:"relative",width:"100%",height:"10%","background-color":"rgba(0,0,0,.85)","border-bottom-right-radius":"10px","border-top-right-radius":"10px"});L=$(document.createElement("img"));L.css({top:"30%",width:"40%",height:"auto",position:"relative",left:"20%"});L.attr("src",tagPath+"images/icons/Left.png");k.append(L);T.append(k);T.on("click",function(){var e=A?"-20%":"0%";L.attr("src",A?tagPath+"images/icons/Right.png":tagPath+"images/icons/Left.png");i.animate({left:e},600);T.animate({left:e},600);A=!A});r.append(i);r.append(T)}function D(e,t){t&&t.force&&t.force()}function P(){return t}function H(){p.close();d.close();h.close()}function B(){function f(){var e,i,f,l,c,h,d,v,m;s=$(".mainPanel").height(),o=$(".mainPanel").width(),u=1.564,n=$(document.createElement("div"));n.addClass("tnBorderWrapper");n.css({position:"relative",top:"0px",left:"0px",height:"100%",width:"100%",display:"none"});e=$(document.createElement("div"));e.addClass("tnBorderCenter");e.css({position:"absolute",top:"15%",left:"25%",height:50+"%",width:50*s*u/o+"%","background-color":"transparent",border:"2px solid white","z-index":60});i=$(document.createElement("div"));i.addClass("tbBorderLeft");i.css({position:"absolute",top:"0%",left:0,height:"100%",width:"25%","background-color":"rgba(0,0,0,.6)","z-index":50});f=$(document.createElement("div"));f.addClass("tnBorderTop");f.css({position:"absolute",top:"0%",left:"25%",height:"15%",width:$(e).width()+"%","background-color":"rgba(0,0,0,.6)","z-index":50});l=$(document.createElement("div"));l.addClass("tnBorderBottom");l.css({position:"absolute",top:15+$(e).height()+"%",left:"25%",height:100-$(e).height()-$(f).height()+"%",width:$(e).width()+"%","background-color":"rgba(0,0,0,.6)","z-index":55});c=$(document.createElement("div"));c.addClass("tnBorderRight");c.css({position:"absolute",top:"0%",left:25+$(e).width()+"%",height:"100%",width:100-25-$(e).width()+"%","background-color":"rgba(0,0,0,.6)","z-index":50});h=$(document.createElement("div"));h.addClass("tnHelp");h.css({position:"relative",top:"5%",left:"0%",width:"100%",padding:"1%","text-align":"center","font-size":"120%",color:"white"});h.text("Move and resize the artwork within the thumbnail window, and select “Save Thumbnail” when you’re happy with the composition.");d=parseInt($(h).css("padding"),10)/100*($(l).innerWidth()/100)*t.width();v=parseInt($(h).css("border"),10);m=$(l).innerWidth()/100*t.width();h.width(m-2*v-2*d);a=$(document.createElement("button"));a.text("Save Thumbnail").css("border-radius","3.5px");a.css({position:"relative",top:"8%","float":"right"});a.on("click",p);l.append(h);l.append(a);n.append(f);n.append(i);n.append(e);n.append(l);n.append(c);r.append(n)}function l(){i?h():c()}function c(){if(!i){H();n.fadeIn();w.css({"background-color":"white",color:"black"});E.attr("src",tagPath+"images/icons/RightB.png");i=true}}function h(){if(i){n.fadeOut();w.css({"background-color":"transparent",color:"white"});E.attr("src",tagPath+"images/icons/Right.png");i=false}}function p(){function m(){TAG.Util.removeProgressCircle(n);a[0].removeAttribute("disabled");h()}function g(){TAG.Util.removeProgressCircle(n);var e=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  You must log in to save changes.");$("body").append(e);$(e).show();a[0].removeAttribute("disabled")}function y(){TAG.Util.removeProgressCircle(n);var e=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  There was an error contacting the server.");$("body").append(e);$(e).show();a[0].removeAttribute("disabled")}var t={position:"absolute",top:"110%",left:"100%","z-index":"50",height:"auto",width:"40px"};var n=TAG.Util.showProgressCircle($(".tnHelp"),t,"0px","0px",false);var r=$("canvas"),i=r[0].getContext("2d"),s=$(".tnBorderCenter"),o=s.offset().left,u=s.offset().top,f=s.outerWidth(),l=s.outerHeight(),c=i.getImageData(o,u,f,l),p=document.createElement("canvas"),d,v;a.attr("disabled","true");p.width=c.width;p.height=c.height;d=p.getContext("2d");d.putImageData(c,0,0);v=p.toDataURL();TAG.Worktop.Database.uploadImage(v,function(t){TAG.Worktop.Database.changeArtwork(e.Identifier,{Thumbnail:t},m,g,D)},g,y)}var n,i=false,s,o,u,a;return{init:f,toggle:l,close:h,open:c,save:p}}function j(){function s(){r=TAG.Util.RLH({artwork:e,root:t,authoring:true});i=r.init()}function o(){if(!n){H();v.close();S.css({"background-color":"white",color:"black"}).css("border-radius","3.5px");x.attr("src",tagPath+"images/icons/RightB.png");T.hide();i.show("slide",{direction:"left"},500);i.css({display:"inline"});n=true}}function u(){if(n){S.css({"background-color":"transparent",color:"white"}).css("border-radius","3.5px");x.attr("src",tagPath+"images/icons/Right.png");i.hide("slide",{direction:"left"},500,function(){if(!h.isOpen()){T.show()}});n=false}}function a(){n?u():o()}function f(){return n}var n=false,r,i;return{init:s,open:o,close:u,toggle:a,isOpen:f}}function F(){function y(){var e=$(document.createElement("div")),n=$(document.createElement("div")),r=$(document.createElement("div")),i=$(document.createElement("div"));s=$(document.createElement("div")).css({position:"absolute",display:"none"}).addClass("hotspotedit");e.css({position:"absolute",display:"block",width:"40px",height:"40px",border:"solid rgba(255,255,255,1) 5px","border-radius":"50%",top:"-50px",left:"-50px"}).attr("on",null).appendTo(s).addClass("hotspotCircle");n.css({display:"block",width:"30px",height:"30px",background:"rgba(0,0,0,0.01)",border:"solid rgba(0,0,0,1) 5px","border-radius":"50%"}).appendTo(e);i.css({display:"block",width:"0px",height:"0px",background:"rgba(0,0,0,0)",border:"solid rgba(0,0,0,0.1) 15px","border-radius":"50%"}).appendTo(n);r.text("Hotspot (drag to update)").css({position:"relative",left:"-5px",top:"-5px",width:"auto",color:"white","font-weight":"bold","font-size":"large",padding:"8px","background-color":"rgba(0,0,0,.85)"}).appendTo(s);TAG.Util.disableDrag(t);e.get(0).addEventListener("mouseup",function(){$(".addbutton").prop("disabled",false);$(".addbutton").css("opacity","1");g=true},false);if(IS_WINDOWS){TAG.Util.makeManipulatableWin(e[0],{onManipulate:function(e){var t=s.css("top"),n=s.css("left");s.css("top",parseInt(t,10)+e.pivot.y-20+"px");s.css("left",parseInt(n,10)+e.pivot.x-20+"px");m.updateOverlay(s[0],Seadragon.OverlayPlacement.TOP_LEFT)}})}else{TAG.Util.makeManipulatable(e[0],{onManipulate:function(e){var t=s.css("top"),n=s.css("left");s.css("top",parseInt(t,10)+e.pivot.y-20+"px");s.css("left",parseInt(n,10)+e.pivot.x-20+"px");m.updateOverlay(s[0],Seadragon.OverlayPlacement.TOP_LEFT)}})}s.appendTo(t)}function b(e){e=e||m.viewer.viewport.getCenter();var t=m.viewer.viewport.pixelFromPoint(e),n=new Seadragon.Point(t.x+50,t.y+50),r=m.viewer.viewport.pointFromPixel(n);p&&T();a.text("Remove Hotspot");l.attr("disabled","disabled");l.css("opacity","0.5");m.addOverlay(s[0],r,Seadragon.OverlayPlacement.TOP_LEFT);m.viewer.viewport.panTo(new Seadragon.Point(e.x,e.y),false);s.fadeIn(100);h=true}function w(){a.text("Set as Hotspot");l.removeAttr("disabled");a.on("mousedown",function(){a.css({"background-color":"white",color:"black"})});a.on("mouseleave",function(){a.css({"background-color":"transparent",color:"white"})});l.css("opacity","1.0");m.removeOverlay(s[0]);s.fadeOut(100);h=false}function E(){var e=o.offset(),t=o.width(),n=o.height(),r=m.viewer.viewport.pointFromPixel(new Seadragon.Point(e.left,e.top)),i=m.viewer.viewport.pointFromPixel(new Seadragon.Point(e.left+t,e.top+n));console.log("width"+t);console.log("height"+n);return new Seadragon.Rect(r.x,r.y,i.x-r.x,i.y-r.y)}function S(){o=$(document.createElement("img")).attr({src:u}).addClass("layerContainer").appendTo(t);LADS.Util.makeManipulatable(o[0],{onManipulate:function(e){var t=o.offset().left,n=o.offset().top,r=e.translation.x,i=e.translation.y;o.css({left:t+r+"px",top:n+i+"px"});m.viewer.drawer.updateOverlay(o[0],E())},onScroll:function(e,n){var r=o.offset().left,i=o.offset().top,s=o.width(),u=o.height(),a=s*e,f=u*e;m.viewer.drawer.removeOverlay(o[0]);t.append(o);o.css({left:r+(1-e)*n.x+"px",top:i+(1-e)*n.y+"px",width:a+"px",height:f+"px",position:"absolute"});m.viewer.drawer.addOverlay(o[0],E())}},false,true);o.on("mousedown",function(){m.freezeArtwork()});o.on("mouseup",function(){g=true;m.unfreezeArtwork();m.viewer.drawer.updateOverlay(o[0],E())});o.on("click",function(){g=true;m.unfreezeArtwork();m.viewer.drawer.updateOverlay(o[0],E())})}function x(e){var n,r=$(".layerContainer");h&&w();p=true;S();l.text("Remove Layer");if(r.length>0){for(n=0;n<r.length;n++){m.viewer.drawer.removeOverlay(r[n]);$(r[n]).remove()}}o.css({border:"2px solid red",display:"block",opacity:"0.5",position:"absolute"}).appendTo(t);if(!e){o.css({left:"30%",top:"20%",width:"40%",height:"auto"});e=E()}m.viewer.drawer.addOverlay(o[0],e)}function T(){p=false;l.text("Set as Layer");a.removeAttr("disabled");a.css("opacity","1.0");l.on("mousedown",function(){l.css({"background-color":"white",color:"black"})});l.on("mouseleave",function(){l.css({"background-color":"transparent",color:"white"})});if(o){m.viewer.drawer.removeOverlay(o[0]);o.remove();o.css("display","none")}}function N(e,t){var n=$(".rightbar").find(".assocmedia").children();n.length?n.data(e,t):f[e]=t}function C(e){var t=$(".rightbar").find(".assocmedia").children();if(!e){return false}else{return t.data(e)||f[e]}}function k(e){var t=e[0];var n=t.volume;var r=false;t.addEventListener("volumechange",function(){if(t.muted){t.volume=0;r=true}else{if(r){t.volume=n;r=false}n=t.volume}},false)}function A(e){var t,n,r,i=e.doq.Metadata.Source,s=e.doq.Metadata.ContentType,o=e.doq.Metadata.Thumbnail&&!e.doq.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.doq.Metadata.Thumbnail):"",u,a,f,l,c,h,p=TAG.Worktop.Database.fixPath(i);if(s==="Image"){return $(document.createElement("div")).css({width:"100%",height:"100%","background-image":"url("+p+")","background-repeat":"no-repeat","background-position":"center center","background-size":"contain",border:"0"})}else if(s==="Video"){t=$(document.createElement("video"));k(t);t[0].onerror=function(e){var n="";switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:n="Video playback aborted. Please see FAQs on the TAG website.";break;case e.target.error.MEDIA_ERR_NETWORK:n="Network error during video upload. Please see FAQs on the TAG website.";break;case e.target.error.MEDIA_ERR_DECODE:n="Error decoding video. Please see FAQs on the TAG website.";break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:n="Either the video format is not supported or a network or server error occurred. Please see FAQs on the TAG website.";break;default:n="Error: please see FAQs on the TAG website.";break}h=$(document.createElement("div"));h.css({width:"80%","margin-left":"10%","margin-top":"50%",color:"white","text-align":"center"});h.text(n);t.hide();t.parent().append(h);t[0].onerror=function(e){}};t.attr({preload:"none",poster:o,controls:"controls"});f=document.createElement("source");f.src=p;f.type="video/mp4";u=document.createElement("source");u.src=p;u.type="video/webm";a=document.createElement("source");a.src=p;a.type="video/ogg";t.append(f);t.append(u);t.append(a);t[0].innerHTML+="Your browser does not support this video.";t.css({color:"white",position:"relative",width:"100%",height:"100%"});return t}else if(s==="Audio"){n=$(document.createElement("audio"));k(n);n.attr({preload:"none",controls:"controls"});l=document.createElement("source");l.src=p;l.type="audio/mp3";a=document.createElement("source");a.src=p;a.type="audio/ogg";n.append(l);n.append(a);n.css({position:"absolute",width:"100%",bottom:"0%"});return n}else if(s==="iframe"){r=$(document.createElement("iframe"));r.attr({src:i+"?modestbranding=1&showinfo=0&fs=0",frameborder:"0"});r.css({width:"100%",height:"100%"});return r}}function M(){var e,t,n;$(".assetHolder").css("background-color","");if(C("ContentType")==="Video"){}else if(C("ContentType")==="Audio"){}e=$(".title").val()||"Untitled";t=$(".description").val()||"Untitled";d=d||"Untitled";v=v||"Untitled";n=h?"Hotspot":p?"Layer":"Asset";if(e!=d||t!=v||g){console.log(e+" "+d+" "+t+" "+v+" "+g);_({title:TAG.Util.htmlEntityEncode(e),desc:TAG.Util.htmlEntityEncode($(".description").val()),pos:h?Seadragon.Utils.getElementPosition(s.children().first().get(0)):null,rect:p?E():null,contentType:c.doq.Metadata.ContentType,contentUrl:TAG.Worktop.Database.fixPath(c.doq.Metadata.Source),assetType:n,metadata:{assetDoqID:c.doq.Identifier}})}}function _(t){function v(){c.fadeOut();L(f.assetDoqID);h.fadeOut()}function g(){}var n=t.title,i=t.desc,s=t.contentType,o=t.contentUrl,u=t.duration,a=t.assetType,f=t.metadata||{},l,c,h,p;if(t.pos){l=m.viewer.viewport.pointFromPixel(t.pos);l.width=0;l.height=0}else if(t.rect){l=t.rect}else{l={x:0,y:0,width:0,height:0}}c=$(document.createElement("div"));c.css({width:"20%",height:"100%",position:"absolute","background-color":"rgba(0,0,0,.85)",top:$(".topbar").css("height"),right:"0%","z-index":100});r.append(c);TAG.Util.showLoading(c,"20%","40%","40%");c.attr("class","rightbarLoadingSave");var d=$(document.getElementById(f.assetDoqID)).height();h=$(document.createElement("div"));h.css({width:"100%",height:"100%",position:"relative","background-color":"rgba(0,0,0,.85)",top:"-"+d-4+"px","z-index":100});$("#"+f.assetDoqID).append(h);TAG.Util.showLoading(h,"20%","40%","40%");h.attr("class","thumbnailLoadingSave");p={Name:n,ContentType:s,Duration:u,LinqTo:e.Identifier,X:l.x,Y:l.y,W:l.width,H:l.height,LinqType:a,Description:i};if(s!=="iframe"){p.Source=o}TAG.Worktop.Database.changeHotspot(f.assetDoqID,p,v,g,D,g)}function P(){var t=$(document.createElement("div")).addClass("rightbar").css({width:"20%",height:"100%",position:"absolute","background-color":"rgba(0,0,0,0.85)",top:$(".topbar").css("height"),right:"-20%","float":"right","z-index":100,color:"white"}),n=$(document.createElement("div")).css({margin:"5% 8%",color:"white","font-size":"100%","float":"left",position:"relative"}).addClass("header").text("Edit Associated Media").appendTo(t),i=$(document.createElement("div")).css({position:"relative",margin:"10% 8%","margin-top":"20%",border:"2px solid white",width:"86%",height:"30%"}).addClass("assocMediaContainer").appendTo(t),o=$(document.createElement("div")).addClass("assocmedia").addClass("contentwrapper").css({"background-color":"rgba(0,0,0,.9)",height:"100%",width:"100%",left:"0",position:"absolute"}).appendTo(i),u=$(document.createElement("div")).addClass("toggleModeContainer").css({width:"87%",left:"8%",position:"relative",height:"auto","max-height":"10%"}).appendTo(t),f=$(document.createElement("button")).addClass("toggleHotspot").css({width:"100%",height:"auto","max-height":"45%",border:"2px solid white",position:"relative","font-size":$(".addRemoveMedia").css("font-size")}).css("border-radius","3.5px").attr("type","button").appendTo(u),d=$(document.createElement("button")).addClass("toggleLayer").css("border-radius","3.5px").css({width:"100%",height:"auto","max-height":"45%","margin-top":"5%",border:"2px solid white",position:"relative","font-size":$(".addRemoveMedia").css("font-size")}).attr("type","button"),v=$(document.createElement("div")).addClass("textareaContainer").css({width:"87%",left:"8%",position:"relative",height:"auto","max-height":"10%","margin-top":"5%"}).appendTo(t),m=$(document.createElement("input")).addClass("title").attr("placeholder"," Title").attr("title","Title").css({width:"100%","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box","font-size":"0.7em"}).appendTo(v),S=$(document.createElement("div")).addClass("textareaContainer").css({width:"87%",left:"8%",position:"relative",height:"16%","margin-top":"5%"}).appendTo(t),N=$(document.createElement("textarea")).addClass("description").attr("placeholder"," Description").css({"background-color":"white",width:"100%","min-width":"100%",height:"90%","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box","font-size":"0.7em","padding-right":"8px"}).appendTo(S),k=$(document.createElement("div")).addClass("buttoncontainer").css({width:"87%",padding:"5% 8%",position:"relative",height:"5%",display:"block"}).appendTo(t),L=$(document.createElement("button")).addClass("asscmediabutton unassociatebutton").css("border-radius","3.5px").text("Unassociate").css({"float":"left",border:"2px solid white","max-width":"43%",width:"43%",display:"inline-block","text-align":"center",padding:"4px 4px 4px 4px","font-size":$(".addRemoveMedia").css("font-size")}).attr("type","button").appendTo(k),A=$(document.createElement("button")).css("border-radius","3.5px").addClass("asscmediabutton addbutton").text("Save").attr("type","button").css({"float":"right",border:"2px solid white","max-width":"43%",width:"43%",display:"inline-block","text-align":"center",padding:"4px 4px 4px 4px","font-size":$(".addRemoveMedia").css("font-size")}).appendTo(k),M=$(document.createElement("img")).addClass("closeEditAssocMedia").attr("src",tagPath+"images/icons/x.svg").css({position:"absolute",top:"85%",left:"8%",width:"11%",height:"5%"}).appendTo(t);A.on("mousedown",function(){A.css({"background-color":"white",color:"black"})});L.on("mousedown",function(){L.css({"background-color":"white",color:"black"})});A.on("mouseleave",function(){A.css({"background-color":"transparent",color:"white"})});L.on("mouseleave",function(){L.css({"background-color":"transparent",color:"white"})});L.on("mouseup",function(){L.css({"background-color":"transparent",color:"white"})});A.prop("disabled",true);A.css("opacity","0.4");m.on("keyup",function(){A.prop("disabled",false);A.css("opacity","1")});N.on("keyup",function(){A.prop("disabled",false);A.css("opacity","1")});f.on("click",function(){A.prop("disabled",false);A.css("opacity","1")});d.on("click",function(){A.prop("disabled",false);A.css("opacity","1")});y();f.on("click",function(){g=true;h?w():b()});d.on("click",function(){p?T():x()});a=f;l=d;L.on("click",function(){TAG.Util.removeYoutubeVideo();var t=C("assetDoqID");A.attr("disabled",true).css("color","rgba(255,255,255,0.5)");if(C("contentType")==="Video"){$(".rightbar").find("video")[0].pause()}else if(C("contentType")==="Audio"){$(".rightbar").find("audio")[0].pause()}var n;var i=$(document.getElementById(t)).height();n=$(document.createElement("div"));n.css({width:"100%",height:"100%",position:"relative","background-color":"rgba(0,0,0,.85)",top:"-"+i-4+"px","z-index":100});$("#"+t).append(n);TAG.Util.showLoading(n,"20%","40%","40%");n.attr("class","thumbnailLoadingUnassoc");var s=$(document.createElement("div"));s.css({width:"20%",height:"100%",position:"absolute","background-color":"rgba(0,0,0,.85)",top:$(".topbar").css("height"),right:"0%","z-index":100});r.append(s);TAG.Util.showLoading(s,"20%","40%","40%");L.attr("disabled",true).css("color","rgba(255,255,255,0.5)");if(t){TAG.Worktop.Database.changeArtwork(e.Identifier,{RemoveIDs:t},function(){B();$(".assetContainer").empty();O();s.fadeOut()},function(){console.log("error 1")},function(){console.log("error 2")},function(){console.log("error 3")})}else{B();O();s.fadeOut()}});A.on("click",function(){var e,t;if(C("ContentType")==="Video"){$(".rightbar").find("video")[0].pause()}else if(C("ContentType")==="Audio"){$(".rightbar").find("audio")[0].pause()}e=m.val()||"Untitled";t=h?"Hotspot":p?"Layer":"Asset";_({title:TAG.Util.htmlEntityEncode(e),desc:TAG.Util.htmlEntityEncode(N.val()),pos:h?Seadragon.Utils.getElementPosition(s.children().first().get(0)):null,rect:p?E():null,contentType:c.doq.Metadata.ContentType,contentUrl:TAG.Worktop.Database.fixPath(c.doq.Metadata.Source),assetType:t,metadata:{assetDoqID:c.doq.Identifier}})});M.on("click",function(){if(C("contentType")==="Video"){$(".rightbar").find("video")[0].pause()}else if(C("contentType")==="Audio"){$(".rightbar").find("audio")[0].pause()}B()});r.append(t)}function H(t,r,s){function o(e){var o=parseFloat(e.Offset._x),f=parseFloat(e.Offset._y),m=parseFloat(e.Dimensions?e.Dimensions._x:0),y=parseFloat(e.Dimensions?e.Dimensions._y:0),E=TAG.Util.htmlEntityDecode(t.doq.Name),S=t.doq.Metadata.Description?TAG.Util.htmlEntityDecode(t.doq.Metadata.Description).replace(/<br>/g,"\n"):"",C,k=t.doq.Metadata.ContentType==="Image"&&e.Dimensions,L,A,O=$(".rightbar");h=e.Metadata.Type==="Hotspot";p=e.Metadata.Type==="Layer";d=E;v=S;g=false;if(k){u=LADS.Worktop.Database.fixPath(t.doq.Metadata.Source)}$(".assocMediaContainer").show();if(h){C=new Seadragon.Point(o,f)}else if(p){L=new Seadragon.Rect(o,f,m,y)}a.text(h?"Remove Hotspot":"Create Hotspot");l.text(p?"Remove Layer":"Create Layer");h?b(C):w();p?x(L):T();l.css({display:k?"inline-block":"none"});O.find(".assocmedia").html(r);O.find(".title").val(E);O.find(".description").val(S);O.find(".title").on("keyup",function(){i=true});O.find(".description").on("keyup",function(){i=true});if(!n){O.animate({right:0},600)}for(A in t.doq.Metadata){if(t.doq.Metadata.hasOwnProperty(A)){N(A,t.doq.Metadata[A])}}N("assetDoqID",t.doq.Identifier);n=true;c=t;s&&s()}$(".addbutton").prop("disabled",true);$(".addbutton").css("opacity","0.4");if(n){}$(".asscmediabutton").attr("disabled",false).css("color","rgba(255,255,255,1)");i=false;TAG.Worktop.Database.getLinq(e.Identifier,t.doq.Identifier,o,function(){},function(){})}function B(){TAG.Util.removeYoutubeVideo();var e;if(n){e=$(".rightbar");s.fadeOut(100);if(o){m.viewer.drawer.removeOverlay(o[0]);o.remove()}m.unfreezeArtwork();e.animate({right:"-20%"},600);$(".assetHolder").css("background-color","");i=false;n=false}}function j(){return n}var n=false,i=false,s,o,u,a=$(".toggleHotspot"),l=$(".toggleLayer"),c,h=false,p=false,d,v,g=false;a.css("border-radius","3.5px");l.css("border-radius","3.5px");return{init:P,open:H,close:B,createMediaWrapper:A,isOpen:j}}function q(){function f(){i.text(a.Title.val());var t=new LADS.Authoring.SettingsView("Artworks",null,null,e.Identifier);TAG.Util.UI.slidePageRight(t.getRoot())}function l(){i.text(a.Title.val());var t=$(TAG.Util.UI.popUpMessage(function(){var t=new LADS.Authoring.SettingsView("Artworks",null,null,e.Identifier);TAG.Util.UI.slidePageRight(t.getRoot())},"Changes to "+e.Name+" have not been saved.  You must log in to save changes."));$("body").append(t);t.show();I=false}function c(){i.text(a.Title.val());var t;t=$(TAG.Util.UI.popUpMessage(function(){var t=new LADS.Authoring.SettingsView("Artworks",null,null,e.Identifier);TAG.Util.UI.slidePageRight(t.getRoot())},"Changes to "+e.Name+" have not been saved.  There was an error contacting the server."));$("body").append(t);t.show();I=false}var t,n=$(".additionalField"),r={};i.text("Saving "+a.Title.val()+"...");for(t=0;t<n.length;t++){var s=$(n[t]).attr("value");if(s===""){s="Unnamed Field "+t}r[s]=$(n[t]).attr("entry")}var o=$(a.Title).val();if(o==""){o="Untitled Artwork"}TAG.Worktop.Database.changeArtwork(e.Identifier,{Name:o,Artist:$(a.Artist).val(),Year:$(a.Year).val(),Location:JSON.stringify(u),Description:$(a.Description).val(),InfoFields:JSON.stringify(r)},f,l,D,c)}function R(){function u(e){var t=e.field,r=e.entry,i=e.animate,o=e.isTextarea,u=e.isAdditionalField,f=$(document.createElement("div")).addClass("textareaContainer"),c=$(document.createElement(u?"input":"div")).addClass("fieldTitle"),h=$(document.createElement(o?"textarea":"input")),p=$(document.createElement("div"));f.css({"margin-bottom":"7%",width:"100%","text-align":"left"});u&&c.addClass("additionalField");u&&t!==""?c.attr("value",t):c.text(t);c.css({display:"inline-block",color:u?"black":"white","margin-right":"12px",width:"18%","text-align":"right","vertical-align":u?"":"top","padding-top":u?"0px":"5px","font-size":"0.8em",overflow:"hidden",border:"0px solid black"});if(o){h.attr("rows",3);h.css({overflow:"auto",background:"white",border:"0px solid black"})}h.change(function(){I=true});c.change(function(){I=true});h.css({width:"70%","font-size":"11pt",display:"inline-block",border:"0px solid black"});if(u){h.attr("placeholder","Metadata Field")}if(!u){h.attr("placeholder",t)}if(u){c.attr("entry",r);h.on("keyup",function(){c.attr("entry",h.attr("value"))})}a[t]=h;h.val(r);h.attr("title",t);p.css({"margin-left":"15px",display:"inline-block",width:"30px"});if(t!=="Title"&&t!=="Keywords"&&t!=="Artist"&&t!=="Year"&&t!=="Description"){c.attr("placeholder","New");p=$(document.createElement("img"));p.attr("src",tagPath+"images/icons/minus.svg");p.css({"float":"right","margin-right":"2%",width:"30px",height:"30px",display:"inline-block"});p.bind("click",{Param1:t},function(e){I=true;f.remove();if(!l()){n.removeAttr("disabled")}})}i&&f.css("display","none");f.append(c);f.append(h);f.append(p);s.append(f);if(i){f.slideDown(function(){$("#metadataForm").animate({scrollTop:$("#metadataForm")[0].scrollHeight},1e3)})}return h}function f(){var t=e.Metadata.InfoFields;t=t||{};$.each(t,function(e,t){u({field:e,entry:t,animate:true,isAdditionalField:true})})}function l(){return $(".additionalField").length>=4}function c(){var t;o=$(document.createElement("div")).attr("id","metadataForm").css({background:"rgba(0, 0, 0, 0.85)","border-radius":"0px 10px 10px 0px",left:"20%",width:"45%",position:"absolute",display:"none",color:"white","padding-top":"1%","margin-top":"1%","z-index":1e5,"max-height":"70%","overflow-y":"scroll"}).appendTo(r);t=$(document.createElement("div"));t.text("Metadata Editor");t.css({width:"100%","text-align":"center","font-size":"150%"});o.append(t);s=$(document.createElement("div"));s.attr("id","textFieldContainer");s.css({position:"relative",height:"25%",overflow:"auto",padding:"0px 4% 0px 0px","margin-top":"30px"});o.append(s);n=$(document.createElement("button"));n.text("Add Metadata Field").css("border-radius","3.5px");n.attr("type","button");n.css({left:"10%",width:"80%","margin-top":"2%","margin-bottom":"3%",position:"relative"});o.append(n);i=$(document.createElement("button"));i.text("Save");i.attr("type","button");i.css({left:"10%",width:"80%","margin-top":"2%","margin-bottom":"3%",position:"relative"});u({field:"Title",entry:e.Name});u({field:"Artist",entry:e.Metadata.Artist});u({field:"Year",entry:e.Metadata.Year});u({field:"Description",entry:e.Metadata.Description,isTextarea:true});f();if(l()){n.attr("disabled","true")}n.on("click",function(){I=true;u({field:"",entry:"",animate:true,isAdditionalField:true});if(l()){n.attr("disabled","disabled")}})}function h(){if(!t){H();o.toggle();y.css({"background-color":"white",color:"black"});b.attr("src",tagPath+"images/icons/RightB.png");T.hide();t=true}}function p(){if(t){o.toggle();y.css({"background-color":"transparent",color:"white"});b.attr("src",tagPath+"images/icons/Right.png");T.show();t=false}}function d(){t?p():h()}function v(){return t}var t,n,i,s,o;return{init:c,open:h,close:p,toggle:d,isOpen:v}}var t=$(document.createElement("div")),n=$(document.createElement("div")),r=$(document.createElement("div")),i=$(document.createElement("div")),s="To select a location, type into the search field or                     right-click/long-press on the map and drag the pushpin                     to the desired location, then click on the desired                     address and click 'Confirm.'",o="AkNHkEEn3eGC3msbfyjikl4yNwuy5Qt9oHKEnqh4BSqo5zGiMGOURNJALWUfhbmj",u=[],a={},f={},l=TAG.Util.createQueue(),c=8,h=R(),p=B(),d=j(),v=F(),m,g,y,b,w,E,S,x,T;LADS.Util.UI.getStack()[0]=null;t.attr("class","rootPage");N();return{getRoot:P};var I=false};TAG.Util.makeNamespace("TAG.Layout.TourAuthoringNew");TAG.Layout.TourAuthoringNew=function(e,t){"use strict";var n=$(document.createElement("div")),r=$(document.createElement("div")),i=window.innerHeight*.3,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=new DataHolder;n.css({"background-color":"rgb(219,218,199)",height:"100%",width:"100%"});n.attr("class","rootPage");TAG.Util.UI.getStack()[0]=null;(function(){r.css({"background-color":"rgb(219,218,199)",height:i+"px",width:"100%","box-shadow":"0px 30px 30px -25px #888"});r.attr("id","resizableArea");var t=document.createDocumentFragment();var o=$(document.createElement("div"));t.appendChild(o[0]);o.addClass("resizeButtonArea");o.css({height:"3%",width:"10%",position:"absolute",top:i+window.innerHeight*.09+"px",left:"45%","margin-left":"-1.5%","z-index":0,"float":"left"});var f=$(document.createElement("img"));f.addClass("resizeButton");f.attr("src",tagPath+"images/icons/dragTourWindowTwoBars.svg");f.attr("id","resizeButton");f.css({cursor:"pointer",height:"auto",width:"30%",position:"absolute",top:"20%",left:"40%"});var l;var g;var y;o.draggable({axis:"y",containment:[0,window.innerHeight/5+window.innerHeight*.1,0,window.innerHeight/1.5+window.innerHeight*.1],scroll:false,start:function(e,t){if(a.getEditInkOn()===true){return false}$("#bufferingDiv").css({background:"rgba(0,0,0,.9)"});$($("#bufferingDiv").parent()).css({opacity:.9,display:"block"});l=t.position.top;s.stop()},stop:function(e,t){a.onUpdate()},drag:function(e,t){if(a.getEditInkOn()===true){return false}t.position.top=Math.constrain(t.position.top,window.innerHeight/5+window.innerHeight*.1,window.innerHeight/1.5+window.innerHeight*.1);if(l===null){l=t.position.top;return}var n=t.position.top-l;r.css({height:i+n+"px"});if(!c){c=$(".mainScrollHider")}c.css({height:c.height()-n+"px"});if(!h){h=$("#trackBody")}h.css({height:h.height()-n+"px"});if(!p){p=$("#trackScrollVeil")}p.css({height:p.height()-n+"px"});$("#verticalSliderPane").css({height:h.height()+"px"});$("#trackScrollVeil").css({height:h.height()+"px"});i=i+n;var s=r.offset().top;var o=r.height();if(!d){d=$("#inkTextControls")}if(!v){v=$("#inkDrawControls")}if(!m){m=$("#inkTransControls")}if($("#inkTextControls").length>0){$("#inkTextControls").css("height",s+o-$("#inkTextControls").offset().top-10)}if($("#inkDrawControls").length>0){$("#inkDrawControls").css("height",s+o-$("#inkDrawControls").offset().top-10)}if($("#inkTransControls").length>0){$("#inkTransControls").css("height",s+o-$("#inkTransControls").offset().top-10)}u.resize();l=t.position.top},appendTo:"body"});o.append(f);n.append(t)})();(function(){s=TAG.TourAuthoring.TimeManager();o=TAG.TourAuthoring.UndoManager();u=TAG.TourAuthoring.Viewer({timeManager:s});a=TAG.TourAuthoring.Timeline({timeManager:s,undoManager:o,dataHolder:E,viewer:u,root:n});u.setTimeline(a);l=TAG.TourAuthoring.PlaybackControl({timeManager:s,undoManager:o,viewer:u,timeline:a,root:n});f=TAG.TourAuthoring.ComponentControls({root:n,undoManager:o,playbackControls:l,timeline:a,dataHolder:E,viewer:u,timeManager:s});w=TAG.TourAuthoring.TopMenu({viewer:u,timeline:a,tourobj:e,componentControls:f,timeManager:s,undoManager:o,playbackControls:l,root:n});var c=document.createDocumentFragment();c.appendChild(r[0]);w.addToDOM(n);f.addToDOM(r);u.addToDOM(r);f.addCatalogToDOM(c);a.addToDOM(c);l.addToDOM(c);n.append(c);var h=JSON.parse(unescape(e.Metadata.Content));if(jQuery.isEmptyObject(h)){h=a.toRIN()}u.initializeTour(h);a.loadRIN(h,t);a.updateVerticalScroller()})();this.getRoot=function(){return n}};TAG.Util.makeNamespace("TAG.TourAuthoring.TimeManager");TAG.TourAuthoring.TimeManager=function(e,t){"use strict";function m(e){var t=[];if(e.start){D=null;r=e.start;t.push("start")}if(e.end){i=e.end;t.push("end")}if(e.scale){D=null;s=e.scale;t.push("scale")}if(e.start||e.end||e.scale){R({start:r,end:i,scale:s,updated:t})}if(e.current){D=null;o=e.current;I({current:o})}}function g(e){D=null;r=e;R({start:r,end:i,scale:s,updated:["start"]})}function y(e){i=e;if(o>i){D=null;o=i}R({start:r,end:i,scale:s,updated:["end"]})}function b(e){D=null;s=e;R({start:r,end:i,scale:s,updated:["scale"]})}function w(e){if(e<0){e=0}else if(e>i){e=i}D=null;o=e;var t=(o-r)/(i-r);K({current:o,percent:t});I({current:o,percent:t});if(o>i){console.log("On timeManager seek: asked to seek past end (normal seek)")}}function E(e){D=null;o+=e;var t=(o-r)/(i-r);K({current:o,percent:t});I({current:o,percent:t});if(o>i){console.log("On timeManager seek: asked to seek past end (amount seek)")}}function S(e){D=null;o=(i-r)*e;K({current:o,percent:(o-r)/(i-r)});I({current:o,percent:e})}function x(e){p=e}function T(){return p}function N(e){d=e}function C(){return s}function k(){var e=100,t=-10,s=false,u=Date.now(),a=(o-r)/(i-r);K({current:o,percent:a});z({current:o,percent:a});n=window.requestAnimationFrame(function f(e){n=window.requestAnimationFrame(f);if(p){if(!s){o=d();if(o===t){s=true;o+=(e-u)/1e3}}else{o+=(e-u)/1e3}if(o>=i){o=i;L()}X({current:o,percent:(o-r)/(i-r)});D=null;t=o;u=e}})}function L(){if(n){window.cancelAnimationFrame(n);n=null;$()}}function A(e){return(e-r)*s}function O(e){return e/s+r}function M(e){var t=parseInt(e/60,10);var n=Math.floor(e%60);if(n<10){n="0"+n}return t+":"+n}function _(e){var t,n;e.split(":");t=parseFloat(t);n=parseFloat(n);return t*60+n}function P(){return o}function H(){if(!D){D=A(o)}return D}function B(){return(o-r)/(i-r)}function j(){return{start:r,end:i,scale:s}}function F(e){u.push(e)}function I(e){var t;for(t=0;t<u.length;t++){u[t].call(v,e)}}function q(e){a.push(e)}function R(e){var t;for(t=0;t<a.length;t++){a[t].call(v,e)}}function U(e){f.push(e)}function z(e){var t;for(t=0;t<f.length;t++){f[t].call(v,e)}}function W(e){l.push(e)}function X(e){var t;for(t=0;t<l.length;t++){l[t].call(v,e)}}function V(e){c.push(e)}function $(e){var t;for(t=0;t<c.length;t++){c[t].call(v,e)}}function J(e){h.push(e)}function K(e){var t;for(t=0;t<h.length;t++){h[t].call(v,e)}}e=e||{};var n=null,r=e.start||0,i=e.end||180,s=e.scale||20,o=e.current||0,u=[],a=[],f=[],l=[],c=[],h=[],p=false,d=null,v={setTime:m,setStart:g,setEnd:y,setScale:b,seek:w,seekByAmount:E,seekToPercent:S,setReady:x,getReady:T,registerTime:N,getScale:C,play:k,stop:L,timeToPx:A,pxToTime:O,formatTime:M,unformatTime:_,getCurrentTime:P,getCurrentPx:H,getCurrentPercent:B,getDuration:j,onSeek:F,onSizing:q,onPlayStart:U,onPlay:W,onStop:V,onMove:J};F(L);var D=null;return v};TAG.Util.makeNamespace("TAG.TourAuthoring.UndoManager");TAG.TourAuthoring.UndoManager=function(e,t){"use strict";function a(e){if(s===true){if(e.savedState===undefined)e.savedState=false;if(i.length>0){i=[];$(".redoButton").css({opacity:"0.4"});console.log("clear redoStack?")}r.push(e);$(".undoButton").css({opacity:"1.0"});if(r.length>u){var t=r.length-u;r.splice(0,t)}}if(r.length){$("#tourSaveButton").css("opacity","1");$("#tourSaveButton").prop("disabled",false)}}function f(){if(r.length>0){console.log("SAVED STATE //TOP//FROM DSG// ==="+r[r.length-1].savedState);return r[r.length-1].savedState}return true}function l(){return r.length}function c(){if(r.length>0){r[r.length-1].savedState=true;for(var e=0;e<r.length-1;e++){r[e].savedState=false}}}function h(e){s=e}function p(){return s}function d(){if(r.length>0){var e=r.pop();e.unexecute();i.push(e);$(".redoButton").css({opacity:"1.0"});if(r.length===0)$(".undoButton").css({opacity:"0.4"})}else{$("#tourSaveButton").prop("disabled",true);$("#tourSaveButton").css("opacity","0.4");$(".undoButton").css({opacity:"0.4"})}if(!r.length){$("#tourSaveButton").prop("disabled",true);$("#tourSaveButton").css("opacity","0.4");$(".undoButton").css({opacity:"0.4"})}}function v(){if(i.length>0){var e=i.pop();e.execute();r.push(e);$(".undoButton").css({opacity:"1.0"});if(i.length===0)$(".redoButton").css({opacity:"0.4"})}else $(".redoButton").css({opacity:"0.4"});if(r.length){$("#tourSaveButton").css("opacity","1");$("#tourSaveButton").prop("disabled",false)}}function m(){r=[];i=[]}function g(){$(".undoButton").css({opacity:"1.0"});$(".redoButton").css({opacity:"1.0"});if(r.length<1){$(".undoButton").css({opacity:"0.4"})}if(i.length<1){$(".redoButton").css({opacity:"0.4"})}}function y(e){var t,n;e=e||2;t={execute:function(){for(n=0;n<e;n++){v()}},unexecute:function(){for(n=0;n<e;n++){d()}}};a(t)}var n={},r=[],i=[],s=false,o=0,u=75;n.logCommand=a;n.dirtyStateGetter=f;n.undoStackSize=l;n.setPrevFalse=c;n.setInitialized=h;n.getInitialized=p;n.undo=d;n.redo=v;n.clear=m;n.greyOutBtn=g;n.combineLast=y;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.ArtworkTrack");TAG.TourAuthoring.ArtworkTrack=function(e,t){"use strict";e.type=TAG.TourAuthoring.TrackType.artwork;t=t||{};var n=TAG.TourAuthoring.Track(e,t);t.track.addClass("artwork");return n};TAG.Util.makeNamespace("TAG.TourAuthoring.AudioTrack");TAG.TourAuthoring.AudioTrack=function(e,t){"use strict";e.type=TAG.TourAuthoring.TrackType.audio;t=t||{};var n=TAG.TourAuthoring.Track(e,t);t.track.addClass("audio");return n};TAG.Util.makeNamespace("TAG.TourAuthoring.Viewer");TAG.TourAuthoring.Viewer=function(e,t){"use strict";function b(e){console.log(e.eventId);if(r){switch(e.eventId){case rin.contracts.esEventIds.interactionActivatedEventId:u.stop();d=true;v=e.sender._esData.experienceId;if(d&&!c&&!m&&u.getReady()){w(e.sender)}break;case rin.contracts.esEventIds.stateTransitionEventId:if(d&&!c&&!m&&u.getReady()){w(e.sender)}break}}}function w(e){var t,n="";if(e.captureKeyframe&&d){n=e.captureKeyframe();if(n===""){console.log("No keyframe captured!?");return}t=e._esData.experienceId;r.receiveKeyframe(t,n,true);r.allDeselected()}}function E(){d=false;v=""}function S(){return m}function x(e){m=e}function T(e){l=!e;u.setReady(e);c=false;if(e){if(h&&p){h=false;D(u.getCurrentTime());p=null}h=false;setTimeout(function(){var e=document.createEvent("Event");e.initEvent("playerReady",true,true);$("body")[0].dispatchEvent(e)},500)}}function N(){d=false}function C(e){if(n){return n.captureKeyframe(e)}}function k(){return n.orchestrator.getCurrentLogicalTimeOffset()}function L(e){e.append(s)}function A(){return o}function O(){var e=s.height()-2*TAG.TourAuthoring.Constants.rinBorder,t=s.width()-2*TAG.TourAuthoring.Constants.rinBorder,n=e*16/9,r,i,u;if(n<=t){i=(t-n)/2;o.css({width:n+"px",height:e+"px",top:"0px",left:i+"px"})}else{r=t*9/16;u=(e-r)/2;o.css({width:t+"px",height:r+"px",top:u+"px",left:"0px"})}}function M(e){if(!f){n.play(e);f=true}}function _(){if(f&&!l){n.pause();f=false}}function D(e){if(n.orchestrator._isNarrativeLoaded){if(h){p=u.timeToPx(e)}else if(n&&!f){_();f=false;n.pause(e)}}}function P(e){n.volume(e)}function H(e){r=e}function B(e,t){if(n){n.load(e,t)}else{setTimeout(function(){B(e,t)},50)}}function j(e,t){if(!t){g=true}for(var r in e.resources){if(e.resources.hasOwnProperty(r)){if(typeof e.resources[r].uriReference==="string"){e.resources[r].uriReference=TAG.Worktop.Database.fixPath(e.resources[r].uriReference)}}}if(n){c=true;h=true;n.orchestrator._isPlayerReady=false;p=u.getCurrentTime();n.unload();n.loadData(e,function(){if(!h){D(u.getCurrentTime());setTimeout(function(){var e=document.createEvent("Event");e.initEvent("playerReady",true,true);$("body")[0].dispatchEvent(e)},500)}if(!t){g=false}})}else{setTimeout(function(){j(e,true)},50)}}function F(){return g}function I(e){g=e}function q(e){var t;g=true;console.log("isReloading: true, in initializeTour");if(n){t=u.getCurrentTime();n.unload();n.loadData(e,function(){setTimeout(function(){D(t);g=false;console.log("isReloading: false, in initializeTour")},50)})}else if(r.getTrackslength()===0){t=u.getCurrentTime();setTimeout(function(){g=false;console.log("isReloading: false, in initializeTour")},50)}else{setTimeout(function(){j(e,true)},50)}}function R(){n.unload()}function U(){return n}var n,r,i={},s=$(document.createElement("div")),o=$(document.createElement("div")),u=e.timeManager,a=e.url,f=false,l=false,c=false,h=false,p=null,d=false,v="",m=false,g=false,y=IS_WINDOWS?tagPath+"js/WIN8_RIN/web":tagPath+"js/RIN/web";(function(){s.attr("id","viewer");s.css({"background-color":"rgb(0,0,0)",height:"100%",width:"80%",position:"relative",left:"20%"});o.attr("id","rinContainer");o.css({"border-style":"solid","border-width":TAG.TourAuthoring.Constants.rinBorder+"px","border-color":"white",height:"95%",width:"30%",top:"0%",left:"30%",position:"absolute","z-index":0});s.append(o);var t=$(document.createElement("div"));t.attr("id","rinplayer");t.css({"z-index":-100,overflow:"hidden",height:"100%",width:"100%",position:"absolute"});o.append(t);rin.processAll(null,y).then(function(){var e="systemRootUrl="+y+"/&hideAllControllers=true&playerMode=authorerEditor";n=rin.createPlayerControl(t[0],e);n.orchestrator.playerESEvent.subscribe(b,"id");n.orchestrator.isPlayerReadyChangedEvent.subscribe(T);u.registerTime(k)});if(a){B(a,function(){console.log("Viewer: initial loading complete")})}})();i.capturingOff=E;i.isKeyframingDisabled=S;i.setKeyframingDisabled=x;$("body")[0].addEventListener("playerReady",function(){m=false});$("body")[0].addEventListener("playerReloading",function(){m=true;setTimeout(function(){m=false},150)});u.onMove(N);u.onStop(N);i.captureKeyframe=C;i.getCurrentTime=k;i.addToDOM=L;i.getContainer=A;i.resize=O;i.play=M;u.onPlayStart(function(e){M(e.current)});i.stop=_;u.onStop(_);i.seek=D;u.onSeek(function(e){D(e.current)});i.volume=P;i.setTimeline=H;i.loadTour=B;i.reloadTour=j;i.getIsReloading=F;i.setIsReloading=I;i.initializeTour=q;i.unload=R;i.getPlayer=U;return i};TAG.Util.makeNamespace("TAG.TourAuthoring.Command");TAG.TourAuthoring.Command=function(e,t){"use strict";var n={};n.execute=e.execute;n.unexecute=e.unexecute;n.savedState=false;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.ComponentControls");TAG.TourAuthoring.ComponentControls=function(e,t){"use strict";function P(e){var t=TAG.Util.UI.popUpMessage(null,e,null);$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(t);$(t).fadeIn(500);l.onUpdate(true)}function H(e){e.append(r)}function B(e){e.appendChild(_);e.appendChild(D)}function j(){return A}var n=$(document.createElement("div")),r=document.createDocumentFragment(),i=$(document.createElement("div")),s=$(document.createElement("div")),o={},u=e.root,a=e.playbackControls,f=e.timeManager,l=e.timeline,c=e.viewer,h=e.tourobj,p=e.undoManager,d,v,m,g,y,b,w,E,S,x,T=TAG.Util.createQueue(),N=TAG.Util.createQueue(),C="Search by Name, Artist, or Year...",k=["visible","exhibits","selected"],L=c.getContainer(),A=false,O,M=false;r.appendChild(n[0]);l.setCompControl(o);var _=TAG.Util.UI.blockInteractionOverlay();$(_).addClass("catalogPickerOverlay");$(_).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);var D=TAG.Util.UI.blockInteractionOverlay();$(D).addClass("associatedMediaPickerOverlay");$(D).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);(function(){function r(e){if(e.keyCode===90&&e.ctrlKey){if(!h){h=true;u.on("keyup.z",function(e){h=false;u.off("keyup.z");if(l.getEditInkOn()){if(e.shiftKey){d.getInkUndoManager().redo()}else{d.getInkUndoManager().undo()}}else{if(e.shiftKey){p.redo()}else{p.undo()}}})}}else if(e.keyCode===89&&e.ctrlKey){u.on("keyup.y",function(e){u.off("keyup.y");if(d!==null&&d.getInkUndoManager()){d.getInkUndoManager().redo()}else{p.redo()}})}}function H(t,n){function L(){if(ut.isDatastringEmpty(ut.update_datastring())){var e=TAG.Util.UI.PopUpConfirmation(function(){t.setIsVisible(true);var e=TAG.TourAuthoring.Command({execute:function(){l.removeTrack(t)},unexecute:function(){t.reloadTrack()}});p.logCommand(e);e.execute();w.hide();ci();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none")},"You have created an empty annotation. Would you like to delete annotation track or go back to editing?","Delete Track",true);u.append(e);$(e).show();return}if(v){var n=$("#inkCanv");var r=$("[data-proxy='"+escape(f)+"']");var i={x:r.data("x"),y:r.data("y"),w:r.data("w"),h:r.data("h")};var s=c.captureKeyframe(f);if(!s){P("The track this annotation is attached to must be fully on screen in order to save this annotation. Please seek to a location where the track is visible.");return false}var o,h,g,y,b=m.getType();if(b===TAG.TourAuthoring.TrackType.artwork){o=s.state.viewport.region.center.x;h=s.state.viewport.region.center.y;g=s.state.viewport.region.span.x;y=s.state.viewport.region.span.y}else if(b===TAG.TourAuthoring.TrackType.image){g=1/s.state.viewport.region.span.x;var E=s.state.viewport.region.span.x*n.width();y=s.state.viewport.region.span.y;o=-s.state.viewport.region.center.x*g;h=-(n.height()/E)*s.state.viewport.region.center.y}t.setInkInitKeyframe({x:o,y:h,w:g,h:y});t.setInkRelativeArtPos(ut.getArtRelativePos(i,n.width(),n.height()))}var S=ut.update_datastring();var x=t.getInkPath();var T=TAG.TourAuthoring.Command({execute:function(){t.setInkPath(S);l.onUpdate(true)},unexecute:function(){t.setInkPath(x);l.onUpdate(true)}});ut.remove_all();ci();w.hide();t.setIsVisible(true);p.logCommand(T);T.execute();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none");if(d){d.getInkUndoManager().clear();p.greyOutBtn()}}a.undoRedoInkOnly.css({display:"block"});var r,i,s,f,h,v=t.getInkEnabled(),m=t.getInkLink();if(v){f=m.getTitle();var g=$("[data-proxy='"+escape(f)+"']");h={x:g.data("x"),y:g.data("y"),w:g.data("w"),h:g.data("h")};var y=c.captureKeyframe(f);if(!y){t.setIsVisible(true);P("The track this annotation is attached to must be fully on screen in order to edit this annotation. Please seek to a location where the track is visible.");return false}var b,E,S,x,T=m.getType();if(T===TAG.TourAuthoring.TrackType.artwork){b=y.state.viewport.region.center.x;E=y.state.viewport.region.center.y;S=y.state.viewport.region.span.x;x=y.state.viewport.region.span.y}else if(T===TAG.TourAuthoring.TrackType.image){S=1/y.state.viewport.region.span.x;var N=y.state.viewport.region.span.x*$("#rinplayer").width();x=y.state.viewport.region.span.y;b=-y.state.viewport.region.center.x*S;E=-($("#rinplayer").height()/N)*y.state.viewport.region.center.y}}li();w.css({display:"block"});var C=$("#resizableArea").offset().top;var k=$("#resizableArea").height();w.css("height",C+k-w.offset().top-10);lr.css({color:"black"});cr.css({color:"gray"});fr="draw";ar.text("Draw");hr.text("Width: ");pr.text("7px");hr.append(pr);vr.css("left","0px");wr.text("Opacity: ");Er.text("100%");wr.append(Er);xr.css("left",.87*Sr.width()+"px");ir.off("click");ir.on("click",function(){t.setIsVisible(true);l.setEditInkOn(false);l.onUpdate(true);l.setModifyingInk(false);l.hideEditorOverlay();vr.attr("value",7);ut.updatePenWidth("brushEditSlider");ut.remove_all();ci();w.hide();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none")});Tr.off("click");Tr.on("click",function(){L();l.hideEditorOverlay();l.setEditInkOn(false);l.setModifyingInk(false)});o.saveDraw=L;ii(sr);var A=hi();var O=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",e);$("#inkCanv").css("background","rgba(0,0,0,0.01)");d=O;O.set_editable();O.set_mode(TAG.TourAuthoring.InkMode.draw);if(v){s=t.getInkInitKeyframe();O.setInitKeyframeData(s);O.setArtName(f);O.retrieveOrigDims();O.setEID(t.getTitle())}O.loadInk(n);if(v){O.update_datastring();O.setOldOpac(1);O.adjustViewBoxDiv({x:h.x,y:h.y,width:h.w,height:h.h});O.drawPaths();O.drawBezierPath()}ut=O;l.onUpdate(true);l.showEditorOverlay();l.setEditInkOn(true)}function B(){if(d)return d.getInkUndoManager()}function j(t,n,r){function B(){var e;if(ut.isDatastringEmpty(ut.update_datastring())){var n=TAG.Util.UI.PopUpConfirmation(function(){t.setIsVisible(true);var e=TAG.TourAuthoring.Command({execute:function(){l.removeTrack(t)},unexecute:function(){t.reloadTrack()}});p.logCommand(e);e.execute();y.hide();ci();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none")},"You have created an empty annotation. Would you like to delete annotation track or go back to editing?","Delete Track",true);u.append(n);$(n).show();return}if(L){var r=$("#inkCanv");var i=$("[data-proxy='"+escape(h)+"']");var s={x:i.data("x"),y:i.data("y"),w:i.data("w"),h:i.data("h")};var o=c.captureKeyframe(h);if(!o){P("The track this annotation is attached to must be fully on screen in order to save this annotation. Please seek to a location where the track is visible.");return false}var f,v,m,g,b=A.getType();if(b===TAG.TourAuthoring.TrackType.artwork){f=o.state.viewport.region.center.x;v=o.state.viewport.region.center.y;m=o.state.viewport.region.span.x;g=o.state.viewport.region.span.y}else if(b===TAG.TourAuthoring.TrackType.image){m=1/o.state.viewport.region.span.x;var w=o.state.viewport.region.span.x*r.width();g=o.state.viewport.region.span.y;f=-o.state.viewport.region.center.x*m;v=-(r.height()/w)*o.state.viewport.region.center.y}t.setInkInitKeyframe({x:f,y:v,w:m,h:g});t.setInkRelativeArtPos(ut.getArtRelativePos(s,r.width(),r.height()))}ut.get_trans_shape_data();e=ut.update_datastring();e+=ut.getBoundingShapes();var E=t.getInkPath();var S=TAG.TourAuthoring.Command({execute:function(){t.setInkPath(e);l.onUpdate(true)},unexecute:function(){t.setInkPath(E);l.onUpdate(true)}});t.setIsVisible(true);p.logCommand(S);S.execute();ut.remove_all();ci();y.hide();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none");if(d){d.getInkUndoManager().clear();p.greyOutBtn()}}a.undoRedoInkOnly.css({display:"block"});var i,s,f,h,E,S,x,T,N,C,k,L=t.getInkEnabled(),A=t.getInkLink();if(L){f=t.getInkInitKeyframe();h=A.getTitle();var O=$("[data-proxy='"+escape(h)+"']");E={x:O.data("x"),y:O.data("y"),w:O.data("w"),h:O.data("h")};var M=c.captureKeyframe(h);if(!M){t.setIsVisible(true);P("The track this annotation is attached to must be fully on screen in order to edit this annotation. Please seek to a location where the track is visible.");return false}if(t.getInkLink().getType()===TAG.TourAuthoring.TrackType.artwork){T=M.state.viewport.region.center.x;N=M.state.viewport.region.center.y;C=M.state.viewport.region.span.x;k=M.state.viewport.region.span.y}else if(t.getInkLink().getType()===TAG.TourAuthoring.TrackType.image){C=1/M.state.viewport.region.span.x;var _=M.state.viewport.region.span.x*$("#rinplayer").width();k=M.state.viewport.region.span.y;T=-M.state.viewport.region.center.x*C;N=-($("#rinplayer").height()/_)*M.state.viewport.region.center.y}}v.css({display:"none"});m.css({display:"none"});g.css({display:"none"});w.css("display","none");b.css("display","none");y.show();var D=$("#resizableArea").offset().top;var H=$("#resizableArea").height();y.css({height:D+H-y.offset().top-10});Yr.text("Opacity: ");Zr.text("80%");Yr.append(Zr);ti.css("left",.8*(ei.offset().left+ei.width())/1.28+"px");Ur.off("click");Ur.on("click",function(){t.setIsVisible(true);l.onUpdate(true);l.setModifyingInk(false);l.setEditInkOn(false);l.hideEditorOverlay();ut.remove_all();ci();y.hide();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none")});ni.off("click");ni.on("click",function(){B();l.hideEditorOverlay();l.setModifyingInk(false);l.setEditInkOn(false)});o.saveTrans=B;ii(zr);var j=hi();var F=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",e);$("#inkCanv").css("background","rgba(0,0,0,0.01)");d=F;F.set_mode(TAG.TourAuthoring.InkMode.shapes);F.set_editable();F.setMarqueeFillOpacity(F.get_attr(n,"opac","f"));if(L){F.setInitKeyframeData(f);F.setArtName(h);i=$("#inkCanv").width();s=$("#inkCanv").height();F.retrieveOrigDims();F.setEID(t.getTitle())}var I=n.split("mode")[1].split("[")[0].replace("]","");F.setTransMode(r);F.load_transparency_bounding_shapes(n);if(I==="isolate"){Qr.css({color:"black"});Gr.css({color:"gray"});Kr="isolate";Jr.text("Isolate");F.setTransMode("isolate")}if(I==="block"){Qr.css({color:"gray"});Gr.css({color:"black"});Kr="block";Jr.text("Block");F.setTransMode("block")}if(L){var q=F.origPaperW/C;var R=q*S/x;var U=-T*q;var z=-N*q;F.update_datastring();F.setOldOpac(1);F.adjustViewBoxDiv({x:E.x,y:E.y,width:E.w,height:E.h})}ut=F;var W=ut.getMarqueeFillOpacity();Zr.text(Math.round(100*W)+"%");Yr.append(Zr);ti.css("left",W*(ei.offset().left+ei.width())/1.28+"px");l.onUpdate(true);l.showEditorOverlay()}function I(t,n,r){function _(){if(ut.isTextboxEmpty()){var e=TAG.Util.UI.PopUpConfirmation(function(){t.setIsVisible(true);var e=TAG.TourAuthoring.Command({execute:function(){l.removeTrack(t)},unexecute:function(){t.reloadTrack()}});p.logCommand(e);e.execute();b.hide();ci();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none")},"You have created an empty annotation. Would you like to delete annotation track or go back to editing?","Delete Track",true);u.append(e);$(e).show();return}if(g){var n=$("#inkCanv");var r=$("[data-proxy='"+escape(v)+"']");var i={x:r.data("x"),y:r.data("y"),w:r.data("w"),h:r.data("h")};var s=c.captureKeyframe(v);if(!s){P("The track this annotation is attached to must be fully on screen in order to save this annotation. Please seek to a location where the track is visible.");return false}var o,f,h,m,w=y.getType();if(w===TAG.TourAuthoring.TrackType.artwork){o=s.state.viewport.region.center.x;f=s.state.viewport.region.center.y;h=s.state.viewport.region.span.x;m=s.state.viewport.region.span.y}else if(w===TAG.TourAuthoring.TrackType.image){h=1/s.state.viewport.region.span.x;var E=s.state.viewport.region.span.x*n.width();m=s.state.viewport.region.span.y;o=-s.state.viewport.region.center.x*h;f=-(n.height()/E)*s.state.viewport.region.center.y}t.setInkInitKeyframe({x:o,y:f,w:h,h:m});t.setInkRelativeArtPos(ut.getArtRelativePos(i,n.width(),n.height()))}t.setInkPath(ut.update_datastring());ci();b.hide();t.setIsVisible(true);a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none");Kt.text("#FFFFFF");$("#textColorToggle").attr("value","FFFFFF");if(d){d.getInkUndoManager().clear();p.greyOutBtn()}l.onUpdate()}a.undoRedoInkOnly.css({display:"block"});var i,s,f,h,v,m,g=t.getInkEnabled(),y=t.getInkLink();if(g){f=t.getInkInitKeyframe();v=y.getTitle();var w=$("[data-proxy='"+escape(v)+"']");m={x:w.data("x"),y:w.data("y"),w:w.data("w"),h:w.data("h")};var S=c.captureKeyframe(v);if(!S){t.setIsVisible(true);P("The track this annotation is attached to must be fully on screen in order to edit this annotation. Please seek to a location where the track is visible.");return false}var T,N,C,k,L=y.getType();if(L===TAG.TourAuthoring.TrackType.artwork){T=S.state.viewport.region.center.x;N=S.state.viewport.region.center.y;C=S.state.viewport.region.span.x;k=S.state.viewport.region.span.y}else if(L===TAG.TourAuthoring.TrackType.image){C=1/S.state.viewport.region.span.x;var A=S.state.viewport.region.span.x*$("#rinplayer").width();k=S.state.viewport.region.span.y;T=-S.state.viewport.region.center.x*C;N=-($("#rinplayer").height()/A)*S.state.viewport.region.center.y}}li();b.show();var O=$("#resizableArea").offset().top;var M=$("#resizableArea").height();b.css({height:O+M-b.offset().top-10});vn.text("Font: ");mn.text("Times New Roman");vn.append(mn);An.css("left","0px");Cn.text("Text Size: ");ii(on);sn.off("click");sn.on("click",function(){t.setIsVisible(true);l.onUpdate(true);l.setModifyingInk(false);l.setEditInkOn(false);l.hideEditorOverlay();ut.resetText();ut.remove_all();ci();b.hide();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none")});On.off("click");On.on("click",function(){_();fn.val("");an.text("");l.hideEditorOverlay();l.setModifyingInk(false);l.setEditInkOn(false)});o.saveText=_;var D=hi();var H=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",e);$("#inkCanv").css("background","rgba(0,0,0,0.01)");d=H;i=$("#inkCanv").width();s=$("#inkCanv").height();H.set_mode(TAG.TourAuthoring.InkMode.text);H.set_editable();var B,j,I;B=H.get_attr(n,"fontsize","f")*s;H.setFontSize(B);E=Math.max(48,B);var q=H.get_attr(n,"str","s");fn.val(q);an.text(q);var R=r.fontsize/B;var U,z;try{U=H.get_attr(n,"w","f");U=g?U*R:U;z=H.get_attr(n,"h","f");z=g?z*R:z}catch(W){U=null;z=null}if(g){H.setInitKeyframeData(f);H.setArtName(v);H.retrieveOrigDims();H.setEID(t.getTitle());H.loadInk(n);H.adjustViewBoxDiv({x:m.x,y:m.y,width:m.w,height:m.h})}var X=H.getPannedPos().x||H.get_attr(n,"x","f")*i;var V=H.getPannedPos().y||H.get_attr(n,"y","f")*s;H.setFontFamily(H.get_attr(n,"font","s"));H.setFontColor(H.get_attr(n,"color","s"));H.add_text_box(X,V,U,z,q);var J=H.getSVGText();x=B;kn.text(Math.round(B)+"px");Cn.append(kn);var K=(B-8)/(E-8);Ln.attr("value",Math.round(B)+"px");var Q=H.get_attr(n,"color","s");xn.text(Q);F.fromString(Q);ut=H;pn();ri(on,fn);l.onUpdate(true);l.showEditorOverlay()}function et(){ci();li();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css({display:"none"})}function tt(){function c(e,t,n){var r=e[t];try{r.properties.getMusicPropertiesAsync().done(function(r){i.push(r.duration/1e3);if(t<e.length-1){c(e,t+1,n)}else{n&&n()}},function(e){console.log(e)})}catch(s){console.log(s.message);i.push(TAG.TourAuthoring.Constants.maxTourLength);if(t<e.length-1){c(e,t+1,n)}else{n&&n()}}}function h(e,t,n){var r=e[t];try{r.properties.getVideoPropertiesAsync().done(function(r){i.push(r.duration/1e3);if(t<e.length-1){h(e,t+1,n)}else{n&&n()}},function(e){console.log(e)})}catch(s){i.push(TAG.TourAuthoring.Constants.maxTourLength);if(t<e.length-1){h(e,t+1,n)}else{n&&n()}}}var e,t=[],n=$(this).text(),r=f.getCurrentPx(),i=[],s,o,a;A=true;if(n==="Audio (MP3)"){o=TAG.Authoring.FileUploader(u,TAG.Authoring.FileUploadTypes.Standard,function(n){var r;for(s=0;s<n.length;s++){r=n[s];t.push(r.displayName)}e=TAG.TourAuthoring.TrackType.audio;a=n},function(e){function n(){var n,o,u;for(s=0;s<e.length;s++){n=e[s];o=t[s];u=i[s];var a=l.addAudioTrack(n,o,null,u);var c=r;var h=u;if(f.getDuration().end<h+f.pxToTime(c)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,h+f.pxToTime(c)))}var d=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(c);var v=d<TAG.TourAuthoring.Constants.displayEpsilon?a.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):a.addDisplay(c,Math.min(d,h));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}p.combineLast(2*e.length);A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})}c(a,0,n)},[".mp3"],false,function(){u.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file. Please try again later."))},true);o.setMaxDuration(TAG.TourAuthoring.Constants.maxTourLength);o.setMinDuration(TAG.TourAuthoring.Constants.minMediaLength)}if(n==="Video (MP4, WEBM, OGV)"){o=TAG.Authoring.FileUploader(u,TAG.Authoring.FileUploadTypes.Standard,function(n,r,i,o){var u,f=n.length,l=0,c=[];for(s=0;s<n.length;s++){u=n[s];t.push(u.displayName)}i&&i();e=TAG.TourAuthoring.TrackType.video;a=n;return"uploading test!"},function(e){function n(){var n,o,u,c,h,d,v,m;for(s=0;s<e.length;s++){n=e[s];o=t[s];u=i[s];var g=e[s].slice(8,e[s].length);var y=g.lastIndexOf(".");var b=g.slice(y);var w=g.slice(0,y);TAG.Worktop.Database.convertVideo(function(){},null,g,b,w,null,"True");var c=l.addVideoTrack(n,o,null,u,true,false,true);var h=r;var d=u;if(f.getDuration().end<d+f.pxToTime(h)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,d+f.pxToTime(h)))}var v=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(h);if(d!==0&&a[s].fileType===".mp4"){var m=v<TAG.TourAuthoring.Constants.displayEpsilon?c.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):c.addDisplay(h,Math.min(v,d))}else{c.changeTrackColor("gray")}if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}p.combineLast(2*e.length);A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})}h(a,0,n)},[".mp4",".webm",".ogv",".avi",".mov",".wma"],false,function(){u.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},true);o.setMaxDuration(TAG.TourAuthoring.Constants.maxTourLength);o.setMinDuration(TAG.TourAuthoring.Constants.minMediaLength)}if(n==="Image"){TAG.Authoring.FileUploader(u,TAG.Authoring.FileUploadTypes.Standard,function(e){for(s=0;s<e.length;s++){t.push(e[s].displayName)}},function(e){for(s=0;s<e.length;s++){var n=l.addImageTrack(e[s],t[s].replace(/\'/,"").replace(/\"/,""));var i=Math.min(5,f.getDuration().end-f.pxToTime(r));var o=i<TAG.TourAuthoring.Constants.displayEpsilon?n.addDisplay(f.timeToPx(f.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(r,i);if(i<1.5&&i>=TAG.TourAuthoring.Constants.displayEpsilon){o.setIn(0);o.setOut(0);o.setMain(i)}if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}p.combineLast(2*e.length);A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})},[".jpg",".png",".gif",".tif",".tiff"],false,function(){u.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},true)}}function rt(t,n){var r=$(document.createElement("label"));if(t==="From File")r.addClass("clickable "+"files");else r.addClass("clickable "+t);r.text(t);r.css({left:"0%",position:"relative","font-size":"80%",color:"rgb(256, 256, 256)",display:"block",padding:"2% 0 2% 0","text-indent":"4%","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19});r.on("mouseenter",function(){var e=$(this);e.css({"background-color":"white",color:"black"});switch(e.text()){case"Artwork":case"Associated Media":nt.hide();Q.hide();break;case"From File":Q.show();nt.hide();break;case"Audio (MP3)":case"Video (MP4, WEBM, OGV)":case"Image":lt=true;break;case"Annotate":if(st){nt.show();Q.hide()}else{e.css({"background-color":"transparent",color:"gray"})}break;case"Write":case"Draw":case"Highlight":ct=true;break}});r.on("mouseleave",function(){var e=$(this);e.css({"background-color":"transparent",color:"white"});if(e.text()==="Annotate"&&!st){e.css({"background-color":"transparent",color:"gray"})}if(ht||pt||lt||ct){return}Q.hide();nt.hide()});r.on("mousedown",function(e){e.stopImmediatePropagation()});r.on("click",function(t){if(l.getEditInkOn()===true){var n=TAG.Util.UI.popUpMessage(null,"An annotation is already being edited.",null);$(n).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+2e6);$("#resizableArea").parent().parent().append(n);ft();$(n).fadeIn(500);return}t.stopImmediatePropagation();var i=$(this);for(var s=0;s<it.length;s++){if(i!==$(it[s])){$(it[s]).css({"background-color":"transparent",color:"white"})}}it[it.length]=this;switch(i.text()){case"Artwork":et();i.css({"background-color":"white",color:"black"});li();ci();ft();Lt();break;case"Associated Media":et();i.css({"background-color":"white",color:"black"});K.data("selected",false);li();ci();ft();Et();break;case"From File":i.css({"background-color":"white",color:"black"});Q.show();nt.hide();V.data("selected",false);ht=true;break;case"Audio (MP3)":case"Video (MP4, WEBM, OGV)":case"Image":ft();et();li();ci();lt=true;tt.call(r);break;case"Annotate":if(st){i.css({"background-color":"white",color:"black"});nt.show();Q.hide();$(V).data("selected",false);pt=true}break;case"Write":$(".undoButton").css({opacity:"0.4"});$(".redoButton").css({opacity:"0.4"});i.css({"background-color":"white",color:"black"});K.data("selected",false);a.undoRedoInkOnly.css({display:"block"});ft();li();m.show();var o=$("#resizableArea").offset().top+$("#resizableArea").height()-m.offset().top-10;m.css({height:o});si();var u=hi();var f=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",e);$("#inkCanv").css("background","rgba(0,0,0,0.01)");d=f;f.resetText();f.add_text_box();f.setFontColor("FFFFFF");f.setFontFamily("Times New Roman, serif");f.setFontSize("12");f.set_mode(TAG.TourAuthoring.InkMode.text);f.set_editable();ut=f;jt.val("");Bt.text("");Kt.text("#FFFFFF");$("#textColorToggle").attr("value","FFFFFF");S.fromString("FFFFFF");$(".changeColor")[0].innerHTML="#"+$("#textColorToggle").attr("value");ri(Pt,jt);l.setEditInkOn(true);break;case"Draw":$(".undoButton").css({opacity:"0.4"});$(".redoButton").css({opacity:"0.4"});i.css({"background-color":"white",color:"black"});a.undoRedoInkOnly.css({display:"block"});K.data("selected",false);ft();li();g.css({display:"block"});var c=$("#resizableArea").offset().top;var h=$("#resizableArea").height();g.css("height",c+h-g.offset().top-10);ui();Kn.text("#000000");S.fromString("000000");var u=hi();var f=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",e);$("#inkCanv").css("background","rgba(0,0,0,0.01)");d=f;f.set_mode(TAG.TourAuthoring.InkMode.draw);f.set_editable();f.updatePenWidth("brushSlider");f.updatePenColor("brushColorToggle");f.updatePenOpacity("opacitySlider");ut=f;l.setEditInkOn(true);break;case"Highlight":$(".undoButton").css({opacity:"0.4"});$(".redoButton").css({opacity:"0.4"});i.css({"background-color":"white",color:"black"});a.undoRedoInkOnly.css({display:"block"});K.data("selected",false);ft();li();v.show();var o=$("#resizableArea").offset().top+$("#resizableArea").height()-v.offset().top-10;v.css({height:o});oi();var u=hi();var f=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",e);$("#inkCanv").css("background","rgba(0,0,0,0.01)");d=f;f.set_mode(TAG.TourAuthoring.InkMode.shapes);f.set_editable();ut=f;l.setEditInkOn(true);break}var p=i.data("selected");if(p){i.css({"background-color":"transparent",color:"white"})}i.data("selected",!p);if(!st){K.css({"background-color":"transparent",color:"gray"})}});n.append(r);return r}function at(){st=false;K.css({"background-color":"transparent",color:"gray"});nt.hide();v.css({display:"none"});m.css({display:"none"});g.css({display:"none"});w.css({display:"none"});y.css("display","none");b.css("display","none");l.setEditInkOn(false);l.setModifyingInk(false);ci()}function ft(){ot=true;U.click()}function Et(){function d(e,t){if(t){var n;if(t.data("selected")){t.data("selected",false);t.css("background","#222");n=bt.indexOf(t.data("url"));yt.splice(n,1);bt.splice(n,1);wt[t.data("url")]=false;b.disabled=yt.length?false:true}else{t.data({selected:true});t.css("background","#999");yt.push({url:t.data("url"),name:t.data("name"),id:t.attr("id"),type:t.data("type"),duration:t.data("duration")});bt.push(t.data("url"));wt[t.data("url")]=true;b.disabled=false}}}function v(e,t){if(t){var n,r,i,s,o,u,a;t.css("background","#999");if(t.data("selected")!==true){yt.push({url:t.data("url"),name:t.data("name"),id:t.attr("id"),type:t.data("type"),duration:t.data("duration")});t.data({selected:true})}E();$(D).fadeOut();b.disabled=true;if(yt&&yt.length){for(n=0;n<yt.length;n++){r=yt[n];if(r.type==="Video"){i=l.addVideoTrack(r.url,r.name,null,r.duration);s=f.getCurrentPx();o=parseFloat(r.duration);if(f.getDuration().end<o+f.pxToTime(s)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,o+f.pxToTime(s)))}a=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(s);u=a<TAG.TourAuthoring.Constants.displayEpsilon?i.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):i.addDisplay(s,Math.min(a,o));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else if(r.type==="Image"){i=l.addImageTrack(r.url,r.name);s=f.getCurrentPx();o=5;var c=Math.min(o,f.getDuration().end-f.pxToTime(s));u=c<TAG.TourAuthoring.Constants.displayEpsilon?i.addDisplay(f.timeToPx(f.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):i.addDisplay(s,c);if(c<1.5&&c>=TAG.TourAuthoring.Constants.displayEpsilon){u.setIn(0);u.setOut(0);u.setMain(c)}if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else if(r.type==="Audio"){i=l.addAudioTrack(r.url,r.name,null,r.duration);s=f.getCurrentPx();o=parseFloat(r.duration);if(f.getDuration().end<o+f.pxToTime(s)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,o+f.pxToTime(s)))}a=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(s);u=a<TAG.TourAuthoring.Constants.displayEpsilon?i.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):i.addDisplay(s,Math.min(a,o));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else{console.log("Unrecognized file type imported!!!???")}}p.combineLast(2*yt.length)}}vt.val("");A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})}function m(e){e.click(function(t){var n=this;setTimeout(function(){var r=parseInt($(n).data("double"),10);if(r>0){$(n).data("double",r-1)}else{d.call(n,t,e)}},300)}).dblclick(function(t){$(this).data("double",2);v.call(this,t,e)})}function g(e){TAG.Worktop.Database.getAssocMediaTo(o[e],function(t){t.sort(function(e,t){return e.Name.toLowerCase()<t.Name.toLowerCase()?-1:1});var n=[];if(t){var r=0;var s;for(var u=0;u<t.length;u++){r++;s=t[u];var a=s.Metadata.ContentType==="Video"||s.Metadata.ContentType==="Audio";var f=s.Metadata.Duration<=TAG.TourAuthoring.Constants.maxTourLength&&s.Metadata.Duration>=TAG.TourAuthoring.Constants.minMediaLength;var l=f||s.Metadata.Duration===undefined;if(a&&l||s.Metadata.ContentType==="Image"){n.push(s)}if(r===t.length){i[o[e]]=n;if(n.length>0){var c=document.createDocumentFragment();St(i[o[e]],m,c);TAG.Worktop.Database.getDoq(o[e],function(e){var t;if(e.Name.length>15){var n=false;var r=Math.min(e.Name.length,25);for(var i=14;i<r;i++){if(e.Name[i]===" "&&!n){t=e.Name.substr(0,i)+"...";n=true}else if(e.Name[i]==="-"&&i!==r-1&&!n){if(e.Name[i+1]===" "){t=e.Name.substr(0,i)+"...";n=true}}}if(!n){t=e.Name.substr(0,25)+"..."}}else{t=e.Name}var s=document.createElement("div");$(s).addClass("artworkHolder");$(s).attr("id",e.Identifier);$(s).css({width:"100%",height:"9%",margin:"1px 0px 1px 0px","font-size":"70%","padding-left":"3%","padding-top":"3%"});$(s).text(t);$(mt).append(s);y($(s))})}}}}})}function y(e){e.off("click");e.on("click",function(){N.clear();$(".allAssociatedMediaHolder").css("background","black");$(".artworkHolder").css("background","black");e.css("background","#999");var t=e.attr("id");$(".mediaHolder").detach();var n=document.createDocumentFragment();St(i[t],m,n);b.disabled=yt.length?false:true;TAG.Util.searchData(vt.val(),".mediaHolder",k)})}function E(){$(".mediaHolder").detach();$(".artworkHolder").detach();$(".allAssociatedMediaHolder").detach();$("#associatedLoadingLabel").detach()}yt=[];bt=[];wt={};A=true;$(D).fadeIn();N.clear();var e=$(document.createElement("div"));e.css({display:"inline-block",position:"absolute",left:"3%",bottom:"2%"});e.text("Loading...");e.attr("id","associatedLoadingLabel");var t=$(document.createElement("img"));t.attr("src",tagPath+"images/icons/progress-circle.gif");t.css({height:"12px",width:"auto","margin-left":"20px","float":"right"});e.append(t);s.append(e);var n=l.getRelatedArtworks();var r=document.createElement("div");$(r).addClass("allAssociatedMediaHolder");$(r).css({width:"100%",height:"9%",margin:"1px 0px 1px 0px",background:"#999","padding-left":"3%","padding-top":"3%","font-size":"70%"});$(r).text("All Associated Media");$(mt).append(r);var i={};var o=[];var u;for(var a=0;a<n.length;a++){u=true;for(var c=0;c<a;c++){if(n[c]===n[a]){u=false;break}}if(u){o.push(n[a])}}for(var h=0;h<o.length;h++){g(h)}e.hide();$(r).click(function(){$(".artworkHolder").css("background","black");$(r).css("background","#999");$(".mediaHolder").detach();for(var e=0;e<n.length;e++){var t=document.createDocumentFragment();St(i[o[e]],m,t)}b.disabled=yt.length?false:true;TAG.Util.searchData(vt.val(),".mediaHolder",k)});var b=document.createElement("button");b.disabled=true;$(b).text("Import");$(b).css({position:"absolute",bottom:"1%",right:"22%"}).css("border-radius","3.5px");$(b).click(function(){var e,t,n,r,i,s,o,u;E();$(D).fadeOut();b.disabled=true;if(yt&&yt.length){for(t=0;t<yt.length;t++){e=yt[t];if(e.type==="Video"){n=l.addVideoTrack(e.url,e.name,null,e.duration);r=f.getCurrentPx();o=parseFloat(e.duration);if(f.getDuration().end<o+f.pxToTime(r)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,o+f.pxToTime(r)))}u=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(r);i=u<TAG.TourAuthoring.Constants.displayEpsilon?n.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(r,Math.min(u,o));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else if(e.type==="Image"){n=l.addImageTrack(e.url,e.name);r=f.getCurrentPx();o=5;s=Math.min(o,f.getDuration().end-f.pxToTime(r));i=s<TAG.TourAuthoring.Constants.displayEpsilon?n.addDisplay(f.timeToPx(f.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(r,s);if(s<1.5&&s>=TAG.TourAuthoring.Constants.displayEpsilon){i.setIn(0);i.setOut(0);i.setMain(s)}if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else if(e.type==="Audio"){n=l.addAudioTrack(e.url,e.name,null,e.duration);r=f.getCurrentPx();o=parseFloat(e.duration);if(f.getDuration().end<o+f.pxToTime(r)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,o+f.pxToTime(r)))}u=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(r);i=u<TAG.TourAuthoring.Constants.displayEpsilon?n.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(r,Math.min(u,o));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else{console.log("Unrecognized file type imported!!!???")}}p.combineLast(2*yt.length)}vt.val("");A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})});s.append(b);var w=document.createElement("button");$(w).text("Cancel");$(w).css({position:"absolute",bottom:"1%",right:"5%"}).css("border-radius","3.5px");$(w).click(function(){E();$(D).fadeOut();b.disabled=true;vt.val("");return undefined});s.append(w)}function St(e,t,n){if(e){for(var r=0;r<e.length;r++){N.add(xt(e[r],t))}}}function xt(e,t){return function(){var n=$(document.createElement("div"));n.addClass("mediaHolder");n.attr("id",e.Identifier);n.data("type",e.Metadata.ContentType);n.data("url",e.Metadata.Source);n.data("name",e.Name);n.data("duration",e.Metadata.Duration);n.data("description",e.Metadata.Description);var r=wt[e.Metadata.Source]?true:false;n.data("selected",r);n.css({"float":"left",background:r?"#999":"#222",width:"48%",height:"25%",padding:"2px",margin:"1px"});$(gt).append(n);var i=$(document.createElement("div"));i.addClass("mediaHolderImageHolder");i.css({"float":"left",width:"40%",margin:"3.5%",height:"80%",overflow:"hidden"});n.append(i);var s=$(document.createElement("img"));s.addClass("mediaHolderImage");if(e.Metadata.ContentType==="Audio"){s.attr("src",tagPath+"images/audio_icon.svg")}else if(e.Metadata.ContentType==="Video"){s.attr("src",e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):tagPath+"images/video_icon.svg")}else if(e.Metadata.ContentType==="Image"){s.attr("src",e.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):tagPath+"images/image_icon.svg")}else{s.attr("src",tagPath+"images/text_icon.svg")}s.css({"float":"left",height:"100%","max-height":"100%","text-align":"center"});s.removeAttr("width");i.append(s);var o=$(document.createElement("div"));o.addClass("mediaHolderText");var u;var u=e.Name;if(u.length>15){var a=false;var f=Math.min(u.length,24);for(var l=14;l<f;l++){if(u[l]===" "&&!a){u=u.substr(0,l)+"...";a=true}else if(u[l]==="-"&&l!==f-1&&!a){if(u[l+1]===" "){u=u.substr(0,l)+"...";a=true}}}if(!a){u=u.substr(0,16)+"..."}}o.text(u);o.css({floar:"left","padding-left":"3%","padding-right":"4.5%","font-size":"70%",margin:"5% 0 5% 2%",overflow:"hidden","word-wrap":"break-word"});n.append(o);t(n)}}function Lt(){function s(t){M=false;var r;for(r=0;r<t.length;r++){if(t[r].Type==="Empty"){t.splice(r,1);r--}}t.sort(function(e,t){return e.Name.toLowerCase()<t.Name.toLowerCase()?-1:1});$.each(t,function(t,n){T.add(function(){var t=document.createElement("div");var r=[];var i="";if(e)$(t).hide().data("visible",false);for(var s=0;s<n._Folders.FolderData.length;s++){r.push(n._Folders.FolderData[s]);if(e===n._Folders.FolderData[s].FolderId)$(t).show().data("visible",true);i+=n._Folders.FolderData[s].FolderId+" "}$(t).attr("class","artButton "+i);$(t).data({name:n.Name,artist:n.Metadata.Artist,year:n.Metadata.Year});$(t).data("exhibits",r);$(t).addClass("artHolder");$(t).attr("id",n.Identifier);$(t).data("name",n.Name);$(t).data("type",n.Metadata.Type);$(t).data("description",n.Metadata.Description);if(n.Metadata.InfoFields){$.each(n.Metadata.InfoFields,function(e,n){$(t).data(e,n)})}if(n.Metadata.Duration){$(t).data("duration",n.Metadata.Duration);$(t).data("url",n.Metadata.Source)}else{$(t).data("url",n.Metadata.DeepZoom)}$(t).css({"float":"left",background:"#222",width:"48%",height:"25%",padding:"2px",margin:"1px"});$(kt).append(t);TAG.Util.searchData(Nt.val(),".artButton",k);var o=document.createElement("div");$(o).addClass("artHolderImageHolder");$(o).css({"float":"left",position:"relative",width:"40%",margin:"3.5%",height:"80%",overflow:"hidden"});$(t).append(o);var u=document.createElement("img");$(u).addClass("artHolderImage");$(u).attr("src",TAG.Worktop.Database.fixPath(n.Metadata.Thumbnail));$(u).css({"max-height":"100%",position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto",display:"block","max-width":"100%",width:"auto"});$(o).append(u);var f=document.createElement("div");$(f).addClass("artHolderText");var l=n.Name;if(l.length>23){var c=false;var h=Math.min(l.length,35);for(var p=20;p<h;p++){if(l[p]===" "&&!c){l=l.substr(0,p)+"...";c=true}else if(l[p]==="-"&&p!==h-1&&!c){if(l[p+1]===" "){l=l.substr(0,p)+"...";c=true}}}if(!c){l=l.substr(0,24)+"..."}}$(f).text(l);$(f).css({floar:"left","padding-left":"3%","padding-right":"4.5%","font-size":"70%",margin:"5% 0 5% 2%",overflow:"hidden","word-wrap":"break-word"});$(t).append(f);a($(t))})});T.add(function(){n.hide();M=true})}function o(e,t){var n,r;if(t.data("selected")){t.css("background","#222");t.data("selected",false);r=bt.indexOf(t.data("url"));yt.splice(r,1);bt.splice(r,1);wt[t.data("url")]=false;c.disabled=yt.length?false:true}else{t.css("background","#999");t.data({selected:true});if(bt.indexOf(t.data("url"))===-1){yt.push({url:t.data("url"),name:t.data("name"),id:t.attr("id"),type:t.data("type"),duration:t.data("duration")});bt.push(t.data("url"));wt[t.data("url")]=true}c.disabled=false}}function u(e,t){var n,r;c.disabled=false;t.css("background","#999");if(!wt[t.data("url")]&&t.data("selected")!==true){yt.push({url:t.data("url"),name:t.data("name"),id:t.attr("id"),type:t.data("type"),duration:t.data("duration")});wt[t.data("url")]=true;t.data({selected:true})}$(_).fadeOut();Ot();Nt.val("");for(n=0;n<yt.length;n++){r=yt[n];var i;if(r.type==="VideoArtwork"){i=l.addVideoTrack(r.url,r.name,null,r.duration);var s=f.getCurrentPx();var o=parseFloat(r.duration);if(f.getDuration().end<o+f.pxToTime(s)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,o+f.pxToTime(s)))}var u=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(s);var a=u<TAG.TourAuthoring.Constants.displayEpsilon?i.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):i.addDisplay(s,Math.min(u,o));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else{i=l.addArtworkTrack(r.url,r.name,r.id,r.type);var s=f.getCurrentPx();var o=5;var h=Math.min(o,f.getDuration().end-f.pxToTime(s));var a=h<TAG.TourAuthoring.Constants.displayEpsilon?i.addDisplay(f.timeToPx(f.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):i.addDisplay(s,h);if(h<1.5&&h>=TAG.TourAuthoring.Constants.displayEpsilon){a.setIn(0);a.setOut(0);a.setMain(h)}if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}}p.combineLast(2*yt.length);A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})}function a(e){e.click(function(t){var n=this;setTimeout(function(){var r=parseInt($(n).data("double"),10);if(r>0){$(n).data("double",r-1)}else{o.call(n,t,e)}},300)}).dblclick(function(t){$(this).data("double",2);u.call(this,t,e)})}yt=[];wt={};bt=[];A=true;var e;T.clear();var t=document.createElement("div");$(t).addClass("allArtworksHolder");$(t).css({width:"100%",height:"9%",margin:"1px 0px 1px 0px",background:"#999","padding-left":"3%","padding-top":"3%","font-size":"70%"});$(t).text("All Artworks");$(Ct).append(t);var n=$(document.createElement("div"));n.css({display:"inline-block",position:"absolute",left:"3%",bottom:"2%"});n.text("Loading...");n.attr("id","loadingLabel");var r=$(document.createElement("img"));r.attr("src",tagPath+"images/icons/progress-circle.gif");r.css({height:"12px",width:"auto","margin-left":"20px","float":"right"});n.append(r);TAG.Worktop.Database.getExhibitions(function(t){function l(t){t.click(function(){if(!M)return;$(".allArtworksHolder").css("background","black");$(".exhibHolder").css("background","black");t.css("background","#999");var n=t.attr("id");e=n;$(".catalogPickerArtworks").empty();c.disabled=yt.length?false:true;$(".artButton").hide().data("visible",false);$("."+n).show().data("visible",true);TAG.Util.searchData(Nt.val(),".artButton",k);TAG.Worktop.Database.getArtworksIn(t.attr("id"),s,function(){console.log("error")},function(){console.log("error2")})})}for(var n=0;n<t.length;n++){var r=t[n].Name;var i;if(r.length>15){var o=false;var u=Math.min(r.length,25);for(var a=14;a<u;a++){if(r[a]===" "&&!o){i=r.substr(0,a)+"...";o=true}else if(r[a]==="-"&&a!==u-1&&!o){if(r[a+1]===" "){i=r.substr(0,a)+"...";o=true}}}if(!o){i=r.substr(0,25)+"..."}}else{i=t[n].Name}var f=$(document.createElement("div"));f.addClass("exhibHolder");f.attr("id",t[n].Identifier);f.css({width:"100%",height:"9%","text-overflow":"ellipsis",margin:"1px 0px 1px 0px","font-size":"70%","padding-left":"3%","padding-top":"3%"});f.text(i);$(Ct).append(f);l(f)}TAG.Worktop.Database.getArtworks(s,function(){console.log("error")},function(){console.log("error2")})});$(t).on("click",function(){$(".exhibHolder").css("background","black");$(this).css("background","#999");c.disabled=yt.length?false:true;$(".catalogPickerArtworks").empty();$(".artButton").show().data("visible",true);TAG.Util.searchData(Nt.val(),".artButton",k);e=null;if(O){s(O)}else{TAG.Worktop.Database.getArtworks(s,function(){console.log("error")},function(){console.log("error2")})}});$(_).fadeIn();i.append(n);var c=document.createElement("button");c.disabled=true;$(c).text("Import");$(c).css({position:"absolute",bottom:"2%",right:"22%"}).css("border-radius","3.5px");$(c).click(function(){function t(e){var t=yt[e];var n;var r=f.getCurrentPx();var i;if(t.type==="VideoArtwork"){n=l.addVideoTrack(t.url,t.name,null,t.duration);i=parseFloat(t.duration);if(f.getDuration().end<i+f.pxToTime(r)){f.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,i+f.pxToTime(r)))}var s=TAG.TourAuthoring.Constants.maxTourLength-f.pxToTime(r);var o=s<TAG.TourAuthoring.Constants.displayEpsilon?n.addDisplay(f.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(r,Math.min(s,i));if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}else{n=l.addArtworkTrack(t.url,t.name,t.id);i=5;var u=Math.min(i,f.getDuration().end-f.pxToTime(r));var o=u<TAG.TourAuthoring.Constants.displayEpsilon?n.addDisplay(f.timeToPx(f.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(r,u);if(u<1.5&&u>=TAG.TourAuthoring.Constants.displayEpsilon){o.setIn(0);o.setOut(0);o.setMain(u)}if(l.getTracks().length>0){l.getTracks()[0].leftAndRight({translation:{x:0}},false)}}}var e;c.disabled=true;$(c).css({color:"rgba(255,255,255,0.5)"});$(h).css({color:"rgba(255,255,255,0.5)"}).attr("disabled",true);if(yt&&yt.length){T.clear();n.text("Importing...");n.show();$(c).hide();$(h).hide();for(e=0;e<yt.length;e++){t(e)}p.combineLast(2*yt.length);$(K).css({"background-color":"transparent",color:"white"});st=true;Ot();$(_).fadeOut()}else{Ot();$(_).fadeOut()}Nt.val("");A=false;l.getDataHolder().mapTracks(function(e,t){e.track.updatePos(t)})});i.append(c);var h=document.createElement("button");$(h).text("Cancel");$(h).css({position:"absolute",bottom:"2%",right:"5%"}).css("border-radius","3.5px");$(h).click(function(){$(_).fadeOut();Ot();c.disabled=true;$(c).css({color:"rgba(255,255,255,0.5)"});$(h).css({color:"rgba(255,255,255,0.5)"}).attr("disabled",true);Nt.val("");return undefined});i.append(h)}function At(e,t){if(t===C)t="";return e.toLowerCase().indexOf(t.toLowerCase())!==-1}function Ot(){$(".artHolder").detach();$(".exhibHolder").detach();$(".allArtworksHolder").detach();$("#loadingLabel").detach();T.clear()}function Ft(){var e=ut.getSVGText();Bt.text(jt.val());e.attr("text",jt.val());e.data("str",jt.val())}function qt(e){return function(){var t=jt.val();var n=It;if(t===It||e.which===17){return}var r=ut.getInkUndoManager();var i=TAG.TourAuthoring.Command({execute:function(){jt.val(t);Ft()},unexecute:function(){jt.val(n);Ft()}});r.logCommand(i);It=jt.val()}}function cn(){ln=ut.getSVGText();an.text(fn.val());ut.remove_all();ut.add_text_box(ln.attrs.x,ln.attrs.y,-1,-1,fn.val(),true);ln=ut.getSVGText();ln.data("str",fn.val())}function pn(){ln=ut.getSVGText();an.text(fn.val());ut.remove_all();hn=fn.val();switch(ln.attr("font-family")){case"'Courier New', Courier, monospace":En.prop("selected",true);ut.setFontFamily("'Courier New', Courier, monospace");mn.text("Courier");break;case"Verdana, Geneva, sans-serif":wn.prop("selected",true);ut.setFontFamily("Verdana, Geneva, sans-serif");mn.text("Verdana");break;case"Georgia, serif":bn.prop("selected",true);ut.setFontFamily("Georgia, serif");mn.text("Georgia");break;case"Times New Roman, serif":yn.prop("selected",true);ut.setFontFamily("Times New Roman, serif");mn.text("Times New Roman");break;default:break}ut.add_text_box(ln.attrs.x,ln.attrs.y,-1,-1,fn.val(),true);ln=ut.getSVGText();ln.data("str",fn.val())}function dn(e){return function(){var t=fn.val();var n=hn;if(t===hn||e.which===17){return}var r=ut.getInkUndoManager();var i=TAG.TourAuthoring.Command({execute:function(){fn.val(t);cn()},unexecute:function(){fn.val(n);cn()}});r.logCommand(i);hn=t}}function ri(e,t){if(e===Pt||e===Dn||e===kr||e===on||e===sr||e===zr){$.each(e,function(){if(this===t&&$(t).css("display")==="block"){$(".thicknessLabel").css({"font-weight":"normal"});this.css("display","none")}else{if(this===t){this.css("display","block")}else{this.css("display","none")}}})}else{$.each(e,function(){if(this===t)this.css("display","block");else this.css("display","none")})}}function ii(e){$.each(e,function(){this.css("display","none")})}function si(){Rt.text("Font: ");Ut.text("Times New Roman");Rt.append(Ut);tn.css("left","10%");Wt.attr("selected","selected");Yt.text("Text Size: ");Zt.text("12px");Yt.append(Zt);ii(Pt)}function oi(){Br.text("Opacity: ");jr.text("80%");Br.append(jr);Ir.css("left",.8*(Fr.offset().left+Fr.width())/1.28+"px");Pr.css({color:"black"});Hr.css({color:"gray"});Dr="isolate";_r.text("Isolate");ii(kr)}function ui(){Wn.text("Width: ");Xn.text("7px");Wn.append(Xn);$n.css("left","0px");Fn.css({color:"black"});zn.css({color:"gray"});jn="draw";Bn.text("Draw");Yn.text("Opacity: ");Zn.text("100%");Yn.append(Zn);tr.css("left",.87*er.width()+"px");ii(Dn)}function ai(){nt.hide();Q.hide();W.hide();z.hide();ot=false}function fi(e,t,n){var r=false;var i=false;if(t&&t!==0)r=true;if(n)i=true;var s=$(document.createElement("div"));s.css("display","block");s.css("margin-top","2%");var o=$(document.createElement("button")).addClass("linkButton").css("border-radius","3.5px");o.css({"padding-left":"4px","padding-right":"4px",color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"5%",clear:"left"});o.get(0).innerHTML="Attach to Selected";o.on("click",function(){$n.attr("value",7);ut.updatePenWidth("brushSlider");Kn.text("#000000");S=new jscolor.color(Gn,{});S.fromString("000000");S.onImmediateChange=function(){ut.updatePenColor("brushColorToggle");ut.set_mode(TAG.TourAuthoring.InkMode.draw);$(".changeColor1")[0].innerHTML="#"+$("#brushColorToggle").attr("value")};var t=true;r=false;if(r)t=ut.link_text();else if(i)t=ut.link_trans();else t=ut.link();if(!t)return;e.hide();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none");if(d){d.getInkUndoManager().clear();p.greyOutBtn()}l.setModifyingInk(false);l.setEditInkOn(false)});s.append(o);var u=$(document.createElement("button")).addClass("freeInkButton").css("border-radius","3.5px");u.css({"padding-left":"4px","padding-right":"4px",color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"5%"});u.get(0).innerHTML="Create as Unattached";u.on("click",function(){$n.attr("value",7);ut.updatePenWidth("brushSlider");var t=true;if(r)t=ut.link_text_unattached();else if(i)t=ut.link_trans_unattached();else t=ut.linkUnattached();if(!t){return}e.hide();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css("display","none");if(d){d.getInkUndoManager().clear();p.greyOutBtn()}l.setModifyingInk(false);l.setEditInkOn(false)});s.append(u);return s}function li(){v.css({display:"none"});m.css({display:"none"});g.css({display:"none"});w.css({display:"none"});y.css("display","none");b.css("display","none")}function ci(){if($("#inkCanv").length)$("#inkCanv").remove();$("#rinplayer").css({})}function hi(){ci();var e=document.createElement("div");e.setAttribute("id","inkCanv");e.setAttribute("class","inkCanv");$("#rinplayer").css({position:"absolute"});var t=l.getTrackslength();e.setAttribute("style","overflow:hidden; position:absolute; width:100%; height:100%; background:transparent; pointer-events: all; z-index:"+(20100+t)+";");var n=$("#rinContainer");$("#rinplayer").before(e);return e}var h=false;u.on("keydown",r);var E=48;var x;var L=null;o.showEditDraw=H;o.getInkUndoManager=B;o.showEditTransparency=j;var F=null;o.showEditText=I;n.attr("id","component-controls");n.css({"background-color":"rgb(219,218,199)",height:"48px",width:"20%",top:"15px",left:"0%",position:"relative","float":"left"});var q=$(document.createElement("img"));q.attr("id","addDropDownIconComponent");q.attr("src",tagPath+"images/icons/Down.png");q.css({width:"10%",height:"10%",display:"inline-block","float":"right","margin-top":"3%","margin-right":"3%"});var R="13%";var U=$(document.createElement("label"));U.text("Add Track");U.attr("id","addComponentLabel");U.css({left:R,top:"5%",position:"relative","font-size":"70%",color:"rgb(256, 256, 256)","background-color":"rgb(63, 55, 53)",padding:"3% 1% 4% 3%",width:"70%","float":"left"});U.append(q);n.append(U);var z=$(document.createElement("div"));z.css({width:"100%",height:"100%",position:"fixed",top:"0px",left:"0px","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+18});z.attr("class","fade");n.append(z);z.hide();z.on("mousedown",function(e){z.hide();ot=false;q.css({transform:"scaleY(1)","margin-bottom":"2%"});nt.hide();Q.hide();W.hide()});var W=$(document.createElement("div"));W.css({left:R,position:"relative",color:"rgb(256, 256, 256)",width:"74%","background-color":"rgba(0,0,0,0.95)","float":"left",clear:"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19});n.append(W);W.hide();var X=rt("Artwork",W);var V=rt("Associated Media",W);var J=rt("From File",W);var K=rt("Annotate",W);var Q=$(document.createElement("div"));Q.css({left:"87%","margin-top":"-33%",position:"relative",color:"rgb(256, 256, 256)",width:"74%","background-color":"rgba(0,0,0,0.95)","float":"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19});n.append(Q);Q.hide();var G=rt("Audio (MP3)",Q);var Y=rt("Video (MP4, WEBM, OGV)",Q);var Z=rt("Image",Q);var nt=$(document.createElement("div"));nt.css({left:"87%","margin-top":"-16.5%",position:"relative",color:"rgb(256, 256, 256)",width:"74%","background-color":"rgba(0,0,0,0.95)","float":"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19});n.append(nt);nt.hide();rt("Write",nt);rt("Draw",nt);rt("Highlight",nt);var it=[];var st=false;var ot=false;var ut;o.disableInk=at;U.on("mousedown",function(e){e.stopImmediatePropagation()});U.click(function(e){if(l.getEditInkOn()===true){return}var t,n,r=l.getCloseMenu();if(r&&r!==ft){r()}e.stopImmediatePropagation();ot=!ot;nt.hide();Q.hide();if(ot){W.show();u.on("mousedown.componentMenu",ft);l.setisMenuOpen(true);l.setCloseMenu(ft);f.stop();q.css({transform:"scaleY(-1)","margin-bottom":"2%"});$(".thicknessLabel").css({"font-weight":"normal"});for(t=0;t<it.length;t++){n=$(it[t]);n.css({"background-color":"transparent",color:"white"});n.data("selected",false)}if(!l.checkForArtworks(0)){st=false;K.css({"background-color":"transparent",color:"gray"})}else{st=true;K.css({"background-color":"transparent",color:"white"})}}else{W.hide();u.off("mousedown.componentMenu");l.setCloseMenu(null);l.setisMenuOpen(false);q.css({transform:"scaleY(1)","margin-bottom":"0%"})}});var lt=false;var ct=false;var ht=true;var pt=true;s.addClass("associatedMediaPicker");s.css({position:"absolute",width:"49%",height:"49%",padding:"1%","background-color":"black",border:"3px double white",top:"25%",left:"25%"});$(D).append(s);var dt=document.createElement("div");$(dt).addClass("associatedMediaPickerInfo");$(dt).text("Select media to import");$(dt).css({"font-size":"100%"});var vt=$(document.createElement("input"));vt.attr("type","text");$(vt).css({"float":"right","margin-right":"3%","margin-top":"0.75%",width:"38%","background-image":'url("'+tagPath+'/images/icons/Lens.svg")',"background-size":"auto 50%","background-repeat":"no-repeat","background-position":"8px center"});$(vt).on("focus",function(){$(vt).css({"background-image":""})});$(vt).on("focusout blur",function(){if(!vt.val()){$(vt).css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})}});$(vt).on("keyup",function(e){if(!M)return;e.stopPropagation()});vt.val("");vt.keyup(function(){if(!M)return;TAG.Util.searchData(vt.val(),".mediaHolder",k)});$(dt).append(vt);s.append(dt);var mt=document.createElement("div");$(mt).addClass("associatedMediaPickerArtwork");$(mt).css({position:"absolute","border-right":"1px solid white",top:"15%",padding:"1%",height:"72%",width:"28%",overflow:"auto"});s.append(mt);var gt=document.createElement("div");$(gt).addClass("associatedMediaPickerMedia");$(gt).css({position:"absolute",left:"33%",top:"15%",padding:"1%",height:"72%",width:"62%",overflow:"auto"});s.append(gt);var yt=[];var bt=[];var wt={};i.addClass("catalogPicker");i.css({position:"absolute",width:"49%",height:"49%",padding:"1%","background-color":"black",border:"3px double white",top:"25%",left:"25%"});$(_).append(i);var Tt=document.createElement("div");$(Tt).addClass("catalogPickerInfo");$(Tt).text("Select artwork to import");$(Tt).css({"font-size":"100%%","float":"left"});i.append(Tt);var Nt=$(document.createElement("input"));Nt.attr("type","text");$(Nt).css({"float":"right","margin-right":"3%","margin-top":"0.75%",width:"38%","background-image":'url("'+tagPath+'/images/icons/Lens.svg")',"background-size":"auto 50%","background-repeat":"no-repeat","background-position":"8px center"});$(Nt).on("focus",function(){$(Nt).css({"background-image":""})});$(Nt).on("focusout blur",function(){if(!Nt.val()){$(Nt).css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})}});$(Nt).on("keyup",function(e){e.stopPropagation()});Nt.keyup(function(){if(!M)return;TAG.Util.searchData(Nt.val(),".artButton",k)});Nt.change(function(){if(!M)return;TAG.Util.searchData(Nt.val(),".artButton",k)});i.append(Nt);var Ct=document.createElement("div");$(Ct).addClass("catalogPickerExhibitions");$(Ct).css({position:"absolute","border-right":"1px solid white",top:"13%",padding:"1%",height:"73%",width:"28%",overflow:"auto"});i.append(Ct);var kt=document.createElement("div");$(kt).addClass("catalogPickerArtworks");$(kt).css({position:"absolute",left:"33%",top:"13%",padding:"1%",height:"73%",width:"62%",overflow:"auto"});i.append(kt);var Mt=0;var _t=document.createDocumentFragment();m=$(document.createElement("div"));m.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-x":"none","overflow-y":"auto","margin-top":"8%",display:"none"});m.attr("id","inkTextControls");_t.appendChild(m[0]);m.css({display:"none"});var Dt=$(document.createElement("button"));Dt.css({"font-size":"70%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%","padding-left":"4px","padding-right":"4px"}).css("border-radius","3.5px");Dt.get(0).innerHTML="Cancel";Dt.click(function(){ci();m.hide();l.setModifyingInk(false);l.setEditInkOn(false);d.getInkUndoManager().clear();p.greyOutBtn();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css({display:"none"})});m.append(Dt);var Pt=[];var Ht=$(document.createElement("div"));Ht.addClass("thicknessLabel");var Bt=$(document.createElement("div"));Ht.text("Text:");Ht.append(Bt);m.append(Ht);Bt.css({position:"relative",top:"2px",width:"65%",color:"green",display:"inline-block","margin-left":"2%","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap","margin-bottom":"0"});Ht.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%",display:"inline-block","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var jt=$(document.createElement("textarea"));jt.css({width:"72%","min-width":"0px","margin-left":"8%","margin-top":"2%","overflow-x":"hidden",position:"relative"});Pt.push(jt);jt.attr("id","writeAnnotation");$("#writeAnnotation").autoSize({onResize:function(){$(this).css({opacity:"0.8"})},animateCallback:function(){$(this).css({opacity:"1"})},animateDuration:300,extraSpace:40});m.append(jt);var It="";jt.on("keyup",function(e){var t=e.keyCode;if(t===32){e.stopPropagation()}var n=$.debounce(500,false,qt(e));if(t!==37&&t!==38&&t!==39&&t!==40&&e.keyCode!==90&&!e.ctrlKey&&e.keyCode!==89){n()}Ft()});Ht.click(function(){$(".thicknessLabel").css({"font-weight":"normal"});Ht.css({"font-weight":"bold"});ri(Pt,jt)});var Rt=$(document.createElement("div"));Rt.addClass("thicknessLabel");var Ut=$(document.createElement("div"));Rt.text("Font:");Ut.text("Times New Roman");Rt.append(Ut);m.append(Rt);Ut.css({color:"green",display:"inline","padding-left":"2%"});Rt.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var zt=$(document.createElement("select"));zt.addClass("fontSelector");zt.css({color:"white","float":"left",clear:"both",display:"none",border:"solid 3px rgba(255,255,255,1)",width:"72%","margin-left":"8%","margin-top":"2%","background-color":"rgba(0,0,0,0.5)"});Pt.push(zt);m.append(zt);var Wt=$(document.createElement("option"));Wt.text("Times New Roman").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});Wt.on("click",function(){ut.setFontFamily("Times New Roman, serif");Ut.text("Times New Roman")});var Xt=$(document.createElement("option"));Xt.text("Georgia").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});Xt.on("click",function(){ut.setFontFamily("Georgia, serif");Ut.text("Georgia")});var Vt=$(document.createElement("option"));Vt.text("Verdana").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});Vt.on("click",function(){ut.setFontFamily("Verdana, Geneva, sans-serif");Ut.text("Verdana")});var $t=$(document.createElement("option"));$t.text("Courier").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});$t.on("click",function(){ut.setFontFamily("'Courier New', Courier, monospace");Ut.text("Courier")});zt.append(Wt);zt.append(Xt);zt.append(Vt);zt.append($t);Rt.click(function(){$(".thicknessLabel").css({"font-weight":"normal"});Rt.css({"font-weight":"bold"});ri(Pt,zt)});var Jt=$(document.createElement("div"));Jt.addClass("thicknessLabel");var Kt=$(document.createElement("div"));Kt.addClass("changeColor");Jt.text("Color: ");Kt.text("#FFFFFF");Jt.append(Kt);m.append(Jt);Jt.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});Kt.css({"font-size":"0.8em",color:"green",display:"inline","padding-left":"2%"});var Qt=$(document.createElement("div"));Qt.attr("id","colorTextDiv");Qt.css("display","none");m.append(Qt);Pt.push(Qt);Jt.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Jt.css({"font-weight":"bold"});ri(Pt,Qt)});var Gt=document.createElement("input");$(Gt).attr("id","textColorToggle");$(Gt).attr("readonly","readonly");$(Gt).css({"margin-left":"8%","margin-top":"3%",clear:"left",width:"40%"});$(Gt).on("keyup",function(e){e.stopPropagation()});if(Gt.addEventListener){Gt.addEventListener("DOMNodeInserted",function(){S=new jscolor.color(Gt,{});S.fromString("FFFFFF");S.onImmediateChange=function(){ut.setFontColor("#"+$("#textColorToggle").attr("value"));$(".changeColor")[0].innerHTML="#"+$("#textColorToggle").attr("value")}},false)}Qt.append(Gt);var Yt=$(document.createElement("div"));Yt.addClass("thicknessLabel");var Zt=$(document.createElement("div"));Yt.text("Text Size: ");Zt.text("12px");Yt.append(Zt);m.append(Yt);Zt.css({color:"green",display:"inline","padding-left":"2%"});Yt.css({"font-size":"70%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var en=$(document.createElement("div"));en.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative","float":"left"});var tn=$(document.createElement("div"));tn.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%",left:"50px"});en.append(tn);en.attr("value","12px");m.append(en);tn.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){tn.value=tn.css("left").replace("px","")/(en.offset().left+en.width())*1.28;en.attr("value",tn.value*39+8+"px");var t=Math.round(tn.value*39)+8;Zt.text(t+"px");ut.setFontSize(en.attr("value"))},appendTo:"body"});Pt.push(en);Yt.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Yt.css({"font-weight":"bold"});ri(Pt,en)});var nn=fi(m,"Write");m.append(nn);n.append(_t);var rn=document.createDocumentFragment();b=$(document.createElement("div"));b.attr("id","inkEditText");b.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"});rn.appendChild(b[0]);b.css({display:"none"});var sn=$(document.createElement("button")).css("border-radius","3.5px");sn.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});sn.get(0).innerHTML="Cancel";b.append(sn);var on=[];var un=$(document.createElement("div"));un.addClass("thicknessLabel");var an=$(document.createElement("div"));un.text("Text:");un.append(an);b.append(un);an.css({position:"relative",top:"2px",width:"65%",color:"green",display:"inline-block","margin-left":"2%","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap","margin-bottom":"0"});un.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%",display:"inline-block","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var fn=$(document.createElement("textarea"));fn.css({width:"72%","min-width":"0px","margin-left":"8%","margin-top":"2%","overflow-x":"hidden",position:"relative"}).attr("id","textEditArea");on.push(fn);$("#textEditArea").autoSize({onResize:function(){$(this).css({opacity:"0.8"})},animateCallback:function(){$(this).css({opacity:"1"})},animateDuration:300,extraSpace:40});b.append(fn);var ln;var hn;fn.on("keyup",function(e){var t=e.keyCode;if(t==32){e.stopPropagation()}var n=$.debounce(500,false,dn(e));if(t!==37&&t!==38&&t!==39&&t!==40&&!e.ctrlKey){n()}cn()});un.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});un.css({"font-weight":"bold"});ri(on,fn)});var vn=$(document.createElement("div"));vn.addClass("thicknessLabel");var mn=$(document.createElement("div"));vn.text("Font:");mn.text("Times New Roman");vn.append(mn);b.append(vn);mn.css({color:"green",display:"inline","padding-left":"2%"});vn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var gn=$(document.createElement("select"));gn.addClass("fontSelector");gn.css({color:"white","float":"left",clear:"both",display:"none",border:"solid 3px rgba(255,255,255,1)",width:"72%","margin-left":"8%","margin-top":"2%","background-color":"rgba(0,0,0,0.5)"});on.push(gn);b.append(gn);var yn=$(document.createElement("option"));yn.text("Times New Roman").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});yn.click(function(){ut.setFontFamily("Times New Roman, serif");mn.text("Times New Roman")});var bn=$(document.createElement("option"));bn.text("Georgia").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});bn.click(function(){ut.setFontFamily("Georgia, serif");mn.text("Georgia")});var wn=$(document.createElement("option"));wn.text("Verdana").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});wn.click(function(){ut.setFontFamily("Verdana, Geneva, sans-serif");mn.text("Verdana")});var En=$(document.createElement("option"));En.text("Courier").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"});En.click(function(){ut.setFontFamily("'Courier New', Courier, monospace");mn.text("Courier")});gn.append(yn);gn.append(bn);gn.append(wn);gn.append(En);vn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});vn.css({"font-weight":"bold"});ri(on,gn)});var Sn=$(document.createElement("div"));Sn.addClass("thicknessLabel");var xn=$(document.createElement("div"));xn.addClass("changeColorEdit");Sn.text("Color: ");xn.text("#FFFFFF");Sn.append(xn);b.append(Sn);Sn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});xn.css({color:"green",display:"inline","padding-left":"2%"});var Tn=$(document.createElement("div"));Tn.css("display","none");b.append(Tn);on.push(Tn);Sn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Sn.css({"font-weight":"bold"});ri(on,Tn)});var Nn=document.createElement("input");$(Nn).attr("id","textEditColorToggle");$(Nn).attr("readonly","readonly");$(Nn).css({"margin-left":"8%","margin-top":"3%",clear:"left",width:"40%"});$(Nn).on("keyup",function(e){e.stopPropagation()});if(Nn.addEventListener){Nn.addEventListener("DOMNodeInserted",function(){F=new jscolor.color(Nn,{});F.fromString("FFFFFF");F.onImmediateChange=function(){ut.setFontColor("#"+$("#textEditColorToggle").attr("value"));$(".changeColorEdit")[0].innerHTML="#"+$("#textEditColorToggle").attr("value")}},false)}Tn.append(Nn);var Cn=$(document.createElement("div"));Cn.addClass("thicknessLabel");var kn=$(document.createElement("div"));Cn.text("Text Size: ");kn.text("8px");Cn.append(kn);b.append(Cn);kn.css({color:"green",display:"inline","padding-left":"2%"});Cn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Ln=$(document.createElement("div"));Ln.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});b.append(Ln);var An=$(document.createElement("div"));An.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"});Ln.append(An);Ln.attr("value","8px");An.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e,t){An.value=t.position.left/(Ln.width()-An.width());Ln.attr("value",An.value*(E-8)+8+"px");var n=Math.round(An.value*(E-8))+8;x=n;kn.text(n+"px");ut.setFontSize(Ln.attr("value"))},appendTo:"body"});on.push(Ln);Cn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Cn.css({"font-weight":"bold"});ri(on,Ln);var e=(x-8)/(E-8);var t=e*(Ln.width()-An.width());An.css("left",t+"px")});var On=$(document.createElement("button")).css("border-radius","3.5px");On.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-top":"3%","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});On.get(0).innerHTML="Save";b.append(On);n.append(rn);var Mn=document.createDocumentFragment();g=$(document.createElement("div"));g.attr("id","inkDrawControls");g.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"});Mn.appendChild(g[0]);g.css({display:"none"});var _n=$(document.createElement("button")).css("border-radius","3.5px");_n.css({"font-size":"70%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%","padding-left":"4px","padding-right":"4px"});_n.get(0).innerHTML="Cancel";_n.click(function(){$n.attr("value",7);ut.updatePenWidth("brushSlider");ci();g.hide();l.setModifyingInk(false);l.setEditInkOn(false);d.getInkUndoManager().clear();p.greyOutBtn();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css({display:"none"})});g.append(_n);var Dn=[];var Pn=$(document.createElement("div"));Pn.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var Hn=$(document.createElement("div"));Hn.addClass("thicknessLabel");var Bn=$(document.createElement("div"));Hn.text("Mode: ");Bn.text("Draw");Hn.append(Bn);Bn.css({color:"green",display:"inline","padding-left":"2%"});Hn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});g.append(Hn);g.append(Pn);Dn.push(Pn);Hn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Hn.css({"font-weight":"bold"});ri(Dn,Pn)});var jn="draw";var Fn=$(document.createElement("label"));Fn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"bold","float":"left"});Fn.text("Draw");Pn.append(Fn);var In=7;var qn=7;var Rn=0;var Un=0;Fn.on("click",function(){if(jn==="erase"){Fn.css({color:"black"});zn.css({color:"gray"});jn="draw";Bn.text("Draw");qn=parseFloat($n.val());Un=parseFloat($n.css("left"));$("#brushSlider").attr("value",In);$("#brushSlider").css({left:Rn+"px"});ut.updatePenWidth("brushSlider");ut.setEraserWidth($("#brushSlider").attr("value"));$(".brushLabel1").text(Math.round($("#brushSlider").attr("value"))+"px");ut.set_mode(1)}});var zn=$(document.createElement("label"));zn.css({"font-size":"0.8em",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"});zn.text("Erase");Pn.append(zn);zn.on("click",function(){if(jn==="draw"){Fn.css({color:"gray"});zn.css({color:"black"});jn="erase";Bn.text("Erase");In=parseFloat($n.val());Rn=parseFloat($n.css("left"));$("#brushSlider").attr("value",qn);$("#brushSlider").css({left:Un+"px"});ut.updatePenWidth("brushSlider");ut.setEraserWidth($("#brushSlider").attr("value"));$(".brushLabel1").text(Math.round($("#brushSlider").attr("value"))+"px");ut.set_mode(2)}});var Wn=$(document.createElement("div"));Wn.addClass("thicknessLabel");var Xn=$(document.createElement("div")).addClass("brushLabel1");Wn.text("Width: ");Xn.text("7px");Wn.append(Xn);g.append(Wn);Xn.css({color:"green",display:"inline","padding-left":"2%"});Wn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Vn=$(document.createElement("div")).addClass("brushSliderDiv");Vn.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});g.append(Vn);Dn.push(Vn);var $n=$(document.createElement("div"));$n.attr("id","brushSlider");$n.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%"});$n.attr("value",7);Vn.append($n);Wn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Wn.css({"font-weight":"bold"});ri(Dn,Vn)});$n.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){$n.attr("value",$n.css("left").replace("px","")/(Vn.offset().left+Vn.width())*60+1+6);if($n.value<7){$n.attr("value",7)}ut.updatePenWidth("brushSlider");ut.setEraserWidth($n.attr("value"));Xn.text(Math.round($n.attr("value"))+"px")},appendTo:"body"});var Jn=$(document.createElement("div"));Jn.addClass("thicknessLabel");var Kn=$(document.createElement("div"));Kn.addClass("changeColor1");Jn.text("Color: ");Kn.text("#000000");Jn.append(Kn);g.append(Jn);Jn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});Kn.css({color:"green",display:"inline","padding-left":"2%"});var Qn=$(document.createElement("div"));Qn.css("display","none");g.append(Qn);Dn.push(Qn);Jn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Jn.css({"font-weight":"bold"});ri(Dn,Qn);ut.set_mode(TAG.TourAuthoring.InkMode.draw);Fn.css({color:"black"});zn.css({color:"gray"});jn="draw";Bn.text("Draw")});var Gn=document.createElement("input");$(Gn).attr("id","brushColorToggle");$(Gn).attr("readonly","readonly");$(Gn).css({"margin-left":"8%","float":"left","margin-top":"3%",clear:"left",width:"40%"});Gn.onfocus=function(){ut.set_mode(TAG.TourAuthoring.InkMode.draw)};$(Gn).on("keyup",function(e){e.stopPropagation()});if(Gn.addEventListener){Gn.addEventListener("DOMNodeInserted",function(){S=new jscolor.color(Gn,{});S.fromString("000000");S.onImmediateChange=function(){ut.updatePenColor("brushColorToggle");ut.set_mode(TAG.TourAuthoring.InkMode.draw);$(".changeColor1")[0].innerHTML="#"+$("#brushColorToggle").attr("value")}},false)}Qn.append(Gn);var Yn=$(document.createElement("div"));Yn.addClass("thicknessLabel");var Zn=$(document.createElement("div"));Yn.text("Opacity: ");Zn.text("100%");Yn.append(Zn);g.append(Yn);Zn.css({color:"green",display:"inline","padding-left":"2%"});Yn.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var er=$(document.createElement("div"));er.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});g.append(er);Dn.push(er);var tr=$(document.createElement("div"));tr.attr("id","opacitySlider");tr.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"});tr.attr("value",1);er.append(tr);Yn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Yn.css({"font-weight":"bold"});ri(Dn,er);ut.set_mode(TAG.TourAuthoring.InkMode.draw);Fn.css({color:"black"});zn.css({color:"gray"});jn="draw";Bn.text("Draw")});tr.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){tr.attr("value",parseFloat(tr.css("left").replace("px",""))/(parseFloat(er.offset().left)+parseFloat(er.width()))*1.28);if(tr[0].value>.99){tr.attr("value",1)}else if(tr[0].value<0){tr.attr("value",0)}ut.updatePenOpacity("opacitySlider");Zn.text(Math.round(100*tr.attr("value"))+"%")},appendTo:"body"});var nr=fi(g);g.append(nr);n.append(Mn);var rr=document.createDocumentFragment();w=$(document.createElement("div"));w.attr("id","inkEditDraw");w.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"});rr.appendChild(w[0]);w.css("display","none");var ir=$(document.createElement("button")).css("border-radius","3.5px");ir.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});ir.get(0).innerHTML="Cancel";w.append(ir);var sr=[];var or=$(document.createElement("div"));or.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var ur=$(document.createElement("div"));ur.addClass("thicknessLabel");var ar=$(document.createElement("div"));ur.text("Mode: ");ar.text("Draw");ur.append(ar);ar.css({color:"green",display:"inline","padding-left":"2%"});ur.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});w.append(ur);w.append(or);sr.push(or);ur.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});ur.css({"font-weight":"bold"});ri(sr,or)});var fr="draw";var lr=$(document.createElement("label"));lr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"bold","float":"left"});lr.text("Draw");or.append(lr);lr.on("click",function(){if(fr==="erase"){lr.css({color:"black"});cr.css({color:"gray"});fr="draw";ar.text("Draw");ut.set_mode(1)}});var cr=$(document.createElement("label"));cr.css({"font-size":"0.8em",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"});cr.text("Erase");or.append(cr);cr.on("click",function(){if(fr==="draw"){lr.css({color:"gray"});cr.css({color:"black"});fr="erase";ar.text("Erase");ut.set_mode(2)}});var hr=$(document.createElement("div"));hr.addClass("thicknessLabel");var pr=$(document.createElement("div"));hr.text("Width: ");pr.text("7px");hr.append(pr);w.append(hr);pr.css({color:"green",display:"inline","padding-left":"2%"});hr.css({"-ms-touch-action":"none","font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var dr=$(document.createElement("div"));dr.addClass("brushEditSlider");dr.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative","float":"left"});w.append(dr);sr.push(dr);var vr=$(document.createElement("div"));vr.attr("id","brushEditSlider");vr.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%"});vr.attr("value",7);dr.append(vr);hr.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});hr.css({"font-weight":"bold"});ri(sr,dr)});vr.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){vr.attr("value",vr.css("left").replace("px","")/(dr.offset().left+dr.width())*60+1+6);if(vr.value<7){vr.attr("value",7)}ut.updatePenWidth("brushEditSlider");pr.text(Math.round(vr.attr("value"))+"px")},appendTo:"body"});var mr=$(document.createElement("div"));mr.addClass("thicknessLabel");var gr=$(document.createElement("div"));gr.addClass("changeColor1Edit");mr.text("Color: ");gr.text("#000000");mr.append(gr);w.append(mr);mr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});gr.css({color:"green",display:"inline","padding-left":"2%"});var yr=$(document.createElement("div"));yr.css("display","none");w.append(yr);sr.push(yr);mr.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});mr.css({"font-weight":"bold"});ri(sr,yr);ut.set_mode(TAG.TourAuthoring.InkMode.draw);lr.css({color:"black"});cr.css({color:"gray"});fr="draw";ar.text("Draw")});var br=document.createElement("input");$(br).attr("id","brushEditColorToggle");$(br).attr("readonly","readonly");$(br).css({"margin-left":"8%","float":"left","margin-top":"3%",clear:"left",width:"40%"});br.onfocus=function(){ut.set_mode(TAG.TourAuthoring.InkMode.draw);lr.css({color:"black"});cr.css({color:"gray"});fr="draw";ar.text("Draw")};$(br).on("keyup",function(e){e.stopPropagation()});if(br.addEventListener){br.addEventListener("DOMNodeInserted",function(){L=new jscolor.color(br,{});L.fromString("000000");L.onImmediateChange=function(){ut.updatePenColor("brushEditColorToggle");ut.set_mode(TAG.TourAuthoring.InkMode.draw);lr.css({color:"black"});cr.css({color:"gray"});fr="draw";ar.text("Draw");$(".changeColor1Edit")[0].innerHTML=ut.getPenColor()}},false)}yr.append(br);var wr=$(document.createElement("div"));wr.addClass("thicknessLabel");var Er=$(document.createElement("div"));wr.text("opacity: ");Er.text("100%");wr.append(Er);w.append(wr);Er.css({color:"green",display:"inline","padding-left":"2%"});wr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Sr=$(document.createElement("div"));Sr.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});w.append(Sr);sr.push(Sr);var xr=$(document.createElement("div"));xr.attr("id","opacityEditSlider");xr.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%",left:"87%","margin-top":"-0.57%"});xr.attr("value",1);Sr.append(xr);wr.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});wr.css({"font-weight":"bold"});ri(sr,Sr);ut.set_mode(1);lr.css({color:"black"});cr.css({color:"gray"});fr="draw";ar.text("Draw")});xr.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){xr.attr("value",parseFloat(xr.css("left").replace("px",""))/(parseFloat(Sr.offset().left)+parseFloat(Sr.width()))*1.28);if(xr[0].value>.99){xr.attr("value",1)}else if(xr[0].value<0){xr.attr("value",0)}ut.updatePenOpacity("opacityEditSlider");Er.text(Math.round(100*xr.attr("value"))+"%")},appendTo:"body"});var Tr=$(document.createElement("button")).css("border-radius","3.5px");Tr.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-top":"3%","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});Tr.get(0).innerHTML="Save";w.append(Tr);n.append(rr);var Nr=document.createDocumentFragment();v=$(document.createElement("div"));v.attr("id","inkTransControls");v.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"});Nr.appendChild(v[0]);v.css({display:"none"});var Cr=$(document.createElement("button")).css("border-radius","3.5px");Cr.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});Cr.get(0).innerHTML="Cancel";Cr.on("click",function(){ci();v.hide();l.setModifyingInk(false);l.setEditInkOn(false);d.getInkUndoManager().clear();p.greyOutBtn();a.undoButton.off("click");a.redoButton.off("click");a.undoButton.on("click",function(){p.undo()});a.redoButton.on("click",function(){p.redo()});a.undoRedoInkOnly.css({display:"none"})});v.append(Cr);var kr=[];var Lr=$(document.createElement("button")).css("border-radius","3.5px");Lr.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%",clear:"left"});Lr.get(0).innerHTML="Add Ellipse";Lr.on("click",function(){ut.add_ellipse()});v.append(Lr);var Ar=$(document.createElement("button")).css("border-radius","3.5px");Ar.css({"padding-left":"4px","padding-right":"4px",color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%"});Ar.get(0).innerHTML="Add Rectangle";Ar.on("click",function(){ut.add_rectangle()});v.append(Ar);var Or=$(document.createElement("div"));Or.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var Mr=$(document.createElement("div"));Mr.addClass("thicknessLabel");var _r=$(document.createElement("div"));Mr.text("Mode: ");_r.text("Isolate");Mr.append(_r);_r.css({color:"green",display:"inline","padding-left":"2%"});Mr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});v.append(Mr);v.append(Or);kr.push(Or);Mr.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Mr.css({"font-weight":"bold"});ri(kr,Or)});var Dr="isolate";var Pr=$(document.createElement("label"));Pr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"bold","float":"left"});Pr.text("Isolate");Or.append(Pr);Pr.on("click",function(){if(Dr==="block"){Pr.css({color:"black"});Hr.css({color:"gray"});Dr="isolate";_r.text("Isolate");ut.setTransMode("isolate")}});var Hr=$(document.createElement("label"));Hr.css({"font-size":"0.8em",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"});Hr.text("Block");Or.append(Hr);Hr.on("click",function(){if(Dr==="isolate"){Pr.css({color:"gray"});Hr.css({color:"black"});Dr="block";_r.text("Block");ut.setTransMode("block")}});var Br=$(document.createElement("div"));Br.addClass("thicknessLabel");var jr=$(document.createElement("div"));Br.text("Opacity: ");jr.text("80%");Br.append(jr);v.append(Br);jr.css({color:"green",display:"inline","padding-left":"2%"});Br.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Fr=$(document.createElement("div"));Fr.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});var Ir=$(document.createElement("div"));Ir.attr("id","opacityTransparencySliderPoint");Ir.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"});Fr.append(Ir);v.append(Fr);Br.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Br.css({"font-weight":"bold"});ri(kr,Fr)});Ir.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){Ir.attr("value",parseFloat(Ir.css("left").replace("px",""))/(parseFloat(Fr.offset().left)+parseFloat(Fr.width()))*1.28);if(Ir[0].value>.99){Ir.attr("value",1)}else if(Ir[0].value<0){Ir.attr("value",0)}ut.setMarqueeFillOpacity(parseFloat(Ir.attr("value")));jr.text(Math.round(100*Ir.attr("value"))+"%")},appendTo:"body"});kr.push(Fr);var qr=fi(v,0,"trans");v.append(qr);n.append(Nr);var Rr=document.createDocumentFragment();y=$(document.createElement("div"));y.attr("id","inkEditTransparency");y.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"});Rr.appendChild(y[0]);y.css({display:"none"});var Ur=$(document.createElement("button")).css("border-radius","3.5px");Ur.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});Ur.get(0).innerHTML="Cancel";y.append(Ur);var zr=[];var Wr=$(document.createElement("button")).css("border-radius","3.5px");Wr.css({"padding-left":"4px","padding-right":"4px",color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%",clear:"left"});Wr.get(0).innerHTML="Add Ellipse";Wr.on("click",function(){ut.add_ellipse()});y.append(Wr);var Xr=$(document.createElement("button")).css("border-radius","3.5px");Xr.css({"padding-left":"4px","padding-right":"4px",color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%"});Xr.get(0).innerHTML="Add Rectangle";Xr.on("click",function(){ut.add_rectangle()});y.append(Xr);var Vr=$(document.createElement("div"));Vr.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var $r=$(document.createElement("div"));$r.addClass("thicknessLabel");var Jr=$(document.createElement("div"));$r.text("Mode: ");Jr.text("Isolate");Mr.attr("id","transModeLabel");$r.append(Jr);Jr.css({color:"green",display:"inline","padding-left":"2%"});$r.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});y.append($r);y.append(Vr);zr.push(Vr);$r.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});$r.css({"font-weight":"bold"});ri(zr,Vr)});var Kr="isolate";var Qr=$(document.createElement("label"));Qr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"bold","float":"left"});Qr.text("Isolate");Vr.append(Qr);Qr.on("click",function(){if(Kr==="block"){Qr.css({color:"black"});Gr.css({color:"gray"});Kr="isolate";Jr.text("Isolate");ut.setTransMode("isolate")}});var Gr=$(document.createElement("label"));Gr.css({"font-size":"0.8em",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"});Gr.text("Block");Vr.append(Gr);Gr.on("click",function(){if(Kr==="isolate"){Qr.css({color:"gray"});Gr.css({color:"black"});Kr="block";Jr.text("Block");ut.setTransMode("block")}});var Yr=$(document.createElement("div"));Yr.addClass("thicknessLabel");var Zr=$(document.createElement("div"));Yr.text("Opacity: ");Zr.text("80%");Yr.append(Zr);y.append(Yr);Zr.css({color:"green",display:"inline","padding-left":"2%"});Yr.css({"font-size":"0.8em",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var ei=$(document.createElement("div"));ei.attr("id","opacityEditTransparencySlider");ei.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"12%","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});var ti=$(document.createElement("div"));ti.attr("id","opacityEditTransparencySliderPoint");ti.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"});ei.append(ti);y.append(ei);Yr.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"});Yr.css({"font-weight":"bold"});ri(zr,ei)});ti.draggable({axis:"x",containment:"parent",scroll:false,drag:function(e){ti.attr("value",parseFloat(ti.css("left").replace("px",""))/(parseFloat(ei.offset().left)+parseFloat(ei.width()))*1.28);if(ti[0].value>.99){ti.attr("value",1)}else if(ti[0].value<0){ti.attr("value",0)}ut.setMarqueeFillOpacity(parseFloat(ti.attr("value")));Zr.text(Math.round(100*ti.attr("value"))+"%")},appendTo:"body"});zr.push(ei);var ni=$(document.createElement("button")).css("border-radius","3.5px");ni.css({"padding-left":"4px","padding-right":"4px","font-size":"70%",color:"black","margin-top":"3%","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"});ni.get(0).innerHTML="Save";y.append(ni);n.append(Rr);o.hideInkControls=li;o.removeInkCanv=ci})();o.addToDOM=H;o.addCatalogToDOM=B;o.getIsUploading=j;return o};TAG.Util.makeNamespace("TAG.TourAuthoring.Display");TAG.Util.makeNamespace("TAG.TourAuthoring.DisplayParts");TAG.TourAuthoring.DisplayParts={main:1,"fade-in":2,"fade-out":3};TAG.TourAuthoring.Display=function(e,t){"use strict";function H(e){y=e}function B(){return b}function j(e){b.push(e)}function F(e){b.splice(b.indexOf(e),1)}function I(){var e=TAG.Util.UI.createDisplay({x:D(s),fadeIn:D(f),fadeOut:D(l),mainLength:D(c),mainColor:u?t.type===TAG.TourAuthoring.TrackType.audio?"rgba(129, 173, 98, 0.8)":TAG.TourAuthoring.Constants.displayColor:TAG.TourAuthoring.Constants.inkDisplayColor,fadeColor:null,height:null,container:t.track});N=e.mainRect;x=e.inRect,C=e.outRect,T=e.inHandle,k=e.outHandle;x.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-in"])});N.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["main"])});C.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-out"])});T.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-in"])});k.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-out"])})}function q(){x.off("mousedown");C.off("mousedown");N.off("mousedown");T.off("mousedown");k.off("mousedown");x.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-in"])});N.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["main"])});C.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-out"])});T.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-in"])});k.on("mousedown",function(e){var t=e.offsetX;R(t,TAG.TourAuthoring.DisplayParts["fade-out"])})}function R(e,r){var i=s,u=h,a=c,f=p,l=o;tn();t.timeManager.stop();A=e;L=r;if(L===TAG.TourAuthoring.DisplayParts["fade-in"]||L===TAG.TourAuthoring.DisplayParts["fade-out"]){if(t.that.getMinimizedState()){return}}if(t.that.getMinimizedState()){T.hide();k.hide()}t.currentDisplay=n;t.timeline.newDataArray();for(var d=0;d<t.timeline.getMultiSelectionArray().length;d++){t.timeline.getMultiSelectionArray()[d].setLoc(L)}$("body").on("mouseup.display",function(){function b(e,n,r){var i={execute:function(){e.setTimes(r)},unexecute:function(){e.setTimes(n)}};t.undoManager.logCommand(i)}if(t.that.getMinimizedState()){T.hide();k.hide()}var e,r,o,l;var d=g.findPreviousDisplay(t.that.getPos(),n);var v=g.findNextDisplay(t.that.getPos(),n);r=0;o=0;var m=A;var y=L;t.currentDisplay=null;A=null;L=null;$("body").off("mouseup.display");if(t.timeline.getMultiSelectionArray().length!==0){var w=t.timeline.getMultiSelectionArray();l=[];w.map(function(e){l.push(e)})}if(i!==s||u!==h||a!==c||f!==p){t.timeline.updateOldData();t.update();switch(y){case TAG.TourAuthoring.DisplayParts["fade-in"]:r=s;o=i;break;case TAG.TourAuthoring.DisplayParts["fade-out"]:r=p;o=f;break;case TAG.TourAuthoring.DisplayParts["main"]:r=h;o=u;break}var E=0;var S=Infinity;if(d){E=d.display.getEnd()}if(v){S=v.display.getStart()}var x=t.timeline.getOldData();var N=t.timeline.getDisplayData();e={execute:function(){var e={pivot:{x:t.timeManager.timeToPx(r)+m}};t.currentDisplay=n;L=y;A=m;if(x&&l){for(var i=0;i<l.length;i++){var s=l[i];var o;switch(y){case TAG.TourAuthoring.DisplayParts["fade-in"]:o=x[i][0];break;case TAG.TourAuthoring.DisplayParts["fade-out"]:o=x[i][2];break;case TAG.TourAuthoring.DisplayParts["main"]:o=x[i][1];break}var u={pivot:{x:t.timeManager.timeToPx(o)+m}};s.setLoc(y);s.setcurrentDisplay(s);s.setOffset(A);var a=E+s.getStart()-n.getStart();var f=S+s.getEnd()-n.getEnd();s.move(u,x[i][3],x[i][4],-1,-1,true);s.setcurrentDisplay(null)}}else{Jt(e,E,S,-1,-1,true)}t.currentDisplay=null;L=null;A=null;t.update()},unexecute:function(){var e={pivot:{x:t.timeManager.timeToPx(o)+m}};t.currentDisplay=n;L=y;A=m;if(N&&l){for(var r=0;r<l.length;r++){var i=l[r];var s;switch(y){case TAG.TourAuthoring.DisplayParts["fade-in"]:s=N[r][0];break;case TAG.TourAuthoring.DisplayParts["fade-out"]:s=N[r][2];break;case TAG.TourAuthoring.DisplayParts["main"]:s=N[r][1];break}var u={pivot:{x:t.timeManager.timeToPx(s)+m}};i.setLoc(y);i.setcurrentDisplay(i);i.setOffset(A);i.move(u,N[r][3],N[r][4],-1,-1,true);i.setcurrentDisplay(null)}}else{Jt(e,E,S,-1,-1,true)}t.currentDisplay=null;L=null;A=null;t.update()}};t.undoManager.logCommand(e);var C=t.timeline.clamped_displays.length;for(var O=0;O<C;O++){var M=t.timeline.clamped_displays[O];b(M,M.clamped_init,M.clamped_new);M.has_been_clamped=false}if(C>0){t.undoManager.combineLast(C+1);t.timeline.clamped_displays.length=0}}})}function U(){function e(e,r){var i=s,u=h,a=c,f=p,l=o;tn();t.timeManager.stop();A=e;L=r;if(L===TAG.TourAuthoring.DisplayParts["fade-in"]||L===TAG.TourAuthoring.DisplayParts["fade-out"]){if(t.that.getMinimizedState()){return}}t.currentDisplay=n;t.timeline.newDataArray();for(var d=0;d<t.timeline.getMultiSelectionArray().length;d++){t.timeline.getMultiSelectionArray()[d].setLoc(L)}$("body").on("mouseup.display",function(){function b(e,n,r){var i={execute:function(){e.setTimes(r)},unexecute:function(){console.log("init: "+n.inStart+", new: "+r.inStart);e.setTimes(n)}};t.undoManager.logCommand(i)}var e,r,o,l;var d=g.findPreviousDisplay(t.that.getPos(),n);var v=g.findNextDisplay(t.that.getPos(),n);r=0;o=0;var m=A;var y=L;t.currentDisplay=null;A=null;L=null;$("body").off("mouseup.display");if(t.timeline.getMultiSelectionArray().length!==0){var w=t.timeline.getMultiSelectionArray();l=[];w.map(function(e){l.push(e)})}if(i!==s||u!==h||a!==c||f!==p){t.timeline.updateOldData();t.update();switch(y){case TAG.TourAuthoring.DisplayParts["fade-in"]:r=s;o=i;break;case TAG.TourAuthoring.DisplayParts["fade-out"]:r=p;o=f;break;case TAG.TourAuthoring.DisplayParts["main"]:r=h;o=u;break}var E=0;var S=Infinity;if(d){E=d.display.getEnd()}if(v){S=v.display.getStart()}var x=t.timeline.getOldData();var T=t.timeline.getDisplayData();e={execute:function(){var e={pivot:{x:t.timeManager.timeToPx(r)+m}};t.currentDisplay=n;L=y;A=m;if(x&&l){for(var i=0;i<l.length;i++){var s=l[i];var o;switch(y){case TAG.TourAuthoring.DisplayParts["fade-in"]:o=x[i][0];break;case TAG.TourAuthoring.DisplayParts["fade-out"]:o=x[i][2];break;case TAG.TourAuthoring.DisplayParts["main"]:o=x[i][1];break}var u={pivot:{x:t.timeManager.timeToPx(o)+m}};s.setLoc(y);s.setcurrentDisplay(s);s.setOffset(A);var a=E+s.getStart()-n.getStart();var f=S+s.getEnd()-n.getEnd();s.move(u,x[i][3],x[i][4],-1,-1,true);s.setcurrentDisplay(null)}}else{Jt(e,E,S,-1,-1,true)}t.currentDisplay=null;L=null;A=null;t.update()},unexecute:function(){var e={pivot:{x:t.timeManager.timeToPx(o)+m}};t.currentDisplay=n;L=y;A=m;if(T&&l){for(var r=0;r<l.length;r++){var i=l[r];var s;switch(y){case TAG.TourAuthoring.DisplayParts["fade-in"]:s=T[r][0];break;case TAG.TourAuthoring.DisplayParts["fade-out"]:s=T[r][2];break;case TAG.TourAuthoring.DisplayParts["main"]:s=T[r][1];break}var u={pivot:{x:t.timeManager.timeToPx(s)+m}};i.setLoc(y);i.setcurrentDisplay(i);i.setOffset(A);i.move(u,T[r][3],T[r][4],-1,-1,true);i.setcurrentDisplay(null)}}else{Jt(e,E,S,-1,-1,true)}t.currentDisplay=null;L=null;A=null;t.update()}};t.undoManager.logCommand(e);var N=t.timeline.clamped_displays.length;for(var C=0;C<N;C++){var k=t.timeline.clamped_displays[C];b(k,k.clamped_init,k.clamped_new);k.has_been_clamped=false}if(N>0){t.undoManager.combineLast(N+1);t.timeline.clamped_displays.length=0}}})}E=t.svgDisplays.append("g").classed("display",true);x=E.append("rect").classed("fade-in",true).attr("x",t.timeManager.timeToPx(s)).attr("y",0).attr("width",t.timeManager.timeToPx(f)).attr("height",t.svg.attr("height")).style("fill","url(#fade-in)").style("stroke-width",1).style("stroke","rgb(0,0,0)");$(x[0][0]).on("mousedown",function(t){console.log("using new events");var n=t.offsetX;e(n-parseInt(x.attr("x"),10),TAG.TourAuthoring.DisplayParts["fade-in"])});if(!u){x.style("fill","url(#fade-in-ink)")}N=E.append("rect").classed("main-display",true).attr("x",t.timeManager.timeToPx(h)).attr("y",0).attr("width",t.timeManager.timeToPx(c)).attr("height",t.svg.attr("height")).style("fill",TAG.TourAuthoring.Constants.displayColor);$(N[0][0]).on("mousedown",function(t){console.log("using new events");var n=t.offsetX;e(n-parseInt(N.attr("x"),10),TAG.TourAuthoring.DisplayParts["main"])});if(!u){N.style("fill",TAG.TourAuthoring.Constants.inkDisplayColor)}C=E.append("rect").classed("fade-out",true).attr("x",t.timeManager.timeToPx(p)).attr("y",0).attr("width",t.timeManager.timeToPx(l)).attr("height",t.svg.attr("height")).style("fill","url(#fade-out)").style("stroke-width",1).style("stroke","rgb(0,0,0)");$(C[0][0]).on("mousedown",function(t){console.log("using new events");var n=t.offsetX;e(n-parseFloat(C.attr("x")),TAG.TourAuthoring.DisplayParts["fade-out"])});if(!u){C.style("fill","url(#fade-out-ink)")}S=t.svg.append("g").classed("keyframes",true);T=E.append("circle").classed("fade-in-handle",true).attr("cx",t.timeManager.timeToPx(s)).attr("cy","50%").attr("r",TAG.TourAuthoring.Constants.fadeBtnSize).attr("style","stroke:black; stroke-width:"+TAG.TourAuthoring.Constants.keyframeStrokeW+"; fill:"+TAG.TourAuthoring.Constants.handleColor);$(T[0][0]).on("mousedown",function(t){console.log("using new events");var n=t.offsetX;e(n-parseInt(x.attr("x"),10),TAG.TourAuthoring.DisplayParts["fade-in"])});k=E.append("circle").classed("fade-out-handle",true).attr("cx",t.timeManager.timeToPx(p+l)).attr("cy","50%").attr("r",TAG.TourAuthoring.Constants.fadeBtnSize).attr("style","stroke:black; stroke-width:"+TAG.TourAuthoring.Constants.keyframeStrokeW+"; fill:"+TAG.TourAuthoring.Constants.handleColor);$(k[0][0]).on("mousedown",function(t){console.log("using new events");var n=t.offsetX;e(n-parseInt(C.attr("x"),10),TAG.TourAuthoring.DisplayParts["fade-out"])})}function z(){O=!O;if(O){T.css("display","none");k.css("display","none");T.css("visibility","hidden");k.css("visibility","hidden")}else{T.css("display","block");k.css("display","block");T.css("visibility","visible");k.css("visibility","visible")}y.map(function(e){e.toggleCircle()})}function W(){var e=t.timeManager.getDuration(),r=e.start,i=e.end;var s=g.findPreviousDisplay(t.that.getPos(),n);var o=g.findNextDisplay(t.that.getPos(),n);r=s?s.display.getEnd():r;i=o?o.display.getStart():i;if(t.mediaLength){r=Math.max(r,pt()-parseFloat(t.mediaLength));i=Math.min(i,parseFloat(t.mediaLength)+ht())}return{left:r,right:i}}function X(e){var n,r,i=W(),o=s;var u=0;if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){var a=Qt();i.left=Math.max(i.left,a.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset);i.right=Math.min(i.right,a.getEnd())}else if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){r=B();u=Gt(r)}s=Math.constrain(e,i.left,i.right-f-l-c);Dt(s);bn(s-o);if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){for(var h=0;h<r.length;h++){pn(r[h])}}}function V(e){var n=W(),r,i=!y.isEmpty()?y.max().getTime()+TAG.TourAuthoring.Constants.epsilon-h:-Infinity;var o=0;if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){var u=Qt();n.left=Math.max(n.left,u.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset);n.right=Math.min(n.right,u.getEnd())}else if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){r=B();o=Gt(r)}c=Math.constrain(Math.max(.1,e),i,n.right-s-l-f);if(f===0&&l===0&&c===0)c=1;Ot(c+f+l>=o?c:o-f-l);if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){for(var a=0;a<r.length;a++){pn(r[a])}}}function J(e){var n=W(),r,i,o,u;var a=0;if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){var p=Qt();n.left=Math.max(n.left,p.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset);n.right=Math.min(n.right,p.getEnd())}else if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){o=B();a=Gt(o)}f=Math.constrain(e,0,h-n.left);var d=h-f;if(!y.isEmpty()&&d>y.min().getTime()-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize)){s=y.min().getTime()-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize);f=h-s}else{s=d}var v;if(c+f+l>=a){v=f}else{v=a-c-l}Mt(v);if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){for(r=0;r<o.length;r++){pn(o[r])}}}function K(e){var n=W(),r,i,s,o,u;var a=0;if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){var h=Qt();n.left=Math.max(n.left,h.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset);n.right=Math.min(n.right,h.getEnd())}else if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){s=B();a=Gt(s)}l=Math.constrain(e,0,n.right-p);u=p+l;if(!y.isEmpty()&&u<y.max().getTime()+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize)){l=y.max().getTime()+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize)-p}_t(c+f+l>=a?l:a-c-f);if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image){for(r=0;r<s.length;r++){pn(s[r])}}}function Q(e){w.open(e)}function G(){w.close()}function Y(e){w.menuCloseable=e}function Z(e){L=e}function et(){return A}function tt(e){A=e}function nt(e){t.currentDisplay=e}function rt(){var e;if(n.getStorageContainer().displayTree.isSolo()&&t.attachedInks.length>0){w.forceClose();t.timeline.confirmDeleteDisableInk(t.title,n,t)}else{e=it();ot(true);if(e>0){t.undoManager.combineLast(e+1)}}}function it(){var e=B();var t,n=e.length;for(t=0;t<n;t++){e[t].removeDisplay(true)}return n}function ot(e){w.forceClose(true);var r=y.clone();if(i){var s=i}var o=TAG.TourAuthoring.Command({execute:function(){st=true;g.removeDisplay(t.that.getPos(),n);y.clear(function(e){e._value.removeHelper()});N.remove();C.remove();x.remove();k.remove();T.remove();t.update()},unexecute:function(){st=false;I();var e=g.addDisplay(t.that.getPos(),n);g.replaceKeyframes(e.display,r);var i=g.getKeyframes(e);i._root&&i._root.traverse(ut);t.update()}});o.execute();if(e){t.undoManager.logCommand(o);console.log("logging")}}function ut(e){e._value.reactivateKeyframe()}function at(){return st}function ft(){g.addDisplay(t.that.getPos(),n);Tt();t.update()}function ct(){lt++;if(t.that.getEventsPaused()){return}if(lt>1){lt=0;if(!menuCloseable){menuCloseable=true;setTimeout(t.timeline.getCloseMenu(),0)}}}function ht(){return s}function pt(){return p+l}function dt(){return h}function vt(){return c}function mt(){return p}function gt(){return f}function yt(){return l}function bt(){return o}function wt(e){Lt(e.inStart);At(e.outStart);Nt(e.inStart+e.fadeIn);Ot(e.main);Mt(e.fadeIn);_t(e.fadeOut)}function Et(e){s=e.inStart;p=e.outStart;h=e.inStart+e.fadeIn;c=e.main;f=e.fadeIn;l=e.fadeOut;Tt()}function St(){return{inStart:s,outStart:p,fadeIn:f,main:c,mainStart:h,fadeOut:l}}function xt(e){h+=e;s+=e;p+=e;Tt();bn(e)}function Tt(){x.css("left",D(s)+"px");N.css("left",D(h)+"px");C.css("left",D(p)+"px");T.css("left",D(s)-20+"px");k.css("left",D(p+l)-20+"px");t.track.append(N).append(x).append(C).append(T).append(k);x.show();N.show();C.show();T.show();k.show()}function Nt(e,t){h=e;s=h-f;p=h+c;Tt();bn(t)}function Ct(e){s=e}function kt(e){p=e}function Lt(e){s=e;h=s+f;c=p-h;o=p+l-e;x.css("left",D(e)+"px");T.css("left",D(e)-20+"px");N.css({left:D(h)+"px",width:D(c)+"px"})}function At(e){c=e-h;p=e;o=e+l-s;C.css("left",D(e)+"px");k.css("left",D(e+l)-20+"px");N.css("width",D(c)+"px")}function Ot(e){c=e;p=h+c;o=p+l-s;C.css("left",D(p)+"px");k.css("left",D(p+l)-20+"px");N.css("width",D(c)+"px")}function Mt(e){if(a){f=e;h=s+f;o=p+l-s;x.css("left",D(s)+"px");x.css("width",D(f)+"px");T.css("left",D(s)-20+"px");N.css({left:D(h)+"px",width:D(c)+"px"})}else{Ot(c+e)}}function _t(e){if(a){l=e;o=p+l-s;C.css("width",D(l)+"px");k.css("left",D(p+l)-20+"px")}else{Ot(c+e)}}function Dt(e){s=e;h=s+f;p=c+h;x.css("left",D(s)+"px");T.css("left",D(s)-20+"px");N.css("left",D(h)+"px").css("width",D(c)+"px");C.css("left",D(p)+"px");k.css("left",D(p+l)-20+"px")}function Pt(){return d}function Ht(e){d=e}function Bt(){return r}function jt(e){r=e}function Ft(){return t.that}function It(){return parseFloat(t.mediaLength)}function qt(){return mouseisup}function Rt(){return t.type}function Ut(){return N}function zt(){return k}function Wt(){return T}function Xt(){return L}function Vt(){if(t.that.getMinimizedState()){T.hide();k.hide();T.css("visibility","hidden");k.css("visibility","hidden")}}function Jt(e,r,i,o,u,a){var d=t.timeManager.getDuration();var v,m,g,b,w;var E=0;r=r||d.start;i=i||d.end;o=o||-1;u=u||-1;if(!L||A!==0&&!A||!t.currentDisplay){console.log("Move display called when no display is selected!")}else if(L===TAG.TourAuthoring.DisplayParts["fade-in"]){if(o!==-1){s=o}else{if(!a&&t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){b=Qt();r=Math.max(r,b.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset)}else if(!a&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)){v=B();E=Gt(v)}else if(t.type===TAG.TourAuthoring.TrackType.video||t.type===TAG.TourAuthoring.TrackType.audio){if(t.mediaLength){g=parseFloat(t.mediaLength);var S=p+l-g;r=Math.max(r,S)}}w=t.timeManager.pxToTime(e.pivot.x-A);if(pt()-w>=E){if(f===0&&l===0){s=Math.constrain(w,r,Math.min(t.timeManager.pxToTime(parseFloat(k.css("left"))+20-2*TAG.TourAuthoring.Constants.fadeBtnSize),!y.isEmpty()&&y.min().getTime()-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||Infinity))}else{s=Math.constrain(t.timeManager.pxToTime(e.pivot.x-A),r,Math.min(p-f-.1,!y.isEmpty()&&y.min().getTime()-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||Infinity))}if(!a&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)){for(m=0;m<v.length;m++){pn(v[m])}}}}Lt(s)}else if(L===TAG.TourAuthoring.DisplayParts["fade-out"]){if(u!==-1){p=u}else{if(!a&&t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){b=Qt();i=Math.min(i,b.getOutStart()+b.getFadeOut())}else if(!a&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)){v=B();E=Gt(v)}else if(t.type===TAG.TourAuthoring.TrackType.video||t.type===TAG.TourAuthoring.TrackType.audio){if(t.mediaLength){g=parseFloat(t.mediaLength);var x=s+g;i=Math.min(i,x)}}w=t.timeManager.pxToTime(e.pivot.x-A);if(w+l-ht()>=E){if(f===0&&l===0){p=Math.constrain(w,Math.max(t.timeManager.pxToTime(parseFloat(T.css("left"))+20)+t.timeManager.pxToTime(2*TAG.TourAuthoring.Constants.fadeBtnSize),!y.isEmpty()&&y.max().getTime()-l+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-Infinity),i-l)}else{p=Math.constrain(w,Math.max(s+f+.1,!y.isEmpty()&&y.max().getTime()-l+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-Infinity),i-l)}if(!a&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)){for(m=0;m<v.length;m++){pn(v[m])}}}}At(p)}else if(L===TAG.TourAuthoring.DisplayParts["main"]){var N=null;if(!a&&t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){b=Qt();i=Math.min(i,b.getOutStart()+b.getFadeOut());r=Math.max(r,b.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset)}else if(!a&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)){v=B()}var C=Math.constrain(t.timeManager.pxToTime(e.pivot.x-A),r+f,i-l-c),O=C-h;Nt(C,O);var M=null;var _=null;if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){M=Qt().getEnd();_=Qt().getStart()}var D=t.timeManager.pxToTime(e.pivot.x-A);var P=ht();var H=pt();if(D>P-.001){ln(M)}else if(D<P+.001){cn(_)}if(!a&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)){for(m=0;m<v.length;m++){pn(v[m])}}}else{console.log("currentDisplay.loc should be one of: 'fade-in', 'fade-out', or 'main'")}n.outStart=p;n.inStart=s;t.that.drawLines()}function Kt(e){i=e}function Qt(){return i}function Gt(e){var t={};var n=0;for(var r=0;r<e.length;r++){var i=e[r].getTrack().getTitle();t[i]=(typeof t[i]==="number"?t[i]:0)+(e[r].getRemoved()?0:e[r].getEnd()-e[r].getStart());if(t[i]>n)n=t[i]}return n+TAG.TourAuthoring.Constants.inkTrackOffset}function Yt(){var e=[];var n;var r=[];var i=g.getTracks();for(n=0;n<i.length;n++){if(i[n].track.getType()===TAG.TourAuthoring.TrackType.ink&&i[n].track.getInkEnabled()&&i[n].track.getInkLink().getTitle()===t.title)r.push(i[n])}for(n=0;n<r.length;n++){var o=r[n],u=o.displays.getContents();for(var a=0;a<u.length;a++){var f=u[a].display;if(f.getOutStart()<=p+l&&f.getOutStart()>=s){e.push(f)}}}return e}function tn(){var e=n.getStorageContainer().hostTrack.getPos();var r=null;if(!(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled)){r=nn(e)}var i=un(e,r);M=an(i);Zt=g.findNextDisplay(e,n);en=g.findPreviousDisplay(e,n)}function on(e,t,n){if(n){for(var r=0;r<e.length;r++){if(!n.lookup(e[r].display.getStart())){t.add({key:e[r].display.getStart()})}if(!n.lookup(e[r].display.getEnd())){t.add({key:e[r].display.getEnd()})}}}else{for(var r=0;r<e.length;r++){t.add({key:e[r].display.getStart()});t.add({key:e[r].display.getEnd()})}}}function un(e,t){var n=e-1>=0?e-1:null,r=e+1<g.numTracks()?e+1:null;var i=new AVLTree(rn,sn);var s=g.getTracks();if(n!=null){on(s[n].displays.getContents(),i,t)}if(r!=null){on(s[r].displays.getContents(),i,t)}return i}function an(e){var t=e.getContents();var n=new DoublyLinkedList;for(var r=0;r<t.length;r++){n.append(t[r].key)}return n}function fn(e){var n=t.timeManager.timeToPx(e);if(n<$(window).width()*.01&&n>0){return true}return false}function ln(e){var r=ht();var i=pt();var o=M.findNext(r);var u=M.findNext(i);var a=false;if(e&&u&&u.data===e){}else{if(u!==null){var f=u.data-(s+n.getTotalLength());if(!fn(f)||e&&i+f>e){}else{if(Zt&&Zt.display.getStart()-i>=f){xt(f);a=true}else if(!Zt){xt(f);a=true}}}}if(e&&o&&o.data===e){return}else{if(o!=null){var l=o.data-r;if(!fn(l)||e&&i+l>e||i+l>t.timeManager.getDuration().end){}else{if(a===false){if(Zt&&Zt.display.getStart()-i>=l){xt(l)}else if(!Zt){xt(l)}}}}}}function cn(e){var t=ht();var r=pt();var i=M.findPrev(t);var o=M.findPrev(r);var u=false;if(e&&i&&i.data===e){}else{if(i!=null){var a=t-i.data;if(!fn(a)||e&&t-a<e){}else{if(en&&en.display.getEnd()-t>=a){xt(-1*a);u=true}else if(!en){xt(-1*a);u=true}}}}if(e&&o&&o.data===e){}else{if(o!=null){var f=s+n.getTotalLength()-o.data;if(!fn(f)||e&&t-f<e||t-f<0){}else{if(u===false){if(en&&en.display.getEnd()-t>=f){xt(-1*f)}else if(!en){xt(-1*f)}}}}}}function hn(){var e=t.experienceId,n=e.getStorageContainer().displays,r,i,s;var o=n.nearestNeighbors(ht(),1);return o[0]}function pn(e){var t=e.getStart(),n=e.getEnd(),r=e.getMain(),i=e.getFadeIn(),o=e.getFadeOut(),u=e.getStorageContainer().displayTree,a=t,f=n,c=r,h,d=false;if(t<s+TAG.TourAuthoring.Constants.inkTrackOffset){dn(e,u,"right",s+TAG.TourAuthoring.Constants.inkTrackOffset)}if(f>p+l){dn(e,u,"left",p+l)}}function dn(e,n,r,i){var s,o,u;var a=e.getStart(),f=e.getEnd(),l=e.getMain();var c=e.getFadeOut(),h=e.getFadeIn();var p;if(!e.has_been_clamped){e.clamped_init={inStart:a,outStart:f-c,main:l,fadeIn:h,fadeOut:c};e.has_been_clamped=true;t.timeline.clamped_displays.push(e)}if(r==="right"){p=i-a;s=i;o=f+p;u=l;e.setInStart(s);e.setOutStart(o-c);e.setMain(u);e.clamped_new={inStart:s,outStart:o-c,main:u,fadeIn:h,fadeOut:c};var d=n.findNext(e.getStorageContainer());if(d&&d.display.getStart()<o){dn(d.display,n,"right",o)}}else{p=f-i;o=i;s=a-p;u=l;e.setInStart(s);e.setOutStart(o-c);e.setMain(u);e.clamped_new={inStart:s,outStart:o-c,main:u,fadeIn:h,fadeOut:c};var v=n.findPrevious(e.getStorageContainer());if(v&&v.display.getEnd()>s){dn(v.display,n,"left",s)}}}function vn(e,n,r,i,o){var u;if(!L||A!==0&&!A||!t.currentDisplay){console.log("Move display called when no display is selected!")}else if(L===TAG.TourAuthoring.DisplayParts["fade-in"]){var a=Math.constrain(t.timeManager.pxToTime(e.pivot.x-A),n,s+i);u=a-s}else if(L===TAG.TourAuthoring.DisplayParts["fade-out"]){var d=Math.constrain(t.timeManager.pxToTime(e.pivot.x-A),pt()-o-l,r-l);u=d-p}else if(L===TAG.TourAuthoring.DisplayParts["main"]){var v=Math.constrain(t.timeManager.pxToTime(e.pivot.x-A),n+f,r-l-c);u=v-h}return u}function mn(e,r,i,o){i=i||-1;o=o||-1;var u,a,f,l;var c=0;if(!L||A!==0&&!A){console.log("Move display called when no display is selected!")}else if(L===TAG.TourAuthoring.DisplayParts["fade-in"]){for(a=0;a<e.length;a++){l=e[a];if(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image){u=l.getChildDisplays();c=l.getLongestSubgroup(u)}if(l.getEnd()-r>=c){var h=l.getStart();if(i!==-1){h=i}else{h=h+r}l.setInStart(h);if(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image){for(f=0;f<u.length;f++){if(e.indexOf(u[f])===-1){l.clampDisplay(u[f])}}}}}}else if(L===TAG.TourAuthoring.DisplayParts["fade-out"]){for(a=0;a<e.length;a++){l=e[a];if(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image){u=l.getChildDisplays();c=l.getLongestSubgroup(u)}if(l.getEnd()-r>=c){var d=l.getOutStart();if(o!==-1){p=o}else{d=d+r}l.setOutStart(d);if(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image){for(f=0;f<u.length;f++){if(e.indexOf(u[f])===-1){l.clampDisplay(u[f])}}}}}}else if(L===TAG.TourAuthoring.DisplayParts["main"]){for(a=0;a<e.length;a++){l=e[a];if(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image){u=l.getChildDisplays();c=l.getLongestSubgroup(u)}var v=l.getMainStart();var m=r+v;l.setMainStart(m,r);if(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image){for(f=0;f<u.length;f++){if(e.indexOf(u[f])===-1){l.clampDisplay(u[f])}}}l.getTrackFromDisplay().drawLines()}}else{console.log("currentDisplay.loc should be one of: 'fade-in', 'fade-out', or 'main'")}n.outStart=p;n.inStart=s;t.that.drawLines()}function gn(){return t.that}function yn(e,r,i,s,o){var u={pivot:{x:e}};t.currentDisplay=n;L=s;A=o;Jt(u,r,i,-1,-1);t.currentDisplay=null;L=null;A=null}function bn(e){y.map(function(t){t.translate(e)})}function wn(){if(D(s)<1884&&D(s)>1883)console.log("");p=s+f+c;x.css("left",D(s)+"px").css("width",D(f)+"px");N.css("left",D(h)+"px").css("width",D(c)+"px");C.css("left",D(p)+"px").css("width",D(l)+"px");T.css("left",D(s)-20+"px");k.css("left",D(p+l)-20+"px");y.map(function(e){e.scale()})}function En(e,r,i){if(u){var s=t.timeline.captureKeyframe(t.title),o,a,f;var l={loc:{x:Math.twoDecPlaces(t.timeManager.pxToTime(e)),y:t.type===TAG.TourAuthoring.TrackType.audio?r:48},gkey:S,display:n,data:s,displayDiv:N};var c=y.nearestNeighbors(l.loc.x,1);if(c[0]&&Math.abs(c[0].getTime()-l.loc.x)<.05||c[1]&&Math.abs(c[1].getTime()-l.loc.x)<.05){return null}o=TAG.TourAuthoring.Keyframe(l,t),a=TAG.TourAuthoring.Command({execute:function(){y.add(o);o.reactivateKeyframe();o.restoreHandlers();t.that.addKeyframeToLines(o);t.update()},unexecute:function(){o.remove(false,true);o.setDeselected();t.update()}});t.undoManager.logCommand(a);console.log("logging");y.add(o);if(t.that.getMinimizedState()){o.toggleCircle()}var h=document.createEvent("Event");h.initEvent("playerReloading",true,true);$("body")[0].dispatchEvent(h);return o}else{return null}}function Sn(e){y.remove(e)}function xn(e){y.add(e)}function Tn(){var e;keyframes.sort(kn);for(e=0;e<keyframes.length;e++){keyframes[e].updatePosition(e)}}function Nn(){return y.max()}function Cn(){return y}function kn(e,t){if(e.getTime()<t.getTime()){return-1}else if(e.getTime()===t.getTime){return 0}else{return 1}}function Ln(e,t){return e.getTime()<t.getTime()}function An(e,n,r,i){var s={},o=t.title+"-"+i;e.experienceStreams[o]={duration:c,data:{zIndex:t.timeline.getNumTracks()-t.that.getPos(),layerProperties:{passthrough:n}}};if(a){e.experienceStreams[o].data.transition={providerId:"FadeInOutTransitionService",inDuration:f,outDuration:l}}switch(t.type){case TAG.TourAuthoring.TrackType.artwork:e.experienceStreams[o].data.ContentType="<SingleDeepZoomImage/>";e.experienceStreams[o].header={};e.experienceStreams[o].header.defaultKeyframeSequence=o;e.experienceStreams[o].keyframes=On(r);break;case TAG.TourAuthoring.TrackType.image:e.experienceStreams[o].header={};e.experienceStreams[o].header.defaultKeyframeSequence=o;e.experienceStreams[o].keyframes=On(r);break;case TAG.TourAuthoring.TrackType.audio:e.experienceStreams[o].header={};e.experienceStreams[o].header.defaultKeyframeSequence=o;e.experienceStreams[o].keyframes=On(r);break;case TAG.TourAuthoring.TrackType.video:e.experienceStreams[o].data.markers={beginAt:0,endAt:c};break;case TAG.TourAuthoring.TrackType.ink:break;default:console.log("RIN track type not yet implemented")}}function On(e){var r,i=[],s;var o=g.getKeyframes(n.getStorageContainer());var u=o.getContents();if(u.length>0){if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.audio||t.type===TAG.TourAuthoring.TrackType.image){s=o.min().toRIN();s.offset=0;s.init=true;i.push(s)}o.map(function(e){i.push(e.toRIN())})}else if(e){s=e.toRIN();s.offset=0;s.init=true;i.push(s)}else if(t.type===TAG.TourAuthoring.TrackType.audio){s={offset:0,init:true,holdDuration:0,state:{sound:{volume:TAG.TourAuthoring.Constants.defaultVolume}}};i.push(s)}else if(u.length==0){console.log("capturing blank kf for reset");s=t.timeline.captureKeyframe(t.title);if(!s){s={state:{viewport:{region:{center:{x:0,y:0},span:{x:1,y:1}}}}}}s.offset=0;s.init=true;i.push(s)}return i}function Mn(e){var n={},r=t.title+"-"+e;n.experienceId=t.title;n.experienceStreamId=r;n.begin=s;n.duration=f+c;n.layer="foreground";n.zIndex=g.numTracks()-t.that.getPos();if(t.type===TAG.TourAuthoring.TrackType.audio){n.dominantMedia="audio";n.volume=1}else{n.dominantMedia="visual";n.volume=1}return n}function _n(e){}if(t.type===TAG.TourAuthoring.TrackType.audio){console.log("audio")}var n={},r,i,s=e.start||0,o=e.length||5,u=e.canKeyframe,a=e.canFade,f=a&&o>=1.5?e.fadeIn||.5:0,l=a&&o>=1.5?e.fadeOut||.5:0,c=o-(f+l),h=s+f,p=h+c,d,v,m,g=e.dataHolder,y,b=[],w=TAG.TourAuthoring.EditorMenu({type:TAG.TourAuthoring.MenuType.display,parent:n},t);n.inStart=s;n.fadeIn=f;n.fadeOut=l;n.oldStart=p;n.clamped_new={};n.clamped_init={};n.has_been_clamped=false;var E,S,x,T,N,C,k,L,A,O=false;var M=new DoublyLinkedList;var _;var D=t.timeManager.timeToPx,P=t.timeManager.pxToTime;n.setKeyframeTree=H;n.getChildDisplays=B;n.addChildDisplay=j;n.removeChildDisplay=F;n.initVisuals=I;I();n.restoreHandlers=q;n.toggleCircles=z;(function(){w.addInput("Start",TAG.TourAuthoring.MenuInputFormats.minSec,ht,X);w.addInput("Main Length",TAG.TourAuthoring.MenuInputFormats.minSec,vt,V);if(a){w.addInput("Fade-In",TAG.TourAuthoring.MenuInputFormats.sec,gt,J);w.addInput("Fade-Out",TAG.TourAuthoring.MenuInputFormats.sec,yt,K)}w.addButton("Delete","left",rt);w.addButton("Close","right",w.forceClose)})();n.setFadeInFromMenu=J;n.setFadeOutFromMenu=K;n.rightTapped=Q;n.closeMenu=G;n.setLoc=Z;n.getOffset=et;n.setOffset=tt;n.setcurrentDisplay=nt;n.removeHelper=rt;n.removeAttachedInkDisplays=it;var st=false;n.removeDisplay=ot;n.getRemoved=at;n.reloadDisplay=ft;var lt=0;n.released=ct;n.getStart=ht;n.getEnd=pt;n.getMainStart=dt;n.getMain=vt;n.getOutStart=mt;n.getFadeIn=gt;n.getFadeOut=yt;n.getTotalLength=bt;n.setTimes=wt;n.basicSetTimes=Et;n.getTimes=St;n.updateDispTimes=xt;n.resetVisuals=Tt;n.setMainStart=Nt;n.setInStart=Lt;n.setOutStart=At;n.setMain=Ot;n.setIn=Mt;n.setOut=_t;n.translateTo=Dt;n.getID=Pt;n.setID=Ht;n.getStorageContainer=Bt;n.setStorageContainer=jt;n.getTrack=Ft;n.getMediaLength=It;n.getMouseup=qt;n.getType=Rt;n.getMainD=Ut;n.getFioHandle=zt;n.getFinHandle=Wt;n.getLoc=Xt;n.suppressHandles=Vt;var $t;n.move=Jt;n.setParentDisplay=Kt;n.getParentDisplay=Qt;n.getLongestSubgroup=Gt;n.getAllChildDisplays=Yt;var Zt,en;var nn=function(){var e=Yt();var t=new HashTable;for(var n=0;n<e.length;n++){t.insert(e[n].getStart(),1);t.insert(e[n].getEnd(),1)}if(t.getLength()===0){return null}return t};var rn=function(e,t){if(e.key<t.key){return-1}else if(e.key>t.key){return 1}else{return 0}};var sn=function(e,t){if(!t){return null}else if(e<t.key){return-1}else if(e>t.key){return 1}else{return 0}};n.getParentArtDisplay=hn;n.clampDisplay=pn;n.slideDisplay=dn;n.getTranslation=vn;n.msMove=mn;n.getTrackFromDisplay=gn;n.internalMove=yn;n.scale=wn;n.addKeyframe=En;n.removeKeyframe=Sn;n.insertKeyframe=xn;n.sortKeyframes=Tn;n.getLastKeyframe=Nn;n.getKeyframes=Cn;n.toES=An;n.toScreenPlayEntry=Mn;n.loadRIN=_n;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.MenuInputFormats");TAG.Util.makeNamespace("TAG.TourAuthoring.EditorMenu");TAG.TourAuthoring.MenuInputFormats={minSec:1,sec:2,percent:3};TAG.TourAuthoring.MenuType={display:1,keyframe:2,track:3};TAG.TourAuthoring.EditorMenu=function(e,t){"use strict";function l(e){var i=t.timeline.getCloseMenu();if(i){i()}if(t.that.getEventsPaused())return;t.timeline.allDeselected();t.timeline.setisMenuOpen(true);t.timeline.setCloseMenu(h);t.that.updateTracksEventsPaused(true);if(e)y(e);g();t.currentDisplay=null;if(t.currentKeyframe){t.currentKeyframe.setDeselected();t.currentKeyframe=null}if(!r.data("events")||!r.data("events").click){r.on("click",function(e){f.map(m);e.stopImmediatePropagation()})}if(!r.data("events")||!r.data("events").MSPointerDown){r.on("MSPointerDown",function(e){f.map(m);e.stopImmediatePropagation()})}if(!r.data("events")||!r.data("events").mousedown){r.on("mousedown",function(e){f.map(m);e.stopImmediatePropagation()})}t.root.on("mousedown.editorMenu",function(e){var t,r=false;for(t=0;t<f.length;t++){if($(e.target).parents().index(f[t].input)===-1){r=true;break}}n.close()})}function c(e){h(e)}function h(e){var n;t.root.off("mousedown.editorMenu");t.timeline.setisMenuOpen(false);t.timeline.setCloseMenu(null);t.that.updateTracksEventsPaused(false);r.hide();i.hide();if(!e){for(n=0;n<f.length;n++){m(f[n])}}}function p(e,t,n,i){var s={},o=$(document.createElement("div")),u=$(document.createElement("div")),a=$(document.createElement("input")),l=$(document.createElement("text"));a.attr("type","text");a.val(E(n(),t));a.css({width:"15%",position:"absolute",right:"40%","font-size":".65em"});a.on("click",function(e){a.select();e.stopImmediatePropagation()});a.on("MSPointerDown",function(e){e.stopImmediatePropagation()});a.keypress(function(e){if(e.keyCode===13){m(s);g()}});l.css({position:"absolute","float":"right","font-size":"0.95em",right:"15px"});switch(t){case TAG.TourAuthoring.MenuInputFormats.minSec:l.text("min:sec");break;case TAG.TourAuthoring.MenuInputFormats.sec:l.text("secs");break;case TAG.TourAuthoring.MenuInputFormats.percent:l.text("percent")}o.css({width:"95%","margin-left":"auto","margin-right":"auto","font-size":"0.8em","padding-top":"3%"});o.append(e);o.append(a);o.append(l);r.append(o);s.input=a;s.accessCallback=n;s.updateCallback=i;s.format=t;f.push(s)}function d(e){var t=$(document.createElement("label"));t.text(e);t.css({left:"auto",top:"auto",position:"relative","font-size":"0.8em",color:"rgb(256, 256, 256)",display:"block",padding:"4%","text-align":"center"});r.append(t)}function v(e,t,n){var i=$(document.createElement("label"));i.text(e);i.css({left:"0%",position:"relative",top:"5%","font-size":"0.8em",color:"rgb(256, 256, 256)",display:"block",padding:"10px 0","text-align":"center","margin-left":"3%","margin-right":"3%","float":t});switch(s){case TAG.TourAuthoring.MenuType.track:i.css({width:"93%",height:"16%","border-style":"solid","border-width":"2px","margin-left":"3%","margin-right":"3%","margin-bottom":"3%",top:""}).css("border-radius","3.5px");break}r.append(i);TAG.Util.makeManipulatable(i[0],{onTapped:n});return i}function m(e){function s(e,n,r){var i={execute:function(){e.setTimes(r)},unexecute:function(){console.log("init: "+n.inStart+", new: "+r.inStart);e.setTimes(n)}};t.undoManager.logCommand(i);e.has_been_clamped=false}var n,r=e.accessCallback(),i=e.input.val();if(b(i)){i=w(i,e.format);if(Math.abs(r-i)>TAG.TourAuthoring.Constants.epsilon){t.timeline.clamped_displays.length=0;n={execute:function(){e.updateCallback(i);e.input.val(E(e.accessCallback(),e.format));t.update()},unexecute:function(){e.updateCallback(r);e.input.val(E(e.accessCallback(),e.format));t.update()}};n.execute();t.undoManager.logCommand(n);var o=t.timeline.clamped_displays.length;for(var u=0;u<o;u++){var a=t.timeline.clamped_displays[u];s(a,a.clamped_init,a.clamped_new)}t.undoManager.combineLast(o+1)}}e.input.val(E(e.accessCallback(),e.format))}function g(){var e,t;for(e=0;e<f.length;e++){t=f[e];t.input.val(E(t.accessCallback(),t.format))}}function y(e){var n,o,a,f,l;r.show();i.show();switch(s){case TAG.TourAuthoring.MenuType.display:case TAG.TourAuthoring.MenuType.keyframe:n=t.track.offset().left+e.position.x-r.width()/2;a=n+r.width()/2-i.width()/2;f=t.track.offset().top;o=f-r.height()-3;n=Math.min(n,$(document).width()-r.width());break;case TAG.TourAuthoring.MenuType.track:o=t.track.offset().top+t.track.height()/2-r.height()/2;f=o+r.height()/2-i.height()/2;o=Math.min(o,(u.offset().top+u.height())/2+$(document).height()/2-r.height());n=r.offset().left;a=i.offset().left;break}r.css({left:n+"px",top:o+"px"});i.css({left:a+"px",top:f+"px"})}function b(e){var t,n,r=0;if(!e){return false}for(t=0;t<e.length;t){n=e.charAt(t);if(n===":"){r++}if(r>1||isNaN(parseFloat(n))&&n!="."&&n!=":"){return false}t=t+1}return true}function w(e,t){var n,r;switch(t){case TAG.TourAuthoring.MenuInputFormats.minSec:e=e.split(":");if(e.length===1){return parseFloat(e[0])}else{if(e[0])n=parseFloat(e[0]);else n=0;r=parseFloat(e[1]);return r+60*n}break;case TAG.TourAuthoring.MenuInputFormats.sec:case TAG.TourAuthoring.MenuInputFormats.percent:return parseFloat(e)}}function E(e,t){var n,r;switch(t){case TAG.TourAuthoring.MenuInputFormats.minSec:n=Math.floor(e/60);if(n<10)n="0"+n;r=e%60;r=x(r);if(r<10)r="0"+r;return n+":"+r;case TAG.TourAuthoring.MenuInputFormats.sec:case TAG.TourAuthoring.MenuInputFormats.percent:return x(e)+""}}function x(e){return Math.round(e*S)/S}var n={},r=$(document.createElement("div")),i=$(document.createElement("img")),s=e.type,o=e.parent,u=t.timeline.getTrackBody(),a=.95,f=[];n.menuCloseable=true;r.addClass("displayMenu");(function(){var n,o;switch(s){case TAG.TourAuthoring.MenuType.display:n="22%";break;case TAG.TourAuthoring.MenuType.keyframe:n="18%";break;case TAG.TourAuthoring.MenuType.track:n="15%";break}r.css({position:"fixed",color:"rgb(256, 256, 256)",width:n,"background-color":"rgba(0,0,0,"+a+")","padding-top":"3px","padding-left":"2px","padding-right":"2px","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+7,"border-radius":"15px"});switch(s){case TAG.TourAuthoring.MenuType.display:break;case TAG.TourAuthoring.MenuType.keyframe:break;case TAG.TourAuthoring.MenuType.track:r.css({left:"18%",padding:".5%","margin-top":"1%","float":"left",clear:"left","border-radius":"5%"});break}t.track.append(r);r.hide();t.timeline.isMenuOpen=false;r.on("MSPointerDown",function(e){f.map(m);e.stopImmediatePropagation()});r.on("mousedown",function(e){f.map(m);e.stopImmediatePropagation()});r.on("click",function(e){f.map(m);e.stopImmediatePropagation()});switch(s){case TAG.TourAuthoring.MenuType.display:case TAG.TourAuthoring.MenuType.keyframe:o=tagPath+"images/icons/KeyframeInfo-Opaque.png";break;case TAG.TourAuthoring.MenuType.track:o=tagPath+"images/icons/LeftPoint-Opaque.png";break}i.attr("src",o);i.css({position:"fixed",height:"45px",width:"54px","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+5,opacity:a});switch(s){case TAG.TourAuthoring.MenuType.track:i.css({left:"14%",height:"6%",width:"4%"});break;default:i.css({"margin-top":"-1px"});break}t.track.append(i);i.hide()})();n.open=l;n.close=c;n.forceClose=h;n.addInput=p;n.addTitle=d;n.addButton=v;var S=Math.pow(10,TAG.TourAuthoring.Constants.menuDecimals);return n};TAG.Util.makeNamespace("TAG.TourAuthoring.ImageTrack");TAG.TourAuthoring.ImageTrack=function(e,t){"use strict";e.type=TAG.TourAuthoring.TrackType.image;t=t||{};var n=TAG.TourAuthoring.Track(e,t);t.track.addClass("image");return n};TAG.Util.makeNamespace("TAG.TourAuthoring.InkAuthoring");TAG.TourAuthoring.InkMode={shapes:0,draw:1,erase:2,text:5};TAG.TourAuthoring.InkCallers={inkes:1,componentcontrols:2};TAG.TourAuthoring.InkAuthoring=function(e,t,n,r){"use strict";function Et(){l="#000000";c=1;h=7;p=5;b="#ffffff";w=.7;E=5;S="#000000";x=0;T="#000000";N=.8;C="isolate";M="'Times New Roman', serif";_="#ffffff";D="12px";P=1}function St(e,t){return parseFloat(e)*parseFloat(t)}function xt(e,t,n,r,i,s){var o;var u;var a={x:0,y:0,w:0,h:0};var l={x:0,y:0,w:0,h:0};var c={x:0,y:0,w:0,h:0};var h={x:0,y:0,w:0,h:0};var p,d,v,m;var g;if(t===undefined)t=S;if(n===undefined)n=x;if(r===undefined)r=b;if(i===undefined)i=w;if(s===undefined)s=E;e.attr({"stroke-width":s,stroke:r,"stroke-opacity":i,fill:t,"fill-opacity":n,"stroke-dasharray":"-"});var y,T;var N;var C=TAG.TourAuthoring.Constants.inkDragHandleRadius;if(e.data("type")=="ellipse"){var k=e.data("curr_rx");var L=e.data("curr_ry");var A=e.data("currx")+k;var O=e.data("curry")+L;var M=k/Math.sqrt(2);var _=L*Math.sqrt(1-M*M/(k*k));y=f.ellipse(A-M-s/2,O+s/2-_,C-2,C-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#296B2F","fill-opacity":.9}).data("type","grabHandle");T=f.ellipse(A+M+s/2,O+_+s/2,C-2,C-2).attr({"stroke-width":2,stroke:"#296B2F",fill:"#ffffff","fill-opacity":.9}).data("type","grabHandle");N=f.ellipse(A+M+s/2,O+s/2-_,C-2,C-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#880000","fill-opacity":.9}).data("type","grabHandle")}else if(e.data("type")=="rect"){var D=e.data("currx");var P=e.data("curry");var H=e.data("currw");var B=e.data("currh");y=f.ellipse(D,P,C-2,C-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#296B2F","fill-opacity":.9}).data("type","grabHandle");T=f.ellipse(D+H,P+B,C-2,C-2).attr({"stroke-width":2,stroke:"#296B2F",fill:"#ffffff","fill-opacity":.9}).data("type","grabHandle");N=f.ellipse(D+H,P,C-2,C-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#880000","fill-opacity":.9}).data("type","grabHandle")}y.data("curr_cx",y.attr("cx"));y.data("curr_cy",y.attr("cy"));T.data("curr_cx",T.attr("cx"));T.data("curr_cy",T.attr("cy"));N.data("curr_cx",N.attr("cx"));N.data("curr_cy",N.attr("cy"));var j=TAG.TourAuthoring.Command({execute:function(){e.show();y.show();T.show();N.show();e.data("visible","yes")},unexecute:function(){e.hide();y.hide();T.hide();N.hide();e.data("visible","no")}});j.execute();vt.logCommand(j);y.drag(function(t,n,r,i){g=true;e.toFront();y.toFront();T.toFront();N.toFront();var o=(a.w+s)/2;var u=(a.h+s)/2;var f=y.attr("rx");if(c.x+s+f+t<=o){t=o-c.x-f}if(c.y+f+s+n<=u){n=o-c.y-f}if(l.x+f+t+o>=si){t=si-o-l.x-f}if(l.y+f+n+u>=oi){n=oi-l.y-f-u}var h=parseInt(y.data("curr_cx"),10);var p=parseInt(y.data("curr_cy"),10);var d=h+t;var v=p+n;y.attr({cx:d,cy:v});var m=parseInt(T.data("curr_cx"),10);var b=parseInt(T.data("curr_cy"),10);d=m+t;v=b+n;T.attr({cx:d,cy:v});var w=parseInt(N.data("curr_cx"),10);var E=parseInt(N.data("curr_cy"),10);d=w+t;v=E+n;N.attr({cx:d,cy:v});var S,x;if(e.data("type")==="ellipse"){S=parseInt(e.data("currx"),10)+e.attr("rx");x=parseInt(e.data("curry"),10)+e.attr("ry")}else if(e.data("type")==="rect"){S=parseInt(e.data("currx"),10);x=parseInt(e.data("curry"),10)}d=S+t;v=x+n;e.attr({x:d,y:v,cx:d,cy:v})},function(t,n){g=false;p=e.getBBox();a.x=p.x;a.y=p.y;a.w=p.width;a.h=p.height;d=y.getBBox();l.x=d.x;l.y=d.y;l.w=d.width;l.h=d.height;v=T.getBBox();c.x=v.x;c.y=v.y;c.w=v.width;c.h=v.height;m=N.getBBox();h.x=m.x;h.y=m.y;h.w=m.width;h.h=m.height},function(t,n){if(!g){return}var r=y.getBBox().x;var i=y.getBBox().y;var s=y.getBBox().width;var o=y.getBBox().height;this.data("curr_cx",r+s/2);this.data("curr_cy",i+o/2);var u=T.getBBox().x;var f=T.getBBox().y;var p=T.getBBox().width;var d=T.getBBox().height;T.data("curr_cx",u+p/2);T.data("curr_cy",f+d/2);var v=N.getBBox().x;var m=N.getBBox().y;var b=N.getBBox().width;var w=N.getBBox().height;N.data("curr_cx",v+b/2);N.data("curr_cy",m+w/2);var E=e.getBBox().x;var S=e.getBBox().y;var x=e.getBBox().width;var C=e.getBBox().height;if(e.data("type")=="ellipse"){e.data("currx",e.attr("cx")-e.attr("rx"));e.data("curry",e.attr("cy")-e.attr("ry"));e.data("curr_rx",e.attr("rx"));e.data("curr_ry",e.attr("ry"))}else if(e.data("type")=="rect"){e.data("currx",e.attr("x"));e.data("curry",e.attr("y"))}var k=a.x;var L=a.y;var A=a.w;var O=a.h;var M=l.x;var _=l.y;var D=l.w;var P=l.h;var H=c.x;var B=c.y;var j=c.w;var F=c.h;var I=h.x;var q=h.y;var R=h.w;var U=h.h;var z=TAG.TourAuthoring.Command({execute:function(){e.data("currx",E);e.data("curry",S);e.data("currw",x);e.data("currh",C);e.data("curr_rx",x/2);e.data("curr_ry",C/2);e.attr({cx:E+x/2,cy:S+C/2,rx:x/2,ry:C/2,x:E,y:S,width:x,height:C});y.data("curr_cx",r+s/2);y.data("curr_cy",i+o/2);y.attr({cx:r+s/2,cy:i+o/2,rx:s/2,ry:o/2});T.data("curr_cx",u+p/2);T.data("curr_cy",f+d/2);T.attr({cx:u+p/2,cy:f+d/2,rx:p/2,ry:d/2});N.data("curr_cx",v+b/2);N.data("curr_cy",m+w/2);N.attr({cx:v+b/2,cy:m+w/2,rx:b/2,ry:w/2})},unexecute:function(){e.data("currx",k);e.data("curry",L);e.data("currw",A);e.data("currh",O);e.data("curr_rx",A/2);e.data("curr_ry",O/2);e.attr({cx:k+A/2,cy:L+O/2,rx:A/2,ry:O/2,x:k,y:L,width:A,height:O});y.data("curr_cx",M+D/2);y.data("curr_cy",_+P/2);y.attr({cx:M+D/2,cy:_+P/2});T.data("curr_cx",H+j/2);T.data("curr_cy",B+F/2);T.attr({cx:H+j/2,cy:B+F/2});N.data("curr_cx",I+R/2);N.data("curr_cy",q+U/2);N.attr({cx:I+R/2,cy:q+U/2})}});z.execute();vt.logCommand(z)});T.drag(function(t,n,r,i){g=true;e.toFront();y.toFront();T.toFront();N.toFront();var s=parseInt(T.data("curr_cx"),10);var o=parseInt(T.data("curr_cy"),10);var u=s+t;var a=o+n;var f=y.attr("cx");var l=y.attr("cy");var c=TAG.TourAuthoring.Constants.inkDragHandleRadius;if(u-f>2*c){T.attr({cx:u});N.attr({cx:u})}if(a-l>2*c){T.attr({cy:a})}var h=this.attr("cx");var p=this.attr("cy");var d=e.attr("rx");var v=f+(h-f)/2;var m=l+(p-l)/2;var b=(h-f)/2*Math.sqrt(2);e.attr({cx:v,cy:m,rx:b,ry:b*Math.sqrt(-(p-m)*(p-m)/((h-v)*(h-v)-b*b)),width:h-f,height:p-l})},function(t,n){g=false;var r=e.getBBox();a.x=r.x;a.y=r.y;a.w=r.width;a.h=r.height;r=y.getBBox();l.x=r.x;l.y=r.y;l.w=r.width;l.h=r.height;r=T.getBBox();c.x=r.x;c.y=r.y;c.w=r.width;c.h=r.height;r=N.getBBox();h.x=r.x;h.y=r.y;h.w=r.width;h.h=r.height},function(t,n){if(!g){return}var r=T.getBBox().x;var i=T.getBBox().y;var s=T.getBBox().width;var o=T.getBBox().height;T.data("curr_cx",r+s/2);T.data("curr_cy",i+o/2);if(e.data("type")==="ellipse"){e.data("currx",e.attr("cx")-e.attr("rx"));e.data("curry",e.attr("cy")-e.attr("ry"));e.data("curr_rx",e.attr("rx"));e.data("curr_ry",e.attr("ry"))}else if(e.data("type")==="rect"){e.data("currx",e.attr("x"));e.data("curry",e.attr("y"));e.data("currw",e.attr("width"));e.data("currh",e.attr("height"))}var u=e.getBBox().x;var f=e.getBBox().y;var p=e.getBBox().width;var d=e.getBBox().height;var v=y.getBBox().x;var m=y.getBBox().y;var b=y.getBBox().width;var w=y.getBBox().height;var E=N.getBBox().x;var S=N.getBBox().y;var x=N.getBBox().width;var C=N.getBBox().height;var k=a.x;var L=a.y;var A=a.w;var O=a.h;var M=l.x;var _=l.y;var D=l.w;var P=l.h;var H=c.x;var B=c.y;var j=c.w;var F=c.h;var I=h.x;var q=h.y;var R=h.w;var U=h.h;var z=TAG.TourAuthoring.Command({execute:function(){e.data("currx",u);e.data("curry",f);e.data("currw",p);e.data("currh",d);e.data("curr_rx",p/2);e.data("curr_ry",d/2);e.attr({cx:u+p/2,cy:f+d/2,rx:p/2,ry:d/2,x:u,y:f,width:p,height:d});y.data("curr_cx",v+b/2);y.data("curr_cy",m+w/2);y.attr({cx:v+b/2,cy:m+w/2,rx:b/2,ry:w/2});T.data("curr_cx",r+s/2);T.data("curr_cy",i+o/2);T.attr({cx:r+s/2,cy:i+o/2,rx:s/2,ry:o/2});N.data("curr_cx",E+x/2);N.data("curr_cy",S+C/2);N.attr({cx:E+x/2,cy:S+C/2,rx:x/2,ry:C/2})},unexecute:function(){e.data("currx",k);e.data("curry",L);e.data("currw",A);e.data("currh",O);e.data("curr_rx",A/2);e.data("curr_ry",O/2);e.attr({cx:k+A/2,cy:L+O/2,rx:A/2,ry:O/2,x:k,y:L,width:A,height:O});y.data("curr_cx",M+D/2);y.data("curr_cy",_+P/2);y.attr({cx:M+D/2,cy:_+P/2});T.data("curr_cx",H+j/2);T.data("curr_cy",B+F/2);T.attr({cx:H+j/2,cy:B+F/2});N.data("curr_cx",I+R/2);N.data("curr_cy",q+U/2);N.attr({cx:I+R/2,cy:q+U/2})}});z.execute();vt.logCommand(z)});e.drag(function(t,n,r,i){g=true;this.toFront();y.toFront();T.toFront();N.toFront();var o=(a.w+s)/2;var u=(a.h+s)/2;var f=y.attr("rx");if(c.x+s+f+t<=o){t=o-c.x-f}if(c.y+f+s+n<=u){n=o-c.y-f}if(l.x+f+t+o>=si){t=si-o-l.x-f}if(l.y+f+n+u>=oi){n=oi-l.y-f-u}var h=parseInt(y.data("curr_cx"),10);var p=parseInt(y.data("curr_cy"),10);var d=h+t;var v=p+n;y.attr({cx:d,cy:v});var m=parseInt(T.data("curr_cx"),10);var b=parseInt(T.data("curr_cy"),10);d=m+t;v=b+n;T.attr({cx:d,cy:v});var w=parseInt(N.data("curr_cx"),10);var E=parseInt(N.data("curr_cy"),10);d=w+t;v=E+n;N.attr({cx:d,cy:v});var S,x;if(e.data("type")=="ellipse"){S=parseInt(this.data("currx"),10)+this.attr("rx");x=parseInt(this.data("curry"),10)+this.attr("ry")}else if(e.data("type")=="rect"){S=parseInt(this.data("currx"),10);x=parseInt(this.data("curry"),10)}d=S+t;v=x+n;this.attr({x:d,y:v,cx:d,cy:v})},function(t,n){g=false;var r=e.getBBox();a.x=r.x;a.y=r.y;a.w=r.width;a.h=r.height;r=y.getBBox();l.x=r.x;l.y=r.y;l.w=r.width;l.h=r.height;r=T.getBBox();c.x=r.x;c.y=r.y;c.w=r.width;c.h=r.height;r=N.getBBox();h.x=r.x;h.y=r.y;h.w=r.width;h.h=r.height},function(t,n){if(!g){return}var r=y.getBBox().x;var i=y.getBBox().y;var s=y.getBBox().width;var o=y.getBBox().height;y.data("curr_cx",r+s/2);y.data("curr_cy",i+o/2);var u=T.getBBox().x;var f=T.getBBox().y;var p=T.getBBox().width;var d=T.getBBox().height;T.data("curr_cx",u+p/2);T.data("curr_cy",f+d/2);if(e.data("type")=="ellipse"){e.data("currx",e.attr("cx")-e.attr("rx"));e.data("curry",e.attr("cy")-e.attr("ry"));e.data("curr_rx",e.attr("rx"));e.data("curr_ry",e.attr("ry"))}else if(e.data("type")=="rect"){e.data("currx",e.attr("x"));e.data("curry",e.attr("y"))}var v=e.getBBox().x;var m=e.getBBox().y;var b=e.getBBox().width;var w=e.getBBox().height;var E=N.getBBox().x;var S=N.getBBox().y;var x=N.getBBox().width;var C=N.getBBox().height;var k=a.x;var L=a.y;var A=a.w;var O=a.h;var M=l.x;var _=l.y;var D=l.w;var P=l.h;var H=c.x;var B=c.y;var j=c.w;var F=c.h;var I=h.x;var q=h.y;var R=h.w;var U=h.h;var z=TAG.TourAuthoring.Command({execute:function(){e.data("currx",v);e.data("curry",m);e.data("currw",b);e.data("currh",w);e.data("curr_rx",b/2);e.data("curr_ry",w/2);e.attr({cx:v+b/2,cy:m+w/2,rx:b/2,ry:w/2,x:v,y:m,width:b,height:w});y.data("curr_cx",r+s/2);y.data("curr_cy",i+o/2);y.attr({cx:r+s/2,cy:i+o/2,rx:s/2,ry:o/2});T.data("curr_cx",u+p/2);T.data("curr_cy",f+d/2);T.attr({cx:u+p/2,cy:f+d/2,rx:p/2,ry:d/2});N.data("curr_cx",E+x/2);N.data("curr_cy",S+C/2);N.attr({cx:E+x/2,cy:S+C/2,rx:x/2,ry:C/2})},unexecute:function(){e.data("currx",k);e.data("curry",L);e.data("currw",A);e.data("currh",O);e.data("curr_rx",A/2);e.data("curr_ry",O/2);e.attr({cx:k+A/2,cy:L+O/2,rx:A/2,ry:O/2,x:k,y:L,width:A,height:O});y.data("curr_cx",M+D/2);y.data("curr_cy",_+P/2);y.attr({cx:M+D/2,cy:_+P/2});T.data("curr_cx",H+j/2);T.data("curr_cy",B+F/2);T.attr({cx:H+j/2,cy:B+F/2});N.data("curr_cx",I+R/2);N.data("curr_cy",q+U/2);N.attr({cx:I+R/2,cy:q+U/2})}});z.execute();vt.logCommand(z)});N.mousedown(function(){var t=TAG.TourAuthoring.Command({execute:function(){e.hide();y.hide();T.hide();N.hide();e.data("visible","no")},unexecute:function(){e.show();y.show();T.show();N.show();e.data("visible","yes")}});t.execute();vt.logCommand(t)})}function Tt(){return vt}function Nt(e,t,n,r){var i;On(TAG.TourAuthoring.InkMode.shapes);if(e===undefined)e=100+Math.random()*10;if(t===undefined)t=100+Math.random()*10;if(n===undefined)n=50;if(r===undefined)r=50;i=f.ellipse(e,t,n,r);i.data("currx",i.getBBox().x);i.data("curry",i.getBBox().y);i.data("curr_rx",n);i.data("curr_ry",r);i.data("type","ellipse");xt(i)}function Ct(e,t,n){var r=e.rc;var i;var s=0;var u=0;var a;var l;var c=o.width();var h=o.height();if(t===undefined)t=T;if(n===undefined)n=N;r.mouseover(function(){if(!u&&z==3){i=r.glow({width:10,color:"#33ff00",opacity:.8})}});r.mouseout(function(){if(z==3)i.remove()});r.attr({"stroke-width":0,stroke:"#222222",fill:"#ffffff","fill-opacity":0});r.data("surr-fill",t);r.data("surr-opac",n);var p=f.set();p.push(e.rn,e.re,e.rs,e.rw);p.attr({"stroke-width":0,stroke:"#222222",fill:t,"fill-opacity":n});r.drag(function(t,n,r,i){if(z==3){this.toFront();var o=this.getBBox();if(!s){var u=parseInt(this.data("currx"),10);var f=parseInt(this.data("curry"),10);var p=u+t;var d=f+n;this.attr({x:p,y:d});e.rn.attr({height:d});e.re.attr({x:p+o.width,y:d,width:c-(p+o.width),height:o.height});e.rs.attr({y:d+o.height,height:h-(d+o.height)});e.rw.attr({y:d,width:p,height:o.height})}else{this.attr({width:o.width+r-a,height:o.height+i-l});e.rs.attr({y:o.y+o.height+i-l,height:h-(o.y+o.height+i-l)});e.re.attr({x:o.x+o.width+r-a,width:c-(o.x+o.width+r-a),height:o.height+i-l});e.rw.attr({height:o.height+i-l})}a=r;l=i}},function(e,t){if(z==3){a=e;l=t;var n=this.getBBox();var r=parseFloat(o.css("left"));var f=parseFloat(o.css("top"));if(arguments[2].offsetX>n.x+n.width*.5&&arguments[2].offsetY>n.y+n.height*.5){s=1}i.remove();u=1;this.animate({opacity:.25},500,"<>")}},function(){if(z==3){this.data("currx",this.getBBox().x);this.data("curry",this.getBBox().y);e.re.data("currx",this.getBBox().x+this.getBBox().width);e.rs.data("curry",this.getBBox().y+this.getBBox().height);s=0;this.animate({opacity:1},500,"<>");u=0}})}function kt(e,t){var n;On(TAG.TourAuthoring.InkMode.shapes);if(e===undefined)e=200+Math.random()*10;if(t===undefined)t=200+Math.random()*10;n=f.rect(e,t,100,100);n.data("currx",e);n.data("curry",t);n.data("currw",100);n.data("currh",100);n.data("type","rect");xt(n)}function Lt(){return F}function At(e,t,n,r,i,s,u){e=e||75;t=t||75;i=i||"Your text here";F=f.text(e,t,i);F.data({type:"text",str:i});F.attr({"alignment-baseline":"before-edge","text-anchor":"start"});On(TAG.TourAuthoring.InkMode.text);F.attr({"font-family":M,"font-size":D,fill:_});F.attr("text",i);F.data({font:M,fontsize:D,color:_});if(s){var a;if(u){a=u}else{a=bn(F.data("fontsize"),o.height())*o.height()}F.attr({"font-size":a});F.data({fontsize:a})}Pn(F)}function Ot(e,t){var n=e.x,r=e.y,i=e.width,s=e.height,u,a,l,c;u=et/X.w;a=u*(s/i);l=-X.x*u;c=-X.y*u;if(ln({x:n,y:r,w:i,h:s},{x:ot,y:ut,w:at,h:ft})){var h=et/u;var p=tt/a;var d=i*h;var v=s*p;var m=d/et*(Y-l)+n;var g=v/tt*(Z-c)+r;var y=d/ht;K=i/it;if(!k.length||C==="block"){var b=et/K;var w=tt/K;f.setViewBox(-m/K,-g/K,b,w)}else{var E=o.width();var S=o.height();nn=E;rn=S;dn(-lt/et,-ct/tt,{cw:E,ch:S},0);Sn(y,y);dn(m/et,g/tt,{cw:E,ch:S},1)}lt=m;ct=g;ht=d;pt=v;ot=n;ut=r;at=i;ft=s}}function Mt(e,t){var n=e.x,r=e.y,i=e.width,s=e.height,u,a,f,l;try{u=et/X.w;a=u*(s/i);f=-X.x*u;l=-X.y*u}catch(c){console.log("ERROR in adjustViewBox: "+c);f=nt;l=rt;u=it;a=st}if(dt===0){self.origpx=n;self.origpy=r;self.origpw=i;self.origph=s}if(ln({x:n,y:r,w:i,h:s},{x:ot,y:ut,w:at,h:ft})){var h=$("[ES_ID='"+J+"']");var p=et/u;var d=tt/a;var v=i*p;var m=s*d;var g=v/et*(Y-f)+n;var y=m/tt*(Z-l)+r;var b=v/ht;var w=m/pt;var E=o.width();var S=o.height();dn(-lt/et,-ct/tt,{cw:E,ch:S},0);Sn(b,w);dn(g/et,y/tt,{cw:E,ch:S},1);lt=g;ct=y;ht=v;pt=m;ot=n;ut=r;at=i;ft=s;var x;try{x=parseInt(t||h[0].style.opacity,10)}catch(c){console.log("error in adjustViewBox: "+c)}dt=x}}function _t(e){var t="";var n=[""];var r=Raphael.parsePathString(e);var i=[];var s=0;var o=G.width();var u=G.height();var a;for(var f=r.length-2;f>=0;f--){if(r[f][0]=="z"){t+="M"+i[0]+","+i[1];for(a=2;a<i.length;a++){t+=a%6==2?"C"+i[a]:i[a];t+=a%6!=1?",":""}t+="z";i.length=0;i=[]}else if(r[f][0]=="M"){i.push(r[f][1]);i.push(r[f][2])}else{i.push(r[f][5]);i.push(r[f][6]);i.push(r[f][3]);i.push(r[f][4]);i.push(r[f][1]);i.push(r[f][2])}}t+="M"+i[0]+","+i[1];for(a=2;a<i.length;a++){t+=a%6==2?"C"+i[a]:i[a];t+=a%6!=1?",":""}t+="z";t+="M-5,-5L"+(o+5)+",-5L"+(o+5)+","+(u+5)+"L-5,"+(u+5)+"L-5,-5z";return t}function Dt(e,t){function w(e,t){return e.t1-t.t1}function S(e,t){return e.t2-t.t2}var n=[];var r,i,s,o,u;var a=0;if(t==="")return e;var f=Raphael.parsePathString(e);for(r=0;r<f.length;r++){if(f[r][0]=="z"){f.splice(r,1);r--}}var l=Raphael.parsePathString(t);var c=0;for(r=0;r<l.length;r++){if(l[r][0]=="z"){l.splice(r,1);r--;c++}}var h=[];for(r=0;r<f.length-1;r++){s=f[r];o=f[(r+1)%f.length];u=s.length;h.push({x:s[u-2],y:s[u-1],ax1:o[1],ay1:o[2],ax2:o[3],ay2:o[4]})}var p=[];for(r=0;r<l.length-1;r++){s=l[(r+1)%l.length];var d=(r+2)%l.length!==0?(r+2)%l.length:1;o=l[d];u=s.length;p.push({x:s[u-2],y:s[u-1],ax1:o[1],ay1:o[2],ax2:o[3],ay2:o[4]})}var v=0;for(r=0;r<h.length;r++){for(i=0;i<p.length;i++){if(Tn(h[r],p[i])){h[r].x+=1;h[r].y+=1;h[r].ax1+=1;h[r].ay1+=1;h[r].ax2+=1;h[r].ay2+=1;v=1;break}}}if(v){e="M"+h[0].x+","+h[0].y;var m;for(r=1;r<h.length;r++){m=h[r];var g=h[r-1];e+="C"+g.ax1+","+g.ay1+","+g.ax2+","+g.ay2+","+m.x+","+m.y}e+="C"+m.ax1+","+m.ay1+","+m.ax2+","+m.ay2+","+h[0].x+","+h[0].y;e+="z";f=Raphael.parsePathString(e);for(r=0;r<f.length;r++){if(f[r][0]=="z"){f.splice(r,1);r--}}}var y=Raphael.pathIntersection(e,t);var b=[[],[],[],[]];for(r=0;r<y.length;r++)b[y[r].segment1-1].push(y[r]);for(r=0;r<b.length;r++)b[r].sort(w);var E=[];for(r=0;r<l.length-c;r++)E.push([]);for(r=0;r<y.length;r++)E[y[r].segment2-1].push(y[r]);for(r=0;r<E.length;r++){E[r].sort(S)}var x="";if(y.length===0){if(yn(e,p[0].x,p[0].y))return C==="isolate"?t:e;if(yn(t,h[0].x,h[1].y))return C==="isolate"?e:t;return e+t}for(r=0;r<b.length;r++){if(!yn(t,h[r].x,h[r].y)&&!wn(h[r],n)){if(r===0)a=1;n.push({point:h[r],type:"endpoint",path:0})}var T=b[r];for(i=0;i<T.length;i++){if(!wn(T[i],n)){n.push({point:T[i],type:"intpoint",path:n.length?n[n.length-1].type:0})}var N=T[i].segment2-1;var k=N;var L=k;while(!yn(e,p[L].x,p[L].y)&&!wn(p,n)){var A=p[L];var O=1;var M=1;if(L==N){for(var _=0;_<E[L].length;_++){if(E[L][_].t2>T[i].t2){O=0;break}}}else{if(E[L].length>0)M=0}if(!O||!M||wn(A,n))break;n.push({point:p[L],type:"endpoint",path:1});k++;L=k%E.length}}}if(!yn(t,h[0].x,h[0].y)){n.push({point:h[0],type:"endpoint",path:0})}if(!Tn(n[n.length-1].point,n[0].point)){n.push(n[0])}var D=[];var P;for(r=0;r<n.length-1;r++){P=n[r];var H=n[(r+1)%n.length];var B=cn(P,H);var j=fn(P,H);D.push({ax1:B.x,ay1:B.y,ax2:j.x,ay2:j.y,x:H.point.x,y:H.point.y})}x="M"+D[D.length-1].x+","+D[D.length-1].y;for(r=0;r<D.length;r++){P=D[r];x+="C"+P.ax1+","+P.ay1+","+P.ax2+","+P.ay2+","+P.x+","+P.y}x+="z";return x}function Pt(){var e=G.width();var t=G.height();var n="";var r="";var i;var s=g.length;for(i=0;i<s;i++){g[i].remove()}g.length=0;for(i=0;i<d.length;i++){if(d[i]==="M"){n+="PATH::[pathstring]";r+="PATH::[pathstring]"}n+=d[i]+e*v[i][0]+","+t*v[i][1];r+=d[i]+v[i][0]+","+v[i][1];if(d[i+1]!="L"){n+="[stroke]"+m[i].color+"[strokeo]"+m[i].opacity+"[strokew]"+t*m[i].width+"[]|";r+="[stroke]"+m[i].color+"[strokeo]"+m[i].opacity+"[strokew]"+m[i].width+"[]|"}}var o=[];if(n.length>0){o=n.split("PATH::")}for(i=1;i<o.length;i++){var u=jt(o[i],"pathstring","s");var a=jt(o[i],"stroke","s");var l=jt(o[i],"strokeo","f");var c=jt(o[i],"strokew","f");var h=f.path(u);h.data("type","path");h.attr({"stroke-width":c,"stroke-opacity":l,stroke:a,"stroke-linejoin":"round","stroke-linecap":"round"});g.push(h)}y=r}function Ht(){En();var e=o.width();var t=o.height();var n="";var r=0;for(var i=0;i<L.length;i++){if(L[i]=="M"||L[i]=="L"){n+=L[i]+k[r]*e+","+k[r+1]*t;r+=2}else if(L[i]=="C"){n+="C"+k[r]*e;for(var s=1;s<6;s++){n+=","+(s%2?k[r+s]*t:k[r+s]*e)}r+=6}else if(L[i]=="z")n+="z";else console.log("ELSE: "+L[i])}var u=n;if(C=="isolate")u=_t(n);var a=f.path(u).attr({fill:T,"fill-opacity":N,"stroke-width":0}).data("type","trans");A="TRANS::[path]"+n+"[color]"+T+"[opac]"+N+"[mode]"+C+"[]";Fn()}function Bt(e){var t=o.width();var n=o.height();var r=p;for(var i=0;i<v.length;i++){if(e[0]-r<=t*v[i][0]&&t*v[i][0]<=e[0]+r){if(e[1]-r<=n*v[i][1]&&n*v[i][1]<=e[1]+r){if(d[i+1]==="L"){d[i+1]="M"}d.splice(i,1);v.splice(i,1);m.splice(i,1)}}}var s=false;for(var u=0;u<d.length;u++){if(d[u]==="L"){s=true;break}}if(!s){v.length=0;d.length=0;m.length=0}Pt()}function jt(e,t,n){if(n==="f")return parseFloat(e.split("["+t+"]")[1].split("[")[0]);if(n==="s")return e.split("["+t+"]")[1].split("[")[0];else return parseInt(e.split("["+t+"]")[1].split("[")[0],10)}function Ft(e,t){var n=U.split("["+e+"]");var r=n[1].split("]");r.splice(0,1);r[0]="[color]"+r[0];var i=r.join("]");U=n[0]+"[fontsize]"+t+i}function It(){return O}function qt(){return U}function Rt(e){var t=o.width();var n=o.height();var r="";for(var i=0;i<e.length;i++){e[i]=jn(e[i],t,n);e[i]=e[i][e[i].length-1]==="z"?e[i]:e[i]+"z"}while(e.length){var s=e[0];e.splice(0,1);if(e.length){var u=Raphael.parsePathString(s);for(var a=0;a<e.length;a++){var f=Raphael.parsePathString(e[a]);if(Raphael.pathIntersection(s,e[a]).length||yn(s,f[0][1],f[0][2])||yn(e[a],u[0][1],u[0][2])){s=Dt(e[a],s);e.splice(a,1);a=-1}}}r+=s}un(r)}function Ut(e,t,n){return{x:e.x/t,y:e.y/n,w:e.w/t,h:e.h/n}}function zt(){return o.find("svg")[0]}function Wt(){var e=Fn();var t=[];var n=o.width();var r=o.height();if(e===""){return}var i=e.split("|");for(var s=0;s<i.length;s++){var u=i[s];var a=u.split("::")[0];a=a.toLowerCase();switch(a){case"lrect":case"mrect":case"rect":var f=St(jt(u,"x","f"),n);var l=St(jt(u,"y","f"),r);var c=St(jt(u,"w","f"),n);var h=St(jt(u,"h","f"),r);var p={X:f,Y:l,w:c,h:h,type:"rect"};O+="BOUNDRECT::[x]"+f/n+"[y]"+l/r+"[w]"+c/n+"[h]"+h/r+"[fillc]#000000[fillo]0[strokec]"+jt(u,"strokec","s")+"[strokeo]"+jt(u,"strokeo","f")+"[strokew]"+jt(u,"strokew","f")+"[]|";t.push(p);break;case"lellipse":case"mellipse":case"ellipse":var d=St(jt(u,"cx","f"),n);var v=St(jt(u,"cy","f"),r);var m=St(jt(u,"rx","f"),n);var g=St(jt(u,"ry","f"),r);var y={cx:d,cy:v,rx:m,ry:g,type:"ellipse"};O+="BOUNDELLIPSE::[cx]"+d/n+"[cy]"+v/r+"[rx]"+m/n+"[ry]"+g/r+"[fillc]#000000[fillo]0[strokec]"+jt(u,"strokec","s")+"[strokeo]"+jt(u,"strokeo","f")+"[strokew]"+jt(u,"strokew","f")+"[]|";t.push(y);break}}Hn(t)}function Xt(){return $("#"+H).attr("value")===""}function Vt(e){if(!Br&&e==="")return true;var t=e.split("::")[0].toLowerCase();var n=false;switch(t){case"trans":if(e.split("[path]")[1].split("[")[0]==="")n=true;break;case"bezier":case"path":if(!Br&&e.split("[pathstring]")[1].split("[")[0]==="")n=true;break;case"text":if(e.split("[str]")[1].split("[")[0]==="")n=true;break;default:break}return n}function $t(e){yt.hideEditorOverlay();var t=TAG.Util.UI.popUpMessage(null,e,null);$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(t);$(t).fadeIn(500)}function Jt(e){var t=bt.getCurrentTime();var n=e.getStorageContainer().displays.nearestNeighbors(t,1)[0];if(n){return true}else{return false}}function Kt(){if(!a){a=yt.dataHolder}var e=a.getSelectedTrack();if(!e||e.getType()!==TAG.TourAuthoring.TrackType.artwork&&e.getType()!==TAG.TourAuthoring.TrackType.image){$t("There is no artwork or image track selected. Please select a valid track or create an unlinked annotation.");return false}if(Xt()){$t("Unable to attach an empty annotation. Please add to annotation component before attaching.");return false}var t=Jt(e);if(!t){$t("Please move the playhead within the currently selected track's display.");return false}var n=wt.captureKeyframe(e.getTitle());if(!n){$t("The track selected must be fully on screen in order to attach an annotation. Please seek to a location where the track is visible.");return false}Nn();return Zt()}function Qt(){if(Xt()){$t("Unable to attach an empty annotation. Please add to annotation component before attaching.");return false}if(!en())return false;return true}function Gt(){if(!a){a=yt.dataHolder}var e=a.getSelectedTrack();if(!e||e.getType()!==TAG.TourAuthoring.TrackType.artwork&&e.getType()!==TAG.TourAuthoring.TrackType.image){$t("There is no artwork or image track selected. Please select a valid track or create an unlinked annotation.");return false}var t=Jt(e);if(!t){$t("Please move the playhead within the currently selected track's display.");return false}var n=wt.captureKeyframe(e.getTitle());if(!n){$t("The track selected must be fully on screen in order to attach an annotation. Please seek to a location where the track is visible.");return false}Wt();return Zt()}function Yt(){if(Vt(Fn())){$t("Unable to attach an empty annotation. Please add to annotation component before attaching.");return false}Wt();en();return true}function Zt(){if(!a){a=yt.dataHolder}var e=a.getSelectedTrack();if(!e||e.getType()!==TAG.TourAuthoring.TrackType.artwork&&e.getType()!==TAG.TourAuthoring.TrackType.image){$t("There is no artwork or image track selected. Please select a valid track or create an unlinked annotation.");return false}if(Vt(Fn())){$t("Unable to attach an empty annotation. Please add to annotation component before attaching.");return false}var t=Jt(e);if(!t){$t("Please move the playhead within the currently selected track's display.");return false}V=e.getTitle();var n=o.width();var r=o.height();nn=n;rn=r;var i=$("[data-proxy='"+escape(V)+"']");var s={x:i.data("x"),y:i.data("y"),w:i.data("w"),h:i.data("h")};var u=Fn();var f=wt.captureKeyframe(V);if(!f){$t("The track selected must be fully on screen in order to attach an annotation. Please seek to a location where the track is visible.");return false}var l,c,h,p,d=e.getType();if(d===TAG.TourAuthoring.TrackType.artwork){l=f.state.viewport.region.center.x;c=f.state.viewport.region.center.y;h=f.state.viewport.region.span.x;p=f.state.viewport.region.span.y}else if(d===TAG.TourAuthoring.TrackType.image){h=1/f.state.viewport.region.span.x;var v=f.state.viewport.region.span.x*o.width();p=f.state.viewport.region.span.y;l=-f.state.viewport.region.center.x*h;c=-(o.height()/v)*f.state.viewport.region.center.y}var m=u.split("::")[0].toLowerCase();I=yt.addInkTrack(e,"Ink "+decodeURI(e.getTitle()),m);I.setInkLink(e);if(m==="trans")u+=O;I.setInkPath(u);I.setInkProps({});I.setInkInitKeyframe({x:l,y:c,w:h,h:p});I.setInkEnabled(true);I.setInkType(m);I.setInkRelativeArtPos(Ut(s,n,r));I.addInkTypeToTitle(m);W=true;o.remove();var g=bt.getCurrentTime();var y=e.getStorageContainer().displays.nearestNeighbors(g,1)[0].display;var b=y.getEnd();var w=I.addDisplay(bt.getCurrentPx(),Math.min(5,b-g));y.addChildDisplay(w);w.setParentDisplay(y);e.addAttachedInkTrack(I);I.setInkLink(e);gt.combineLast(2);if(a._trackArray.length>0){a._trackArray[0].track.leftAndRight({translation:{x:0}},false)}return true}function en(){function n(t){e.fadeOut(200)}var e=$(TAG.Util.UI.blockInteractionOverlay());var t=$(document.createElement("div"));if(Vt(Fn())){t.attr("id","inkEmptyDialog");t.css({display:"none",position:"fixed",top:"40%",left:"30%",width:"auto","background-color":"black",border:"3px double white","z-index":TAG.TourAuthoring.aboveRinZIndex+5,"text-align":"center",padding:"1.5% 1.5% 2% 2%"});e.append(t);$("body").append(e);e.fadeIn(100);var r=$(document.createElement("div"));r.text("Unable to attach an empty annotation. Please add to annotation component before attaching.");r.css("font-size","1.25em","text-align","left");t.append(r);var i=$(document.createElement("div"));i.css("text-align","center");var s=$(document.createElement("button"));s.text("OK");s.css({width:"auto","background-color":"black",border:"1px solid white","margin-top":"25px"});i.append(s);t.append(i);t.show();TAG.Util.makeManipulatable(s[0],{onTapped:n},false);return false}I=yt.addInkTrack(null,"Unattached Annotation",1);I.setInkLink(null);var u=Fn();var a=u.split("::")[0].toLowerCase();if(a=="trans")u+=O;I.setInkPath(u);I.setInkEnabled(false);I.setInkSize(D);I.setInkInitKeyframe({});I.setInkRelativeArtPos({});I.addInkTypeToTitle(a);W=false;o.remove();I.addDisplay(Math.min(bt.timeToPx(bt.getDuration().end-.5),bt.getCurrentPx()),Math.min(5,Math.max(.5,bt.getDuration().end-bt.getCurrentTime())));gt.combineLast(2);if(yt.getTracks().length>0){yt.getTracks()[0].leftAndRight({translation:{x:0}},false)}return true}function tn(){return u}function sn(){return rn}function on(e){var t=e.split("|");var n;var r=o.width();var i=o.height();nn=r;rn=i;Br="";var s=t.length;for(n=0;n<s;n++){var a=t[n];var l,c,h,p,d,v,g,b,w;if(a&&a!==""){var E=a.split("::")[0];switch(E.toLowerCase()){case"text":var S=jt(a,"fontsize","f")*i;D=S;l=jt(a,"x","f")*r;c=jt(a,"y","f")*i;try{h=jt(a,"w","f");p=jt(a,"h","f")}catch(x){h=null;p=null}var O=jt(a,"color","s");var M=jt(a,"font","s");var _=jt(a,"str","s");var P=f.text(l,c,_);P.attr({"font-family":M,"font-size":S+"px",fill:O,"text-anchor":"start"});P.data({x:l,y:c,w:h,h:p,fontsize:S,color:O,font:M,type:"text",str:_});u=P;break;case"path":if(!y)y="";y+=a+"|";In(a+"|");break;case"bezier":Br+=jt(a,"pathstring","s");m.push({color:jt(a,"stroke","s"),opacity:jt(a,"strokeo","f"),width:jt(a,"strokew","f")});break;case"trans":if(!A)A="";A+=a+"|";var H=jt(a,"path","s");T=jt(a,"color","s");N=jt(a,"opac","f");C=jt(a,"mode","s");k=H.match(/[0-9.\-]+/g);L=H.match(/[CMLz]/g);Ht();break;case"rect":l=St(jt(a,"x","f"),r);c=St(jt(a,"y","f"),i);h=St(jt(a,"w","f"),r);p=St(jt(a,"h","f"),i);d=jt(a,"fillc","s");v=jt(a,"fillo","f");g=jt(a,"strokec","s");b=jt(a,"strokeo","f");w=jt(a,"strokew","f");var B=f.rect(l,c,h,p);B.data("currx",l);B.data("curry",c);B.data("currw",h);B.data("currh",p);B.data("type","rect");B.data("visible","yes");xt(B,d,v,g,b,w);break;case"ellipse":var j=St(jt(a,"cx","f"),r);var F=St(jt(a,"cy","f"),i);var I=St(jt(a,"rx","f"),r);var q=St(jt(a,"ry","f"),i);d=jt(a,"fillc","s");v=jt(a,"fillo","f");g=jt(a,"strokec","s");b=jt(a,"strokeo","f");w=jt(a,"strokew","f");var R=f.ellipse(j,F,I,q);R.data("currx",R.getBBox().x);R.data("curry",R.getBBox().y);R.data("curr_rx",I);R.data("curr_ry",q);R.data("type","ellipse");R.data("visible","yes");xt(R,d,v,g,b,w);break;case"marquee":var U=St(jt(a,"x","f"),r);var z=St(jt(a,"y","f"),i);h=St(jt(a,"w","f"),r);p=St(jt(a,"h","f"),i);var X=jt(a,"surrfillc","s");var V=jt(a,"surrfillo","f");var $=U+h;var J=z+p;var K=f.rect(0,0,r,z);K.data("currx",0);K.data("curry",0);var Q=f.rect($,z,r-$,J-z);Q.data("currx",$);Q.data("curry",z);var G=f.rect(0,J,r,i-J);G.data("currx",0);G.data("curry",J);var Y=f.rect(0,z,U,J-z);Y.data("currx",0);Y.data("curry",z);var Z=f.rect(U,z,$-U,J-z);Z.data("currx",U);Z.data("curry",z);Z.data("type","marquee");break}}}Pt();if(Br){Yr()}if(W){f.setViewBox(0,0,r,i)}}function un(e){var t=o.width();var n=o.height();var r=f.path(e).attr({"fill-opacity":N,fill:T,"stroke-opacity":0,stroke:"#888888","stroke-width":0});r.data("type","trans");A="TRANS::[path]"+jn(e,1/t,1/n)+"[color]"+T+"[opac]"+N+"[mode]"+C+"[]|";Fn()}function an(e){var t=e.split("|");var n;var r=o.width();var i=o.height();for(n=0;n<t.length;n++){var s=t[n];var u,a,l,c,h;if(s&&s!==""){var p=s.split("::")[0];p=p.toLowerCase();switch(p){case"boundrect":var d=St(jt(s,"x","f"),r);var v=St(jt(s,"y","f"),i);var m=St(jt(s,"w","f"),r);var g=St(jt(s,"h","f"),i);u=jt(s,"fillc","s");a=jt(s,"fillo","f");l=jt(s,"strokec","s");c=jt(s,"strokeo","f");h=jt(s,"strokew","f");var y=f.rect(d,v,m,g);y.data("currx",d);y.data("curry",v);y.data("currw",m);y.data("currh",g);y.data("type","rect");y.data("visible","yes");xt(y,u,a,l,c,h);break;case"boundellipse":var b=St(jt(s,"cx","f"),r);var w=St(jt(s,"cy","f"),i);var E=St(jt(s,"rx","f"),r);var S=St(jt(s,"ry","f"),i);u=jt(s,"fillc","s");a=jt(s,"fillo","f");l=jt(s,"strokec","s");c=jt(s,"strokeo","f");h=jt(s,"strokew","f");var x=f.ellipse(b,w,E,S);x.data("currx",x.getBBox().x);x.data("curry",x.getBBox().y);x.data("curr_rx",E);x.data("curr_ry",S);x.data("type","ellipse");x.data("visible","yes");xt(x,u,a,l,c,h);break}}}}function fn(e,t){var n,r,i;if(e.type=="endpoint"){if(t.type=="endpoint"){return{x:e.point.ax2,y:e.point.ay2}}else{n=e.path===0?t.point.bez1:t.point.bez2;r=e.path===0?t.point.t1:t.point.t2;i=Raphael.findDotsAtSegment(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],r);return{x:i.m.x,y:i.m.y}}}else{if(t.type==="endpoint"){n=t.path===0?e.point.bez1:e.point.bez2;return{x:n[4],y:n[5]}}else{n=t.path===0?t.point.bez1:t.point.bez2;r=t.path===0?t.point.t1:t.point.t2;i=Raphael.findDotsAtSegment(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],r);return{x:i.n.x,y:i.n.y}}}}function ln(e,t){return Math.abs(e.x-t.x)>1e-8||Math.abs(e.y-t.y)>1e-8||Math.abs(e.w-t.w)>1e-8||Math.abs(e.h-t.h)>1e-8}function cn(e,t){if(e.type==="endpoint"){return{x:e.point.ax1,y:e.point.ay1}}else{var n=t.path===0?e.point.bez1:e.point.bez2;var r=t.path===0?e.point.t1:e.point.t2;var i=Raphael.findDotsAtSegment(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],r);return{x:i.n.x,y:i.n.y}}}function dn(e,t,n,r){var i=n.cw;var s=n.ch;var o;f.forEach(function(n){var r=n.data("type");if(r!="path"&&r!="bezier"&&r!="text"&&r!="trans"){n.attr({x:parseFloat(n.attr("x"))+e*i,y:parseFloat(n.attr("y"))+t*s,cx:parseFloat(n.attr("cx"))+e*i,cy:parseFloat(n.attr("cy"))+t*s});if(r=="ellipse"){n.data("currx",parseFloat(n.attr("cx"))-parseFloat(n.attr("rx")));n.data("curry",parseFloat(n.attr("cy"))-parseFloat(n.attr("ry")));n.data("curr_rx",n.attr("rx"));n.data("curr_ry",n.attr("ry"))}else{n.data("currx",n.attr("x"));n.data("curry",n.attr("y"))}}else if(r=="text"){n.attr({x:parseFloat(n.attr("x"))+e*i,y:parseFloat(n.attr("y"))+t*s});n.data("x",parseFloat(n.data("x"))+e*i);n.data("y",parseFloat(n.data("y"))+t*s);hn=n.attr("x");pn=n.attr("y")}});var u=v.length;for(o=0;o<u;o++){v[o][0]=v[o][0]+e;v[o][1]=v[o][1]+t}var a,l;a=Xr(Br);l=Vr(Br);for(o=0;o<a.length;o+=2){a[o]+=e;a[o+1]+=t}Br=$r(l,a);var c=k.length;for(o=0;o<c;o++){k[o]+=o%2?t:e}if(u&&r)Pt();if(c&&r)Ht();if(Br&&r)Yr();if(!u&&!c&&r){var h=Fn();En();U=h;on(U)}}function vn(){var e={x:hn,y:pn};return e}function mn(e,t,n){if(!n){f.forEach(function(e){e.transform("t-"+e.data("bboxcenterx")+",-"+e.data("bboxcentery")+"...")})}else{f.forEach(function(n){n.transform("t"+(e+n.data("bboxcenterx"))+","+(t+n.data("bboxcentery"))+"...")})}}function gn(e,t,n){f.forEach(function(n){var r=n.getBBox();n.transform("s"+e+"...");n.transform("t"+ -n.getBBox().x+","+ -n.getBBox().y+"...");n.transform("t"+r.x*e+","+r.y*t+"...")})}function yn(e,t,n){var r=Raphael.isPointInsidePath(e,t,n);var i=Raphael.isPointInsidePath(e,t-1,n-1);var s=Raphael.isPointInsidePath(e,t+1,n-1);var o=Raphael.isPointInsidePath(e,t-1,n+1);var u=Raphael.isPointInsidePath(e,t+1,n+1);if(r||i+s+o+u>=2)return 1;return 0}function bn(e,t){return parseFloat(e)/parseFloat(t)}function wn(e,t){for(var n=0;n<t.length-1;n++){if(Tn(t[n].point,e)){return 1}}return 0}function En(){f.clear();d.length=0;v.length=0;m.length=0;g.length=0;q.length=0;y="";U=""}function Sn(e,t,n){f.forEach(function(n){var r=n.data("type");if(r!=="path"&&r!=="bezier"&&r!=="text"&&r!=="trans"&&r!=="grabHandle"){n.attr({x:parseFloat(n.attr("x"))*e,y:parseFloat(n.attr("y"))*t,cx:parseFloat(n.attr("cx"))*e,cy:parseFloat(n.attr("cy"))*t,rx:parseFloat(n.attr("rx"))*e,ry:parseFloat(n.attr("ry"))*t,width:parseFloat(n.attr("width"))*e,height:parseFloat(n.attr("height"))*t});if(r==="ellipse"){n.data("currx",parseFloat(n.attr("cx"))-parseFloat(n.attr("rx")));n.data("curry",parseFloat(n.attr("cy"))-parseFloat(n.attr("ry")));n.data("curr_rx",parseFloat(n.attr("rx")));n.data("curr_ry",parseFloat(n.attr("ry")))}else{n.data("currx",n.attr("x"));n.data("curry",n.attr("y"))}}else if(r==="text"){n.attr({"font-size":parseFloat(n.attr("font-size"))*t,x:n.attr("x")*e,y:n.attr("y")*t});n.data({fontsize:n.data("fontsize")*t,x:n.data("x")*e,y:n.data("y")*t})}});var r=v.length;var i;for(i=0;i<r;i++){v[i][0]=v[i][0]*e;v[i][1]=v[i][1]*t;m[i].width=m[i].width*e}var s,o;s=Xr(Br);o=Vr(Br);for(i=0;i<s.length;i+=2){s[i]*=e;s[i+1]*=t}for(i=0;i<m.length;i++){m[i].width=m[i].width*e}Br=$r(o,s);var u=k.length;for(i=0;i<u;i++){k[i]*=i%2?t:e}if(r&&n)Pt();if(u&&n)Ht();if(Br&&n)Yr();if(!r&&!u&&n){var a=Fn();En();U=a;on(U)}}function xn(){var e=$("[data-proxy='"+escape(V)+"']");var t=X.x;var n=X.y;var r=X.w;var i=et/r;var s=i*(e.data("h")/e.data("w"));var o=-t*i;var u=-n*s;nt=o;rt=u;it=i;st=s;ot=nt;ut=rt;at=it;ft=st}function Tn(e,t,n){if(n===undefined)n=1e-5;return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}function Nn(){var e=F.left;var t=F.top;var n=f.text(e,t,str);n.attr("text-anchor","start");var r=n.attr("x");var i=n.attr("y");var s=n.getBBox();n.data({x:r+parseFloat(textboxelmt.css("padding-left")),y:i+s.height+parseFloat(textboxelmt.css("padding-top")),font:M,fontsize:D,color:_,str:str,type:"text"});Fn()}function Cn(e){V=e}function kn(){var e=zt();e.style.background="rgba(0, 0, 0, 0)";e.style.pointerEvents="all"}function Ln(e){J=e}function An(e){X=e}function On(e){e=parseInt(e,10);z=e}function Mn(e){dt=e}function _n(e){var t=X.x;var n=X.y;var r=X.w;var i=et/r;var s=i*(e.h/e.w);var o=-t*i;var u=-n*s;nt=o;rt=u;it=i;st=s;ot=nt;ut=rt;at=it;ft=st}function Dn(){U=""}function Pn(e){var t;var n=TAG.TourAuthoring.Constants.inkDragHandleRadius;var r=e.attrs.x,i=e.attrs.y,s={x:0,y:0},o={x:0,y:0},u=e.getBBox();var a=TAG.TourAuthoring.Constants.inkDragHandleRadius;t=f.ellipse(r,i,n-2,n-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#296B2F","fill-opacity":.8}).data("type","grabHandle");t.toFront();e.toFront();t.data("curr_cx",t.attr("cx"));t.data("curr_cy",t.attr("cy"));e.data({x:r,y:i});t.drag(function(n,r,i,o){var u=t.attr("rx");if(s.x+n<=u+5){n=u+5-s.x}if(s.y+r<=u+5){r=u+5-s.y}if(s.x+n>=si-(u+5)){n=si-(u+5)-s.x}if(s.y+r>=oi-(u+5)){r=oi-(u+5)-s.y}var a=parseInt(this.data("curr_cx"),10);var f=parseInt(this.data("curr_cy"),10);var l=a+n;var c=f+r;this.attr({cx:l,cy:c});e.attr("x",s.x+n);e.attr("y",s.y+r)},function(n,r){s.x=parseFloat(e.attrs.x);s.y=parseFloat(e.attrs.y);var i=t.getBBox();o.x=i.x;o.y=i.y;o.w=i.width;o.h=i.height},function(n,r){var i=this.getBBox().x;var u=this.getBBox().y;var a=this.getBBox().width;var f=this.getBBox().height;this.data("curr_cx",i+a/2);this.data("curr_cy",u+f/2);e.data({x:e.attrs.x,y:e.attrs.y});var l=parseFloat(e.attrs.x);var c=parseFloat(e.attrs.y);i=t.getBBox().x;u=t.getBBox().y;a=t.getBBox().width;f=t.getBBox().height;var h=s.x;var p=s.y;var d=s.w;var v=s.h;var m=o.x;var g=o.y;var y=o.w;var b=o.h;var w=TAG.TourAuthoring.Command({execute:function(){F.attr({x:l});F.attr({y:c});e.attr({x:l,y:c});e.data({x:l,y:c});t.data("curr_cx",i+a/2);t.data("curr_cy",u+f/2);t.attr({cx:i+a/2,cy:u+f/2,rx:a/2,ry:f/2})},unexecute:function(){F.attr({x:h});F.attr({y:p});e.attr({x:h,y:p});e.data({x:h,y:p});t.data("curr_cx",m+y/2);t.data("curr_cy",g+b/2);t.attr({cx:m+y/2,cy:g+b/2})}});w.execute();vt.logCommand(w)})}function Hn(e){var t=o.width();var n=o.height();var r=[];En();for(var i=0;i<e.length;i++){var s=e[i];var u;var a=s.type.toLowerCase();if(s.type=="rect"){var f=parseFloat(s.X)/t;var l=parseFloat(s.Y)/n;var c=parseFloat(s.w)/t;var h=parseFloat(s.h)/n;var p=10/t;var d=10/n;u="M"+f+","+l+"C"+(f+p)+","+l+","+(f+c-p)+","+l+","+(f+c)+","+l+"C"+(f+c)+","+(l+d)+","+(f+c)+","+(l+h-d)+","+(f+c)+","+(l+h)+"C"+(f+c-p)+","+(l+h)+","+(f+p)+","+(l+h)+","+f+","+(l+h)+"C"+f+","+(l+h-d)+","+f+","+(l+d)+","+f+","+l+"z"}else if(s.type=="ellipse"){var v=parseFloat(s.cx)/t;var m=parseFloat(s.cy)/n;var g=parseFloat(s.rx)/t;var y=parseFloat(s.ry)/n;var b=4/3*(Math.sqrt(2)-1);u="M"+v+","+(m-y)+"C"+(v+g*b)+","+(m-y)+","+(v+g)+","+(m-y*b)+","+(v+g)+","+m+"C"+(v+g)+","+(m+y*b)+","+(v+g*b)+","+(m+y)+","+v+","+(m+y)+"C"+(v-g*b)+","+(m+y)+","+(v-g)+","+(m+y*b)+","+(v-g)+","+m+"C"+(v-g)+","+(m-y*b)+","+(v-g*b)+","+(m-y)+","+v+","+(m-y)+"z"}r.push(u)}Rt(r);return r}function Bn(){try{console.log("showInkPath gives: "+I.getInkPath())}catch(e){console.log("error in showInkPath: "+e.message)}}function jn(e,t,n){var r=e.match(/[0-9.\-]+/g);var i="";var s=0,o=e.length;for(var u=0;u<o;u++){if(e[u]=="M"||e[u]=="L"){i=i+e[u];i+=(parseFloat(r[s])*t).toFixed(6)+",";i+=(parseFloat(r[s+1])*n).toFixed(6);s=s+2}else if(e[u]=="C"){i=i+e[u];i+=(parseFloat(r[s])*t).toFixed(6)+",";i+=(parseFloat(r[s+1])*n).toFixed(6)+",";i+=(parseFloat(r[s+2])*t).toFixed(6)+",";i+=(parseFloat(r[s+3])*n).toFixed(6)+",";i+=(parseFloat(r[s+4])*t).toFixed(6)+",";i+=(parseFloat(r[s+5])*n).toFixed(6);s=s+6}else if(e[u]=="z"){i+="z"}}return i}function Fn(){var e="";var t=o.width();var n=o.height();var r;if(y){if(y.split("Mundefined").length>1)y=y.split("Mundefined").join("");e+=y}if(A){e+=A}if(qr){e+=qr.replace(/undefined/g,"")}f.forEach(function(i){if(i.data("type")==="rect"&&i.data("visible")==="yes"){r="RECT::[x]"+bn(i.attr("x"),t)+"[y]"+bn(i.attr("y"),n);r+="[w]"+bn(i.attr("width"),t)+"[h]"+bn(i.attr("height"),n);r+="[fillc]"+i.attr("fill")+"[fillo]"+i.attr("fill-opacity");r+="[strokec]"+i.attr("stroke")+"[strokeo]"+i.attr("stroke-opacity")+"[strokew]"+i.attr("stroke-width")+"[]";e+=r+"|"}else if(i.data("type")==="ellipse"&&i.data("visible")==="yes"){r="ELLIPSE::[cx]"+bn(i.attr("cx"),t)+"[cy]"+bn(i.attr("cy"),n);r+="[rx]"+bn(i.attr("rx"),t)+"[ry]"+bn(i.attr("ry"),n);r+="[fillc]"+i.attr("fill")+"[fillo]"+i.attr("fill-opacity");r+="[strokec]"+i.attr("stroke")+"[strokeo]"+i.attr("stroke-opacity")+"[strokew]"+i.attr("stroke-width")+"[]";e+=r+"|"}else if(i.data("type")==="marquee"){r="MARQUEE::[x]"+bn(i.attr("x"),t);r=r+"[y]"+bn(i.attr("y"),n);r+="[w]"+bn(i.attr("width"),t)+"[h]"+bn(i.attr("height"),n);r+="[surrfillc]"+i.data("surr-fill")+"[surrfillo]"+i.data("surr-opac")+"[]";e+=r+"|"}else if(i.data("type")==="text"){r="TEXT::[str]"+i.data("str")+"[font]"+i.data("font")+"[fontsize]"+bn(i.data("fontsize"),n)+"[color]"+i.data("color")+"[x]"+bn(i.data("x"),t)+"[y]"+bn(i.data("y"),n)+"[w]"+i.data("w")+"[h]"+i.data("h")+"[]";e+=r+"|"}});U=e;return e}function In(e){var t,n;for(t=0;t<e.length;t++){if(e[t]==="L"||e[t]==="M"){var r=e.substring(t).split("|")[0];var i=jt(r,"stroke","s");var s=jt(r,"strokeo","f");var o=jt(r,"strokew","f");d.push(e[t]);m.push({color:i,opacity:s,width:o})}}var u=e.split("L");for(t=0;t<u.length;t++){if(u[t].length>0){var a=u[t].split("M");for(n=0;n<a.length;n++){if(a[n].length>0&&a[n].charAt(0)!="P"){var f=a[n].split(",");v.push([parseFloat(f[0]),parseFloat(f[1])])}}}}R=false}function qn(e){l=e[0]=="#"?e:"#"+e}function Rn(e){c=e}function Un(e){h=e}function zn(e){p=e}function Wn(e){b=e[0]=="#"?e:"#"+e}function Xn(e){w=e}function Vn(e){E=e}function $n(e){T=e[0]=="#"?e:"#"+e}function Jn(e){N=e}function Kn(e){W=end}function Qn(e){M=e;if(F){F.attr({"font-family":M});F.data({font:M})}}function Gn(e){D=e;if(F){F.attr({"font-size":D});F.data({fontsize:D})}}function Yn(e){_=e[0]=="#"?e:"#"+e;if(F){F.attr({fill:_});F.data({color:_})}}function Zn(e){P=e}function er(e){C=e}function tr(){return l}function nr(){return c}function rr(){return h}function ir(){return p}function sr(){return b}function or(){return w}function ur(){return E}function ar(){return T}function fr(){return N}function lr(){return W}function cr(){return M}function hr(){return D}function pr(){return _}function dr(){return P}function vr(){return C}function mr(e){var t=document.getElementById(e).value;if(t!==undefined){if(t.indexOf("#")==-1)t="#"+t;l=t}}function gr(e){var t=document.getElementById(e).value;if(t!==undefined)c=t}function yr(e){var t=document.getElementById(e).value;if(t!==undefined)h=t}function br(e){var t=document.getElementById(e).value;if(t!==undefined)p=t}function wr(e){var t=document.getElementById(e).value;if(t.length===6){b="#"+t}}function Er(e){var t=document.getElementById(e).value;if(t!==undefined)w=t}function Sr(e){var t=document.getElementById(e).value;if(t!==undefined)E=t}function xr(e){var t=document.getElementById(e).value;if(t.length===6)S="#"+t}function Tr(e){var t=document.getElementById(e).value;if(t!==undefined)x=t}function Nr(e){var t=document.getElementById(e).value;if(t.length===6)T=t}function Cr(e){var t=document.getElementById(e).value;if(t!==undefined)N=t}function kr(e){var t=document.getElementById(e).value;if(t!==undefined){M=t}}function Lr(e){var t=document.getElementById(e).value;if(t!==undefined){D=parseFloat(t)}}function Ar(e){var t=document.getElementById(e).value;if(t!==undefined){if(t.indexOf("#")==-1)t="#"+t;_=t}}function Or(e){var t=document.getElementById(e).value;if(t!==undefined){P=t}}function Wr(e,t,n,r){var i=(e[0]-t[0])*(n||1);var s=(e[1]-t[1])*(r||1);return Math.sqrt(i*i+s*s)}function Xr(e){var t=e.match(/[0-9.\-]+/g)||[];var n=[];for(var r=0;r<t.length;r++){n.push(parseFloat(t[r]))}return n}function Vr(e){return e.match(/[MLR ]/g)||[]}function $r(e,t){var n="",r;for(r=0;r<e.length;r++){n+=e[r]+t[2*r]+","+t[2*r+1]}return n}function Jr(){Ir=m.slice(0);Rr=Br}function Kr(e){e.stopImmediatePropagation();e.stopPropagation();if(!(z===1||z===2))return;Ur=G.width(),zr=G.height();R=true;Mr.length=0;_r.length=0;Jr();if(z===1){m.push({color:l,opacity:c,width:h/zr});Mr.push([e.offsetX/Ur,e.offsetY/zr]);Zr()}else if(z===2){ei([e.offsetX,e.offsetY]);Yr()}o.on("mousemove",Qr);o.on("mouseup",Gr);o.on("mouseleave",Gr)}function Qr(e){var t=Mr.length,n=[e.offsetX/Ur,e.offsetY/zr],r=[e.offsetX,e.offsetY];if(z===1){if(t===0||Wr(r,[Mr[t-1][0]*Ur,Mr[t-1][1]*zr])>Dr){_r.length=0;Mr.push(n);Zr()}else{_r.push(n);Zr()}}else if(z===2){ei([e.offsetX,e.offsetY]);Yr()}}function Gr(e){if(Mr.length>0){Zr(true)}R=false;Mr.length=0;_r.length=0;o.off("mousemove");o.off("mouseup");o.off("mouseleave");var t={pathstring:Br,pa:m};var n={pathstring:Rr,pa:Ir};var r=TAG.TourAuthoring.Command({execute:function(){Br=t.pathstring;m=t.pa.slice(0);Yr()},unexecute:function(){Br=n.pathstring;m=n.pa.slice(0);Yr()}});r.execute();vt.logCommand(r)}function Yr(e){var t=G.width();var n=G.height();var r=[],i="",s="";var o="",u="",a,l,c;e=e||Br;f.clear();if(!e)return;var h=Vr(e);var p=Xr(e);var d=0;for(a=0;a<h.length;a++){if(h[a]==="M"){i+="BEZIER::[pathstring]"}s+=h[a]+t*p[2*a]+","+n*p[2*a+1];i+=h[a]+p[2*a]+","+p[2*a+1];if(h[a+1]==="M"||a===h.length-1){r.push(s);s="";i+="[stroke]"+m[d].color+"[strokeo]"+m[d].opacity+"[strokew]"+m[d].width+"[]|";d++}}for(a=0;a<r.length;a++){var v=f.path(r[a]);v.data("type","bezier");v.attr({"stroke-width":m[a].width*n,"stroke-opacity":m[a].opacity,stroke:m[a].color,"stroke-linejoin":"round","stroke-linecap":"round"})}qr=i}function Zr(e){var t="",n="",r,i,s,o=Mr.length,u=_r.length,a=Mr[0][0],f=Mr[0][1],l,c,h;if(o===1){t="M"+a+","+f+"L"+a+","+f}else if(o===2){t="M"+a+","+f+"L"+Mr[1][0]+","+Mr[1][1]}else if(o>2){t="M"+a+","+f+"R";for(r=1;r<o;r++){t+=(r===1?"":" ")+Mr[r][0]+","+Mr[r][1]}}if(u>0){l=_r[0][0];c=_r[0][1];if(o>0){for(r=0;r<u;r++){n+=" "+_r[r][0]+","+_r[r][1]}}else{if(u===1){n="M"+l+","+c+"L"+l+","+c}else if(u===2){n="M"+l+","+c+"L"+_r[1][0]+","+_r[1][1]}else{n="M"+l+","+c+"R";for(r=1;r<u;r++){n+=(r===1?"":" ")+_r[r][0]+","+_r[r][1]}}}}if(e){Br+=t;h=Br.match(/[MLR ]/g);if(h&&h[h.length-1]!=="L"){Br+=u===0?"":" "+_r[u-1][0]+","+_r[u-1][1]}Yr()}else{Yr(Br+t+n)}}function ei(e){if(!Br)return;var t=o.width(),n=o.height(),r=Xr(Br),i=Vr(Br),s=-1;for(var u=0;u<i.length;u++){if(i[u]==="M"){s++}if(Wr(e,[t*r[2*u],n*r[2*u+1]])<p){if(i[u]==="M"){if(i[u+1]==="R"){if(i[u+3]==="M"||!i[u+3]){i.splice(u,3,"M","L");r.splice(2*u,2)}else{i.splice(u,3,"M","R");r.splice(2*u,2)}}else if(i[u+1]==="L"){i.splice(u,2);r.splice(2*u,4);m.splice(s,1)}}else if(i[u]==="L"){i.splice(u-1,2);r.splice(2*(u-1),4);m.splice(s,1)}else if(i[u]==="R"){if(i[u+2]==="M"||!i[u+2]){i.splice(u-1,3);r.splice(2*(u-1),6);m.splice(s,1)}else if(i[u+3]===" "){i.splice(u-1,4,"M","R");r.splice(2*(u-1),4)}else{i.splice(u-1,4,"M","L");r.splice(2*(u-1),4)}}else if(i[u]===" "){if(i[u+1]==="M"||!i[u+1]){if(i[u-1]==="R"){i.splice(u-2,3);r.splice(2*(u-2),6);m.splice(s,1)}else{i.splice(u,1);r.splice(2*u,2)}}else if(i[u+1]===" "&&i[u+2]===" "&&i[u+3]===" "){i.splice(u,3,"M","R");r.splice(2*u,2);m.splice(s,0,m[s])}else if(i[u+1]===" "&&i[u+2]===" "){i.splice(u,3,"M","L");r.splice(2*u,2);m.splice(s,0,m[s])}else if(i[u+1]===" "){i.splice(u,2);r.splice(2*u,4)}else{i.splice(u,1);r.splice(2*u,2)}}}}s=-1;var a=0;for(u=0;u<i.length;u++){if(i[u]==="M"){a=u;s++;if(i[u+1]==="R"&&i[u+2]!==" "){i.splice(u,2);r.splice(2*u,4);u--;m.splice(s,1);s--;a--;continue}}if(isNaN(r[2*u])||isNaN(r[2*u+1])){for(var f=0;f<i.length-u;f++){if(i[f+1]==="M"&&!i[f+1]){i.splice(a,u+f-a);r.splice(2*a,2*(u+f-a));m.splice(s,1);s--;u=a;continue}}}}Br=$r(i,r);if(Br.match(/undefined/)||Br&&Br[0]!=="M"){console.log("uh oh")}}function ti(e){Dr=parseInt(e,10)}function ni(e){Pr=parseInt(e,10)}var i={};var s=e;i.canvid=e;t=t?t:$("#"+s)[0];var o=$(t);var u;var a=r.dataHolder;var f=new Raphael(t,"100%","100%");$("#"+s+" svg").css("position","absolute");var l="#000000";var c=1;var h=7;var p=5;var d=[];var v=[];var m=[];var g=[];var y="";var b="#ffffff";var w=.7;var E=5;var S="#000000";var x=0;var T="#000000";var N=.8;var C="isolate";var k=[];var L=[];var A="";var O="";var M="'Times New Roman', serif";var _="#ffffff";var D="12px";var P=1;var H="textbox";var B="outerdiv";var j="";var F;var I=null;n=n==="inkes"?"inkes":"componentcontrols";var q=[];var R=false;var U="";var z=TAG.TourAuthoring.InkMode.draw;var W=true;var X={};var V="";var J="";var K=1;var Q=2;var G;if(n==="inkes")G=$("#rinplayer").length?$("#rinplayer"):$("#rinPlayer");else G=$("#rinContainer");var Y=0;var Z=0;var et=G.width();var tt=G.height();var nt=0;var rt=0;var it=0;var st=0;var ot=0;var ut=0;var at=0;var ft=0;var lt=0;var ct=0;var ht=et;var pt=tt;var dt=0;var vt;var mt;var gt;var yt;var bt;var wt;var a;if(n!=="inkes"){mt=r.playbackControls;gt=r.undoManager;yt=r.timeline;bt=r.timeManager;wt=r.viewer;vt=new TAG.TourAuthoring.UndoManager;vt.setInitialized(true);mt.undoButton.off("click");mt.redoButton.off("click");mt.undoButton.on("click",function(){vt.undo()});mt.redoButton.on("click",function(){vt.redo()})}i.resetParams=Et;i.abs_dims=St;i.add_attributes=xt;i.getInkUndoManager=Tt;i.add_ellipse=Nt;i.add_marq_attributes=Ct;i.add_rectangle=kt;i.getSVGText=Lt;i.add_text_box=At;i.adjustViewBox=Ot;i.adjustViewBoxDiv=Mt;i.block_to_isol=_t;i.const_path_alg=Dt;i.drawPaths=Pt;i.drawTrans=Ht;i.erase=Bt;i.get_attr=jt;i.set_attr=Ft;i.getBoundingShapes=It;i.getDatastring=qt;i.get_outer_path=Rt;i.getArtRelativePos=Ut;i.getSVGElement=zt;i.get_trans_shape_data=Wt;i.isTextboxEmpty=Xt;i.isDatastringEmpty=Vt;i.link_text=Kt;i.link_text_unattached=Qt;i.link_trans=Gt;i.link_trans_unattached=Yt;i.link=Zt;i.linkUnattached=en;i.getTextElt=tn;var nn=o.width(),rn=o.height();i.getTextMagnification=sn;i.loadInk=on;i.load_trans_from_path=un;i.load_transparency_bounding_shapes=an;i.next_in_bez=fn;i.nontrivial=ln;i.out_bez=cn;var hn;var pn;i.panObjects=dn;i.getPannedPos=vn;i.testPan=mn;i.testScale=gn;i.point_inside=yn;i.rel_dims=bn;i.repeat_pt=wn;i.remove_all=En;i.resizeObjects=Sn;i.retrieveOrigDims=xn;i.same_point=Tn;i.save_text=Nn;i.setArtName=Cn;i.set_editable=kn;i.setEID=Ln;i.setInitKeyframeData=An;i.set_mode=On;i.setOldOpac=Mn;i.setOrigDims=_n;i.resetText=Dn;i.setTextAttributes=Pn;i.shapes_to_paths=Hn;i.showInkPath=Bn;i.transform_pathstring_marq=jn;i.update_datastring=Fn;i.update_ml_xy_pa=In;i.setPenColor=qn;i.setPenOpacity=Rn;i.setPenWidth=Un;i.setEraserWidth=zn;i.setShapeStrokeColor=Wn;i.setShapeStrokeOpacity=Xn;i.setShapeStrokeWidth=Vn;i.setMarqueeFillColor=$n;i.setMarqueeFillOpacity=Jn;i.setEnabled=Kn;i.setFontFamily=Qn;i.setFontSize=Gn;i.setFontColor=Yn;i.setFontOpacity=Zn;i.setTransMode=er;i.getPenColor=tr;i.getPenOpacity=nr;i.getPenWidth=rr;i.getEraserWidth=ir;i.getShapeStrokeColor=sr;i.getShapeStrokeOpacity=or;i.getShapeStrokeWidth=ur;i.getMarqueeFillColor=ar;i.getMarqueeFillOpacity=fr;i.getEnabled=lr;i.getFontFamily=cr;i.getFontSize=hr;i.getFontColor=pr;i.getFontOpacity=dr;i.getTransMode=vr;i.updatePenColor=mr;i.updatePenOpacity=gr;i.updatePenWidth=yr;i.updateEraserWidth=br;i.updateShapeStrokeColor=wr;i.updateShapeStrokeOpacity=Er;i.updateShapeFillColor=xr;i.updateShapeFillOpacity=Tr;i.updateMarqueeColor=Nr;i.updateMarqueeOpacity=Cr;i.updateFontFamily=kr;i.updateFontSize=Lr;i.updateFontColor=Ar;i.updateFontOpacity=Or;var Mr=[],_r=[],f,Dr=8,Pr=5,Hr=false,Br="",jr,Fr=[],Ir=[],qr="",Rr="",Ur,zr;o.on("mousedown",Kr);o.on("mouseenter",function(){o.css("cursor",z==1||z==2?"crosshair":"pointer")});i.drawBezierPath=Yr;i.erase=Bt;var ri=[],ii=[],Ir=[],si,oi;return i};TAG.Util.makeNamespace("TAG.TourAuthoring.InkTrack");TAG.Util.makeNamespace("TAG.TourAuthoring.InkType");TAG.Util.makeNamespace("TAG.TourAuthoring.InkShape");TAG.TourAuthoring.InkType={text:1,isolate:2,draw:3,block:4,highlight:5};TAG.TourAuthoring.InkShape={rectangle:1,ellipse:2};TAG.TourAuthoring.InkTrack=function(e,t){"use strict";e.type=TAG.TourAuthoring.TrackType.ink;e.fadeIn=-1e-6;e.fadeOut=-1e-6;t=t||{};t.inkSpec=e.inkSpec;t.inkType=e.media;var n=TAG.TourAuthoring.Track(e,t);t.track.addClass("ink");return n};TAG.Util.makeNamespace("TAG.TourAuthoring.Keyframe");TAG.TourAuthoring.Keyframe=function(e,t){"use strict";function N(){function o(){m=!m;if(m){c.css("display","none");p.css("display","none")}else{c.css("display","block");p.css("display","block")}}var e=t.timeManager.timeToPx(i.x);var r=t.type!==TAG.TourAuthoring.TrackType.audio?48:i.y;var s=TAG.Util.UI.createKeyframe({container:t.track,x:e,y:r});h=s.line,c=s.circ,p=s.innerCirc;c.on("mousedown",function(e){var t=e.offsetX,n=e.offsetY;k(t,n)});p.on("mousedown",function(e){var t=e.offsetX,n=e.offsetY;k(t,n)});n.toggleCircle=o}function C(){c.off("mousedown");p.off("mousedown");c.on("mousedown",function(e){var t=e.offsetX,n=e.offsetY;k(t,n)});p.on("mousedown",function(e){var t=e.offsetX,n=e.offsetY;k(t,n)})}function k(e,r){var s=i.x,o=i.y;t.timeManager.stop();d=e;v=r;t.currentKeyframe=n;$("body").on("mouseup.keyframe",function(){var e,n,r;t.currentKeyframe=null;d=null;v=null;$("body").off("mouseup.keyframe");if(i.x!==s||i.y!==o){t.update();n=i.x;r=i.y;e=TAG.TourAuthoring.Command({execute:function(){i.x=n;i.y=r;rt();t.update()},unexecute:function(){i.x=s;i.y=o;rt();t.update()}});t.undoManager.logCommand(e)}})}function L(){var e=x(i.x);c.css({left:e-21-5+"px",top:(t.type!==TAG.TourAuthoring.TrackType.audio?48:i.y)-21-5+"px"});p.css({left:e-17+"px",top:(t.type!==TAG.TourAuthoring.TrackType.audio?48:i.y)-17+"px"});h.css("left",e-3/2+"px")}function A(){function r(){m=!m;if(m){c.attr("display","none");p.attr("display","none")}else{c.attr("display",null);p.attr("display",null)}}function o(e,r){var s=i.x,o=i.y;t.timeManager.stop();d=e;v=r;t.currentKeyframe=n;$("body").on("mouseup.keyframe",function(){var e,n,r;t.currentKeyframe=null;d=null;v=null;$("body").off("mouseup.keyframe");if(i.x!==s||i.y!==o){t.update();n=i.x;r=i.y;e=TAG.TourAuthoring.Command({execute:function(){i.x=n;i.y=t.type===TAG.TourAuthoring.TrackType.audio?r:48;rt();t.update()},unexecute:function(){i.x=s;i.y=t.type===TAG.TourAuthoring.TrackType.audio?o:48;rt();t.update()}});t.undoManager.logCommand(e)}})}var e=t.timeManager.timeToPx(i.x);h=s.append("line").attr("x1",e).attr("y1","0%").attr("x2",e).attr("y2","100%").attr("style","stroke:"+TAG.TourAuthoring.Constants.keyframeColor+"; stroke-width:"+TAG.TourAuthoring.Constants.keyframeLineW+";");c=s.append("circle").attr("style","stroke:"+TAG.TourAuthoring.Constants.keyframeColor+"; fill:white; stroke-width:"+TAG.TourAuthoring.Constants.keyframeStrokeW+";");$(c[0][0]).on("mousedown",function(e){console.log("using new events");var t=e.offsetX;var n=e.offsetY;o(t-parseInt(c.attr("cx"),10),n-parseInt(c.attr("cy"),10))});if(t.type!==TAG.TourAuthoring.TrackType.audio){i.y=48}c.attr("cx",e).attr("cy",i.y).attr("r",TAG.TourAuthoring.Constants.keyframeSize);p=s.append("circle").attr("cx",e).attr("cy",i.y).attr("r",TAG.TourAuthoring.Constants.innerKeyframeSize).attr("style","display:none; stroke:"+TAG.TourAuthoring.Constants.keyframeColor+"; fill:"+TAG.TourAuthoring.Constants.keyframeColor+"; stroke-width:0;");$(p[0][0]).on("mousedown",function(e){console.log("using new events");var t=e.offsetX;var n=e.offsetY;o(t-parseInt(p.attr("cx"),10),n-parseInt(p.attr("cy"),10))});n.toggleCircle=r}function O(){M(true)}function M(e,r){B(r);var i,s=TAG.TourAuthoring.Command({execute:function(){i=o.removeKeyframe(n);c.remove();h.remove();p.remove();n.removed=true;o.getTrack().drawLines();rt();t.update()},unexecute:function(){_();o.insertKeyframe(n,i);o.getTrack().drawLines();rt();t.update()}});s.execute();if(e){t.undoManager.logCommand(s)}}function _(){n.removed=false;N()}function D(e){a=e}function P(){return a}function H(){return f}function B(e){l.close(e)}function j(){return l.menuCloseable}function F(e){l.menuCloseable=e}function I(e){l.open(e)}function q(e){t.timeManager.seek(i.x);U()}function U(e){function i(){return TAG.TourAuthoring.Command({execute:function(){},unexecute:function(){r=currData;t.update();if(t.selectedKeyframe===n){g=i();y=true}}})}if(e){t.selectedKeyframe=n;c.css({"background-color":"white"});p.css({display:"inherit","background-color":"#296b2f"})}else{R()}}function z(){g=null;t.selectedKeyframe=null;p.css("background-color","white")}function W(){return i.x}function X(e){var n,r=o.getKeyframes(),s=a>0?Math.max(r[a-1].getTime(),o.getStart()):o.getStart(),u=a+1<r.length?Math.min(r[a+1].getTime(),o.getEnd()):o.getEnd();i.x=Math.constrain(e,s+TAG.TourAuthoring.Constants.epsilon,u+TAG.TourAuthoring.Constants.epsilon);n=t.timeManager.timeToPx(i.x);c.css("left",n-21-5+"px");h.css("left",n-3/2+"px");p.css("left",n-17+"px");if(t.type===TAG.TourAuthoring.TrackType.audio){o.getTrack().drawLines()}z()}function V(){return i.y}function J(){return Q(i.y)}function K(e){i.y=G(Math.constrain(e,0,100));c.css("top",i.y-21-5+"px");p.css("top",i.y-17+"px");t.that.drawLines()}function Q(e){return Math.round((TAG.TourAuthoring.Constants.trackHeight-e)*100/TAG.TourAuthoring.Constants.trackHeight*100)/100}function G(e){return TAG.TourAuthoring.Constants.trackHeight-e*TAG.TourAuthoring.Constants.trackHeight/100}function Y(){return o}function Z(){return n.removed}function et(e,n,r){var s;n=n||0;r=r||Infinity;if(!d&&d!==0||!v&&v!==0||!t.currentKeyframe){console.log("Move keyframe called when no keyframe is selected!")}else{i.x=Math.constrain(t.timeManager.pxToTime(e.pivot.x-d),Math.max(n,o.getStart())+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.fadeBtnSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.keyframeSize),Math.min(r,o.getEnd())-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.fadeBtnSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.keyframeSize));if(i.x<o.getStart()||i.x>o.getEnd()){i.x=(o.getStart()+o.getEnd())/2}if(i.x<n){i.x=n}if(i.x>r){i.x=r}s=t.timeManager.timeToPx(i.x);c.css("left",s-21-5+"px");h.css("left",s-3/2+"px");p.css("left",s-17+"px");if(t.type===TAG.TourAuthoring.TrackType.audio){i.y=Math.constrain(e.pivot.y-v,0,TAG.TourAuthoring.Constants.trackHeight);c.css("top",i.y-21-5+"px");p.css("top",i.y-17+"px");o.getTrack().drawLines()}else{i.y=48}z()}}function tt(e,r,i,s){var u={pivot:{x:e,y:r}};d=0;v=0;t.currentKeyframe=n;et(u,i,s);o.sortKeyframes();t.update();d=null;v=null;t.currentKeyframe=null}function nt(e){var n;i.x=Math.constrain(i.x+e,o.getStart(),o.getEnd());n=t.timeManager.timeToPx(i.x);c.css("left",n-21-5+"px");h.css("left",n-3/2+"px");p.css("left",n-17+"px");z()}function rt(){var e=t.timeManager.timeToPx(i.x);c.css({left:e-21-5+"px",top:i.y-21-5+"px"});h.css("left",e-3/2+"px");p.css({left:e-17+"px",top:i.y-17+"px"});if(t.type===TAG.TourAuthoring.TrackType.audio){o.getTrack().drawLines()}}function it(){return Math.constrain((TAG.TourAuthoring.Constants.trackHeight-i.y)/TAG.TourAuthoring.Constants.trackHeight,0,1)}function st(){var e;switch(t.type){case TAG.TourAuthoring.TrackType.artwork:e={offset:i.x-o.getStart(),init:false,holdDuration:0,state:r};break;case TAG.TourAuthoring.TrackType.image:e={offset:i.x-o.getStart(),init:false,holdDuration:0,state:r};break;case TAG.TourAuthoring.TrackType.audio:e={offset:i.x-o.getStart(),init:false,holdDuration:0,state:{sound:{volume:it()}}};break;default:console.log("RIN track type not yet implemented");break}return e}function ot(e){f=e;if(e.state){r=e.state}else if(e.data){var n=e.data.default,i={x:Number(/Viewport_X='([^']+)'/.exec(n)[1]),y:Number(/Viewport_Y='([^']+)'/.exec(n)[1])},s={x:Number(/Viewport_Width='([^']+)'/.exec(n)[1]),y:Number(/Viewport_Height='([^']+)'/.exec(n)[1])};r={viewport:{region:{center:i,span:s}}}}if(g){(function(n){n.execute=function(){r=e;t.update();g=n;y=false}})(g);if(y){t.undoManager.logCommand(g);y=false}}}var n={},r=e.data||{viewport:{region:{center:{x:0,y:0},span:{x:1,y:1}}}},i=e.loc,s=e.gkey,o=e.display,u=e.displayDiv,a=0,f,l=TAG.TourAuthoring.EditorMenu({type:TAG.TourAuthoring.MenuType.keyframe,parent:n},t),c,h,p,d,v,m=false,g,y;var b=TAG.TourAuthoring.Constants.keyframeColor,w=TAG.TourAuthoring.Constants.keyframeLineW,E=TAG.TourAuthoring.Constants.keyframeStrokeW,S=TAG.TourAuthoring.Constants.keyframeSize,x=t.timeManager.timeToPx,T=t.timeManager.pxToTime;n.position=0;n.removed=false;N();n.restoreHandlers=C;n.resetVisuals=L;(function(){l.addInput("Time",TAG.TourAuthoring.MenuInputFormats.minSec,W,X);if(t.type===TAG.TourAuthoring.TrackType.audio){l.addInput("Volume",TAG.TourAuthoring.MenuInputFormats.percent,J,K)}l.addButton("Delete","left",O);l.addButton("Close","right",l.forceClose)})();n.removeHelper=O;n.remove=M;n.reactivateKeyframe=_;n.updatePosition=D;n.getPosition=P;n.getCaptureData=H;n.closeMenu=B;n.rightTapped=I;n.tapped=q;var R=$.debounce(250,function(){function s(){return TAG.TourAuthoring.Command({execute:function(){},unexecute:function(){r=e;t.update();if(t.selectedKeyframe===n){g=s();y=true}}})}if(t.type!==TAG.TourAuthoring.TrackType.audio){t.selectedKeyframe=n;$(".keyframeInnerCirc").css("background-color","#ffffff");c.css({"background-color":"white"});p.css("background-color","#296b2f");var e=r;var i=s();g=i}});n.setSelected=U;n.setDeselected=z;n.getTime=W;n.setTime=X;n.getVolumePx=V;n.getVolume=J;n.setVolume=K;n.isRemoved=Z;n.getContainingDisplay=Y;n.move=et;n.internalMove=tt;n.translate=nt;n.scale=rt;n.toRIN=st;n.loadRIN=ot;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.PlaybackControl");TAG.TourAuthoring.PlaybackControl=function(e,t){"use strict";function h(e){e.appendChild(r[0])}var n={},r=$(document.createElement("div")),i=false,s=e.undoManager,o=e.timeManager,u=e.viewer,a=e.timeline,f=e.root,l,c=o.getDuration().scale;(function(){function u(){if(!a.getEditInkOn()){if(!i){o.play()}else{o.stop()}}}function E(){o.onSeek(w);o.onPlay(w);o.onSizing(w);v.append(b)}function B(e){var t=a.getTrackBody(),n=a.getTimeRuler(),r=o.getDuration(),i=r.scale,s=r.end,u=t.width()/s,f=u+e*(TAG.TourAuthoring.Constants.maxZoom-u);f=Math.min(Math.max(f,u),TAG.TourAuthoring.Constants.maxZoom);c=i;if(f===i){return}var l=t.width();var h=l*.5;var p=l*.45;var d=o.timeToPx(s);var v=f*r.end;var m=o.timeToPx(o.getCurrentTime());var g=t.scrollLeft();var y;if(m>=g&&m<=g+l){if(f<i){t.scrollLeft(0)}if(f>=u){if(v>=t.width()){o.setScale(f)}}else if(f<=TAG.TourAuthoring.Constants.maxZoom){o.setScale(f)}var b=m-g;var w=o.getCurrentPx();var E=w-b;t.scrollLeft(E)}else{if(f<i){t.scrollLeft(0);if(f>=u){if(v>=t.width()){o.setScale(f)}}else if(f<=TAG.TourAuthoring.Constants.maxZoom){o.setScale(f)}var S=(g+h)/d;var x=S*v;y=x-h;if(y+l>v){t.scrollLeft(v-l)}else if(y<0){t.scrollLeft(0)}else{t.scrollLeft(y)}}else{if(f>=u){if(v>=t.width()){o.setScale(f)}}else if(f<=TAG.TourAuthoring.Constants.maxZoom){o.setScale(f)}var T=(g+p)/d;var N=T*v;y=N-h;if(y+l>v){t.scrollLeft(v-l)}else if(y<0){t.scrollLeft(0)}else{t.scrollLeft(y)}}}D=e}function q(e){var t=a.getTimeRuler();var n=a.getTrackBody();e=e||o.getDuration();var r=g.width();if(t.position()){var i=n.width()/o.timeToPx(e.end)*v.width();var s=n.scrollLeft()/o.timeToPx(e.end)*v.width()-2;if(i&&r!==Math.ceil(i)){if(i+s>v.position().left+v.width()){if(i>v.width()){i=v.width()}s=v.position().left+v.width()-i}g.css("width",i+"px")}g.css("left",s+"px")}}function V(){var e=$(document.createElement("div"));var t=d3.select(e[0]).append("svg").style("position","absolute").style("left","0px").style("top","-110%").attr("width","0%").attr("height","100%");l=t.append("g");var n=l.append("circle").attr("cx","0").attr("cy","80%").attr("r","40%").attr("fill","black").attr("stroke","black").attr("stroke-width","10%").attr("fill-opacity","0");var r=l.append("line").attr("x1","0").attr("y1","110%").attr("x2","0").attr("y2","210%").attr("pointer-events","none").attr("stroke","black").attr("stroke-width","10%");return e}r.css({"background-color":"rgb(219,218,199)",height:"9.25%",width:"96.95%",bottom:"0%","margin-left":"1.25%",position:"absolute","box-shadow":"0px -16px 14px -14px #888","z-index":"102"});r.attr("id","playback-controls");var t=$(document.createElement("img"));t.css({"margin-top":"1%","margin-left":"2%",width:"4%",height:"60%",position:"relative",display:"inline-block"});t.attr("src",tagPath+"images/icons/Play.svg");t.attr("id","playButton");t.click(function(){u()});r.append(t);f.on("keyup",function(e){if(e.which===32){u()}});$("#rinContainer").on("click",function(e){e.preventDefault();e.stopPropagation()});o.onPlayStart(function(){t.attr("src",tagPath+"images/icons/Pause.svg");i=true});o.onStop(function(){t.attr("src",tagPath+"images/icons/Play.svg");i=false});var h=$(document.createElement("div"));h.attr("id","playhead-location");h.css({"margin-left":"12%",height:"100%","margin-top":"1%",width:"37.5%",position:"relative",display:"inline-block","vertical-align":"middle",color:"black"});r.append(h);var p=$(document.createElement("label"));p.attr("id","playLabel");p.text("Timeline Overview");p.css({"font-weight":"600","font-size":"0.8em",margin:"0px 2% 0px 0px",top:"4%","vertical-align":"top",position:"relative",display:"inline-block"});h.append(p);var d=$(document.createElement("div"));d.attr("id","sliderContainer");d.css({position:"absolute",width:"40%",height:"100%","margin-top":"-2%",display:"inline-block"});h.append(d);var v=$(document.createElement("div"));v.attr("id","timelineSlider");v.css({position:"relative","margin-left":"4%",display:"inline-block",width:"100%",height:"20%",border:"1px","border-style":"solid","border-color":"gray","background-color":"white","margin-top":"8.5%"});d.append(v);var m=125;var g=$(document.createElement("div"));g.attr("id","timelineSliderBox");g.css({position:"absolute",width:m+"px",height:"130%",border:"2px none black","margin-top":"-2%"});g.draggable({axis:"x",drag:function(e,t){if(a.getEditInkOn()){return false}var n=v.width()-g.width();t.position.left=Math.constrain(t.position.left,0,n);var r=t.position.left/(n+Math.ceil(g.width()))*a.getTimeRuler().width();a.registerUpdateSlider(null);a.getTrackBody().scrollLeft(r);a.cancelAccel();a.registerUpdateSlider(q)}});v.append(g);g.mousedown(function(e){e.stopPropagation()});var y=$(document.createElement("div"));y.css({"background-color":"DarkGreen",top:"10%",height:"80%",position:"absolute",width:"100%",border:"2px solid black"});g.append(y);var b=V();b.css({height:"155%",width:"0%","margin-top":"-4%",position:"absolute",left:"0%"});b.attr("id","fader");b.draggable({axis:"x",drag:function(e,t){if(a.getEditInkOn()){return false}var n=v.width();t.position.left=Math.constrain(t.position.left,0,n);var r=Math.constrain(t.position.left/(n-b.width()),0,1);o.seekToPercent(r)},stop:function(){if(b.offset().left>v.offset().left+v.width()){b.css("left",v.width()+"px")}}});var w=function(e){b.css("left",(b.offsetParent().width()-b.width())*e.percent+"px")};n.faderUpdate=w;n.updateFader=E;E();var S=$(document.createElement("label"));S.attr("id","playhead-position");S.css({position:"relative",left:"45%",color:"black",display:"inline-block","font-weight":"600","font-size":"0.8em",margin:"0px 2% 0px 0px",top:"4%","vertical-align":"top"});S.text("0:00/1:00");var x=function(e){var t=o.getCurrentTime();var n=o.getDuration().end;var r;var i;if(isNaN(t)||isNaN(n)){r="0:00";i="0:00"}else{r=o.formatTime(t);i=o.formatTime(n)}S.text(r+"/"+i)};o.onSeek(x);o.onPlay(x);o.onSizing(x);h.append(S);var T=$(document.createElement("div"));T.css({position:"relative",display:"inline-block",width:"20%",height:"60%","vertical-align":"middle","margin-top":"-1%","margin-right":"2%"});r.append(T);var N=$(document.createElement("div"));N.attr("id","imgContainer");N.css({position:"absolute",display:"inline-block",height:"50%"});T.append(N);var C=$(document.createElement("img"));C.css({"margin-top":"8%","margin-left":"0%",height:"85%",width:"auto",position:"relative",display:"inline-block"});C.attr("src",tagPath+"images/icons/Lens.svg");C.attr("id","lensSmall");C.click(function(){var e=L.position().left-.1*k.width();if(e>=0){L.css("left",e+"px")}else{L.css("left","0px")}var t=L.position().left/(L.offsetParent().width()-L.width());B(t)});N.append(C);var k=$(document.createElement("div"));k.attr("id","zoomslider");k.css({position:"absolute",display:"inline-block",width:"68%",height:"35%","margin-top":"2%","margin-left":"10%","background-color":"rgb(136, 134, 134)","border-radius":"25px"});k.mousedown(function(e){if(e.which!=1)return;L.css("left",Math.constrain(e.pageX-k.offset().left-L.width()/2,0,k.width()-L.width()));var t=L.position().left/(L.offsetParent().width()-L.width());B(t);L.trigger(e)});T.append(k);var L=$(document.createElement("div"));L.attr("id","zoomPoint");var A=o.getDuration().scale;var O=1581/o.getDuration().end;var M=(A-O)/(TAG.TourAuthoring.Constants.maxZoom-O)*100;L.css({"background-color":"white",height:"110%",width:"10%",position:"absolute",top:"-10%",left:M+"%",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%"});k.append(L);L.mousedown(function(e){e.stopPropagation()});L.draggable({axis:"x",containment:"parent",drag:function(){var e=L.position().left/(L.offsetParent().width()-L.width());B(e);a.cancelAccel()}});$("#timeRuler").livequery(function(){var e=L.position().left/(L.offsetParent().width()-L.width());B(e);$("#timeRuler").expire()});var _=function(e){L.css("left",(L.offsetParent().width()-L.width())*e.percent+"px")};var D=0;var P=0;var H=0;var j=$(document.createElement("div"));j.attr("id","imgContainer");j.css({position:"absolute",display:"inline-block",height:"40%","margin-left":"80%"});T.append(j);var F=$(document.createElement("img"));F.height=1;F.width=1;F.css({"margin-top":"-7%",height:"170%",width:"auto",position:"relative",display:"inline-block"});F.attr("src",tagPath+"images/icons/Lens.svg");F.attr("id","lensBig");F.click(function(){var e=L.position().left+.1*k.width();if(e<=L.offsetParent().width()-L.width()){L.css("left",e+"px")}else{L.css("left",L.offsetParent().width()-L.width()+"px")}var t=L.position().left/(L.offsetParent().width()-L.width());B(t)});j.append(F);var I=$(document.createElement("div"));I.css({position:"relative",display:"inline-block",width:"5%",height:"60%","vertical-align":"middle","margin-top":"-1%","margin-right":"2%"});r.append(I);$("#editor").livequery(function(){q(o.getDuration());$("#editor").expire()});o.onSizing(q);a.registerUpdateSlider(q);var R=$(document.createElement("div"));var U=$(document.createElement("div"));n.undoRedoInkOnly=U;U.text("Affects Ink Only");U.css({color:"green","margin-top":"-2.5%",position:"relative",display:"none","margin-left":"10%","font-weight":"600","font-size":"0.8em"});R.css({"margin-top":"-2%",position:"relative","z-index":0,height:"60%",width:"15%","vertical-align":"middle",display:"inline-block"});R.attr("id","undoRedoButtonArea");var z={height:"70%",width:"auto","margin-left":"15%",opacity:"0.4"};var W=$(document.createElement("img"));$(W).addClass("undoButton");W.attr("src",tagPath+"images/icons/Undo.svg");W.css(z);W.click(function(){s.undo()});R.append(W);n.undoButton=W;var X=$(document.createElement("img"));$(X).addClass("redoButton");X.attr("src",tagPath+"images/icons/Redo.svg");X.css(z);X.click(function(){s.redo()});R.append(X);n.redoButton=X;R.append(U);r.append(R)})();n.addToDOM=h;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.Tests");TAG.TourAuthoring.Tests=function(){"use strict";function n(n,r){var i,s,o,u,a,f,l;n.addAudioTrack(t[0]);u=n.addArtworkTrack(e[0]);n.addArtworkTrack(e[1]);n.addArtworkTrack(e[2]);a=u.addDisplay(r.timeToPx(0),5);f=u.addDisplay(r.timeToPx(10),5);u.addDisplay(r.timeToPx(30),19);a.internalMove(r.timeToPx(1),0,10,"fade-in",0);a.internalMove(r.timeToPx(4),0,10,"fade-out",0);a.internalMove(r.timeToPx(4),0,10,"main",0);a.internalMove(r.timeToPx(9.8),0,10,"fade-out",0);a.internalMove(r.timeToPx(-1),0,10,"fade-in",0);a.internalMove(r.timeToPx(.25),0,10,"fade-out",0);a.internalMove(r.timeToPx(9.5),0,10,"main",0);a.internalMove(r.timeToPx(100),0,10,"fade-in",0);s=u.getDisplays();for(i=0;i<s.length;i++){console.log(i+": "+s[i].getStart())}l=s[1].addKeyframe(r.timeToPx(12));l.internalMove(r.timeToPx(14.5));f.internalMove(r.timeToPx(15),10,30,"main",0);l.internalMove(r.timeToPx(15.5));o=n.toRIN();n.onUpdate()}function r(n,r){var i,s,o,u=n.addArtworkTrack(e[0],"Monet"),a=n.addAudioTrack(t[0],"AudioTest");u.addDisplay(r.timeToPx(0),5);u.addDisplay(r.timeToPx(10),7);u.addDisplay(r.timeToPx(25),10);n.onUpdate()}function i(n,r){var i,s,o,u=n.addArtworkTrack(e[0],"Haystacks"),a=n.addArtworkTrack(e[1],"Garibaldi Panorama"),f=n.addAudioTrack(t[1],"Audio"),l,c,h;u.addDisplay(r.timeToPx(0),4);l=a.addDisplay(r.timeToPx(4),10);u.addDisplay(r.timeToPx(14),5);f.addDisplay(r.timeToPx(0),180);c=l.addKeyframe(r.timeToPx(5));c.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0' Viewport_Y='-0.09984642817137874' Viewport_Width='1' Viewport_Height='0.2109375'/>");h=l.addKeyframe(r.timeToPx(9));h.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.021664630037101146' Viewport_Y='0.00045129340904827893' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>");l.addKeyframe(r.timeToPx(13)).loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.040299281871932956' Viewport_Y='0.00041899765196884864' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>");n.onUpdate()}function s(n,r){var i,s,o,u=n.addArtworkTrack(e[0],"Haystacks"),a=n.addArtworkTrack(e[1],"Garibaldi Panorama"),f=n.addAudioTrack(t[1],"Audio"),l,c,h;u.addDisplay(r.timeToPx(0),4);l=a.addDisplay(r.timeToPx(4),10);u.addDisplay(r.timeToPx(10),7);f.addDisplay(r.timeToPx(0),180);c=l.addKeyframe(r.timeToPx(5));c.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0' Viewport_Y='-0.09984642817137874' Viewport_Width='1' Viewport_Height='0.2109375'/>");h=l.addKeyframe(r.timeToPx(9));h.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.021664630037101146' Viewport_Y='0.00045129340904827893' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>");l.addKeyframe(r.timeToPx(13)).loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.040299281871932956' Viewport_Y='0.00041899765196884864' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>");n.onUpdate()}function o(e){e.loadTour("js/RIN/web/narratives/TAGTest/narrative.js",function(){console.log("TAG RIN data loaded !!! ???")})}function u(){var e="http://cs.brown.edu/research/TAG/TAG2.0Data/repository.xml",t;TAG.Worktop.Database.load(e);a();var n=TAG.Worktop.Database.getAllTours();f(n[0].Identifier);n=TAG.Worktop.Database.getAllTours();f(a().Identifier);n=TAG.Worktop.Database.getAllTours()}function a(){tourdoq=TAG.Worktop.Database.createTour();return tourdoq}function f(e){var t=TAG.Worktop.Database.getDoqXML(e);var n=new DOMParser;var r=$(n.parseFromString(t,"text/xml"));r.find("Name").text("new name");r.find("d3p1\\:Key:contains('Content') + d3p1\\:Value").text("[]");r.find("d3p1\\:Key:contains('Thumbnail') + d3p1\\:Value").text("http://www.cs.brown.edu/research/TAG/images/waterfallzoom.jpg");TAG.Worktop.Database.pushXML(r[0],e,"Tour")}function l(e){TAG.Worktop.Database.deleteDoq(e,"Tour")}function c(e){e.addAudioTrack(t[2],"Audio")}var e=["http://cs.brown.edu/research/TAG/TAG2.0Data/Documents/monethay/monet%20haystacks/monet%20haystacks.xml","http://cs.brown.edu/research/TAG/TAG2.0Data/Documents/gari/garidz/dz.xml","http://cs.brown.edu/research/TAG/TAG2.0Data/Documents/rembrandtself/rembrandt%20self/rembrandt%20self.xml","http://cs.brown.edu/research/TAG/TAG2.0Data/Documents/marcdream/marc%20dream/marc%20dream.xml","http://cs.brown.edu/research/TAG/TAG2.0Data/Documents/dirck/dirck/dirck.xml","http://10.116.71.58:8086/Images/20121105221815/dz.xml"],t=["http://archive.bsrlive.brown.edu/archives/bsrbonusbeats/kurtboone.mp3","http://archive.bsrlive.brown.edu/archives/bsrbonusbeats/GaribaldiScene43Tour_mastered.mp3","http://archive.bsrlive.brown.edu/archives/bsrbonusbeats/GariEdit.mp3","http://10.116.71.58:8086/Images/20121104223746.mp3"];return{trackEditTest:n,testRINreload:o,testDemo:i,testTrackReload:r,testServer:u,makeDemo:c,testOverlap:s}}();TAG.Util.makeNamespace("TAG.TourAuthoring.Timeline");TAG.TourAuthoring.Timeline=function(e,t){"use strict";function Z(){$("#resizeButton").attr("src",tagPath+"images/icons/Ellipsis_gray.svg");lt(true);$("#multiSelButton").css({color:"gray","border-color":"gray"});m.attr("fill","gray");m.attr("stroke","gray");var e=TAG.Util.constrainAndPosition(R.width(),R.height(),{center_h:true,center_v:true,width:.3,height:.2,max_width:550,max_height:100});var t=TAG.Util.getMaxFontSizeEM("Annotation is being edited...",0,e.width-10,e.height,.01);U.css({top:e.y+"px",left:e.x+"px",width:e.width+"px",height:e.height+"px","font-size":t,overflow:"hidden"});R.show()}function et(){$("#resizeButton").attr("src",tagPath+"images/icons/dragTourWindowTwoBars.svg");lt(false);$("#multiSelButton").css({color:"black","border-color":"black"});m.attr("fill","black");m.attr("stroke","black");R.hide()}function tt(e){var t=[];var n=$(document.createElement("div"));n.css({position:"relative","background-color":"rgb(255,255,255)",width:"70%",left:"15%",height:"100%",overflow:"hidden",border:"1px solid gray"});L=$(document.createElement("div"));L.attr("id","verticalSlider");L.css({position:"absolute",height:"100px",width:"100%",border:"2px none black",left:"-1px"});L.draggable({axis:"y",drag:function(e,t){e.stopPropagation();t.position.top=Math.constrain(t.position.top,0,A.height()-L.height()-2);var n=t.position.top/(A.height()-L.height()-4);var r=n*(st()-c.height()+8);c.scrollTop(r);a.scrollTop(r);Nn()}});t.push(n);t.push(L);L.mousedown(function(e){e.stopPropagation()});var r=$(document.createElement("div"));r.css({"background-color":"rgb(63, 55, 53)",top:"0%",left:"15%",height:"100%",position:"absolute",width:"70%",border:"2px solid white"});L.append(r);return t}function nt(e){var t=st();var n=e/t*A.height();if(n<0){n=0}else if(n>A.height()-L.height()-2){n=A.height()-L.height()-2}L.css({top:n+"px"})}function rt(){var e=L.height();var t=st();var n=c.scrollTop()/t*A.height()-4;if(n<0){n=0}A.height(a.height()-10);if(L.scrollTop()===n){return}if(t===0){A.height(c.height()-10);L.css({height:A.height()+"px",top:"0px"});it();return}if(e!==(a.height()-4)*A.height()/t){if(t<a.height()){L.css({height:"100%"})}else{L.css({height:(a.height()-4)*A.height()/t+"px"})}L.css({top:n+"px"})}}function it(){if(st()<a.height()-10){L.draggable("disable");A.hide();L.css({height:"100%"})}else{L.draggable("enable");A.show();L.css({height:(a.height()-4)*A.height()/st()+"px"})}}function st(){var e,t=0;for(e=0;e<O._trackArray.length;e++){var n=O._trackArray[e].track;if(n.getMinimizedState()){t=t+TAG.TourAuthoring.Constants.minimizedTrackHeight}else{t=t+TAG.TourAuthoring.Constants.trackHeight}}return t+O._trackArray.length*2}function at(e){function m(e){ot.add(function(){var t;for(t=e;t<=e+v;t=t+i){ut.appendChild(g(t)[0])}})}function g(t){var n=Math.min(t,e.end),r=x.formatTime(t),i=TAG.Util.getFontSize(100),s=x.timeToPx(t),o=$(document.createElement("div")).addClass("time-label").text(r).css({"border-width":"0px 0px 0px 1px","border-color":"black","border-style":"solid",position:"absolute",left:s+"px","padding-left":"5px","font-size":".65em",color:"black",height:"100%"});return o}var t,n,r=e.scale,i=r,s=f.children("div"),o=Date.now();ot.clear();ut=document.createDocumentFragment();s.text("");W=true;c.scrollLeft(c.scrollLeft());while(i*r<80){i=i*2}while(i*r>100){i=i/2}i=Math.ceil(i);var u=x.pxToTime(c.scrollLeft()),a=u-u%i,l=u+x.pxToTime(c.width());var h,p=document.createDocumentFragment();s.remove();for(h=a;h<=l;h+=i){p.appendChild(g(h)[0])}f.append(p);var d=20,v=d*i;for(t=e.start;t<=e.end;t=Math.min(t+v,e.end)){m(t);if(t===e.end)break}ot.add(function(){var e;s.remove();f.append(ut);console.log("time ruler update elapsed: "+(Date.now()-o))})}function ft(){return F}function lt(e){F=e}function ct(e){e.appendChild(E)}function ht(e){y=e}function pt(e,t){y.showEditDraw(e,t);I=true}function dt(e,t,n){y.showEditText(e,t,n);I=true}function vt(e,t,n){y.showEditTransparency(e,t,n);I=true}function mt(e){I=e}function gt(){y.removeInkCanv();y.hideInkControls()}function yt(e){var t=false;if(e){if(e.getFadeOut()===0){t=true}}O.reInitHeaps();for(var n=0;n<J.length;n++){J[n].getTrack().boundHelper(J[n],t)}}function bt(){V=false;$("#multiSelButton").css({color:"black","background-color":"transparent","border-color":"black"})}function St(){var e=At();var t=e.length;if(e.length===0){return}Et=new Array(t);yt();var n=O._leftExternal.peek(),r=O._rightExternal.peek();if(n){n=n.bound}if(r){r=r.bound}for(var i=0;i<t;i++){Et[i]=new Array(5);var s=e[i].getStart()-n;var o=e[i].getEnd()+r;Et[i][0]=e[i].getStart();Et[i][1]=e[i].getMainStart();Et[i][2]=e[i].getOutStart();Et[i][3]=s;Et[i][4]=o}}function xt(){wt=[]}function Tt(){return Et}function Nt(e,t){bt();yt(t);var n=O._leftExternal.peek().bound,r=O._rightExternal.peek().bound,i=O._leftInternal.peek().bound,s=O._rightInternal.peek().bound,o=t.getLoc(),u=At(),a=t.getStart()-n,f=t.getEnd()+r,l=t.getTranslation(e,a,f,i,s),c,h,p,d;var v=t.getOffset();if(wt[0]===null||wt[0]===undefined){wt=new Array(At().length);for(var m=0;m<u.length;m++){c=u[m].getStart()-n;h=u[m].getEnd()+r;p=u[m].getStart()+i;d=u[m].getEnd()-s;if(wt[m]===null||wt[m]===undefined){wt[m]=new Array(10);wt[m][0]=u[m].getStart();wt[m][1]=u[m].getMainStart();wt[m][2]=u[m].getOutStart();wt[m][3]=c;wt[m][4]=h;wt[m][5]=l;wt[m][6]=o;wt[m][7]=v;wt[m][8]=p;wt[m][9]=d}}}t.msMove(u,l)}function Ct(){return wt}function kt(){bt();var e=At();var t=At().length;if(e.length>0){for(var n=0;n<t;n++){e[0].getTrack().setDisplayDeselected(e[0],false)}}Et=[];wt=[];J=[]}function Lt(){return V}function At(){return J}function Ot(){return s.length}function Mt(){return s}function _t(){return c[0]}function Dt(){return f}function Pt(){return j}function Ht(e){j=e}function jt(e){Bt=e}function Ft(){return Bt}function qt(e){It=e}function Rt(e){if(It){setTimeout(It(e),0)}}function Ut(e){return O.findTrackByTitle(e)}function zt(){var e,t=0,n=O.getTracks();for(e=0;e<n.length;e++){var r=O.maxDisplay(n[e].track.getPos());var i=r.display.getFadeOut()+r.display.getOutStart();if(i>t){t=i}}return t}function Wt(e,t){var n,r,i,s,o,u,a=[],f=-1;t=t||-1;var l=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");var c="";for(n=0;n<e.length;n++){c=c+e.substr(n,1).replace(l,"")}u=new RegExp(c+"(?:-([0-9]+))?");O.mapTracks(function(e){r=e.track.getTitle();o="";for(s=0;s<r.length;s++){o=o+r.substr(s,1).replace(l,"")}i=u.exec(o);if(i&&i[0]===o&&t!==e.track.getID()){if(i[1]){a.push(parseInt(i[1],10))}else{a.push(-1)}}});if(a.length>0){a.sort(function(e,t){return e-t});for(n=0;n<a.length;n++){if(a[n]+1!==n){f=n-1;break}f++}if(f!==-1){return e+"-"+f}else{return e}}else{return e}}function Xt(e,t,r,i){r=r||(O.getSelectedTrack()?O.getSelectedTrack().getPos():0);var o={dataHolder:O,media:e,mediaLength:i,root:T,id:r,title:Wt(t),timeManager:x,undoManager:C,update:xn,timeline:n,trackarray:s,selectedTrack:q},u,a=TAG.TourAuthoring.AudioTrack(o),f=TAG.TourAuthoring.Command({execute:function(){Gt(a);O.insertTrack(a,u);a.setTitle(a.getTitle())},unexecute:function(){u=a.getPos();Yt(a)}});Gt(a);O.insertTrack(a,r);u=a.getPos();if(t){a.setTitle(t)}C.logCommand(f);return a}function Vt(e,t,r,i,o,u,a){r=r||(O.getSelectedTrack()?O.getSelectedTrack().getPos():0);var f={dataHolder:O,media:e,mediaLength:i,converted:u,toConvert:o,root:T,id:r,title:Wt(t),timeManager:x,undoManager:C,update:xn,timeline:n,trackarray:s,selectedTrack:q,firstupload:a},l,c=TAG.TourAuthoring.VideoTrack(f),h=TAG.TourAuthoring.Command({execute:function(){Gt(c);O.insertTrack(c,l);c.setTitle(c.getTitle())},unexecute:function(){l=c.getPos();Yt(c)}});Gt(c);O.insertTrack(c,r);l=c.getPos();if(t){c.setTitle(t)}C.logCommand(h);return c}function $t(e,t,r,i){i=i||(O.getSelectedTrack()?O.getSelectedTrack().getPos():0);var o={dataHolder:O,media:e,root:T,id:i,guid:r,title:Wt(t),timeManager:x,undoManager:C,update:xn,timeline:n,trackarray:s,selectedTrack:q},u,a=TAG.TourAuthoring.ArtworkTrack(o),f=TAG.TourAuthoring.Command({execute:function(){Gt(a);O.insertTrack(a,u)},unexecute:function(){u=a.getPos();Yt(a)}});Gt(a);O.insertTrack(a,i);u=a.getPos();C.logCommand(f);return a}function Jt(e,t,r){r=r||(O.getSelectedTrack()?O.getSelectedTrack().getPos():0);var i={dataHolder:O,media:e,root:T,id:r,title:Wt(t),timeManager:x,undoManager:C,update:xn,timeline:n,trackarray:s,selectedTrack:q},o,u=TAG.TourAuthoring.ImageTrack(i),a=TAG.TourAuthoring.Command({execute:function(){Gt(u);O.insertTrack(u,o);u.setTitle(u.getTitle())},unexecute:function(){o=u.getPos();Yt(u)}});Gt(u);O.insertTrack(u,r);o=u.getPos();if(t){u.setTitle(t)}C.logCommand(a);return u}function Kt(e,t,r,i,o){var u=O.getSelectedTrack();if(!o){if(u){o=u.getPos()}else if(e){o=e.getPos()}else{o=0}}var a={dataHolder:O,media:r,root:T,inkSpec:i,id:o,title:Wt(t),timeManager:x,undoManager:C,update:xn,timeline:n,trackarray:s,selectedTrack:q},f,l=TAG.TourAuthoring.InkTrack(a),c=TAG.TourAuthoring.Command({execute:function(){Gt(l);O.insertTrack(l,f);l.setTitle(l.getTitle())},unexecute:function(){f=l.getPos();Yt(l)}});Gt(l);O.insertTrack(l,o);f=l.getPos();if(t){l.setTitle(t)}C.logCommand(c);return l}function Gt(e){var t;e.addTitleToDOM(a);e.addEditorToDOM(c)}function Yt(e){var t;O.removeTrack(e);e.updatePos(e.getPos());if(e.getType()===TAG.TourAuthoring.TrackType.ink&&e.getInkEnabled()){e.getInkLink().removeAttachedInkTrack(e)}e.detach();O.mapTracks(function(e,t){e.track.updatePos(t)});xn()}function Zt(e,t){a.prepend(t);c.prepend(e)}function en(){return O.numTracks()}function tn(){var e,t,n=[];O.mapTracks(function(t){e=t;if(e.track.getType()===TAG.TourAuthoring.TrackType.artwork){n.push(e.track.getGUID())}});return n}function nn(){return c}function rn(){return d}function sn(e){for(var t=0;t<O._trackArray.length;t++){var n=O._trackArray[t].track;if(n.getType()===TAG.TourAuthoring.TrackType.artwork||n.getType()===TAG.TourAuthoring.TrackType.image){return true}}return false}function on(){y.disableInk()}function an(e){un=e}function fn(){return un}function ln(){i=true;C.setInitialized(true)}function cn(e,t,n){for(var r=0;r<O._trackArray.length;r++){var i=O._trackArray[r].track;if(i.getTitle()===e){i.receiveKeyframe(t,n);break}}}function hn(){var e;O.mapTracks(function(e){e.track.deselectKeyframe()})}function pn(e){return k.captureKeyframe(e)}function dn(){return k}function vn(){return O}function mn(){var e={},t="TAGAuthoringPreview";e.version="1.0";e.defaultScreenplayId="SCP1";e.screenplayProviderId="screenplayProvider";e.data={narrativeData:{guid:"e3ced195-0c8b-48f6-b42c-f989e52b4f03",timestamp:(new Date).toISOString(),title:t,author:"TAG Authoring Tool",aspectRatio:"WideScreen",estimatedDuration:x.getDuration().end,description:"TAG Tour",branding:"TAG"}};e.providers={ZMES:{name:"MicrosoftResearch.Rin.ZoomableMediaExperienceStream",version:"1.0"},AES:{name:"MicrosoftResearch.Rin.AudioExperienceStream",version:"1.0"},screenplayProvider:{name:"MicrosoftResearch.Rin.DefaultScreenplayProvider",version:"1.0"},FadeInOutTransitionService:{name:"MicrosoftResearch.Rin.FadeInOutTransitionService",version:"1.0"},InkES:{name:"MicrosoftResearch.Rin.InkExperienceStream",version:"0.0"},VideoES:{name:"MicrosoftResearch.Rin.VideoExperienceStream",version:0},ImageES:{name:"MicrosoftResearch.Rin.ImageExperienceStream",version:"1.0"}};e.resources=gn();e.experiences=yn();e.screenplays={SCP1:{data:{experienceStreamReferences:bn()}}};return e}function gn(){var e,t={};O.mapTracks(function(e){e.track.addResource(t)});return t}function yn(){var e,t={};O.mapTracks(function(e){e.track.addES(t)});return t}function bn(){var e,t=[];O.mapTracks(function(e){e.track.addScreenPlayEntries(t)});t.sort(function(e,t){return e.begin-t.begin});return t}function wn(e){r=e}function Sn(){b=b+1;x.stop();var e;if(i){k.setIsReloading(true);x.stop();k.capturingOff();hn();e=mn();k.reloadTour(e)}rt();it()}function xn(e){if(!e){En()}else{Sn()}}function Tn(e,t){function V(e,t){var n=e.exp.data.zIndex,r=t.exp.data.zIndex,i,s,o,u,a,f=e.exp.experienceStreams,l=t.exp.experienceStreams;if(!n){for(o in f){if(f.hasOwnProperty(o)){i=f[o];if(i){n=i.data.zIndex}break}}}if(!r){for(o in l){if(l.hasOwnProperty(o)){s=l[o];if(s){r=s.data.zIndex}break}}}if(n){if(r){return r-n}else{return-1}}else{if(r){return 1}else{return 0}}}function J(e,t){r.add(function(){Q(e,t)})}function K(e,t,n){T.append(z);z.attr("id","deleteConfirmationOverlay");z.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex});var r=$(document.createElement("div"));r.attr("id","deleteConfirmation");r.css({position:"absolute",left:"32.5%",width:"35%",top:"30%",border:"3px double white","background-color":"black",padding:"2.5% 2.5%"});z.append(r);var i=$(document.createElement("div"));i.attr("id","dialogTitle");i.css({color:"white","font-size":"1.25em","margin-bottom":"10px","word-wrap":"normal"});r.append(i);r.append(document.createElement("br"));var s=$(document.createElement("div"));s.css({"margin-top":"10px","text-align":"center"});r.append(s);var o=$(document.createElement("button"));o.css({width:"auto",border:"1px solid white",padding:"1%","margin-right":"3%"});o.text("Continue");$(o).click(function(){var e=t.removeAttachedInkDisplays();t.removeDisplay(true);if(e>0){C.combineLast(e+1)}z.fadeOut(500)});s.append(o);var u=$(document.createElement("button"));u.css({width:"auto",border:"1px solid white",padding:"1%"});u.text("Cancel");u.click(function(){z.fadeOut(500)});s.append(u);z.fadeIn(500);i.text('Deleting the last display in track "'+e+'" will disable all attached ink tracks. Any existing ink displays will not function until a new artwork display has been created at an overlapping time.')}function Q(e,t){p=e.name;d=e.exp;A=d.providerId;_=d.data.zIndex;if(d.resourceReferences.length!==0){i=d.resourceReferences[0].resourceId}N=null;if(A==="ZMES"){N=$t(U[i].uriReference,p,d.data.guid,t)}else if(A==="ImageES"){N=Jt(U[i].uriReference,p,t)}else if(A==="VideoES"){b=d.data.mediaLength;var n=d.data.toConvert;var r=d.data.converted||false;N=Vt(U[i].uriReference,p,t,b,n,r)}else if(A==="AES"){b=d.data.mediaLength;N=Xt(U[i].uriReference,p,t,b)}else if(A==="InkES"){N=Kt(null,p,1,null,t);N.setInkPath(d.data.linkToExperience.embedding.element.datastring.str);N.setInkEnabled(d.data.linkToExperience.embedding.enabled);N.setInkInitKeyframe(d.data.linkToExperience.embedding.initKeyframe);N.setInkRelativeArtPos(d.data.linkToExperience.embedding.initproxy);N.link=d.data.linkToExperience.embedding.experienceId;N.addInkTypeToTitle(d.data.linkToExperience.embedding.element.datastring.str.split("::")[0].toLowerCase());q.push({track:N,link:d.data.linkToExperience.embedding.experienceId})}else{console.log("Experience not yet implemented")}if(N.getPos()!==c.length-_){console.log("zIndex and track array position are not the same for: "+p)}if(N){D=d.experienceStreams;for(var s in D){if(D.hasOwnProperty(s)){m=s+"";v=D[s];M=v.duration;for(u=0;u<X.length;u++){g=X[u];if(g.experienceStreamId===m){w=g.begin;if(v.data.transition&&v.data.transition.providerId){E=v.data.transition.inDuration;S=v.data.transition.outDuration}else{E=0;S=0}L=N.addDisplay(x.timeToPx(w));L.setMain(M);L.setIn(E);L.setOut(S);if(d.providerId!=="InkES"&&d.providerId!=="VideoES"){y=v.header.defaultKeyframeSequence;P=v.keyframes;for(a=0;a<P.length;a++){H=P[a];if(H.init){continue}j=x.timeToPx(H.offset+L.getStart());if(A==="ZMES"||A==="ImageES"){B=L.addKeyframe(j,TAG.TourAuthoring.Constants.trackHeight/2);if(B)B.loadRIN(H)}else if(A==="AES"){f=H.state.sound.volume;f=Math.constrain(TAG.TourAuthoring.Constants.trackHeight-TAG.TourAuthoring.Constants.trackHeight*f,0,TAG.TourAuthoring.Constants.trackHeight);B=L.addKeyframe(j,f);if(B)N.addKeyframeToLines(B)}else if(A==="VideoES"){}else{console.log("Experience not yet implemented")}}}break}}}}}}var r=TAG.Util.createQueue(),i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,N,L,A,M,_,D,P,H,B,j,F,I,q=[],R=e.data.narrativeData,U=e.resources,W=e.experiences,X=e.screenplays.SCP1.data.experienceStreamReferences;x.setEnd(R.estimatedDuration);h=e.screenplays.SCP1.data.experienceStreamReferences;c=[];for(s in W){if(W.hasOwnProperty(s)){c.push({name:s+"",exp:W[s]})}}c.sort(V);for(s=0;s<c.length;s++){J(c[s],s)}r.add(function(){var e,t;for(u=0;u<q.length;u++){I=Ut(q[u].link);q[u].track.setInkLink(I);if(q[u].track.getInkEnabled()){O.mapDisplays(q[u].track.getStorageContainer(),function(n){t=I.getStorageContainer().displays.nearestNeighbors(n.display.getStart(),1);e=t[0]&&t[0].display;n.display.setParentDisplay(e);e&&e.addChildDisplay(n.display)})}if(I){I.addAttachedInkTrack(q[u].track)}}});O.mapTracks(function(e,t){e.track.updatePos(t)});r.add(function(){ln()});r.add(function(){setTimeout(k.resize,1);if(typeof t==="function"){t()}});n.confirmDeleteDisableInk=K}function Nn(){N.ruler.cancelAccel();N.track.cancelAccel()}var n={},r=false,i=false,s=[],o,u,a,f,l,c,h,p,d,v,m,g,y,b=0,w=0,E,S=e.playbackControls,x=e.timeManager,T=e.root,N={},C=e.undoManager,k=e.viewer,L,A,O=e.dataHolder,M=x.getDuration().scale,_=false,D=false,P=false,H=false,B=false,j,F=false,I=false,q={current:null};n.isMenuOpen=false;var R=$(TAG.Util.UI.blockInteractionOverlay());R.addClass("editInkOverlay");var U=$(document.createElement("div"));U.text("Annotation is being edited...");var z=$(document.createElement("div"));n.editInkOn=false;n.clamped_displays=[];k.setTimeline(n);var W=true;var X=true;var V=false;var J=[];var K=$(window).width()*.995;var Q=$(window).height()*.4825;var G=.127*$(window).width();var Y=Q-5-TAG.TourAuthoring.Constants.timeRulerSize;(function(){function p(){x.seek(x.pxToTime(x.getCurrentPx()+c.scrollLeft()))}function C(e){T=e}o=$(document.createElement("div"));o.attr("class","mainScrollHider");o.css({"background-color":"rgb(219,218,199)",overflow:"hidden",height:Q+"px",width:K+"px","margin-top":"3%",position:"relative"});u=$(document.createElement("div"));u.attr("id","editor");u.css({height:"100%",width:"100%",overflow:"hidden"});var t=$(document.createElement("div"));t.attr("id","trackScrollVeil");t.css({width:G+20+"px",height:Y+"px","margin-left":$(window).width()*.02-20+"px","overflow-x":"hidden","overflow-y":"hidden","float":"left",clear:"left",top:"0px",position:"relative"});a=$(document.createElement("div"));a.attr("id","trackTitleWrapper");a.css({width:G+20+"px",height:"100%","margin-left":"1.5%",position:"relative","overflow-x":"hidden","overflow-y":"hidden","z-index":"102","background-color":"rgb(219, 218, 199)"});c=$(document.createElement("div"));c.attr("id","trackBody");c.css({height:Y+"px","margin-left":"15%","overflow-x":"hidden","overflow-y":"hidden",position:"relative"});f=$(document.createElement("div"));f.css({position:"relative",height:TAG.TourAuthoring.Constants.timeRulerSize+17+"px","overflow-x":"hidden","overflow-y":"hidden"});f.attr("id","timeRuler");l=$(document.createElement("div"));l.attr("id","timeline");l.css({height:"200%",width:"97%",overflow:"hidden",position:"relative"});var r=$(document.createElement("div"));r.attr("id","horizBlock");r.css({height:TAG.TourAuthoring.Constants.timeRulerSize+"px",width:"15.5%","background-color":"rgb(219,218,199)",position:"absolute","z-index":"102"});var i=$(document.createElement("div"));i.attr("id","vertBlock");i.css({height:"100%",width:"1.5%","background-color":"rgb(219,218,199)",position:"absolute","z-index":"102"});var s=$(document.createElement("div"));s.attr("id","rulerScrollVeil");s.css({height:TAG.TourAuthoring.Constants.timeRulerSize+"px",width:"85%","margin-left":"15.4%","overflow-x":"hidden","overflow-y":"hidden"});var h=$(document.createElement("div"));h.attr("id","rulerWrapper");h.css({width:"85%",height:TAG.TourAuthoring.Constants.timeRulerSize+"px","overflow-x":"hidden","overflow-y":"hidden",position:"absolute","z-index":"100","box-shadow":"-7px 5px 10px #888"});n.faderUpdate=p;N.ruler=TAG.Util.makeManipulatable(h[0],{onManipulate:function(e){h.scrollLeft(h.scrollLeft()-e.translation.x);N.track.cancelAccel()},onScroll:function(e){var t=Ft();if(t){t()}if(e===1.1){h.scrollLeft(h.scrollLeft()-30)}else{h.scrollLeft(h.scrollLeft()+30)}N.track.cancelAccel()},onTapped:function(e){if(I){return false}x.seek(x.pxToTime(e.position.x+c.scrollLeft()))}});var y=0;var b;var w=0;var S;N.track=TAG.Util.makeManipulatable(c[0],{onManipulate:function(e){N.ruler.cancelAccel();if(e.translation.x!==0){console.log("trans = "+e.translation.x);console.log("pivot = "+e.pivot.x);c.scrollLeft(c.scrollLeft()-e.translation.x)}if(e.translation.y!==0){if(st()>c.height()){var t=c.scrollTop()-e.translation.y;c.scrollTop(t);nt(t)}}}});h.scroll(function(e){if(W){W=false;c.scrollLeft(h.scrollLeft())}else{W=true}});a.scroll(function(e){if(X){X=false;c.scrollTop(a.scrollTop());nt(a.scrollTop())}else{X=true}});c.scroll(function(e){if(W){W=false;h.scrollLeft(c.scrollLeft())}else{W=true}if(T)T();z();if(X){X=false;if(st()<c.height()){return}a.scrollTop(c.scrollTop());rt();nt(a.scrollTop())}else{X=true}});var T=null;n.registerUpdateSlider=C;var k=function(e){f.css("width",x.timeToPx(e.end)+"px")};k(x.getDuration());x.onSizing(k);var L=$(document.createElement("div"));L.addClass("multiSelButtonPanel");L.css({top:"11%",left:"25%",position:"relative",width:"60%",height:"75%","float":"left","z-index":"5"});var O=$(document.createElement("button")).css("border-radius","3.5px");O.attr("type","button");O.attr("id","multiSelButton");O.text("Multi-Select");O.attr("type","button");var M=TAG.Util.constrainAndPosition($(window).width()*.8,$(window).height()*.08,{center_v:true,width:.1,height:.42});var _=TAG.Util.getMaxFontSizeEM("Multi-Select",.2,.6*M.width,.75*M.height,.01);O.css({color:"black","border-color":"black",position:"absolute","font-size":_,"float":"left",width:M.width+"px",height:M.height+"px"});$(O).click(function(){if(ft()===true){return false}if(V===true){V=false;O.css({color:"black","background-color":"transparent","border-color":"black"})}else{V=true;O.css({color:"white","background-color":"darkgreen","border-color":"white"})}});R.css({top:TAG.Util.Constants.timeRulerSize,width:"100%",height:"100%","margin-left":"2%",position:"absolute","z-index":"10000","background-color":"rgba(0, 0, 0, 0.5)"});U.css({position:"relative",left:"33.5%",top:"35%","font-size":"22pt"});R.hide();A=$(document.createElement("div"));A.attr("id","verticalSliderPane");A.css({position:"absolute",left:"97.35%",top:54+"px",display:"inline-block",width:"1%",height:Y-8+"px"});var D=tt(A);A.append(D[0]);A.append(D[1]);E=document.createDocumentFragment();E.appendChild(o[0]);o.append(u);u.append(l);L.append(O);r.append(L);l.append(r);l.append(i);l.append(s);s.append(h);h.append(f);u.append(A);u.append(R);R.append(U);l.append(t);t.append(a);l.append(c);var P=Q-5;var H=K-17;o.css({height:P+"px",width:H+"px"});O.fitText(.8);d=d3.select(l[0]).append("svg").style("position","absolute").style("left","0px").style("top","0px").attr("id","playhead").attr("width","0%").style("z-index","101").attr("height","100%");var B=d[0][0];v=d.append("g").attr("transform","translate(5,0)");var j=v[0][0];m=v.append("circle").attr("cx","0").attr("cy","27px").attr("r","18px").attr("fill","black").attr("stroke","black").attr("stroke-width","7px").attr("fill-opacity","0");g=v.append("line").attr("x1","0").attr("y1","45px").attr("x2","0").attr("y2","100%").attr("pointer-events","none").attr("stroke","black").attr("stroke-width","1px");var q=$("body");v.on("mousedown",function(){var e,t,n;e=d3.mouse(q[0])[0];t=x.getCurrentPx();q.on("mousemove.playhead",function(r){if(F===true){return false}n=t+(r.pageX-e);if(n>$("#timeRuler").width()){n=$("#timeRuler").width()}else if(n<0){n=0}else{e=r.pageX}x.seek(x.pxToTime(n));t=n});q.on("mouseup.playhead",function(){q.off("mousemove.playhead");q.off("mouseup.playhead")})});var z=function(){var e=x.getCurrentPx();v.attr("transform","translate("+(e+u.width()*.15-c.scrollLeft())+")")};x.onSeek(z);x.onSizing(z);x.onPlay(z)})();n.showEditorOverlay=Z;n.hideEditorOverlay=et;n.updateVerticalScroller=rt;n.enableDisableDrag=it;var ot=TAG.Util.createQueue(),ut=$();at(x.getDuration());x.onSizing(function(e){f.children("div").text("");setTimeout(function(){at(e)},2)});n.getEditInkOn=ft;n.setEditInkOn=lt;n.addToDOM=ct;n.selectedTrack=q;n.setCompControl=ht;n.showEditDraw=pt;n.showEditText=dt;n.showEditTransparency=vt;n.setModifyingInk=mt;n.removeInkSession=gt;n.getMSBounds=yt;n.turnOffMS=bt;var wt=[],Et=[];n.updateOldData=St;n.newDataArray=xt;n.getOldData=Tt;n.moveSelect=Nt;n.getDisplayData=Ct;n.allDeselected=kt;n.getMultiSelection=Lt;n.getMultiSelectionArray=At;n.getTrackslength=Ot;n.getTracks=Mt;n.getTimelineArea=_t;n.getTimeRuler=Dt;n.getisMenuOpen=Pt;n.setisMenuOpen=Ht;var Bt;n.setCloseMenu=jt;n.getCloseMenu=Ft;var It;n.setCloseableFunction=qt;n.getCloseableFunction=Rt;n.getLastDisplayTime=zt;n.fixTrackTitle=Wt;n.addAudioTrack=Xt;n.addVideoTrack=Vt;n.addArtworkTrack=$t;n.addImageTrack=Jt;n.addInkTrack=Kt;var Qt=0;n.removeTrack=Yt;n.prependAddToDom=Zt;n.getNumTracks=en;n.getRelatedArtworks=tn;n.getTrackBody=nn;n.getPlayhead=rn;n.checkForArtworks=sn;n.disableInk=on;var un=true;n.setFadeHidden=an;n.isFadeHidden=fn;n.setLoaded=ln;n.receiveKeyframe=cn;n.capturingOff=hn;n.captureKeyframe=pn;n.getViewer=dn;n.getDataHolder=vn;n.toRIN=mn;n.setTourExited=wn;var En=$.debounce(200,Sn);n.onUpdate=xn;n.loadRIN=Tn;n.cancelAccel=Nn;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.TopMenu");TAG.TourAuthoring.TopMenu=function(e,t){"use strict";function d(e){e.append(c).append(h).append(p)}var n={},r=e.viewer,i=e.undoManager,s=e.timeline,o=e.timeManager,u=e.tourobj,a=e.playbackControls,f=e.root,l=e.componentControls,c=$(document.createElement("div")),h=$(TAG.Util.UI.blockInteractionOverlay()),p=$(TAG.Util.UI.blockInteractionOverlay());(function(){function m(e){console.log("isUploading === "+l.getIsUploading());d=true;v=false;if($("#inkEditText").css("display")!=="none"){l.saveText()}else if($("#inkEditDraw").css("display")!=="none"){l.saveDraw()}else if($("#inkEditTransparency").css("display")!=="none"){l.saveTrans()}s.hideEditorOverlay();i.setPrevFalse();var t=y.val();var n=JSON.stringify(s.toRIN(true));var r=JSON.stringify(s.getRelatedArtworks());var o={Name:t,Content:n,RelatedArtworks:r};TAG.Worktop.Database.changeTour(u,o,function(){h.fadeOut(500);!e&&g()},function(){h.hide();var e=TAG.Util.UI.popUpMessage(null,"Tour not saved.  You must log in to save changes.");$("body").append(e);$(e).show()},function(e,t){t.force()},function(){h.hide();var e=TAG.Util.UI.popUpMessage(null,"Tour not saved.  There was an error contacting the server.");$("body").append(e);$(e).show()})}function g(){var e;if(r.getIsReloading()){e=TAG.Util.UI.popUpMessage(null,"Tour reload in progress. Please wait a few moments.",null);$(e).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(e);$(e).fadeIn(500);return}p.off("click");$(".rightClickMenu").hide();var t=new TAG.Authoring.SettingsView("Tours",null,null,u.Identifier);r.stop();r.unload();TAG.Util.UI.slidePageRight(t.getRoot())}c.css({"background-color":"rgb(63,55,53)",height:"8%",width:"100%"});c.attr("id","topbar");var t=$(window).height()*.0504;var n=$(document.createElement("div"));n.css({top:"18.5%","margin-left":"1.2%",height:"63%",width:t+"px",position:"relative","float":"left"});var p=$(document.createElement("img"));p.attr("src",tagPath+"images/icons/Back.svg");p.css({width:"100%",height:"100%"});p.mousedown(function(){TAG.Util.UI.cgBackColor("backButton",p,false)});p.mouseleave(function(){TAG.Util.UI.cgBackColor("backButton",p,true)});var d=false;var v=false;p.click(function(){var e;$(".rightClickMenu").hide();if(r.getIsReloading()){e=TAG.Util.UI.popUpMessage(null,"Tour reload in progress. Please wait a few moments.",null);$(e).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(e);$(e).fadeIn(500);return}if(v||i.dirtyStateGetter()===false||l.getInkUndoManager()&&l.getInkUndoManager().dirtyStateGetter()===false){if(y.val().length===0){y.val("Untitled Tour")}var t=TAG.Util.UI.PopUpConfirmation(function(){$("#popupConfirmButton").text("Saving...").attr("disabled",true);m()},"Save changes to "+y.val()+" before leaving?","Save",false,function(){g();$("#popupConfirmButton").attr("disabled",true);$("#popupCancelButton").attr("disabled",true).css({color:"rgba(255, 255, 255, 0.5)"})},null,null,true);f.append(t);TAG.Util.multiLineEllipsis($($($(t).children()[0]).children()[0]));$(t).css("z-index",1e6);$(t).show()}else{g()}});n.append(p);c.append(n);var y=$(document.createElement("input"));y.type="text";var b=TAG.Util.constrainAndPosition($(window).width(),$(window).height()*.08,{center_v:true,width:.2,height:.5,x_offset:.05,x_max_offset:60});y.css({"margin-left":"3%",position:"absolute",border:"3px solid","border-color":"#666666",top:b.y-7+"px",left:b.x+"px",width:b.width+"px",height:b.height+"px","font-size":".7em"});y.attr({display:"block",type:"text",id:"textArea",name:"textArea",value:u.Name});y.on("keydown",function(e){e.stopImmediatePropagation()});y.on("keypress",function(e){e.stopImmediatePropagation()});y.on("keyup",function(e){v=true;e.stopImmediatePropagation()});c.append(y);var w=$(document.createElement("button"));w.text("Save").css("border-radius","3.5px");w.attr("type","button");w.attr("id","tourSaveButton");w.prop("disabled",true);w.css("opacity","0.4");w.on("mousedown",function(){if(!w.is(":disabled")){w.css({"background-color":"white",color:"black"})}});w.on("mouseup",function(){if(!w.is(":disabled")){w.css({"background-color":"transparent",color:"white"})}});w.on("mouseout",function(){if(!w.is(":disabled")){w.css({"background-color":"transparent",color:"white"})}});var E=TAG.Util.constrainAndPosition($(window).width()*.8,$(window).height()*.08,{center_v:true,width:.13,height:.5});var S=TAG.Util.getMaxFontSizeEM("Save",.2,.63*E.width,.75*E.height,.01);w.css({color:"white","border-color":"white",position:"absolute",width:E.width+"px",height:E.height+"px",top:E.y+"px","font-size":S,left:parseInt(y.css("left"),10)+y.width()+45+$(window).width()*.022+"px"});c.append(w);w.click(function(){$(".rightClickMenu").hide();if(y.val().length===0){y.val("Untitled Tour")}m(true);w.prop("disabled",true);w.css("opacity","0.4")});var x=TAG.TourAuthoring.TourOptions({timeManager:o,timeline:s,root:f,undoManager:i,playbackControls:a,tour:u});x.addToDOM(c);var T=TAG.Util.constrainAndPosition($(window).width(),$(window).height()*.08,{center_v:true,width:.13,height:.8});var N=TAG.Util.getMaxFontSizeEM("Options",.5,T.width*.8,T.height*.7,.01);var C=TAG.Util.constrainAndPosition(T.width,T.height,{center_v:true,width:.8,height:.8});x.applyCSS({height:T.height+"px",width:T.width+"px",left:"60%",top:T.y+"px",position:"absolute"});x.applyLabelCSS({height:C.height+"px",width:C.width+"px",left:0+"px",top:C.y+"px",position:"absolute","font-size":N});var k=$(document.createElement("div"));var L=TAG.Util.constrainAndPosition($(window).width(),$(window).height()*.08,{width:.4,height:.9});k.css({"margin-right":"2%","margin-top":8*.04+"%",color:"white",position:"absolute","text-align":"right",right:"0px",top:"0px",height:L.height+"px",width:L.width+"px"});var A=TAG.Util.getMaxFontSizeEM("Tour Authoring",.5,L.width,L.height*.85);k.css({"font-size":A});k.text("Tour Authoring");c.append(k)})();n.addToDOM=d;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.TourOptions");TAG.TourAuthoring.TourOptions=function(e){"use strict";function v(e){t.css(e)}function m(e){n.css(e)}function g(e){e.append(t).append(h);e.append(t).append(p)}function y(){var e=d;d={};return e}var t=$(document.createElement("div")),n,r,i,s={},o=e.tour,u=e.playbackControls,a=e.timeManager,f=e.timeline,l=e.root,c=e.undoManager,h=$(TAG.Util.UI.blockInteractionOverlay()),p=$(document.createElement("div")),d={};(function(){function g(e,t,n){var r=$(document.createElement("label"));r.addClass("optionItem");r.attr("id",n);r.text(e);r.css({left:"0%",position:"relative","font-size":".8em",color:"rgb(256, 256, 256)",display:"block",padding:"4% 0 5% 0","text-indent":"4%","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+5});r.on("mousedown",function(e){e.stopImmediatePropagation();r.css({"background-color":"white",color:"black"})});r.on("mouseup",function(e){e.stopImmediatePropagation();r.css({"background-color":"transparent",color:"white"})});r.on("mouseout",function(e){e.stopImmediatePropagation();r.css({"background-color":"transparent",color:"white"})});t.append(r);return r}function w(){h.hide();var e=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  You must log in to save changes.");$("body").append(e);$(e).show();setTimeout(function(){p.fadeOut()},1e3)}function E(e,t){t.force()}function S(){h.hide();var e=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  There was an error contacting the server.");$("body").append(e);$(e).show();setTimeout(function(){p.fadeOut()},1e3)}function H(){var t=Date.now();var n=f.toRIN(true);var r=JSON.stringify(n);var i;var s="";s+="<!DOCTYPE html>\n";s+="    <html>\n";s+="    <head>\n";s+="        <title>TAG Tour Embedding</title>\n";s+='        <script src="TAG-min.js"></script>\n';s+="        <script>\n";s+="            window.onload = load;\n";s+="            function load() {\n";s+="                TAG({\n";s+='                    path: "",\n';s+='                    containerId: "tagContainer",\n';s+='                    serverIp: "'+localStorage.ip+'",\n';s+='                    width: "1000px",\n';s+='                    height: "500px",\n';s+='                    pageToLoad: "#tagpagename=tour&tagguid='+e.tour.Identifier+"&tagtouronly=false&tagserver="+localStorage.ip+'"\n';s+="                });\n";s+="            }\n";s+="        </script>\n";s+="    </head>\n";s+='    <body style="height:1000px;width:1100px;">\n';s+='        <div id="tagContainer" style="margin-left:50px;margin-top:50px"></div>\n';s+="    </body>\n";s+="</html>";j();i=B("Copy the text below into an HTML file and place this file in the top-level 'TAG' directory of the TAG web app source code. Please see our website (cs.brown.edu/research/ptc/tag) for more details.",s);$("body").append(i);i.fadeIn(500)}function B(e,t){function f(){n.fadeOut(500,function(){n.remove()})}var n=$(TAG.Util.UI.blockInteractionOverlay()),r=$(document.createElement("div")),i=$(document.createElement("textarea")),s=$(document.createElement("button")).css("border-radius","3.5px"),o=$(document.createElement("div")),u=$(document.createElement("div")),a=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.6,max_width:1200,max_height:1200});n.on("click",f);u.css({position:"absolute",left:a.x+"px",top:a.y+"px",width:a.width+"px",height:a.height+"px",border:"3px double white","background-color":"black"});u.on("click",function(e){e.stopPropagation()});r.addClass("popupTextareaMessage");r.css({"font-size":"1.2em",height:"60px",left:"5%",position:"relative","margin-top":"10px",width:"90%"});r.text(e);i.css({left:"4%",position:"relative","margin-top":"12px",width:"90%"});i.attr({value:t});o.addClass("optionButtonDiv");o.css({height:"30px",width:"90%",position:"relative",left:"5%","margin-top":"10px"});s.css({border:"1px solid white",display:"inline-block","float":"right",position:"relative"});s.text("Close");s.on("click",f);o.append(s);u.append(r);u.append(i);u.append(o);n.append(u);i.css("height",u.height()-o.height()-r.height()-60+"px");return n}function j(){$(".tourOptionDropDownIcon").css({transform:"scaleY(1)","margin-bottom":"0%"});y=false;r.hide()}t.attr("id","tour-options");t.css({height:"48px",width:"13%",left:"25%",top:"27%",position:"relative","float":"left"});var u=$(document.createElement("img"));u.addClass("tourOptionDropDownIcon");u.attr("src",tagPath+"images/icons/Down.png");u.css({top:"-5%",width:"7.5%",height:"auto","margin-left":"5%","margin-bottom":"3%"});i=u;n=$(document.createElement("label"));n.attr("id","addTourOptionsLabel");n.text("Options");n.css({"font-size":TAG.Util.getFontSize(190),color:"rgb(256, 256, 256)"});n.append(u);t.append(n);r=$(document.createElement("div"));r.css({position:"absolute",color:"rgb(256, 256, 256)","background-color":"rgba(0,0,0,0.85)",left:"0",width:"100%","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex});t.append(r);r.hide();var d=g("Capture Thumbnail",r,"thumbnailButton");var v=g("Change Tour Length",r,"tourLengthButton");var m=g("Export Tour Data",r,"exportButton");var y=false;n.click(function(e){var t=f.getCloseMenu();if(t&&t!==j){t()}e.stopImmediatePropagation();y=!y;if(y){f.setisMenuOpen(true);f.setCloseMenu(j);l.on("mousedown.topMenu",function(e){j()});$(i).css({transform:"scaleY(-1)","margin-bottom":"3%"})}else{f.setisMenuOpen(false);f.setCloseMenu(j);l.off("mousedown.topMenu");$(i).css({transform:"scaleY(1)","margin-bottom":"3%"})}r.css("top",parseInt(n.css("top"),10)+n.height());r.toggle()});n.on("mousedown",function(e){e.stopImmediatePropagation()});var b=$(document.createElement("label"));$(b).text("Capturing Thumbnail...");b.css({"text-align":"center",width:"100%","font-size":"1em",color:"white"});p.append(b);p.addClass("thumbnailcaptured");p.css({"background-color":"black",position:"absolute",left:"52%","z-index":"1000",display:"none",opacity:"0.8",border:"2.8px double white"});d.on("click",function(){var e=$("#resizableArea").height()+$("#topbar").height();p.css({top:.53*e+"px"});j();p.fadeIn("fast");var t=$("#rinplayer");html2canvas([t[0]],{onrendered:function(e){var t=e.toDataURL();TAG.Worktop.Database.uploadImage(t,function(e){TAG.Worktop.Database.changeTour(o.Identifier,{Thumbnail:e},function(){setTimeout(function(){p.fadeOut()},1e3)},w,E,S)},w,S)},allowTaint:true})});v.on("click",function(){j();h.fadeIn(500);L.val(a.formatTime(a.getDuration().end));L.select();A.text("")});var x=$(document.createElement("div"));x.attr("id","lengthDialog");h.css("z-index","100000");var T=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:$("body").width()*.35,max_height:$("body").height()*.25});x.css({position:"absolute",left:T.x+"px",top:T.y+"px",width:T.width+"px",height:T.height+"px",border:"3px double white","background-color":"black"});h.append(x);var N=$(document.createElement("form"));N.attr("id","dialogForm");N.css({"margin-top":"4.5%"});x.append(N);N.on("submit",function(){var e=L.val().split(":");var t=parseInt(e[0],10),n=parseInt(e[1],10);var r;var i;if(e.length==1&&(t||t===0)&&t>=0){if(t>TAG.TourAuthoring.Constants.maxTourLength){A.text("Tour length is too long. Maximum length of tour must be 15 minutes.");A.css({color:"white",width:"80%",left:"10%","font-size":"0.7em",position:"absolute","text-align":"center","margin-top":"3%"});L.select()}else{if(t<f.getLastDisplayTime()){t=f.getLastDisplayTime()}r=a.getDuration().end;i=TAG.TourAuthoring.Command({execute:function(){a.setEnd(t)},unexecute:function(){a.setEnd(r)}});i.execute();c.logCommand(i);h.fadeOut(500)}}else if(e.length===2&&(t||t===0)&&(n||n===0)&&t>=0&&typeof n==="number"&&n>=0&&n<=59){var s=t*60+n;if(s>TAG.TourAuthoring.Constants.maxTourLength){A.text("Tour length is too long. Maximum length of tour is 15 minutes.");L.select()}else{if(s<f.getLastDisplayTime()){s=f.getLastDisplayTime()}r=a.getDuration().end;i=TAG.TourAuthoring.Command({execute:function(){a.setEnd(s)},unexecute:function(){a.setEnd(r)}});i.execute();c.logCommand(i);h.fadeOut(500)}}else{A.text("Please enter a valid length (MM:SS or seconds).");L.select()}f.faderUpdate();return false});var C=$(document.createElement("div"));C.attr("id","dialogTitle");C.css({color:"white",width:"80%",height:"15%",left:"10%","font-size":"0.7em",position:"relative","text-align":"center","word-wrap":"break-word"});var k="Enter New Length (MM:SS): ";C.text(k);N.append(C);var L=$(document.createElement("input"));L.attr("id","timeInput");L.css({position:"relative"});C.append(L);N.append(document.createElement("br"));L.on("keydown",function(e){e.stopImmediatePropagation()});L.on("keypress",function(e){e.stopImmediatePropagation()});L.on("keyup",function(e){e.stopImmediatePropagation()});var A=$(document.createElement("div"));A.css({color:"white",width:"80%",left:"10%","font-size":"0.7em",position:"absolute","text-align":"center","margin-top":"1%"});N.append(A);var O=$(document.createElement("div"));O.css({position:"absolute",display:"block",width:"80%",left:"10%",top:"60%"});N.append(O);var M=$(document.createElement("div"));M.css("text-align","right");var _=$(document.createElement("div"));_.css("clear","both");var D=$(document.createElement("button"));D.text("Apply");D.css({padding:"1%",border:"1px solid white",width:"auto",position:"absolute","float":"left","margin-top":"7%"});var P=$(document.createElement("button")).css("border-radius","3.5px");P.attr("type","button");P.text("Cancel");P.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-top":"7%",bottom:"1%"});O.append(P);O.append(D);O.append(_);N.append(O);P.click(function(){h.fadeOut(500)});O.append(P);m.on("click",H)})();s.applyCSS=v;s.applyLabelCSS=m;s.addToDOM=g;s.getBufferedData=y;return s};TAG.Util.makeNamespace("TAG.TourAuthoring.Track");TAG.Util.makeNamespace("TAG.TourAuthoring.TrackType");TAG.TourAuthoring.TrackType={audio:1,video:2,artwork:3,ink:4,image:5};TAG.TourAuthoring.Track=function(e,t){"use strict";function P(){var e;if(t.converted===false&&t.toConvert===true){var n=$(document.createElement("video"));n.attr("preload","metadata");var i=r.slice(8,r.length);var s=i.substr(0,i.lastIndexOf("."));var o=i.substr(i.lastIndexOf("."));TAG.Worktop.Database.getConvertedCheck(function(n){return function(r){e=r;if(r!=="False"&&r!=="Error"){console.log("converted: ");var i="/Images/"+s+".mp4";var u=TAG.Worktop.Database.fixPath(i);n.attr("src",u);n.on("loadedmetadata",function(){Zn("white");t.converted=true;t.toConvert=true;t.mediaLength=this.duration;if(o!==".mp4"){bn(0,this.duration)}L.text("");O.css("font-style","normal");l.css("opacity","1");clearInterval(k)})}if(r==="Error"){t.converted=false;O.css("font-style","italic");L.text("Conversion Error");l.css("opacity","0.7");var a=TAG.Util.UI.popUpMessage(null,"An error occurred when converting video "+t.title+". Please try to import it again.","OK",null,null,null,true);$("body").append(a);$(a).css("z-index",1e6);$(a).show();clearInterval(k);console.log("Error ocurred when converting")}else{console.log("not converted: ")}}}(n),null,i,s)}return e}function H(){t.track=$(document.createElement("div"));t.track.attr("id",o);t.track.addClass("track");t.track.css({height:TAG.TourAuthoring.Constants.trackHeight+"px",position:"relative",top:"0%",left:"0%","background-color":"rgb(255, 255, 255)",border:"1px solid #888","box-shadow":"5px 0px 10px -2px #888 inset",overflow:"hidden"});if(!t.mediaLength&&t.converted===false){t.track.css({"background-color":"gray"})}t.svg=d3.select(t.track[0]).append("svg").attr("width","100%").attr("height","100%").attr("overflow","hidden").attr("style","position: absolute");t.svgLines=t.svg.append("svg:g").classed("connectionLines",true);if(t.type==TAG.TourAuthoring.TrackType.audio){T=t.svgLines.append("svg:g").attr("id","keyframeLines");var e=T.append("svg:line").attr("x1",0).attr("y1",100-TAG.TourAuthoring.Constants.defaultVolume*100+"%").attr("x2","100%").attr("y2",100-TAG.TourAuthoring.Constants.defaultVolume*100+"%").style("pointer-events","none").style("stroke","green").style("stroke-width",4)}var n=function(e){var n=s.getDisplays(u)&&s.getDisplays(u).getContents()||[];var r,i,o;t.track.css("width",t.timeManager.timeToPx(e.end)+"px");for(r=0;r<n.length;r++){n[r].display.resetVisuals();o=s.getKeyframes(n[r]).getContents();for(i=0;i<o.length;i++){o[i].resetVisuals()}}};n(t.timeManager.getDuration());t.timeManager.onSizing(n)}function B(){t.track=$(document.createElement("div"));t.track.attr("id",o);t.track.addClass("track");t.track.css({height:TAG.TourAuthoring.Constants.trackHeight+"px",position:"relative",top:"0%",left:"0%","background-color":"rgb(255, 255, 255)",border:"1px solid #888","box-shadow":"5px 0px 10px -2px #888 inset"});var e=function(e){t.track.css("width",t.timeManager.timeToPx(e.end)+"px")};e(t.timeManager.getDuration());t.timeManager.onSizing(e);t.svg=d3.select(t.track[0]).append("svg").attr("width","100%").attr("height","100%").attr("overflow","hidden").attr("style","position: absolute");var n=t.svg.append("defs");n.append("linearGradient").attr("id","fade-in").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").call(function(e){e.append("stop").attr("offset","0%").attr("stop-color","rgb(256,256,256)").attr("stop-opacity","0.75");e.append("stop").attr("offset","85%").attr("stop-color",TAG.TourAuthoring.Constants.displayColor).attr("stop-opacity","0.75")});n.append("linearGradient").attr("id","fade-out").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").call(function(e){e.append("stop").attr("offset","15%").attr("stop-color",TAG.TourAuthoring.Constants.displayColor).attr("stop-opacity","0.75");e.append("stop").attr("offset","100%").attr("stop-color","rgb(256,256,256)").attr("stop-opacity","0.75")});n.append("linearGradient").attr("id","fade-in-ink").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").call(function(e){e.append("stop").attr("offset","0%").attr("stop-color","rgb(256,256,256)").attr("stop-opacity","0.75");e.append("stop").attr("offset","85%").attr("stop-color",TAG.TourAuthoring.Constants.inkDisplayColor).attr("stop-opacity","0.75")});n.append("linearGradient").attr("id","fade-out-ink").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").call(function(e){e.append("stop").attr("offset","15%").attr("stop-color",TAG.TourAuthoring.Constants.inkDisplayColor).attr("stop-opacity","0.75");e.append("stop").attr("offset","100%").attr("stop-color","rgb(256,256,256)").attr("stop-opacity","0.75")});t.svgDisplays=t.svg.append("svg:g").classed("displayDrawing",true);t.svgLines=t.svg.append("svg:g").classed("connectionLines",true);if(t.type==TAG.TourAuthoring.TrackType.audio){T=t.svgLines.append("svg:g").attr("id","keyframeLines");var r=T.append("svg:line").attr("x1",0).attr("y1",100-TAG.TourAuthoring.Constants.defaultVolume*100+"%").attr("x2","100%").attr("y2",100-TAG.TourAuthoring.Constants.defaultVolume*100+"%").style("pointer-events","none").style("stroke","green").style("stroke-width",4)}}function F(){j.forceClose()}function I(e){F();var t=TAG.Util.UI.popUpMessage(null,e,null);$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(t);$(t).fadeIn(500);var n=s.getSelectedTrack();if(n){n.setDeselected()}}function q(e){var i=n;var o=r.slice(8,r.length);var u=o.lastIndexOf(".");var a=o.slice(u);var f=o.slice(0,u);TAG.Worktop.Database.convertVideo(function(){},null,o,a,f,null,"True");t.toConvert=true;C.remove();L.text("Converting...");l.css("opacity","0.7");O.css("font-style","italic");var c=s.getSelectedTrack();if(c){c.setDeselected()}F()}function R(e){var r;var i=n.getStorageContainer().displays.getContents();if($("#inkDrawControls").css("display")=="block"||$("#inkTransparencyControls").css("display")=="block"||$("#inkTextControls").css("display")=="block"||$("#inkEditDraw").css("display")=="block"||$("#inkEditTransparency").css("display")=="block"||$("#inkEditText").css("display")=="block"){I("An annotation is already being edited.");return}if(!i.length){I("The annotation must be visible in the preview window in order to edit it.");return}var o=true;var u=t.timeManager.getCurrentTime();if(Pn()){var a=_n(),f=a.getDisplays();for(r=0;r<f.length;r++){if(f[r].getStart()<=u&&u<=f[r].getOutStart()+f[r].getFadeOut()){o=true;break}o=false}}var l=false;var c=-1e6;for(r=0;r<i.length;r++){if(i[r].display.getStart()<=u&&u<=i[r].display.getOutStart()+i[r].display.getFadeOut()){l=true;break}}if(!l||!o){I("The annotation must be visible in the preview window in order to edit it.");return}t.timeManager.stop();var h=n.getInkPath();var p=h.split("::")[0].toLowerCase();F();if(!h||!p){I("This annotation track has become corrupted, please remove and create a new ink.");return}var d=$("[ES_ID='"+t.title+"']");if(!d[0]){I("The annotation must be visible in the preview window in order to edit it.");return}t.isVisible=false;if(p==="path"||p=="bezier"){t.timeline.showEditDraw(n,h)}else if(p==="trans"){var v=h.split("[mode]")[1].split("[")[0];t.timeline.showEditTransparency(n,h,v)}else if(p==="text"){var m=d.find("text");var g=m[0]?d.find("svg")[0].getAttribute("viewBox"):null;if(!m[0]||Pn()&&!g){t.isVisible=true;I("The annotation must be loaded and on screen in order to edit it.");return}var y=$("#rinplayer");var b={x:m.offset().left-y.offset().left,y:m.offset().top-y.offset().top,w:m[0].getBBox().width,h:m[0].getBBox().height,fontsize:Pn()?parseFloat(m.attr("font-size"))*(y.height()/parseFloat(g.split(" ")[3])):null};t.timeline.showEditText(n,h,b)}else{t.isVisible=true;I("This annotation track is in a deprecated format, please remove and create a new ink.");return}var w=s.getSelectedTrack();if(w){w.setDeselected()}if(t.isVisible===true)return;t.timeline.showEditorOverlay()}function U(e){function m(e){$(v).fadeOut(500);var r=n.getTitle();n.setTitle(a.val().replace(/\'/g,"").replace(/\"/g,""));$(v).remove();if(t.type==TAG.TourAuthoring.TrackType.artwork||t.type==TAG.TourAuthoring.TrackType.image){s.mapTracks(function(e){if(e.track.getType()==TAG.TourAuthoring.TrackType.ink&&e.track.getInkEnabled()&&e.track.getInkLink().getTitle()==n.getTitle()){e.setInkLink(n)}})}}j.close();var r=$(document.createElement("div"));r.attr("id","renameDialog");var i=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:200});r.css({position:"absolute",left:i.x+"px",top:i.y+"px",width:i.width+"px",height:i.height+"px",border:"3px double white","background-color":"black"});v.append(r);var o=$(document.createElement("div"));o.attr("id","renameDialogTitle");o.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"});$("body").append(v);t.timeManager.stop();v.fadeIn(500);var u=$(document.createElement("form"));var a=$(document.createElement("input"));u.css("text-align","left").attr("maxlength","100");a.attr("type","text");a.css("margin","4% 4%");a.css("width","100%");a.attr("id","newNameInput");a.val(t.title);var f=$(document.createElement("div"));a.attr("maxlength","50");f.text("Rename track to: ");f.css({color:"white",width:"80%",left:"10%","font-size":"1.25em",position:"absolute","text-align":"center","margin-top":"3%"});u.append(f);u.append(a);r.append(u);a.css({width:"80%","margin-left":"10%","margin-right":"10%","margin-top":"10%","box-sizing":"border-box",position:"relative"});var l=$(document.createElement("div"));l.css("text-align","right");var c=$(document.createElement("div"));c.css("clear","both");var h=$(document.createElement("div"));h.css({position:"relative",display:"block",width:"80%",left:"10%"});l.append(h);var p=$(document.createElement("button"));p.text("Apply");p.css({padding:"1%",border:"1px solid white","border-radius":"3.5px",width:"auto",position:"relative","float":"right","margin-right":"7%","margin-top":"5%"});h.append(p);var d=$(document.createElement("button"));d.attr("type","button");d.text("Cancel");d.css({padding:"1%","border-radius":"3.5px",border:"1px solid white",width:"auto",position:"relative","margin-left":"7%","float":"left","margin-top":"5%"});l.append(c);h.append(d);r.append(h);r.show();F();p.click(m);d.click(function(){v.fadeOut(500);$(v).remove()});$(document).keypress(function(e){if(e.which==13){m(e)}});var g=s.getSelectedTrack();if(g){g.setDeselected()}}function z(e){function d(e){function a(n){var i,s,u=o[n].display;if(r.getType()!==TAG.TourAuthoring.TrackType.audio){i=u.getMain()+2*TAG.TourAuthoring.Constants.defaultFade;s=u.getMainStart()-TAG.TourAuthoring.Constants.defaultFade}else{i=u.getMain();s=u.getMainStart()}var a=o[n];var f=e.addDisplay(t.timeManager.timeToPx(s),i);var l=a.display.getParentDisplay();if(l){l.addChildDisplay(f);f.setParentDisplay(l)}f.basicSetTimes(a.display.getTimes());var c=u.getStorageContainer().keyframes.getContents();for(var h=0;h<c.length;h++){var p=c[h];if(r.getType()===TAG.TourAuthoring.TrackType.audio){var d=f.addKeyframe(t.timeManager.timeToPx(p.getTime()),p.getVolumePx());e.addKeyframeToLines(d);d.restoreHandlers()}else{var d=f.addKeyframe(t.timeManager.timeToPx(p.getTime()));d.loadRIN(p.getCaptureData());t.dirtyKeyframe=true;d.restoreHandlers()}}}var s=e.getPos();var o=n.getStorageContainer().displays.getContents();for(var u=0;u<o.length;u++){a(u)}t.timeManager.setScale(t.timeManager.getScale());console.log("combining "+(t.undoManager.undoStackSize()-i));t.undoManager.combineLast(t.undoManager.undoStackSize()-i)}j.close();var r=n;var i=t.undoManager.undoStackSize();var s=r.getMedia();var o=r.getPos();var u=r.getTitle();var a,f,l,c,h;switch(r.getType()){case TAG.TourAuthoring.TrackType.audio:f=t.timeline.addAudioTrack(s,u,null,t.mediaLength);d(f);r.insert(f);break;case TAG.TourAuthoring.TrackType.video:f=t.timeline.addVideoTrack(s,u,null,t.mediaLength);d(f);r.insert(f);break;case TAG.TourAuthoring.TrackType.image:f=t.timeline.addImageTrack(s,u,null);d(f);r.insert(f);break;case TAG.TourAuthoring.TrackType.ink:var p=r.getInkLink();f=t.timeline.addInkTrack(p,u,r.getMedia(),r.getInkSpec(),null);if(p){p.addAttachedInkTrack(f);f.setInkLink(p)}d(f);r.insert(f);f.setInkEnabled(r.getInkEnabled());f.setInkPath(r.getInkPath());f.setInkProps({});f.setInkInitKeyframe(r.getInkInitKeyframe());f.setInkRelativeArtPos(r.getInkRelativeArtPos());f.addInkTypeToTitle(r.getInkPath().split("::")[0].toLowerCase());break;case TAG.TourAuthoring.TrackType.artwork:f=t.timeline.addArtworkTrack(s,u,r.getGUID(),null);d(f);r.insert(f);break}}function W(e){function v(){function u(e){var n=t.attachedInks[e];var r=n.getStorageContainer().displays;i++;var o=TAG.TourAuthoring.Command({execute:function(){Yn(n);n.remove()},unexecute:function(){var e=s.insertTrack(n,n.getPos());e.displays=r;n.reloadTrack()}});t.undoManager.logCommand(o);o.execute()}F();var e=n.getStorageContainer().displays;var r=TAG.TourAuthoring.Command({execute:function(){mn();if(!t.timeline.checkForArtworks(0)){t.timeline.disableInk()}if(s.numTracks()>0){var e=$("#Track-"+(s.numTracks()-1)+"-title");var n=$(document.getElementById("playback-controls")).offset().top;var r=$(e).offset().top+TAG.TourAuthoring.Constants.trackHeight;var i=s._trackArray[0].track.getTitleDiv();var o=i.offset().top;var u=$(timeline).offset().top;if(o<u){if(r+TAG.TourAuthoring.Constants.trackHeight<n){}}}t.update()},unexecute:function(){var t=s.insertTrack(n,n.getPos());t.displays=e;Et()}});t.undoManager.logCommand(r);r.execute();t.timeline.removeInkSession();var i=1;for(var o=t.attachedInks.length-1;o>=0;o--){u(o)}if(i>1){t.undoManager.combineLast(i)}ht();t.update()}j.close();var r=$(document.createElement("div"));r.attr("id","deleteDialog");var i=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:200});r.css({position:"absolute",left:i.x+"px",top:i.y+"px",width:i.width+"px",height:i.height+"px",border:"3px double white","background-color":"black"});var o=$(document.createElement("div"));o.attr("id","deleteDialogTitle");o.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"});$("body").append(m);m.append(r);t.timeManager.stop();m.fadeIn(500);F();var u=$(document.createElement("div"));u.attr("id","mssge");var a="Are you sure you want to delete "+t.title;u.text(a);u.css({color:"white",width:"80%",height:"50%",left:"10%",top:"12.5%","font-size":"0.8em",position:"relative","text-align":"center","text-overflow":"ellipsis","word-wrap":"break-word",maxlength:"200"});var f=TAG.Util.getMaxFontSizeEM(a,1,u.width(),u.height());u.css("font-size",f);r.append(u);var l=false;var c=s.getTracks();s.mapTracks(function(e){if(e.track.getType()===TAG.TourAuthoring.TrackType.ink&&e.track.getInkEnabled()&&e.track.getInkLink().getTitle()===n.getTitle()){l=true;return}});a+=l&&(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image)?" and any attached annotation tracks?":"?";u.text(a);var h=$(document.createElement("div"));h.css({height:"20%",width:"80%",position:"absolute",color:"white",bottom:"5%",right:"10%"});r.append(h);var p=$(document.createElement("button"));p.css({padding:"1%","border-radius":"3.5px",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%"});p.text("Delete");$(p).click(function(){v();m.fadeOut(500);$(m).remove()});h.append(p);var d=$(document.createElement("button"));d.css({padding:"1%","border-radius":"3.5px",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right"});d.text("Cancel");d.click(function(){m.fadeOut(500)});h.append(d);TAG.Util.multiLineEllipsis(u)}function X(e){var t=s.getSelectedTrack();if(t){t.setDeselected()}F()}function V(e){s.mapTracks(function(t){t.track.setEventsPaused(e)})}function J(){s.selectTrack(n);l.css({"background-color":"#000"})}function K(){s.selectTrack(null);l.css({"background-color":"rgb(105,89,89)"})}function Q(){return t.type}function G(){return r}function Y(){return u}function Z(){return t.title}function et(e){e=t.timeline.fixTrackTitle(e,ct());t.title=e;O.text(t.title)}function tt(){return t}function nt(){return D}function rt(e){D=e}function it(){return t.currentDisplay}function st(e){t.currentDisplay=e}function ot(e){t.isVisible=e}function ut(){return t.currentKeyframe}function at(){return a}function ft(e){i=e}function lt(){return i}function ct(){return o.split("-")[1]}function ht(){s.mapTracks(function(e,t){e.track.updatePos(t)})}function pt(e){u=e;o="Track-"+e;l.attr("id",o+"-title");t.track.attr("id",o);t.resource="R-"+u}function dt(e){var t=l.offset().top;if(n.getPos()==0&&b)t-=TAG.TourAuthoring.Constants.trackHeight;var r=parseInt(l.css("height"),10);if(e>=t&&e<=t+r){return true}else return false}function vt(){return l}function mt(e){if(e==n){return}var r=false;if(u<e.getPos()){r=e.insertHelper(u)}else{r=e.insertHelper(u)}ht();t.update()}function gt(e){var r=$("#trackTitleWrapper").scrollTop();n.detach();var i=n.getStorageContainer();s._trackArray.splice(n.getPos(),1);s._trackArray.splice(e,0,n.getStorageContainer());ht();t.track.detach();Et();l.css("top","0px");t.track.css("display","");$("#trackTitleWrapper").scrollTop(r);Ot=0;return false}function yt(){for(var e=0;e<s._trackArray.length;e++){console.log(e+" - "+s._trackArray[e].track.getTitle())}}function bt(){return t.track}function wt(){l.css("top","0px");l.css("left","0px")}function Et(){if(u===0){t.timeline.prependAddToDom(t.track,l)}else{var e=s._trackArray[u-1].track;e.getTitleDiv().after(l);e.getTrackDomElement().after(t.track)}t.update();St();if(t.that.getType()===TAG.TourAuthoring.TrackType.ink&&t.that.getInkEnabled(t.that)){t.that.getInkLink(t.that).addAttachedInkTrack(t.that)}}function St(){var e=s.getDisplays(u);if(e&&e._root){e._root.traverse(function(e){e._value.display.restoreHandlers();var t=s.getKeyframes(e._value);if(t&&t._root){t._root.traverse(function(e){e._value.restoreHandlers()})}})}}function xt(e){t.inRightTap=true;j.open(e)}function Tt(e){if(D||t.inRightTap)return;var r=s.getSelectedTrack();if(r===n){K()}else{if(r){r.setDeselected()}J()}}function _t(e){var n=t.timeline.getCloseMenu();if(n){n()}if(e===1.1){$("#trackTitleWrapper").scrollTop($("#trackTitleWrapper").scrollTop()-30)}else{$("#trackTitleWrapper").scrollTop($("#trackTitleWrapper").scrollTop()+30)}}function Ft(e){t.inRightTap=false;if(x){x=false;return}x=true;Ut()}function It(e,n){var r=s.getSelectedTrack();n.stopPropagation();if(D||t.inRightTap){return}x=false;if(r){r.setDeselected()}J();if(c){qt(e)}else{if(Ct){Ct=false}if(At<30&&Math.abs(e.translation.y)<Math.abs(e.translation.x)*2){Rt(e.translation.x)}else{Rt(200)}if(Math.abs(e.translation.y)>Math.abs(e.translation.x))At=At+Math.abs(e.translation.y);if(parseInt(l.css("left"),10)<-20){c=true;Ot=0;A=$(document.createElement("div"));A.css({width:.127*$(window).width()+"px","margin-left":"20px",height:l.height()+"px","float":"left",border:"1px solid black","box-shadow":"inset 4px -4px 8px #888",position:"absolute","z-index":0,background:"rgb(219, 218, 199)",top:l.position().top+$("#trackTitleWrapper").scrollTop()+"px"});l.before(A);Nt=l.css("z-index");l.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);l.css("left","-20px");kt=l.offset().top;Lt=kt+TAG.TourAuthoring.Constants.trackHeight}rn(e)}}function qt(e){function h(){var e=u+Ot-1;var t;var n;if(e>=u){e++}if(e>=0){t=s._trackArray[e].track;n=t.getTitleDiv();if(n.position().top>l.position().top){n.css("top",parseFloat(n.css("top"))+2+l.height()+"px");A.css("top",parseFloat(A.css("top"))-2-n.height()+"px");Ot--}}}function p(){var e=u+Ot+1;var t;var n;if(e<=u){e--}if(e<s._trackArray.length){t=s._trackArray[e].track;n=t.getTitleDiv();if(n.position().top<l.position().top){A.css("top",parseFloat(A.css("top"))+2+n.height()+"px");n.css("top",parseFloat(n.css("top"))-2-A.height()+"px");Ot++}}}var t=parseInt(l.css("top"),10);var n=t+e.translation.y;var r=null;var i=0;var o;var a;var f=0;var c;if(n<t){h()}else if(n>t){p()}else{if(l.position().top<15){o=$("#trackTitleWrapper").scrollTop();$("#trackTitleWrapper").scrollTop(o-25);n=n-Math.min(10,o);h()}if(l.position().top+2+l.height()>$("#trackScrollVeil").height()-15){o=$("#trackTitleWrapper").scrollTop();a=o+25;for(c=0;c<s._trackArray.length;c++){f=f+s._trackArray[c].track.getTitleDiv().height()+2}if(a>f-$("#trackTitleWrapper").height())a=f-$("#trackTitleWrapper").height();$("#trackTitleWrapper").scrollTop(a);n=n+a-o;p()}}l.css("top",n)}function Rt(e){var t=parseInt(l.css("left"),10);var n=Math.min(t+e,0);l.css("left",n)}function Ut(){var e=s._trackArray[u+Ot];if(!e){return}e=e.track;var r;var i;At=0;$(".titlediv").css("top","0px");$(".titlediv").css("left","0px");if(A){A.detach()}if(Ot!==0&&c&&e){if(n.getPos()>e.getPos()){r=s._trackArray[n.getPos()-1].track}else if(n.getPos()<e.getPos()){r=s._trackArray[n.getPos()+1].track}else{r=s._trackArray[n.getPos()].track}i=TAG.TourAuthoring.Command({execute:function(){e.insert(n)},unexecute:function(){r.insert(n)}});i.execute();t.undoManager.logCommand(i)}l.css("z-index",Nt);c=false;Ct=true}function x(e){if(D||S){return}t.inRightTap=false;if(n.getCurrentKeyframe()!==null){n.getCurrentKeyframe().released(e)}else if(n.getCurrentDisplay()!==null){n.getCurrentDisplay().released(e)}else{console.log("skipping release")}}function Wt(e){if(D||S){return}t.inRightTap=true;if(n.getCurrentKeyframe()){n.getCurrentKeyframe().rightTapped(e)}else if(n.getCurrentDisplay()){n.getCurrentDisplay().rightTapped(e)}}function Xt(e){if(S){return}if(t.currentDisplay){var n=t.currentDisplay.getLoc();if(n===TAG.TourAuthoring.DisplayParts["fade-out"]||n===TAG.TourAuthoring.DisplayParts["fade-in"]){return}}on(e)}function $t(e){if(e.button===2||e.gesture.srcEvent.buttons===2){return}Dt=false;Pt=false;Ht=0;Bt=0;jt=0;Vt=t.timeline.getMultiSelection();if(!Vt){var r=t.timeline.getMultiSelectionArray().length;if(!n.getCurrentDisplay()&&r>0){for(var i=0;i<r;i++){t.timeline.allDeselected()}}else if(n.getCurrentKeyframe()){if(S){return}n.getCurrentKeyframe().tapped(e)}}else if(n.getCurrentDisplay()){if(t.timeline.getMultiSelectionArray().indexOf(n.getCurrentDisplay())<0){Jt(n.getCurrentDisplay())}else{Kt(n.getCurrentDisplay(),false)}}else if(t.currentKeyframe){if(S){return}if(t.timeline.getMultiSelectionArray().indexOf(t.currentKeyframe.getContainingDisplay())<0){Jt(t.currentKeyframe.getContainingDisplay())}else{Kt(t.currentKeyframe.getContainingDisplay(),false)}}}function Jt(e){t.timeline.getMultiSelectionArray().push(e);if(e.getType()===4||e.getType()===2){e.getMainD().css("background-color",TAG.TourAuthoring.Constants.selectedInkDisplayColor)}else{e.getMainD().css("background-color",TAG.TourAuthoring.Constants.selectedDisplayColor)}}function Kt(e,n){if(!n){t.timeline.getMultiSelectionArray().splice(t.timeline.getMultiSelectionArray().indexOf(e),1)}var r=function(e){return e.source};s._leftExternal.remove(s._leftExternal.findValue(e,r));s._leftInternal.remove(s._leftInternal.findValue(e,r));s._rightExternal.remove(s._rightExternal.findValue(e,r));s._rightInternal.remove(s._rightInternal.findValue(e,r));if(e.getType()===4||e.getType()===2){e.getMainD().css("background-color",TAG.TourAuthoring.Constants.inkDisplayColor)}else if(e.getType()===1){e.getMainD().css("background-color","rgba(129, 173, 98, 0.8)")}else{e.getMainD().css("background-color",TAG.TourAuthoring.Constants.displayColor)}}function Qt(e,r){var i,o,u,a,f;if(D||t.inRightTap){r.stopImmediatePropagation();return}if(t.currentDisplay){t.currentDisplay.suppressHandles();if(r)r.stopPropagation();if(Dt||!Pt&&jt>3&&Math.abs(Bt)>Math.abs(Ht)){Dt=true;rn(e);return}else if(jt>3){Pt=true}else{Ht+=e.translation.x;Bt+=e.translation.y;jt++;return}if(t.timeline.getMultiSelectionArray().length===0){o=t.timeManager.getDuration().start;u=t.timeManager.getDuration().end;var l=n.getStorageContainer().displays.getContents();for(i=0;i<l.length;i++){if(l[i].display===t.currentDisplay){if(i-1>=0){o=l[i-1].display.getEnd()+TAG.TourAuthoring.Constants.esOffset}if(i+1<l.length){u=l[i+1].display.getStart()-TAG.TourAuthoring.Constants.esOffset}}}t.currentDisplay.move(e,o,u)}else{if(t.timeline.getMultiSelectionArray().indexOf(t.currentDisplay)>=0){t.timeline.moveSelect(e,t.currentDisplay)}}}else if(t.currentKeyframe){if(S){return}if(r)r.stopPropagation();a=t.currentKeyframe.getContainingDisplay();o=a.getStart();u=a.getEnd();var c=s.findPrevKeyframe(a,t.currentKeyframe),h=s.findNextKeyframe(a,t.currentKeyframe);if(c){o=c.getTime()+TAG.TourAuthoring.Constants.esOffset}if(h){u=h.getTime()-TAG.TourAuthoring.Constants.esOffset}if(!t.timeline.getMultiSelection()){t.currentKeyframe.move(e,o,u)}}}function Gt(e,n){var r=t.timeManager.getDuration().start,i=t.timeManager.getDuration().end,o=e.getStorageContainer().keyframes,a=Math.min(e.getOutStart()-e.getFadeIn(),!o.isEmpty()&&o.min().getTime()-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||Infinity),f=Math.max(e.getStart()+e.getFadeIn(),!o.isEmpty()&&o.max().getTime()-e.getFadeOut()+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-Infinity),l=e.getStart(),c=e.getLoc();var h=e.getEnd();if(n){h=e.getOutStart()}if(e.getFadeIn()===0||e.getFadeOut()===0){a=Math.min(t.timeManager.pxToTime(e.getFioHandle().attr("cx")-2*TAG.TourAuthoring.Constants.fadeBtnSize),!o.isEmpty()&&o.min().getTime()-t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||Infinity);f=Math.max(t.timeManager.pxToTime(e.getFinHandle().attr("cx"))+t.timeManager.pxToTime(2*TAG.TourAuthoring.Constants.fadeBtnSize),!o.isEmpty()&&o.max().getTime()-e.getFadeOut()+t.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-Infinity)}var p=[];if(a<e.getStart()){a=e.getStart()}if(f>e.getOutStart()){f=e.getOutStart()}var d=s.findPreviousDisplay(u,e);var v=s.findNextDisplay(u,e);var m;if(c===TAG.TourAuthoring.DisplayParts.main){if(d&&t.timeline.getMultiSelectionArray().indexOf(d.display)<0){r=d.display.getEnd()+TAG.TourAuthoring.Constants.esOffset}if(v&&t.timeline.getMultiSelectionArray().indexOf(v.display)<0){i=v.display.getStart()-TAG.TourAuthoring.Constants.esOffset}if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){m=e.getParentDisplay();if(t.timeline.getMultiSelectionArray().indexOf(m)===-1){r=Math.max(r,m.getStart());i=Math.min(i,m.getEnd())}}}else if(c===TAG.TourAuthoring.DisplayParts["fade-out"]||c===TAG.TourAuthoring.DisplayParts["fade-in"]){if(d){r=d.display.getEnd()+TAG.TourAuthoring.Constants.esOffset}if(v){i=v.display.getStart()-TAG.TourAuthoring.Constants.esOffset}if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){m=Yt(e);if(t.timeline.getMultiSelectionArray().indexOf(m)===-1){r=Math.max(r,m.getStart());i=Math.min(i,m.getEnd())}}else if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.image||!t.inkEnabled){var g=e.getChildDisplays();var y=e.getLongestSubgroup(g);f=Math.max(f,e.getStart()+y);a=Math.min(a,e.getEnd()-y)}if(t.type===TAG.TourAuthoring.TrackType.video||t.type===TAG.TourAuthoring.TrackType.audio){if(e.getMediaLength()){var b=parseFloat(e.getMediaLength());r=Math.max(r,e.getEnd()-b);i=Math.min(i,e.getStart()+b)}}}var w={bound:l-r,source:e};var E={bound:a-l,source:e};var S={bound:i-h,source:e};var x={bound:h-e.getFadeOut()-f,source:e};s._leftExternal.push(w);s._leftInternal.push(E);s._rightExternal.push(S);s._rightInternal.push(x)}function Yt(e){return e.getParentDisplay()}function Zt(){var e=n.getStorageContainer().displays.getContents();var t;for(t=0;t<e.length;t++){e[t].display.scale()}}function en(e,t){var n=0;while(n<t.length){if(Math.abs(t[n].getEnd()-e)<=.5&&t[n].getEnd()!==e){return t[n].getEnd()}if(Math.abs(t[n].getStart()-e)<=.5&&t[n].getStart()!==e){return t[n].getStart()}n++}return-1}function tn(e){var n=t.timeline.getTracks();var r;for(r=0;r<n.length;r++){if(e===parseInt(n[r].getID(),10)){return n[r]}}return null}function nn(e,n){if(!p)p=t.timeline.getTrackBody();p.scrollLeft(p.scrollLeft()-e.translation.x)}function rn(e){if(!p)p=$("#trackBody");p.scrollTop(p.scrollTop()-e.translation.y)}function sn(e){var n=t.timeline.getCloseMenu();if(n){n()}if(!p)p=t.timeline.getTrackBody();var r=p.scrollTop();var i;if(e===1.1){i=r-30}else{i=r+30}p.scrollTop(i)}function on(e){var r=e.position.x,i=t.timeManager.pxToTime(r),s=e.position.y,o=true,u=5,a,f,l,c,h,p;if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){var d=_n().getStorageContainer().displays.getContents();var v=false;var d=_n().getStorageContainer().displays.nearestNeighbors(i);for(a=0;a<d.length;a++){if(d[a]&&i<=d[a].display.getEnd()&&i>=d[a].display.getStart()){v=true;h=d[a].display;break}}}if(v===false){return}if(!t.currentDisplay){var m=Infinity;var g=n.getStorageContainer().displays.getContents();for(a=0;a<g.length;a++){c=g[a].display;if(i<=c.getEnd()){if(i>=c.getStart()){o=false;break}else if(i+u>=c.getStart()){u=c.getStart()-i-TAG.TourAuthoring.Constants.esOffset}m=Math.min(m,c.getStart()-i)}}var p=t.timeManager.getDuration().end-i;if(o){t.timeline.allDeselected();if(t.type===TAG.TourAuthoring.TrackType.ink&&t.inkEnabled){l=bn(r,Math.min(u,h.getEnd()-i));l.setParentDisplay(h);h.addChildDisplay(l);if(h.getEnd()-i<1.5||m<1.5){var y=Math.min(m,h.getEnd()-i);l.setIn(0);l.setOut(0);l.setMain(y)}}else{var y=Math.min(u,p);l=bn(r,y);if(p<1.5){l.setIn(0);l.setOut(0);l.setMain(y)}}}}else if(t.type===TAG.TourAuthoring.TrackType.artwork||t.type===TAG.TourAuthoring.TrackType.audio||t.type===TAG.TourAuthoring.TrackType.image){if(t.timeline.getViewer().isKeyframingDisabled()){return}if(i>=t.currentDisplay.getStart()&&i<=t.currentDisplay.getEnd()){if(t.type!==TAG.TourAuthoring.TrackType.audio){t.timeManager.seek(i)}f=t.currentDisplay.addKeyframe(r,s,true);if(f){t.timeline.allDeselected();if(t.type==TAG.TourAuthoring.TrackType.audio){t.allKeyframes.push(f);n.drawLines()}else{f.loadRIN(t.timeline.captureKeyframe(t.title));f.setSelected(true);t.dirtyKeyframe=true}t.update()}}}}function un(){if(t.selectedKeyframe)t.selectedKeyframe.setDeselected();t.dirtyKeyframe=false}function an(e){t.allKeyframes.push(e);n.drawLines()}function fn(){if(S){return}if(t.type===TAG.TourAuthoring.TrackType.audio){var e=t.allKeyframes,n=e.length-1;e.sort(function(e,t){if(e.isRemoved())return 1;else if(t.isRemoved())return-1;else return e.getTime()-t.getTime()});while(n>0&&e[n].isRemoved()){n--}var r=t.svgLines.selectAll("#keyframeLines");r.remove();T=t.svgLines.append("svg:g").attr("id","keyframeLines");var i="green";var s;if(e.length>0){s=T.append("svg:line").attr("x1",0).attr("y1",e[0].getVolumePx()).attr("x2",t.timeManager.timeToPx(e[0].getTime())).attr("y2",e[0].getVolumePx()).style("pointer-events","none").style("stroke",i).style("stroke-width",4);for(var o=0;o<n;o++){s=T.append("svg:line").attr("x1",t.timeManager.timeToPx(e[o].getTime())).attr("y1",e[o].getVolumePx()).attr("x2",t.timeManager.timeToPx(e[o+1].getTime())).attr("y2",e[o+1].getVolumePx()).style("pointer-events","none").style("stroke",i).style("stroke-width",4)}s=T.append("svg:line").attr("x1",t.timeManager.timeToPx(e[n].getTime())).attr("y1",e[n].getVolumePx()).attr("x2","100%").attr("y2",e[n].getVolumePx()).style("pointer-events","none").style("stroke",i).style("stroke-width",4)}else{s=T.append("svg:line").attr("x1",0).attr("y1",100-TAG.TourAuthoring.Constants.defaultVolume*100+"%").attr("x2","100%").attr("y2",100-TAG.TourAuthoring.Constants.defaultVolume*100+"%").style("pointer-events","none").style("stroke",i).style("stroke-width",4)}}}function ln(e){e.title.append(l);e.track.append(t.track)}function cn(e){e.title.prepend(l);e.track.prepend(t.track)}function hn(e){var t;var n;N.attr("id","icon");N.css({bottom:"3px",position:"absolute",right:"8px",width:"30px",height:"30px"});switch(e){case TAG.TourAuthoring.TrackType.audio:t=tagPath+"images/icons/audio_icon_2.svg";break;case TAG.TourAuthoring.TrackType.video:t=tagPath+"images/icons/video_icon_2.svg";break;case TAG.TourAuthoring.TrackType.artwork:t=tagPath+"images/icons/image_icon_2.svg";break;case TAG.TourAuthoring.TrackType.ink:t=tagPath+"images/icons/text_icon_2.svg";break;case TAG.TourAuthoring.TrackType.image:t=tagPath+"images/icons/image_icon_2.svg";break}n=$(document.createElement("img"));n.attr({src:t,height:"30px",width:"30px"});N.append(n);l.append(N)}function pn(e){var t=$(document.createElement("div"));t.attr("id","inkType");t.css({top:"48px",position:"absolute",left:"5px","font-size":"1em",color:"white",width:"80%",height:"20px"});if(e==="trans"){var r=n.getInkPath().split("[mode]")[1].split("[")[0];if(r==="block"){t.text("Block")}else{t.text("Isolate")}}else if(e=="text"){t.text("Text")}else if(e=="path"||e=="bezier"){t.text("Draw")}l.append(t)}function dn(e){if(u>0){e.children().eq(u-1).after(l)}else{e.prepend(l)}d=l.prev(".titlediv")}function vn(e){if(u>0){e.children().eq(u-1).after(t.track)}else{e.prepend(t.track)}}function mn(){s.removeTrack(n);l.remove();t.track.remove()}function gn(){l.detach();t.track.detach()}function bn(e,n){var r,i,o,a,f=TAG.TourAuthoring.Display({start:t.timeManager.pxToTime(e),length:n,dataHolder:s,canKeyframe:t.type!==TAG.TourAuthoring.TrackType.ink&&t.type!==TAG.TourAuthoring.TrackType.video,canFade:t.type!==TAG.TourAuthoring.TrackType.audio},t),l=TAG.TourAuthoring.Command({execute:function(){f.reloadDisplay();f.restoreHandlers();t.update()},unexecute:function(){f.removeDisplay(false);t.update()}});s.addDisplay(u,f);t.update();t.undoManager.logCommand(l);return f}function wn(e,t){return e.getStart()>t.getStart()}function En(){return t.displays}function Sn(){n.getStorageContainer().displays.clear()}function xn(e,r){var i,s,o,u=t.timeManager.getCurrentTime();var a;if(t.selectedKeyframe||(a=n.getStorageContainer().displays.nearestNeighbors(u,1)[0])){var f;if(t.selectedKeyframe){f=t.selectedKeyframe}else{f=a.keyframes.nearestNeighbors(u,1)[0]}if(f&&Math.twoDecPlaces(f.getTime())<=Math.twoDecPlaces(u+.05)&&Math.twoDecPlaces(f.getTime())>=Math.twoDecPlaces(u-.05)&&!f.removed){f.loadRIN(e);t.dirtyKeyframe=true;if(r&&t.selectedKeyframe!==f){f.setSelected()}}else{if(!a){a=n.getStorageContainer().displays.nearestNeighbors(u,1)[0]}if(a){if(u>=a.display.getStart()&&u<=a.display.getEnd()){o=a.display.addKeyframe(t.timeManager.timeToPx(u));if(o){o.loadRIN(e);t.dirtyKeyframe=true;o.setSelected(false,true)}}}}}}function Tn(){if(t.selectedKeyframe){t.selectedKeyframe.setDeselected()}t.currentKeyframe=null;t.dirtyKeyframe=false}function Nn(){return t.inkSpec}function Cn(){return t.inkSpec.penColor}function kn(){return t.inkSpec.font}function Ln(){return t.inkSpec.opacity}function An(){return t.inkSpec.size}function On(){return t.inkSpec.mode}function Mn(){return t.inkPath}function _n(){return t.experienceId}function Dn(){return t.inkProps}function Pn(){return t.inkEnabled}function Hn(){return t.inkInitKeyframe}function Bn(){return t.inkRelativeArtPos}function jn(){return t.inkType}function Fn(){return t.inkType}function In(e){t.inkSpec=e}function qn(e){t.inkSpec.color=e}function Rn(e){t.inkSpec.font=e}function Un(e){t.inkSpec.opacity=e}function zn(e){t.inkSpec.size=e}function Wn(e){t.inkSpec.mode=e}function Xn(e){t.inkPath=e}function Vn(e){t.experienceId=e}function $n(e){t.inkProps=e}function Jn(e){t.inkEnabled=e}function Kn(e){t.inkInitKeyframe=e}function Qn(e){t.inkRelativeArtPos=e}function Gn(e){if(t.attachedInks.indexOf(e)<0){t.attachedInks.push(e)}else{console.log("duplicate added")}}function Yn(e){t.attachedInks.splice(t.attachedInks.indexOf(e),1)}function Zn(e){t.track.css("background-color",e)}function er(e){t.converted=e}function tr(e){e[t.resource]={uriReference:r}}function nr(e){var r,i,o=null,u=t.title,f=0,l={},c=null;l.data={zIndex:s.numTracks()-n.getPos()};switch(t.type){case TAG.TourAuthoring.TrackType.artwork:l.providerId="ZMES";l.data.guid=a;break;case TAG.TourAuthoring.TrackType.image:l.providerId="ImageES";break;case TAG.TourAuthoring.TrackType.audio:l.providerId="AES";l.data.mediaLength=t.mediaLength;break;case TAG.TourAuthoring.TrackType.video:l.providerId="VideoES";l.data.mediaLength=t.mediaLength;l.data.converted=t.converted;l.data.toConvert=t.toConvert;break;case TAG.TourAuthoring.TrackType.ink:l.providerId="InkES";l.data.linkToExperience={};o=t.experienceId?t.experienceId.getTitle():"";l.data.linkToExperience.embedding={element:{datastring:{type:"datastring",str:t.inkPath},props:t.inkProps},enabled:t.inkEnabled,initKeyframe:t.inkInitKeyframe,experienceId:o,initproxy:t.inkRelativeArtPos};l.data.markers={beginAt:0,endAt:5};l.data.transition={inDuration:1e-6,outDuration:1e-6,providerId:"FadeInOutTransitionService"};l.experienceStreams={defaultStream:{duration:16.892}};l.resourceReferences=[];break;default:console.log("Track type not yet implemented in RIN")}if(!s.getSelectedTrack()||s.getSelectedTrack()===n){i=false}else{i=true}if(t.type!==TAG.TourAuthoring.TrackType.ink){l.resourceReferences=[{resourceId:t.resource,required:"true"}]}else{l.resourceReferences=[]}l.experienceStreams={};var h=n.getStorageContainer().displays.getContents();for(var p=0;p<h.length;p++){h[p].display.toES(l,i,c,p);c=s.lastKeyframe(h[p].display)}while(e.hasOwnProperty(u)){u=u+"-0"}e[u]=l}function rr(){var e,n={};for(e=0;e<t.displays.length;e++){t.displays[e].toKeyframeSequence(n)}return n}function ir(e,r){if(r||t.isVisible){var i=s.getDisplays(n.getPos()).getContents();for(var o=0;o<i.length;o++){var u=i[o];e.push(u.display.toScreenPlayEntry(o))}}}function sr(){var e=$(document.getElementById("zoomPoint"));var n=t.timeManager.getDuration().scale;var r=$(timeline).width()/t.timeManager.getDuration().end;var i=(n-r)/(TAG.TourAuthoring.Constants.maxZoom-r);var s=(e.offsetParent().width()-e.width())*i;e.css("left",s)}function or(e){S=e}function ur(){return S}function ar(){S=!S;if(Math.ceil(l.height())===TAG.TourAuthoring.Constants.trackHeight){l.height(TAG.TourAuthoring.Constants.minimizedTrackHeight);t.track.height(TAG.TourAuthoring.Constants.minimizedTrackHeight);N.hide();L.hide();if(T){T.style("display","none")}}else{l.height(TAG.TourAuthoring.Constants.trackHeight);t.track.height(TAG.TourAuthoring.Constants.trackHeight);N.show();L.show();if(T){T.style("display",null)}}s.mapDisplays(n.getStorageContainer(),function(e){e.display.toggleCircles()});fn();t.timeline.updateVerticalScroller();t.timeline.enableDisableDrag()}var n={},r=e.media,i,s=e.dataHolder,o="Track-"+e.id,u=e.id,a=e.guid,f=e.playbackControls,l,c=false,h={},p,d={},v=$(TAG.Util.UI.blockInteractionOverlay()),m=$(TAG.Util.UI.blockInteractionOverlay()),g=$(TAG.Util.UI.blockInteractionOverlay()),y=null,b=false,w=true,E,S=false,x=true,T;var N=$(document.createElement("div"));t=t||{};t.title=decodeURI(e.title);t.resource="R-"+u;t.root=e.root;t.type=e.type||TAG.TourAuthoring.TrackType.artwork;t.timeManager=e.timeManager;t.undoManager=e.undoManager;t.update=e.update;t.timeline=e.timeline;t.dirtyKeyframe=false;t.that=n;t.selectedTrack=e.selectedTrack;t.mediaLength=e.mediaLength;t.isVisible=true;t.attachedInks=[];t.converted=e.converted;t.toConvert=e.toConvert;E=t.timeManager.getDuration().scale;t.displays=[];t.allKeyframes=[];var C;var k;var L;var A,O,M,_=false,D=false;n.compOpsOpen=_;k=setInterval(P,5e3);(function(){l=$(document.createElement("div"));l.attr("id",o+"-title");l.addClass("titlediv");l.css({height:TAG.TourAuthoring.Constants.trackHeight+"px",width:.127*$(window).width()+"px","margin-left":"20px",left:"0%",position:"relative","background-color":"rgb(105,89,89)","border-bottom-style":"solid",border:"1px solid #888",top:"0px",overflow:"hidden","z-index":0});O=$(document.createElement("div"));O.addClass("track-title");O.text(t.title);O.css({"font-size":".75em",color:"white",top:"8%",left:"3%",position:"relative",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",display:"block",width:.115*$(window).width()+"px"});L=$(document.createElement("div"));L.addClass("track-conversion");L.css({"font-size":"0.5em",color:"white",top:"16%",left:"3%",position:"relative",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",display:"block",width:.115*$(window).width()+"px"});if(!e.firstupload){var r=P();if(r==="Error"){O.css("font-style","italic");L.text("Conversion Error");l.css("opacity","0.7")}if(r==="False"){O.css("font-style","italic");L.text("Converting video...");l.css("opacity","0.7")}}else{O.css("font-style","italic");L.text("Converting video...");l.css("opacity","0.7")}l.append(O);l.append(L);hn(t.type)})();H();var j=TAG.TourAuthoring.EditorMenu({type:TAG.TourAuthoring.MenuType.track,parent:n},t);(function(){j.addTitle("Track Options");var n=j.addButton("Rename","left",U);if(t.type===TAG.TourAuthoring.TrackType.ink){j.addButton("Edit Annotation","left",R)}if(t.type===TAG.TourAuthoring.TrackType.video&&!t.toConvert){C=j.addButton("Convert","left",q)}var r=j.addButton("Duplicate","left",z);var i=j.addButton("Delete","left",W);var s=j.addButton("Cancel","left",X);n.on("mousedown",function(){n.css({"background-color":"white",color:"black"})});n.on("mouseup",function(){n.css({"background-color":"transparent",color:"white"})});n.on("mouseout",function(){n.css({"background-color":"transparent",color:"white"})});r.on("mousedown",function(){r.css({"background-color":"white",color:"black"})});r.on("mouseup",function(){r.css({"background-color":"transparent",color:"white"})});r.on("mouseout",function(){r.css({"background-color":"transparent",color:"white"})});i.on("mousedown",function(){i.css({"background-color":"white",color:"black"})});i.on("mouseup",function(){i.css({"background-color":"transparent",color:"white"})});i.on("mouseout",function(){i.css({"background-color":"transparent",color:"white"})});s.on("mousedown",function(){s.css({"background-color":"white",color:"black"})});s.on("mouseup",function(){s.css({"background-color":"transparent",color:"white"})});s.on("mouseout",function(){s.css({"background-color":"transparent",color:"white"})})})();n.updateTracksEventsPaused=V;n.setSelected=J;n.setDeselected=K;n.getType=Q;n.getMedia=G;n.getPos=Y;n.getTitle=Z;n.setTitle=et;n.getSharedMy=tt;n.getEventsPaused=nt;n.setEventsPaused=rt;n.getCurrentDisplay=it;n.setCurrentDisplay=st;n.setIsVisible=ot;n.getCurrentKeyframe=ut;n.getGUID=at;n.setStorageContainer=ft;n.getStorageContainer=lt;n.getID=ct;n.updatePos=pt;n.checkWithinTitleDiv=dt;n.getTitleDiv=vt;n.insert=mt;n.insertHelper=gt;n.getTrackDomElement=bt;n.reloadTrack=Et;n.restoreHandlers=St;TAG.Util.makeManipulatable(l[0],{onManipulate:It,onTapped:Tt,onTappedRight:xt,onRelease:Ft,onScroll:_t,onDoubleTapped:ar},false,true);t.inRightTap=false;this.tapRightTitle=xt;n.tappedTitle=Tt;var Nt=0;var Ct=true;var kt=0;var Lt=0;var At=0;var Ot=0;var Mt=0;var Dt=false,Pt=false,Ht=0,Bt=0,jt=0;var zt;if(IS_WINDOWS){zt=TAG.Util.makeManipulatable(t.track[0],{onManipulate:Qt,onTappedRight:Wt,onScroll:sn,onTapped:$t,onDoubleTapped:Xt,onRelease:function(){t.inRightTap=false;Dt=false;Pt=false;Ht=0;Bt=0;jt=0}})}else{zt=TAG.Util.makeManipulatable(t.track[0],{onManipulate:Qt,onTappedRight:Wt,onScroll:sn,onTapped:$t,onDoubleTapped:Xt,onRelease:function(){t.inRightTap=false;Dt=false;Pt=false;Ht=0;Bt=0;jt=0}})}n.tapRight=Wt;var Vt;n.setDisplaySelected=Jt;n.setDisplayDeselected=Kt;n.onManipTrack=Qt;n.boundHelper=Gt;n.scale=Zt;t.timeManager.onSizing(Zt);n.leftAndRight=nn;n.upAndDown=rn;n.deselectKeyframe=un;n.addKeyframeToLines=an;n.drawLines=fn;n.addAllToDOM=ln;n.prependAllToDOM=cn;n.addInkTypeToTitle=pn;n.addTitleToDOM=dn;n.addEditorToDOM=vn;n.remove=mn;n.detach=gn;var yn=0;t.currentDisplay=null;t.currentKeyframe=null;n.addDisplay=bn;n.displayComp=wn;n.getDisplays=En;n.receiveKeyframe=xn;t.timeManager.onMove(function(){if(t.dirtyKeyframe){t.update(true)}Tn()});t.inkSpec={};t.inkPath="";t.currentInkPath="";t.inkProps={};t.inkEnabled=null;t.inkInitKeyframe={};t.inkRelativeArtPos={};n.getInkType=jn;n.getInkSpec=Nn;n.getInkColor=Cn;n.getInkFont=kn;n.getInkOpacity=Ln;n.getInkSize=An;n.getInkMode=On;n.getInkPath=Mn;n.getInkLink=_n;n.getInkProps=Dn;n.getInkEnabled=Pn;n.getInkInitKeyframe=Hn;n.getInkRelativeArtPos=Bn;n.setInkSpec=In;n.setInkType=Fn;n.setInkColor=qn;n.setInkFont=Rn;n.setInkOpacity=Un;n.setInkSize=zn;n.setInkMode=Wn;n.setInkPath=Xn;n.setInkLink=Vn;n.setInkProps=$n;n.setInkEnabled=Jn;n.setInkInitKeyframe=Kn;n.setInkRelativeArtPos=Qn;n.addAttachedInkTrack=Gn;n.removeAttachedInkTrack=Yn;n.changeTrackColor=Zn;n.videoConverted=er;n.addResource=tr;n.addES=nr;n.addScreenPlayEntries=ir;n.setMinimizedState=or;n.getMinimizedState=ur;return n};TAG.Util.makeNamespace("TAG.TourAuthoring.VideoTrack");TAG.TourAuthoring.VideoTrack=function(e,t){"use strict";e.type=TAG.TourAuthoring.TrackType.video;t=t||{};var n=TAG.TourAuthoring.Track(e,t);t.track.addClass("video");return n};TAG.Util.makeNamespace("TAG.Authoring.SettingsView");TAG.Authoring.SettingsView=function(e,t,n,r){"use strict";function Ot(e){LADS.Worktop.Database.getConvertedVideoCheck(function(t){if(t==="True"){console.log("converted: ");clearInterval(Lt);var n=e.Metadata.Source;var r=n.substr(n.lastIndexOf("."));if(at===e.Identifier){if(r===".mp4"){$("#videoErrorMsg").remove();$("#leftLoading").remove()}else{Mt(e)}}}else if(t==="Error"){clearInterval(Lt);if(at===e.Identifier){$("#videoErrorMsg").remove();$("#leftLoading").remove();var i="An error occured when converting this video. Please try to upload again";if(e.Extension===".mp4"){v.append(TAG.Util.createConversionLoading(i,true,true))}else{v.append(TAG.Util.createConversionLoading(i,true))}}}else{console.log("not converted: ")}},null,e.Identifier)}function Mt(e){var t=$(document.createElement("video"));t.attr("id","videoInPreview");zt(t);t.attr("poster",e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):"");t.attr("identifier",e.Identifier);t.attr("preload","none");t.attr("controls","");t.css({width:"100%","max-width":"100%","max-height":"100%"});var n=TAG.Worktop.Database.fixPath(e.Metadata.Source);var r=n.substring(0,n.lastIndexOf("."));var i=n.substring(n.lastIndexOf("."));var s=$(document.createElement("div"));s.addClass("videoErrorDiv");t.attr("fileName",e.Metadata.Source.substring(0,n.lastIndexOf(".")));var o=r+".mp4";var u=r+".webm";var a=r+".ogv";Dn(t,o,"video/mp4");Dn(t,u,"video/webm");Dn(t,a,"video/ogv");t[0].onerror=TAG.Util.videoErrorHandler(t,v);v.append(t);$("#middleLoading").remove();$("#leftLoading").remove();$("#videoErrorMsg").remove()}function Dt(e){if(e.target.className=="metadataPickerSearchbar"){console.log("searching metadata");e.stopPropagation();e.preventDefault()}if($(".searchBar").is(":focus")){e.stopPropagation();e.preventDefault()}else if(f.is(":focus")){if(!f.val()){jt();f.css({"background-image":"none"})}else{Mn();f.css({"background-image":"none"})}e.stopPropagation();e.preventDefault()}else if(!$("input, textarea, select").is(":focus")){e.stopPropagation();e.preventDefault();if(wt){nn(ct[ht])}if(Et){if($(document.getElementById("artworkEditorButton")).length){zn(ct[ht])}if($(document.getElementById("thumbnailButton")).length){Hn(ct[ht],false)}}if(St){if(!$(".pickerOverlay").length){wn(ct[ht])}}if(xt){cn(ct[ht])}if(Tt){Qn(ct[ht])}}}function Pt(){if(!$("input, textarea").is(":focus")){ft(lt)}}function Ht(){if(!$("input, textarea").is(":focus")){if(R&&R===pt){if(pt.prev()){if(ht>0){rr(".middleLabel");ir(pt.prev());pt=pt.prev();R=pt;ht--;if(wt){rn(ct[ht])}if(Et){Pn(ct[ht])}if(St){mn(ct[ht])}if(xt){fn(ct[ht])}if(Tt){$n(ct[ht])}}}}}if(bt){if(pt===B){rr(".leftLabel");ir(H);pt=H;Wt()}else if(pt===H){rr(".leftLabel");ir(B);pt=B;$t()}}}function Bt(){if(!$("input, textarea").is(":focus")&&!bt){if(R&&R===pt){if(pt.next()){if(ht<ct.length-1){rr(".middleLabel");ir(pt.next());pt=pt.next();R=pt;ht++;if(wt){rn(ct[ht])}if(Et){Pn(ct[ht])}if(St){mn(ct[ht])}if(xt){fn(ct[ht])}if(Tt){$n(ct[ht])}}}}}if(bt){if(pt===H){rr(".leftLabel");ir(B);pt=B;$t()}else if(pt===B){rr(".leftLabel");ir(H);pt=H;Wt()}}}function jt(){if(Et){_n()}else if(St){vn()}else if(wt){Zt()}else if(Tt){Vn()}else if(xt){an()}}function Ft(t){P=i.find("#setViewBackButton");P.attr("src",tagPath+"images/icons/Back.svg");P.mousedown(function(){TAG.Util.UI.cgBackColor("backButton",P,false)});P.mouseleave(function(){TAG.Util.UI.cgBackColor("backButton",P,true)});P.click(function(){TAG.Util.removeYoutubeVideo();TAG.Auth.clearToken();z.clear();U.clear();P.off("click");if(n){var e=n();TAG.Util.UI.slidePageRight(e)}else{TAG.Layout.StartPage(null,function(e){TAG.Util.UI.slidePageRight(e)})}TAG.Util.UI.getStack()[0]=null});var s=i.find("#setViewTopBarLabel");var o=TAG.Util.constrainAndPosition($(window).width(),$(window).height()*.08,{width:.4,height:.9});s.css({height:o.height+"px",width:o.width+"px"});var u=TAG.Util.getMaxFontSizeEM("Tour Authoring",.5,o.width,o.height*.8,.1);s.css({"font-size":u});s.text("Authoring Mode");a.append(J[M.general.text]=Rt(M.general,Ut));a.append(J[M.exhib.text]=Rt(M.exhib,Zt));a.append(J[M.art.text]=Rt(M.art,_n));a.append(J[M.media.text]=Rt(M.media,vn));a.append(J[M.tour.text]=Rt(M.tour,an));f.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")',"background-size":"auto 50%","background-repeat":"no-repeat","background-position":"12px center"});f.on("click focus",function(){f.css({"background-image":"none"})});f.on("focusout",function(){if(!f.val()){f.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})}});f.keyup(function(e){if(!f.val()){jt();f.css({"background-image":"none"})}});l.text("New").css("border-radius","3.5px");c.text("Video");y.text("Loading...");b.attr("src",tagPath+"images/icons/progress-circle.gif");v.css({height:$(window).width()*N/100*1/T+"px"});m.css({top:$(window).width()*N/100*1/T+"px"});g.css({height:or()+"px"});It(e,r)}function It(e,t){rr(".navContainer");switch(e){case"Exhibitions":ir(J[M.exhib.text]);q=J[M.exhib.text];Zt(t);break;case"Artworks":ir(J[M.art.text]);q=J[M.art.text];_n(t);break;case"Associated Media":ir(J[M.media.text]);q=J[M.media.text];vn(t);break;case"Tours":ir(J[M.tour.text]);q=J[M.tour.text];an(t);break;case"Feedback":ir(J[M.feedback.text]);q=J[M.feedback.text];Vn(t);break;case"General Settings":default:ir(J[M.general.text]);q=J[M.general.text];Ut();break}}function qt(){return i}function Rt(e,t){var n=$(document.createElement("div"));n.attr("class","navContainer");n.attr("id","nav-"+e.text);n.mousedown(function(){n.css({background:k})});n.mouseup(function(){n.css({background:"transparent"})});n.mouseleave(function(){n.css({background:"transparent"})});n.click(function(){TAG.Util.removeYoutubeVideo();f[0].value="";rr(".navContainer");ir(n);if(t){t()}q=n});var r=$(document.createElement("label"));r.attr("class","navtext");r.text(e.text);var i=$(document.createElement("label"));i.attr("class","navsubtext");i.text(e.subtext);n.append(r);n.append(i);return n}function Ut(){bt=true;wt=false;Et=false;St=false;xt=false;Tt=false;gt=false;Yn(false);U.add(function(){var e;s.before(e=ir(Gn("Splash Screen",null,Wt),true));H=e;H.addClass("leftLabel");R=e;Wt();B=Gn("Password Settings",null,$t).attr("id","password");B.addClass("leftLabel");s.before(B);s.hide()});W=null}function zt(e){var t=e[0];var n=t.volume;var r=false;t.addEventListener("volumechange",function(){if(t.muted){t.volume=0;r=true}else{if(r){t.volume=n;r=false}n=t.volume}},false)}function Wt(){er(true);Zn();var e=TAG.Worktop.Database.getPrimaryFontColor();var t=TAG.Worktop.Database.getSecondaryFontColor();var n=TAG.Worktop.Database.getFontFamily();var r=TAG.Worktop.Database.getIdleTimerDuration()/6e4;var s=fr("Change Image",function(){gt=true;y.prop("disabled",false);Nr(TAG.Authoring.FileUploadTypes.Standard,function(e){var t=e[0];s.val(t);$("#innerContainer").css({"background-image":'url("'+TAG.Worktop.Database.fixPath(t)+'")',"background-size":"cover"})})});s.css("height","35px");var u=dr(e,null,".primaryFont",function(){gt=true;y.prop("disabled",false);y.css("opacity",1);return 100});u.on("keyup",function(e){if(e.which===13){e.preventDefault();e.stopPropagation();y.click()}else{gt=true;y.prop("disabled",false);y.css("opacity",1)}});u.on("change",function(){gt=true;y.prop("disabled",false);y.css("opacity",1)});var a=dr(t,null,".secondaryFont",function(){gt=true;y.prop("disabled",false);y.css("opacity",1);return 100});a.on("keyup",function(e){if(e.which===13){e.preventDefault();e.stopPropagation();y.click()}else{gt=true;y.prop("disabled",false);y.css("opacity",1)}});a.on("change",function(){gt=true;y.prop("disabled",false);y.css("opacity",1)});var f=cr(r,"",3,false,false,true);f.on("keyup",function(){gt=true;y.prop("disabled",false);y.css("opacity",1)});var c=Qt(u,a);u.focus(function(){$("#tagContainer").off().unbind()});a.focus(function(){$("#tagContainer").off().unbind()});var h=ur("Background Image",s);var p=ur("Primary Font Color",u);var d=ur("Secondary Font Color",a);var v=ur("Idle Timer Duration (in minutes)",f);o.append(h);o.append(p);o.append(d);o.append(v);Sr(f,null,3);g.scroll(function(){a.trigger("blur");u.trigger("blur")});var y=fr("Save",function(){Xt(f);Vt({bgImgInput:s,primaryFontColorInput:u,secondaryFontColorInput:a,idleTimerDurationInput:f})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"},true);var b=fr("Splash Screen",function(){Qt(u,a);S.hidePicker();x.hidePicker()},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var w=fr("Collections Page",function(){Gt(u,a);S.hidePicker();x.hidePicker()},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var E=fr("Artwork Viewer",function(){Yt(u,a);S.hidePicker();x.hidePicker()},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});m.append(y);m.append(b);m.append(w);m.append(E);y.on("mousedown",function(){if(!y.attr("disabled")){y.css({"background-color":"white"})}});b.on("mousedown",function(){b.css({"background-color":"white"})});w.on("mousedown",function(){w.css({"background-color":"white"})});E.on("mousedown",function(){E.css({"background-color":"white"})});s.on("mousedown",function(){s.css({"background-color":"white"})});y.on("mouseleave",function(){y.css({"background-color":"transparent"})});b.on("mouseleave",function(){b.css({"background-color":"transparent"})});w.on("mouseleave",function(){w.css({"background-color":"transparent"})});E.on("mouseleave",function(){E.css({"background-color":"transparent"})});s.on("mouseleave",function(){s.css({"background-color":"transparent"})});l.on("mouseleave",function(){l.css({"background-color":"transparent"})});TAG.Telemetry.register(y,"click","general_set_save",function(e){e.mode="settingsView"});TAG.Telemetry.register(b,"click","startpage_preview",function(e){e.mode="settingsView"});TAG.Telemetry.register(w,"click","collectionspage_preview",function(e){e.mode="settingsView"});TAG.Telemetry.register(E,"click","artworkviewer_preview",function(e){e.mode="settingsView"});TAG.Telemetry.register(i.find("#nav-General Settings"),"click","settings_general",function(e){e.mode="settingsView"});TAG.Telemetry.register(i.find("#nav-Collections"),"click","settings_collections",function(e){e.mode="settingsView"});TAG.Telemetry.register(i.find("#nav-Artworks"),"click","settings_artworks",function(e){e.mode="settingsView"});TAG.Telemetry.register(i.find("#nav-Associated Media"),"click","settings_asscmedia",function(e){e.mode="settingsView"});TAG.Telemetry.register(i.find("#nav-Tours"),"click","settings_tours",function(e){e.mode="settingsView"});TAG.Telemetry.register(i.find("#artworkEditorButtont"),"click","settings_to_artworkeditor",function(e){e.mode="settingsView"})}function Xt(e){idleDuration=parseInt(e.val())*6e4}function Vt(e){Zn();er(true);Yn(false,null,null,"Saving...");var t=e.bgImgInput.val();var n=e.primaryFontColorInput.val();var r=e.secondaryFontColorInput.val();var i=e.idleTimerDurationInput.val()*1e3*60;var s={PrimaryFontColor:n,SecondaryFontColor:r,IdleTimerDuration:i};if(t){s.Background=t}TAG.Worktop.Database.changeMain(s,function(){if(q&&q!==J[M.general.text]){LADS.Worktop.Database.getMain();return}LADS.Worktop.Database.getMain(function(){if(!(R&&R.text()==="Password Settings")){Ut()}},Fn(Ut),null)},kr,jn({Name:"Main"},"Update",Ut),Fn(Ut))}function $t(){er(false,null,false);Zn();var e=lr("Loading...");var t=ur("",e);o.append(t);TAG.Worktop.Database.checkSetting("AllowChangePassword",function(e){t.remove();if(e.toLowerCase()==="true"){var n=cr("",false);var r=cr("",false);var i=cr("",false);var s=lr("");r.on("keyup",function(){gt=true;c.prop("disabled",false);c.css("opacity",1)});n.attr("type","password");r.attr("type","password");i.attr("type","password");var u=ur("Current Password",n);var a=ur("New Password",r);var f=ur("Confirm New Password",i);var l=ur("",s);o.append(u);o.append(a);o.append(f);m.css("display","none");var c=fr("Update Password",function(){Kt({old:n,new1:r,new2:i,msg:s})});c.removeAttr("type");var h=ur("",c);o.append(h);o.append(l)}else{Jt()}})}function Jt(){var e=lr("");var t=ur("Changing the password has been disabled by the server.  Contact the server administrator for more information",e);o.append(t)}function Kt(e){e.msg.text("Processing...");if(e.new1.val()!==e.new2.val()){e.msg.text("New passwords do not match.")}else{TAG.Auth.changePassword(e.old.val(),e.new1.val(),function(){e.msg.text("Password Saved.");e.old.val("");e.new1.val("");e.new2.val("")},function(t){if(t){e.msg.html(t)}else{e.msg.text("Incorrect Password.")}},function(){e.msg.text("There was an error contacting the server.")})}}function Qt(e,t){var n=TAG.Layout.StartPage({primaryFontColor:e.val(),secondaryFontColor:t.val(),isPreview:true},function(e){if(q&&q!=J[M.general.text]){return}v.empty();v.append(e);gr(v)});return n}function Gt(e,t){var n,r,i;r={primaryFontColor:e.val(),secondaryFontColor:t.val(),previewing:true};n=TAG.Layout.CollectionsPage(r);$(n).find("*").off();i=n.getRoot();$(i).css({"z-index":"1"});if(q&&q!=J[M.general.text]){return}v.empty();v.append(i);gr(v)}function Yt(e,t){var n,r,i,s;TAG.Worktop.Database.getArtworks(function(o){n=o[0];var u;for(u=0;u<o.length;u++){if(!(o[u].Metadata.Medium==="Video")&&!(o[u].Type==="Empty")){n=o[u];break}}r={catalogState:{},doq:n,split:"L",primaryFontColor:e.val(),secondaryFontColor:t.val(),previewing:true};i=TAG.Layout.ArtworkViewer(r,v);s=i.getRoot();$(s).css("z-index","-1");if(q&&q!==J[M.general.text]){return}v.empty();v.append(s);gr(v)})}function Zt(e,t){function i(){$.each(n,function(t,n){if(r){return}U.add(function(){if(r){return}if(q&&q!==J[M.exhib.text]){return}var i;if(!R&&(e&&n.Identifier===e||!e&&t===0)){s.before(ir(i=Gn(n.Name,null,function(){D=n.Identifier;if(X)X();rn(n);ht=t},n.Identifier),true));if(p.scrollTop()===0&&i.offset().top-p.height()>0){p.animate({scrollTop:i.offset().top-p.height()/2},1e3)}R=i;pt=R;ht=t;if(X)X();rn(n)}else{s.before(i=Gn(n.Name,null,function(){if(X)X();rn(n);D=n.Identifier;ht=t},n.Identifier))}})});U.add(function(){s.hide()})}bt=false;wt=true;Et=false;St=false;xt=false;Tt=false;gt=false;var n;var r=false;ht=0;Yn(true,"New",sn);Zn();er(true);if(typeof t!=="undefined"){n=t;i()}else{TAG.Worktop.Database.getExhibitions(function(e){if(r)return;yr(e);ct=e;On();n=e;i()})}W=function(){r=true}}function en(e){return function(){var t=e.text().toLowerCase()+"Button",n;if(e.attr("setSort")==="true"||e.attr("setSort")===true){if(j>0){j--}e.attr("setSort",false);e.css({"background-color":"black",background:"transparent",color:"black"});F[e.text()]=false;$("[id='"+t+"']").hide();if(e.text()==="Date"){kt=false;$("#dateButton").hide();$("#showTimelineBttn").css("background-color","");$("#hideTimelineBttn").css("background-color","white");$("#showTimelineBttn").attr("disabled","true")}}else{if(j<4){j++;e.attr("setSort",true);e.css({"background-color":"white"});if($("[id='"+t+"']")[0]){$("[id='"+t+"']").show().css({color:TAG.Util.UI.dimColor("#"+TAG.Worktop.Database.getSecondaryFontColor(),1.7)})}else{n=$(document.createElement("div"));n.addClass("secondaryFont");n.addClass("rowButton").text(e.text()).attr("id",t).css({cursor:"pointer","float":"left","font-size":"92.5%","margin-top":"0.475%","margin-right":"2%",height:"100%",color:TAG.Util.UI.dimColor("#"+TAG.Worktop.Database.getSecondaryFontColor(),1.7)});$("#buttonRow").append(n)}if(e.text()==="Date"){$("#showTimelineBttn").removeAttr("disabled");$("#dateButton").show()}F[e.text()]=true}}}}function tn(e){j=0;var t=$(document.createElement("div")).css({width:"50%",height:"auto","float":"right","margin-right":"3%",overflow:"hidden","overflow-x":"hidden"});var n,r;for(n in e){if(e.hasOwnProperty(n)&&!(n==="")){var r=$(document.createElement("div")).text(n).addClass("sortOptionDiv");var i=e[n];r.attr("setSort",i);if(i===true){j++;r.css({"background-color":"white",border:"1px solid black"})}r.click(en(r));t.append(r)}}return t}function nn(e){if(!e){return}TAG.Util.UI.createAssociationPicker(i,"Add and Remove Artworks in this Collection",{comp:e,type:"exhib"},"exhib",[{name:"All Artworks",getObjs:TAG.Worktop.Database.getArtworksAndTours},{name:"Artworks in this Collection",getObjs:TAG.Worktop.Database.getArtworksIn,args:[e.Identifier]}],{getObjs:TAG.Worktop.Database.getArtworksIn,args:[e.Identifier]},function(){Yn(true,"New",sn);Zn();er(true);Zt(e.Identifier)})}function rn(e){function I(){function R(){z.add(function(){if(t)return;var n;if(q&&q!==J[M.exhib.text]){return}LADS.Layout.Catalog(e,null,function(e){v.append(e.getRoot());e.loadInteraction();gr(v)})})}function U(e){z.add(function(){if(t)return;var n={backCollection:e,previewing:true};var r=new TAG.Layout.CollectionsPage(n);var i=r.getRoot();$(i).css("z-index","-1");v.append(i);gr(v)})}if(t)return;er(true);Zn();U(e);var n=$(document.createElement("div"));n.append(f).append(c);f.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});c.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});var r=$(document.createElement("div"));r.append(p).append(d);p.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});d.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});var s=$(document.createElement("div"));s.append(w).append(E);w.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});E.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});var u=$(document.createElement("div"));u.append(y).append(b);y.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});b.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)});O=cr(TAG.Util.htmlEntityDecode(e.Name),"Title",40);_=hr(TAG.Util.htmlEntityDecode(e.Metadata.Description),false,2e3);D=fr("Select...",function(){Nr(TAG.Authoring.FileUploadTypes.Standard,function(e){gt=true;L.prop("disabled",false);L.css("opacity",1);var t=e[0];D.val(t);$("#bgimage").css({"background-image":'url("'+TAG.Worktop.Database.fixPath(t)+'")',"background-size":"cover"})})});O.focus(function(){if(O.val()==="Collection")O.select()});O.keyup(function(e){e.preventDefault();e.stopPropagation();if(e.which===13){L.click()}else{gt=true;L.prop("disabled",false);L.css("opacity",1)}$(".collection-title").text(O.val())});_.focus(function(){if(_.val()==="Description")_.select()});_.keyup(function(){$("#collectionDescription").text(_.val());var e=$("#infoDiv"),t=$("#tileDiv");if(_.val()===""){e.css("width","0%");t.css({"margin-left":"2%"})}else{e.css("width","25%");t.css({"margin-left":"0%"})}t.css({left:e.width()});gt=true;L.prop("disabled",false);L.css("opacity",1)});Sr(O,"#exhibition-title",40);Sr(_,"#description-text",1790);x=ur("Visibility on Machine",r);S=ur("Publish Setting",n);T=ur("Title",O);N=ur("Description",_);C=ur("Background Image",D);A=ur("Timeline Setting",s);P=ur("Associated Media Timeline Setting",u);if(k){H=ur("Sort Options",k);k.click(function(){gt=true;L.prop("disabled",false);L.css("opacity",1)})}o.append(S);o.append(x);o.append(T);o.append(N);o.append(C);o.append(A);o.append(P);if(H){o.append(H)}var L=fr("Save",function(){if(O.val()===undefined||O.val()===""){O.val("Untitled Collection")}LADS.Util.localVisibility(e.Identifier,{visible:h});on(e,{privateInput:a,nameInput:O,descInput:_,bgInput:D,sortOptions:k,timelineInput:kt,assocMediaInput:g})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"},true);var B=fr("Delete",function(){un(e)},{"margin-left":"2%","margin-top":"1%","margin-right":"0","margin-bottom":"3%"});var j=true;var F=fr("Preview Catalog",function(){v.empty();if(j){LADS.Worktop.Database.getArtworksIn(e.Identifier,function(e){if(t)return;if(!e||!e[0]){var n=LADS.Util.UI.popUpMessage(null,"Cannot view in catalog mode because there is no artwork in this exhibit.",null,true);i.append(n);$(n).show();U()}else{F.text("Preview Collection");R();j=!j}});return}else{F.text("Preview Catalog");U()}j=!j},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var I=fr("Manage",function(){TAG.Util.UI.createAssociationPicker(i,"Add and Remove Artworks in this Collection",{comp:e,type:"exhib"},"exhib",[{name:"All Artworks",getObjs:TAG.Worktop.Database.getArtworksAndTours},{name:"Artworks in this Collection",getObjs:TAG.Worktop.Database.getArtworksIn,args:[e.Identifier]}],{getObjs:TAG.Worktop.Database.getArtworksIn,args:[e.Identifier]},function(){Yn(true,"New",sn);Zn();er(true);Zt(e.Identifier)})},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});I.on("mousedown",function(){I.css({"background-color":"white"})});vt=I;L.on("mousedown",function(){if(!L.attr("disabled")){L.css({"background-color":"white"})}});I.on("mousedown",function(){I.css({"background-color":"white"})});B.on("mousedown",function(){B.css({"background-color":"white"})});L.on("mouseleave",function(){if(!L.attr("disabled")){L.css({"background-color":"transparent"})}});I.on("mouseleave",function(){I.css({"background-color":"transparent"})});B.on("mouseleave",function(){B.css({"background-color":"transparent"})});l.on("mouseleave",function(){l.css({"background-color":"transparent"})});m.append(I).append(B).append(L);TAG.Telemetry.register(I,"click","art-selected_collections",function(e){e.mode="settingsView"});TAG.Telemetry.register(B,"click","art-deleted_collections",function(e){e.mode="settingsView"});TAG.Telemetry.register(L,"click","art-saved_collections",function(e){e.mode="settingsView"})}ft=un;lt=e;var t=false;Zn();v.empty();v.css("background","black");var n={position:"absolute",left:"5%","z-index":"50",height:"auto",width:"10%",top:"20%"};var r=v.height()/2;var s=v.width()/2;var u=TAG.Util.showProgressCircle(v,n,s,r,true);var a;if(e.Metadata.Private){a=/^true$/i.test(e.Metadata.Private)}else{a=false}var f=fr("Unpublish",function(){a=true;f.css("background-color","white");c.css("background-color","")},{"min-height":"0px","margin-right":"4%",width:"48%",height:"35px"});f.attr("class","settingButton");var c=fr("Publish",function(){a=false;c.css("background-color","white");f.css("background-color","")},{"min-height":"0px",width:"48%",height:"35px"});c.attr("class","settingButton");if(a){f.css("background-color","white")}else{c.css("background-color","white")}var h=LADS.Util.localVisibility(e.Identifier);var p=fr("Hide on This Machine",function(){h=false;p.css("background-color","white");d.css("background-color","")},{"min-height":"0px","margin-right":"4%",width:"48%",height:"35px"});var d=fr("Show on This Machine",function(){h=true;d.css("background-color","white");p.css("background-color","")},{"min-height":"0px",width:"48%",height:"35px"});if(h){d.css("background-color","white")}else{p.css("background-color","white")}var g;if(e.Metadata.AssocMediaView==="true"||e.Metadata.AssocMediaView==="false"){e.Metadata.AssocMediaView==="true"?g=true:g=false}else{g=false}var y=fr("Show",function(){g=true;y.css({"background-color":"white"});b.css({"background-color":""});$("#toggleRow").css("display","block")},{"min-height":"0px","margin-right":"4%",width:"48%",height:"35px"});y.attr("class","settingButton");var b=fr("Hide",function(){g=false;b.css("background-color","white");y.css("background-color","");$("#toggleRow").css("display","none")},{"min-height":"0px",width:"48%",height:"35px"});b.attr("class","settingButton");if(g){y.css("background-color","white")}else{b.css("background-color","white")}if(e.Metadata.Timeline==="true"||e.Metadata.Timeline==="false"){e.Metadata.Timeline==="true"?kt=true:kt=false}else{kt=true}var w=fr("Show",function(){kt=true;w.css("background-color","white");E.css("background-color","");if($("#timelineArea").children().length>0){$("#timelineArea").css("display","block");$("#bottomContainer").css({height:"69%",top:"25%"})}},{"min-height":"0px","margin-right":"4%",width:"48%","padding-left":"10px","padding-right":"10px",height:"35px"});w.attr("id","showTimelineBttn");w.attr("class","settingButton");var E=fr("Hide",function(){kt=false;E.css("background-color","white");w.css("background-color","");$("#timelineArea").css("display","none");$("#bottomContainer").css({height:"85%",top:"15%"})},{"min-height":"0px",width:"48%",height:"35px"});E.attr("id","hideTimelineBttn");E.attr("class","settingButton");if(kt){w.css("background-color","white")}else{E.css("background-color","white")}var S;var x;var T;var N;var C;var k=null;var L;var A;var O;var _;var D;var P;var H=null;var B=JSON.parse(e.Metadata.SortOptions||"{}");var j;F={};if(B.Title===false){F.Title=false}else{F.Title=true}if(B.Date===false){F.Date=false}else{F.Date=true}if(B.Artist===false){F.Artist=false}else{F.Artist=true}TAG.Worktop.Database.getArtworksIn(e.Identifier,function(e){if(t)return;for(var n=0;n<e.length;n++){if(e[n].Extension==="tour"||e[n].Type==="Empty"&&e[n].Metadata.ContentType!=="Artwork"&&e[n].Metadata.Type!=="Image"&&e[n].Metadata.ContentType!=="VideoArtwork"&&e[n].Metadata.ContentType!=="iframe"){F["Tours"]=B["Tours"]||false}else{var r=e[n].Metadata.InfoFields;for(j in r){var i=B[j];if(i===null){F[j]=false}else{F[j]=i}}}}if(F&&F!={}){k=tn(F)}I()},kr,jn(e,"Update",Zt),Fn(Zt));X=function(){t=true}}function sn(){Yn(false);Zn();er(true);TAG.Worktop.Database.createExhibition(null,function(e){if(q&&q!==J[M.exhib.text]){return}if(!e){Zt();return}Zt(e.Identifier)},kr,Fn(Zt),true)}function on(e,t){Zn();er(true);Yn(false,null,null,"Saving...");var n=t.nameInput.val();var r=t.descInput.val();var i=t.bgInput.val();var s=t.privateInput;var o=t.timelineInput;var u=t.assocMediaInput;var a={Name:n,Private:s,Description:r,SortOptions:JSON.stringify(F),Timeline:o,AssocMediaView:u};if(i){a.Background=i}TAG.Worktop.Database.changeExhibition(e.Identifier,a,function(){if(q&&q!==J[M.exhib.text]){LADS.Worktop.Database.getExhibitions();return}if(q&&q===J[M.exhib.text]){Zt(e.Identifier);return}},kr,jn(e,"Update",Zt),Fn(Zt))}function un(e){var t=TAG.Util.UI.PopUpConfirmation(function(){Yn(false);Zn();er(true);TAG.Worktop.Database.deleteDoq(e.Identifier,function(){if(q&&q!==J[M.exhib.text]){return}Zt()},kr,jn(e,"Delete",Zt),Fn(Zt))},"Are you sure you want to delete "+e.Name+"?","Delete",true,function(){$(t).hide()});i.append(t);$(t).show();TAG.Util.multiLineEllipsis($($($(t).children()[0]).children()[0]))}function an(e,t){function i(){$.each(n,function(t,n){if(r)return false;U.add(function(){if(r)return;if(q&&q!==J[M.tour.text]){return}var i;if(!R&&(e&&n.Identifier===e||!e&&t===0)){s.before(ir(i=Gn(n.Name,null,function(){D=n.Identifier;fn(n);ht=t},n.Identifier,false,function(){cn(n)}),true));if(p.scrollTop()===0&&i.offset().top-p.height()>0){p.animate({scrollTop:i.offset().top-p.height()/2},1e3)}R=i;pt=R;ht=t;fn(n)}else{s.before(i=Gn(n.Name,null,function(){fn(n);D=n.Identifier;ht=t},n.Identifier,false,function(){cn(n)}))}})});U.add(function(){s.hide()})}bt=false;wt=false;Et=false;St=false;xt=true;Tt=false;gt=false;var n;ht=0;Yn(true,"New",ln);Zn();er(true);var r=false;if(typeof t!=="undefined"){n=t;i()}else{TAG.Worktop.Database.getTours(function(e){if(r)return;yr(e);ct=e;On();n=e;i()})}W=function(){r=true}}function fn(e){er(true);Zn();ft=hn;lt=e;var t=$(document.createElement("img"));t.attr("src",TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail));var n={position:"absolute",left:"30%",top:"22%","z-index":"50",height:v.height()/2+"px",width:"auto"};var r=TAG.Util.showProgressCircle(v,n,"0px","0px",false);var i=R;t.load(function(){if(R&&R.text()!==TAG.Util.htmlEntityDecode(e.Name)){TAG.Util.removeProgressCircle(r);return}TAG.Util.removeProgressCircle(r);v.css("background","black url("+TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail)+") no-repeat center / contain")});if(e.Metadata.Thumbnail==="/Images/default.jpg"){TAG.Util.removeProgressCircle(r)}var s;if(e.Metadata.Private){s=/^true$/i.test(e.Metadata.Private)}else{s=false}var u=fr("Unpublish",function(){s=true;u.css("background-color","white");a.css("background-color","")},{"margin-right":"4%",width:"48%",height:"35px"});u.attr("class","settingButton");u.click(function(){gt=true;x.prop("disabled",false);x.css("opacity",1)});var a=fr("Publish",function(){s=false;a.css("background-color","white");u.css("background-color","")},{width:"48%",height:"35px"});a.click(function(){gt=true;x.prop("disabled",false);x.css("opacity",1)});a.attr("class","settingButton");if(s){u.css("background-color","white")}else{a.css("background-color","white")}var f=$(document.createElement("div"));f.append(u).append(a);var c=cr(TAG.Util.htmlEntityDecode(e.Name),"Tour Title",120);var h=hr(TAG.Util.htmlEntityDecode(e.Metadata.Description).replace(/\n/g,"<br />")||"",false,2e3);var p=cr(e.Identifier,"Tour ID (read-only)",80,false,true);c.focus(function(){if(c.val()==="Untitled Tour")c.select()});h.focus(function(){if(h.val()==="Tour Description")h.select()});Sr(h,null,1500);Sr(c,null,1500);var d=ur("Publish Setting",f);var g=ur("Name",c);var y=ur("Description",h);var b=ur("ID (read-only)",p);o.append(d);o.append(g);o.append(y);o.append(b);c.on("keyup",function(e){if(e.which===13){x.click()}else{gt=true;x.prop("disabled",false);x.css("opacity",1)}});h.on("keyup",function(){gt=true;x.prop("disabled",false);x.css("opacity",1)});var w=fr("Edit",function(){cn(e)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var E=fr("Delete",function(){hn(e)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var S=fr("Duplicate",function(){pn(e,{privateInput:s,nameInput:c,descInput:h})},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var x=fr("Save",function(){if(c.val()===undefined||c.val()===""){c.val("Untitled Tour")}dn(e,{privateInput:s,nameInput:c,descInput:h})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"},true);m.append(w).append(S).append(E).append(x);x.on("mousedown",function(){if(!x.attr("disabled")){x.css({"background-color":"white"})}});S.on("mousedown",function(){S.css({"background-color":"white"})});E.on("mousedown",function(){E.css({"background-color":"white"})});w.on("mousedown",function(){w.css({"background-color":"white"})});x.on("mouseleave",function(){if(!x.attr("disabled")){x.css({"background-color":"transparent"})}});S.on("mouseleave",function(){S.css({"background-color":"transparent"})});E.on("mouseleave",function(){E.css({"background-color":"transparent"})});w.on("mouseleave",function(){w.css({"background-color":"transparent"})});l.on("mouseleave",function(){l.css({"background-color":"transparent"})});TAG.Telemetry.register(w,"click","tour_edit",function(e){e.mode="settingsView"});TAG.Telemetry.register(S,"click","tour_duplicate",function(e){e.mode="settingsView"});TAG.Telemetry.register(E,"click","tour_delete",function(e){e.mode="settingsView"});TAG.Telemetry.register(x,"click","tour_save",function(e){e.mode="settingsView"})}function ln(){Yn(false);Zn();er(true);TAG.Worktop.Database.createTour(null,function(e){if(q&&q!==J[M.tour.text]){return}if(!e){an();return}an(e.Identifier)},kr,Fn(an),true)}function cn(e){if(!e){return}Cr("Loading Tour...",1);U.clear();z.clear();setTimeout(function(){var t=new TAG.Layout.TourAuthoringNew(e,function(){TAG.Util.UI.slidePageLeft(t.getRoot())})},1)}function hn(e){var t=TAG.Util.UI.PopUpConfirmation(function(){Yn(false);Zn();er(true);TAG.Worktop.Database.deleteDoq(e.Identifier,function(){if(q&&q!==J[M.tour.text]){return}an()},kr,jn(e,"Delete",an),Fn(an))},"Are you sure you want to delete "+e.Name+"?","Delete",true,function(){$(t).hide()});i.append(t);$(t).show();TAG.Util.multiLineEllipsis($($($(t).children()[0]).children()[0]))}function pn(e,t){Yn(false);Zn();er(true);var n={Name:"Copy: "+e.Name,Description:e.Metadata.Description,Content:e.Metadata.Content,Thumbnail:e.Metadata.Thumbnail,Private:"true"};TAG.Worktop.Database.createTour(n,function(e){console.log("success");if(q&&q!==J[M.tour.text]){return}an(e.Identifier)},function(){console.log("error")},function(){console.log("cacheError")})}function dn(e,t){var n=t.nameInput.val();var r=t.descInput.val();if(n.indexOf(" ")===0){var s=TAG.Util.UI.popUpMessage(null,"Tour Name cannot start with a space.",null,true);$(i).append(s);$(s).show();return}Yn(false,null,null,"Saving...");Zn();er(true);TAG.Worktop.Database.changeTour(e.Identifier,{Name:n,Description:r,Private:t.privateInput},function(){if(q&&q!==J[M.tour.text]){LADS.Worktop.Database.getTours();return}if(q&&q===J[M.tour.text]){an(D);return}},kr,jn(e,"Update",an),Fn(an))}function vn(e,t){function i(){if(n[0]&&n[0].Metadata){$.each(n,function(t,n){if(r)return;U.add(function(){if(r)return;if(q&&q!==J[M.media.text]){return}var i;var o;switch(n.Metadata.ContentType.toLowerCase()){case"video":o=n.Metadata.Thumbnail&&!n.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(n.Metadata.Thumbnail):tagPath+"images/video_icon.svg";break;case"audio":o=tagPath+"/images/audio_icon.svg";break;case"iframe":o=tagPath+"/images/video_icon.svg";break;case"image":o=n.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(n.Metadata.Thumbnail):tagPath+"images/image_icon.svg";break;default:o=null;break}if(!R&&(e&&n.Identifier===e||!e&&t===0)){s.before(ir(i=Gn(n.Name,o,function(){D=n.identifier;mn(n);ht=t},n.Identifier,false),true));if(p.scrollTop()===0&&i.offset().top-p.height()>0){p.animate({scrollTop:i.offset().top-p.height()/2},1e3)}R=i;pt=R;mn(n)}else{s.before(i=Gn(n.Name,o,function(){mn(n);D=n.Identifier;ht=t},n.Identifier,false))}})});U.add(function(){s.hide()})}else{s.hide()}}bt=false;wt=false;Et=false;St=true;xt=false;Tt=false;gt=false;var n;ht=0;Nt.on("mouseleave",function(){Nt.css({"background-color":"transparent"})});if(Ct){Nt.click()}Yn(true,"Add",Tn);er(true);Zn();var r=false;if(typeof t!=="undefined"){n=t;i()}else{TAG.Worktop.Database.getAssocMedia(function(e){if(r)return;yr(e);ct=e;nt=e;On();n=e;i()})}W=function(){r=true}}function mn(e){er(true);Zn();ft=bn;lt=e;at=e.Identifier;clearTimeout(Lt);var t=e.Metadata.ContentType.toLowerCase();var n;var r;var i=t==="iframe"?e.Metadata.Source:TAG.Worktop.Database.fixPath(e.Metadata.Source);switch(t){case"image":n=$(document.createElement("img"));break;case"video":n=$(document.createElement("video"));n.attr("id","videoInPreview");n.attr("poster",e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):"");n.attr("identifier",e.Identifier);n.attr("preload","none");n.attr("controls","");n.css({width:"100%","max-width":"100%","max-height":"100%"});n.attr("src",i);var i=TAG.Worktop.Database.fixPath(e.Metadata.Source);var s=i.substring(0,i.lastIndexOf("."));r=i.substring(i.lastIndexOf("."));TAG.Worktop.Database.getConvertedVideoCheck(function(t){if(t==="True"||r===".mp4"){n.removeAttr("src");var o=s+".mp4";var u=s+".webm";var a=s+".ogv";Dn(n,o,"video/mp4");Dn(n,u,"video/webm");Dn(n,a,"video/ogv");n[0].onerror=TAG.Util.videoErrorHandler(n,v);v.append(n);if(r===".mp4"){if(t==="False"){var f="This video is being converted to compatible formats for different browsers";Lt=setInterval(function(){Ot(e)},2e3);v.append(TAG.Util.createConversionLoading(f,null,true))}else if(t==="Error"){var f="An error occured when converting this video. Please try to upload again";v.append(TAG.Util.createConversionLoading(f,true,true))}}}else{if(t==="False"){$("#videoErrorMsg").remove();$("#leftLoading").remove();var f="This video is being converted to compatible formats for different browsers";v.append(TAG.Util.createConversionLoading(f));Lt=setInterval(function(){Ot(e)},2e3)}else if(t==="Error"){$("#videoErrorMsg").remove();$("#leftLoading").remove();var f="An error occured when converting this video. Please try to upload again";if(r===".mp4"){v.append(TAG.Util.createConversionLoading(f,true,true))}else{v.append(TAG.Util.createConversionLoading(f,true))}}else if(t===null){TAG.Worktop.Database.convertVideo(function(){},null,i,r,s,artwork.Identifier)}}},null,e.Identifier);break;case"audio":n=$(document.createElement("audio"));n.attr("preload","none");n.attr("controls","");n.css({width:"80%"});zt(n);break;case"iframe":n=$(document.createElement("iframe"));n.attr({src:i+"?modestbranding=1&showinfo=0&fs=0",frameborder:"0"});n.css({width:"100%",height:"100%"});break;case"text":default:n=$(document.createElement("div"));n.css({"font-size":"24px",top:"20%",width:"80%","text-align":"center",color:"white"});n.html(e.Name+"<br /><br />"+e.Metadata.Description);n.crossOrigin="";break}i&&t!=="text"&&t!=="iframe"&&n.attr("src",i);var u={position:"absolute",left:"40%",top:"40%","z-index":"50",height:"auto",width:"20%"};var a=TAG.Util.showProgressCircle(v,u,"0px","0px",false);var f=R;switch(t){case"image":n.load(function(){if(R&&R.text()!==e.Name){TAG.Util.removeProgressCircle(a);return}TAG.Util.removeProgressCircle(a);v.css("background","black url("+i+") no-repeat center / contain")});break;case"video":TAG.Util.removeProgressCircle(a);v.css("background","black");break;case"audio":TAG.Util.removeProgressCircle(a);v.css("background","black");v.append(n);var c=v.width()/2-n.width()/2+"px";var h=v.height()/2-n.height()/2+"px";n.css({position:"absolute",left:c,top:h});break;case"iframe":TAG.Util.removeProgressCircle(a);v.css("background","black");v.append(n);break;case"text":TAG.Util.removeProgressCircle(a);v.css({background:"black"});v.append(n);var c=v.width()/2-n.width()/2+"px";var h=v.height()/2-n.height()/2+"px";n.css({position:"absolute",left:c,top:h});break;default:TAG.Util.removeProgressCircle(a);v.css("background","black");break}var p=cr(TAG.Util.htmlEntityDecode(e.Name)||"","Title",100);var d=hr(TAG.Util.htmlEntityDecode(e.Metadata.Description).replace(/\n/g,"<br />")||"",true,2e3);p.focus(function(){if(p.val()==="Title")p.select()});p.on("keyup",function(e){if(e.which===13){C.click()}else{gt=true;C.prop("disabled",false);C.css("opacity",1)}});d.focus(function(){if(d.val()==="Description")d.select()});d.on("keyup",function(){gt=true;C.prop("disabled",false);C.css("opacity",1)});Sr(p,null,100);Sr(d,null,5e3);var g=ur("Title",p);var y=ur("Description",d);var b=ar(e,function(e){if(e&&e.which===13){C.click()}else{gt=true;C.prop("disabled",false);C.css("opacity",1)}});o.append(g);o.append(y);if(t==="iframe"){var w=e.Metadata.Source;var E;if(w.indexOf("youtube")>-1){if(w.indexOf("embed")>-1){E=w.substring(w.indexOf("embed")+6);E="https://www.youtube.com/watch?v="+E}}else if(w.indexOf("vimeo")){if(w.indexOf("video")>-1){E=w.substring(w.indexOf("video")+6,w.indexOf("?"));E="https://www.vimeo.com/"+E}}var S=cr(E);S.focus(function(){if(d.val()==="Source")d.select()});S.on("keyup",function(e){if(e.which===13){C.click()}else{gt=true;C.prop("disabled",false);C.css("opacity",1)}});Sr(S,null,5e3);var i=ur("Source",S);o.append(i)}o.append(b.yearMetadataDiv);var x=fr("Manage Associations",function(){yt=true;wn(e)},{"float":"left","margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});vt=x;var T=fr("Delete",function(){bn(e)},{"margin-right":"0%","margin-top":"1%","margin-bottom":"3%","margin-left":"2%","float":"left"});var N=fr("Generate Thumbnail",function(){En(e)},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":"2%","float":"left"});var C=fr("Save",function(){if(p.val()===undefined||p.val()===""){p.val("Untitled Asset")}var n={titleInput:p,descInput:d,yearInput:b.yearInput,monthInput:b.monthInput,dayInput:b.dayInput,timelineYearInput:b.timelineYearInput,timelineMonthInput:b.timelineMonthInput,timelineDayInput:b.timelineDayInput};if(t==="iframe"){var r=gn(S.val());if(r){yn(e,n,r)}}else{yn(e,n)}},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"},true);var k=fr("Capture Thumbnail",function(){Hn(e,false)},{"margin-right":"0%","margin-top":"1%","margin-bottom":"3%","margin-left":"2%","float":"left"});k.attr("id","thumbnailButton");m.append(x);if(e.Metadata.ContentType.toLowerCase()==="video"){m.append(k)}else if(e.Metadata.ContentType.toLowerCase()==="image"&&!e.Metadata.Thumbnail&&e.Metadata.Source&&e.Metadata.Source[0]==="/"&&!i.match(/.mp3/)){m.append(N)}m.append(T).append(C);C.on("mousedown",function(){if(!C.attr("disabled")){C.css({"background-color":"white"})}});k.on("mousedown",function(){k.css({"background-color":"white"})});T.on("mousedown",function(){T.css({"background-color":"white"})});x.on("mousedown",function(){x.css({"background-color":"white"})});C.on("mouseleave",function(){if(!C.attr("disabled")){C.css({"background-color":"transparent"})}});k.on("mouseleave",function(){k.css({"background-color":"transparent"})});T.on("mouseleave",function(){T.css({"background-color":"transparent"})});x.on("mouseleave",function(){x.css({"background-color":"transparent"})});l.on("mouseleave",function(){l.css({"background-color":"transparent"})})}function gn(e){var t=e,n,r,i=true;if(t.toLowerCase().indexOf("youtube")>-1){if(t.indexOf("watch?v=")>-1){r=t.substring(t.indexOf("watch?v=")+8);if(r&&!/^[a-zA-Z0-9_-]*$/.test(r)){i=false}}else{i=false}if(i&&r){if(t.indexOf("https://")<0&&t.indexOf("http://")>-1){t=t.replace("http://","https://")}else if(t.indexOf("https://")<0&&t.indexOf("http://")<0){t="https://"+t}t=t.replace("watch?v=","embed/")}else{n=TAG.Util.UI.popUpMessage(null,"There was a problem embedding the given YouTube URL. The URL should be in the format http://www.youtube.com/watch?v=JozMHAWq0TA");$("body").append(n);$(n).show()}}else if(t.toLowerCase().indexOf("vimeo")>-1){if(t.indexOf("vimeo.com")>-1){r=t.substring(t.indexOf("vimeo.com")+10);if(r&&!/^\d+$/.test(r)){i=false}}else{i=false}if(i&&r){t="https://player.vimeo.com/video/"+r+"?title=0&byline=0&portrait=0"}else{n=TAG.Util.UI.popUpMessage(null,"There was a problem embedding the given Vimeo URL. The URL should be in the format http://vimeo.com/11088764 ");$("body").append(n);$(n).show()}}else{n=TAG.Util.UI.popUpMessage(null,"Please enter a valid YouTube or Vimeo URL.");$("body").append(n);$(n).show();i=false}if(i){return t}else{return""}}function yn(e,t,n){var r=t.titleInput.val(),i=t.yearInput.val(),s=t.monthInput.val(),o=t.dayInput.val(),u=t.timelineYearInput.val(),a=t.timelineMonthInput.val(),f=t.timelineDayInput.val(),l=t.descInput.val(),c=n||"";Zn();er(true);Yn(false,null,null,"Saving...");var r=t.titleInput.val();var l=t.descInput.val();TAG.Worktop.Database.changeHotspot(e,{Name:r,Description:l,Source:c,Year:i,Month:s,Day:o,TimelineYear:u,TimelineMonth:a,TimelineDay:f},function(){if(q&&q!==J[M.media.text]){LADS.Worktop.Database.getAssocMedia();return}if(q&&q===J[M.media.text]){vn(D);return}},kr,jn(e,"Update",vn),Fn(vn))}function bn(e){var t=TAG.Util.UI.PopUpConfirmation(function(){Yn(false);Zn();er(true);TAG.Worktop.Database.changeHotspot(e.Identifier,{Name:e.Name},function(){TAG.Worktop.Database.deleteDoq(e.Identifier,function(){console.log("deleted");vn()},function(){console.log("noauth error")},function(){console.log("conflict error")},function(){console.log("general error")})},function(){},function(){},function(){})},"Are you sure you want to delete "+e.Name+"?","Delete",true,function(){$(t).hide()});i.append(t);$(t).show();TAG.Util.multiLineEllipsis($($($(t).children()[0]).children()[0]))}function wn(e){if(!e){return}tt=[[]];Y=1;TAG.Util.UI.createAssociationPicker(i,"Choose artworks",{comp:e,type:"media"},"artwork",[{name:"All Artworks",getObjs:TAG.Worktop.Database.getArtworks}],{getObjs:TAG.Worktop.Database.getArtworksAssocTo,args:[e.Identifier]},function(){})}function En(e){Yn(false,null,null,"Saving...");Zn();er(true);TAG.Worktop.Database.changeHotspot(e.Identifier,{Thumbnail:"generate"},function(){vn(e.Identifier)},Bn,jn,Fn)}function Sn(e){function r(e){function r(){vn(t.Identifier)}var t=new Worktop.Doq(e.responseText);TAG.Worktop.Database.changeHotspot(t.Identifier,n,r,TAG.Util.multiFnHandler(kr,r),TAG.Util.multiFnHandler(jn(t,"Update",r)),Fn(r))}p.empty();p.append(s);s.show();Zn();v.empty();v.css("background","black");var t=gn(e);if(t){var n={Source:t,Name:"Untitled Embedded Video"};TAG.Worktop.Database.createIframeAssocMedia(n,r)}else{vn()}}function xn(){var e=TAG.Util.UI.popupInputBox({confirmAction:Sn,container:i,message:"Enter a YouTube or Vimeo URL",confirmText:"Save"});i.append(e);e.fadeIn(500)}function Tn(){Nr(TAG.Authoring.FileUploadTypes.AssociatedMedia,function(e,t,n,r){function p(e){if(n[e]==="Video"){r[e].properties.getVideoPropertiesAsync().done(function(t){l.push(t.duration/1e3);v(e)},function(e){console.log(e)})}else if(n[e]==="Audio"){r[e].properties.getMusicPropertiesAsync().done(function(t){l.push(t.duration/1e3);v(e)},function(e){console.log(e)})}else{l.push(null);v(e)}}function d(){a++;if(a>=f){vn(c.Identifier)}else{p(a)}}function v(r){var i;try{i=new Worktop.Doq(e[r]);var s={Name:t[r]};if(l[r]){s.Duration=l[r]}TAG.Worktop.Database.changeHotspot(i.Identifier,s,d,TAG.Util.multiFnHandler(kr,d),TAG.Util.multiFnHandler(jn(i,"Update",d)),m(d));if(n[r]==="Video"){var o=i.Metadata.Source;var u=o.slice(8,o.length);var f=u.lastIndexOf(".");var p=u.slice(f);var v=u.slice(0,f);TAG.Worktop.Database.convertVideo(function(){},null,u,p,v,i.Identifier)}}catch(m){a++;console.log("error in uploading: "+m.message);return}if(!h||t[r]<h){c=i;h=t[r]}}var i,s,o,u,a=0,f=e.length,l=[],c,h;Yn(false);Zn();er(true);if(r.length>0){p(0)}},true,[".jpg",".png",".gif",".tif",".tiff",".mp4",".mp3",".mp4",".webm",".ogv",".mov",".avi",".wmv"])}function Nn(){Cn()}function Cn(){var e=[];G=[];tt=[];Y=0;Z=true;Q=TAG.Authoring.FileUploader(i,TAG.Authoring.FileUploadTypes.AssociatedMedia,function(t,n){var r,i,s;var o,u,a;var f;Y=t.length;for(s=0;s<t.length;s++){tt.push([]);r=t[s];i=n[s];if(r.contentType.match(/image/)){f="Image"}else if(r.contentType.match(/video/)||t[s].fileType.toLowerCase()===".mp4"||t[s].fileType.toLowerCase()===".webm"||t[s].fileType.toLowerCase()===".ogv"){f="Video"}else if(r.contentType.match(/audio/)){f="Audio"}e.push(i);G.push({title:r.displayName,contentType:f,localUrl:i,assetType:"Asset",assetLinqID:undefined,assetDoqID:undefined})}},function(e){var t,n;for(t=0;t<e.length;t++){n=e[t];G[t].contentUrl=n}},[".jpg",".png",".gif",".tif",".tiff",".mp4",".mp3"],false,null,true)}function kn(e){var t=tt[e].length;Ln(e,0,t)}function Ln(e,t,n){var r=G[e];An(tt[e][t],{title:TAG.Util.htmlEntityEncode(r.title||"Untitled media"),desc:TAG.Util.htmlEntityEncode(""),pos:null,contentType:r.contentType,contentUrl:r.contentUrl,assetType:r.assetType,metadata:{assetLinqID:r.assetLinqID,assetDoqID:r.assetDoqID}},e,t,n)}function An(e,t,n,r,i){function v(e,t){var u,c,p,d,v,m,g,y,b,w,E;u=$(t);c=u.find("Identifier").text();p=u.find("BubbleContentID:last").text();d=$.parseXML(TAG.Worktop.Database.getDoqXML(p));v=$(d);m=v.find("Name").text(s);g=v.find("Metadata");y=g.find("d3p1\\:Key:contains('Description') + d3p1\\:Value").text(o);b=g.find("d3p1\\:Key:contains('ContentType') + d3p1\\:Value").text(a);w=g.find("d3p1\\:Key:contains('Source') + d3p1\\:Value").text(f);E=u.find("Offset > d2p1\\:_x").text(h.x);E=u.find("Offset > d2p1\\:_y").text(h.y);u.find("d3p1\\:Key:contains('Type') + d3p1\\:Value").text(l);TAG.Worktop.Database.pushLinq(t,c);TAG.Worktop.Database.pushXML(d,p);if(r<i-1){Ln(n,r+1,i)}else if(r===i-1&&n<Y-1){kn(n+1)}else{Z=false;et=false}}var s=t.title,o=t.desc,u=t.pos,a=t.contentType,f=t.contentUrl,l=t.assetType,c=t.metadata||{},h=u?zoomimage.viewer.viewport.pointFromPixel(u):{x:0,y:0},p;var d={Name:s,ContentType:a,Duration:duration,Source:f,LinqTo:e.Identifier,X:h.x,Y:h.y,LinqType:l,Description:o};TAG.Worktop.Database.createHotspot(e.CreatorID,e.Identifier,v)}function On(){var e;f[0].value="";ut=[];$.each(ct,function(t,n){if(!n){return false}e=(n.Name?n.Name:"")+" "+(n.Metadata.Artist?n.Metadata.Artist:"")+" "+(n.Metadata.Year?n.Metadata.Year:"")+" "+(n.Metadata.TimelineYear?n.Metadata.TimelineYear:"")+" "+(n.Metadata.Description?n.Metadata.Description:"")+" "+(n.Metadata.Type?n.Metadata.Type:"")+" "+(n.Metadata.Feedback?n.Metadata.Feedback:"");if(n.Metadata.InfoFields){$.each(n.Metadata.InfoFields,function(t,n){e+=" "+t;e+=" "+n})}ut.push({id:t,keys:e.toLowerCase(),identifier:e.Identifier})})}function Mn(){TAG.Util.removeYoutubeVideo();var e=f.val().toLowerCase(),t=[],n;if(!e){_n();return}for(n=0;n<ut.length;n++){if(ut[n].keys.indexOf(e)>-1){t.push(ct[n])}}if(Et){_n(null,t)}else if(St){vn(null,t)}else if(wt){Zt(null,t)}else if(Tt){Vn(null,t)}else if(xt){an(null,t)}else{return}}function _n(e,t){function i(){if(n[0]&&n[0].Metadata){$.each(n,function(t,n){if(r)return;n.Name=TAG.Util.htmlEntityDecode(n.Name);U.add(function(){if(r)return;if(q&&q!==J[M.art.text]){return}var i;var o;switch(n.Metadata.Type){case"Artwork":o=TAG.Worktop.Database.fixPath(n.Metadata.Thumbnail);break;case"VideoArtwork":o=n.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(n.Metadata.Thumbnail):tagPath+"images/video_icon.svg";break;default:o=null}if(!R&&(e&&n.Identifier===e||!e&&t===0)){s.before(ir(i=Gn(n.Name,o,function(){D=n.identifier;Pn(n);ht=t},n.Identifier,false,function(){if(n.Metadata.Type==="Artwork"){zn(n)}},true,n.Extension),true));if(p.scrollTop()===0&&i.offset().top-p.height()>0){p.animate({scrollTop:i.offset().top-p.height()/2},1e3)}R=i;pt=R;ht=t;Pn(n)}else{s.before(i=Gn(n.Name,o,function(){Pn(n);D=n.Identifier;ht=t},n.Identifier,false,function(){if(n.Metadata.Type==="Artwork"){zn(n)}},true,n.Extension))}})});U.add(function(){s.hide()})}else{s.hide()}}bt=false;wt=false;Et=true;St=false;xt=false;Tt=false;gt=false;var n;ht=0;Yn(true,"Import",In);er(true);Zn();var r=false;if(typeof t!=="undefined"){n=t;i()}else{TAG.Worktop.Database.getArtworks(function(e){if(r)return;yr(e);ct=e;nt=e;On();n=e;i()})}W=function(){r=true}}function Dn(e,t,n){var r=document.createElement("source");r.src=t;r.type=n;e[0].appendChild(r)}function Pn(e){if(At)At();er(true);Zn();ft=Wn;lt=e;clearInterval(Lt);at=e.Identifier;var t;var n=false;if(e.Metadata.Type!=="VideoArtwork"){t=$(document.createElement("img"));t.attr("src",TAG.Worktop.Database.fixPath(e.URL))}else{t=$(document.createElement("video"));t.attr("id","videoInPreview");zt(t);t.attr("poster",e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):"");t.attr("identifier",e.Identifier);t.attr("preload","none");t.attr("controls","");t.css({width:"100%","max-width":"100%","max-height":"100%"});var r=TAG.Worktop.Database.fixPath(e.Metadata.Source);var i=r.substring(0,r.lastIndexOf("."));var s=r.substring(r.lastIndexOf("."));var u=$(document.createElement("div"));u.addClass("videoErrorDiv");t.attr("fileName",e.Metadata.Source.substring(0,r.lastIndexOf(".")));TAG.Worktop.Database.getConvertedVideoCheck(function(n){if(n==="True"||s===".mp4"||n==="true"){clearInterval(Lt);var o=i+".mp4";var u=i+".webm";var a=i+".ogv";Dn(t,o,"video/mp4");Dn(t,u,"video/webm");Dn(t,a,"video/ogv");t[0].onerror=TAG.Util.videoErrorHandler(t,v);v.append(t);if(s===".mp4"){if(n==="False"){var f="This video is being converted to compatible formats for different browsers";Lt=setInterval(function(){Ot(e)},2e3);v.append(TAG.Util.createConversionLoading(f,null,true))}else if(n==="Error"){var f="An error occured when converting this video. Please try to upload again";v.append(TAG.Util.createConversionLoading(f,true,true))}}}else{if(n==="False"){$("#videoErrorMsg").remove();$("#leftLoading").remove();var f="This video is being converted to a compatible format";v.append(TAG.Util.createConversionLoading(f));Lt=setInterval(function(){Ot(e)},2e3)}else if(n==="Error"){$("#videoErrorMsg").remove();$("#leftLoading").remove();var f="An error occured when converting this video. Please try to upload again";if(s===".mp4"){v.append(TAG.Util.createConversionLoading(f,true,true))}else{v.append(TAG.Util.createConversionLoading(f,true))}}else if(n===null){TAG.Worktop.Database.convertVideo(function(){},null,r,s,i,e.Identifier)}}},null,e.Identifier)}t.crossOrigin="";var a={position:"absolute",left:"40%",top:"40%","z-index":"50",height:"auto",width:"20%"};var f;if(e.Metadata.Type!=="VideoArtwork"){f=TAG.Util.showProgressCircle(v,a,"0px","0px",false)}var c=R;if(e.Metadata.Type!=="VideoArtwork"){t.load(function(){if(R&&R.text()!==e.Name){TAG.Util.removeProgressCircle(f);return}TAG.Util.removeProgressCircle(f);v.css("background","black url("+TAG.Worktop.Database.fixPath(e.URL)+") no-repeat center / contain")})}else{}var h;TAG.Worktop.Database.getMain(function(){var t=cr(TAG.Util.htmlEntityDecode(e.Name),"Artwork Title",100);var r=cr(TAG.Util.htmlEntityDecode(e.Metadata.Artist),"Artist",100);var i=hr(TAG.Util.htmlEntityDecode(e.Metadata.Description).replace(/\n/g,"<br />")||"","",false,2e3);t.on("keyup",function(e){if(e.which===13){a.click()}else{gt=true;a.prop("disabled",false);a.css("opacity",1)}});r.on("keyup",function(e){if(e.which===13){a.click()}else{gt=true;a.prop("disabled",false);a.css("opacity",1)}});i.on("keyup",function(){gt=true;a.prop("disabled",false);a.css("opacity",1)});var s={};var u={};var a;var f=ar(e,function(e){if(e&&e.which===13){a.click()}else{gt=true;a.prop("disabled",false);a.css("opacity",1)}});t.focus(function(){if(t.val()==="Title")t.select()});r.focus(function(){if(r.val()==="Artist")r.select()});i.focus(function(){if(i.val()==="Description")i.select()});Sr(t,null,100);Sr(r,null,100);Sr(f.yearInput,null,100);Sr(i,null,5e3);var c=ur("Description",i);var p=ur("Title",t);var d=ur("Artist",r);if(e.Metadata.InfoFields){$.each(e.Metadata.InfoFields,function(e,t){s[e]=cr(TAG.Util.htmlEntityDecode(t),"Metadata Field");u[e]=ur(e,s[e])})}o.append(p);o.append(d);o.append(c);o.append(f.yearMetadataDiv);$.each(u,function(e,t){o.append(t)});if(n)return;h=TAG.Worktop.Database.getLocked();var v=fr("Unlocked",function(){h="";v.css("background-color","white");g.css("background-color","")},{"min-height":"0px","margin-right":"4%",width:"48%"});var g=fr("Locked",function(){h=e.Identifier;g.css("background-color","white");v.css("background-color","")},{"min-height":"0px",width:"48%"});if(h===e.Identifier){g.css("background-color","white")}else{v.css("background-color","white")}var y=$(document.createElement("div"));y.append(g).append(v);g.click(function(){gt=true;a.prop("disabled",false);a.css("opacity",1)});v.click(function(){gt=true;a.prop("disabled",false);a.css("opacity",1)});var b=ur("Lock to this artwork",y);o.append(b);st=fr("Artwork Editor",function(){zn(e)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});vt=st;st.attr("id","artworkEditorButton");var w=fr("Delete",function(){Wn(e)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});if(h==e.Identifier){w.prop("disabled",true);w.css({opacity:"0.5"})}var E={artistInput:r,nameInput:t,yearInput:$(f.yearInput),monthInput:f.monthInput,dayInput:f.dayInput,timelineYearInput:f.timelineYearInput,timelineMonthInput:f.timelineMonthInput,timelineDayInput:f.timelineDayInput,descInput:i,customInputs:s};a=fr("Save",function(){if(t.val()===undefined||t.val()===""){t.val("Untitled Artwork")}Xn(e,{artistInput:r,nameInput:t,yearInput:$(f.yearInput),monthInput:f.monthInput,dayInput:f.dayInput,timelineYearInput:f.timelineYearInput,timelineMonthInput:f.timelineMonthInput,timelineDayInput:f.timelineDayInput,descInput:i,locked:h,customInputs:s})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"},true);var S=fr("Upload XML",function(){qn(e,E,o)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});var x=fr("Capture Thumbnail",function(){Hn(e,true)},{"margin-right":"0%","margin-top":"1%","margin-bottom":"1%","margin-left":"2%","float":"left"});x.attr("id","thumbnailButton");if(e.Metadata.Type!=="VideoArtwork"){m.append(st).append(w).append(a).append(S)}else{m.append(w).append(a).append(S)}a.on("mousedown",function(){if(!a.attr("disabled")){a.css({"background-color":"white"})}});x.on("mousedown",function(){x.css({"background-color":"white"})});S.on("mousedown",function(){S.css({"background-color":"white"})});w.on("mousedown",function(){w.css({"background-color":"white"})});st.on("mousedown",function(){st.css({"background-color":"white"})});a.on("mouseleave",function(){a.css({"background-color":"transparent"})});x.on("mouseleave",function(){x.css({"background-color":"transparent"})});S.on("mouseleave",function(){S.css({"background-color":"transparent"})});w.on("mouseleave",function(){w.css({"background-color":"transparent"})});st.on("mouseleave",function(){st.css({"background-color":"transparent"})});l.on("mouseleave",function(){l.css({"background-color":"transparent"})})});At=function(){n=true}}function Hn(e,t){var n=$("#videoInPreview").attr("identifier");var r=Popcorn("#videoInPreview");var i=$("#videoInPreview")[0].currentTime;var s=r.capture({type:"jpg"});Yn(false,null,null,"Saving...");Zn();er(true);TAG.Worktop.Database.uploadImage(s,function(r){if(t){TAG.Worktop.Database.changeArtwork(n,{Thumbnail:r},function(){console.log("success?");_n(e.Identifier)},Bn,jn,Fn)}else{TAG.Worktop.Database.changeHotspot(n,{Thumbnail:r},function(){console.log("success?");vn(e.Identifier)},Bn,jn,Fn)}},Bn,Fn)}function Bn(){dialogOverlay.hide();var e=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  You must log in to save changes.");$("body").append(e);$(e).show()}function jn(e,t){t.force()}function Fn(){dialogOverlay.hide();var e=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  There was an error contacting the server.");$("body").append(e);$(e).show()}function In(){Nr(TAG.Authoring.FileUploadTypes.DeepZoom,function(e,t,n,r){function p(){a++;if(a>=f){_n(c.Identifier)}else{d(a)}}function d(e){if(n[e]==="Video"){r[e].properties.getVideoPropertiesAsync().done(function(t){l.push(t.duration/1e3);v(e)},function(e){console.log(e)})}else{l.push(null);v(e)}}function v(r){var i;try{i=new Worktop.Doq(e[r])}catch(s){a++;console.log("error in uploading: "+s.message);return}var o={Name:t[r]};if(l[r]){o.Duration=l[r]}if(!h||t[r]<h){c=i;h=t[r]}TAG.Worktop.Database.changeArtwork(i.Identifier,o,p,TAG.Util.multiFnHandler(kr,p),TAG.Util.multiFnHandler(jn(i,"Update",p)),s(p));var u=i.Metadata.Source;var f=u.slice(8,u.length);var d=f.lastIndexOf(".");var v=f.slice(d);var m=f.slice(0,d);if(n[r]==="Video"){TAG.Worktop.Database.convertVideo(function(){},null,f,v,m,i.Identifier)}}var i,s,o,u,a=0,f=e.length,l=[],c,h;Yn(false);Zn();er(true);if(r.length>0){d(0)}},true,[".jpg",".png",".gif",".tif",".tiff",".mp4",".webm",".ogv",".avi",".mov",".wmv"])}function qn(e,t,n){function g(o){var u=new Windows.Storage.Pickers.FileOpenPicker;u.fileTypeFilter.replaceAll([".xml"]);u.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.desktop;u.pickSingleFileAsync().then(function(u){if(!u){r.fadeOut()}if(u){s.fadeIn();var a;var f=30*1024*1024;var l;u.getBasicPropertiesAsync().then(function(s){function v(){$.ajax({type:"GET",url:window.URL.createObjectURL(u),dataType:"xml",success:function(r){var i=[];var s=r.documentElement.childNodes;var u,a;for(u=0;u<s.length;u++){if(p===false){a=s[u].localName;if(a!==null){var f=s[u].childNodes;var l={};var d,v;for(d=0;d<f.length;d++){v=f[d].localName;if(v!==null){v=v.toLowerCase();if(f[d].childNodes[0]){l[v]=f[d].childNodes[0].nodeValue;if(v===o.title&&f[d].childNodes[0].nodeValue===c){p=true}}else{l[v]=""}}}i.push(l);if(p===true){h=l;break}}}}if(p===true){Rn(e,t,h,n,o);$(".parsingOverlay").remove()}else{Un(e,t,n,i,o);$(".parsingOverlay").remove()}},error:function(){$(".parsingOverlay").remove();var e=TAG.Util.UI.popUpMessage(null,"Error occured when parsing xml. Please double check your file","OK",null,null,null,true);$(e).show();i.append(e)}})}a=s.size;if(a<f){l=true;v()}else{r.fadeOut();var d=TAG.Util.UI.PopUpConfirmation(function(){l=true;v()},"The file is larger than 30MB. Parsing it might crash your computer. Are you sure you want to continue?","Confirm",true,function(){l=false});i.append(d);$(d).show();TAG.Util.multiLineEllipsis($($($(d).children()[0]).children()[0]))}})}})}var r=$(TAG.Util.UI.blockInteractionOverlay()).addClass("parsingOverlay"),s=$(document.createElement("label")).addClass("parsingOverlayText").text("Parsing Metadata file now. Please wait."),o=$(document.createElement("div")).addClass("parsingPicker"),u=$(document.createElement("div")).addClass("parsingPickerHeader").text("Please update the input fields below to match the input fields in your XML file."),a=$(document.createElement("div")).addClass("parsingInfo"),f=$(document.createElement("button")).attr("id","parsingPickerConfirm").text("Confirm"),l=$(document.createElement("button")).attr("id","parsingPickerCancel").text("Cancel"),c=e.Name,h,p=false,d=[],v={};f.css("border-radius","3.5px");l.css("border-radius","3.5px");r.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);r.append(s);s.hide();o.append(u);o.append(a);o.append(l);o.append(f);r.append(o);i.append(r);r.fadeIn();if(e.Metadata.InfoFields){d=Object.keys(e.Metadata.InfoFields)}var m={title:"title",description:"description",year:"year",artist:"artist",extra1:d[0]||"",extra2:d[1]||"",extra3:d[2]||"",extra4:d[3]||""};$.each(m,function(e,t){var n=cr(t,"Metadata Field",null,false,false);var r=ur(e,n,null,"7px");r.addClass("metadataspec");$(r).css({margin:"0px 0px 2px 0px",padding:"1% 7% 1% 1%",width:"92%"});$(r).children(":first").css({color:"white","font-style":"normal","vertical-align":"top"});$(r).children().eq(1).css({margin:"0 auto","font-size":"60%"});v[e]=n;r.show().data("visible",true);a.append(r)});f.click(function(){$.each(m,function(e,t){var n=v[e].val();m[e]=n});o.fadeOut();g(m)});l.click(function(){r.fadeOut();l.disabled=true})}function Rn(e,t,n,r,i){var s=0;var o={};var u={};var a=n[i.title];var f=n[i.artist];var l=n[i.year];var c=n[i.description];var h;var p;if(!a)a="";delete n[i.title];delete i.title;if(!l)l="";delete n[i.year];delete i.year;if(!f)f="";delete n[i.artist];delete i.artist;if(!c)c="";delete n[i.description];delete i.description;$.each(i,function(e,t){if(t!==""){o[t]=""}});if(Object.keys(n).length>0){$.each(o,function(e,t){p=n[e];if(p){delete n[e];o[e]=p}delete i[e];s++});for(h in n){if(s<2){o[h]=n[h];t.customInputs[h]=cr(TAG.Util.htmlEntityDecode(n[h]),"Metadata Field");u[h]=ur(h,t.customInputs[h]);s++}}$.each(u,function(e,t){r.append(t)})}Yn(false,null,null,"Saving...");Zn();er(true);TAG.Worktop.Database.changeArtwork(e,{Name:a,Artist:f,Year:l,Description:c,InfoFields:JSON.stringify(o)},function(){if(q&&q!==J[M.art.text]){return}_n(e.Identifier)},kr,jn(e,"Update",_n),Fn(_n))}function Un(e,t,n,r,s){function S(){c.empty();w=[];b=r;for(m=0;m<r.length;m++){E="";$.each(r[m],function(e,t){E+=t+" "});var e=r[m];var t=e[s["title"]];w.push({id:m,keys:E.toLowerCase(),title:t||"Untitled"});if(!t)t="Untitled";o[m]=t;if(m<30){var n=T(t,m);if(m===0){n.click()}g++}}}function x(){var e=l.val();var t=[];if(e){c.empty();g=0;e=e.toLowerCase();b=[];$.each(w,function(t,n){if(n.keys.indexOf(e)>-1||n.title.toLowerCase().indexOf(e)>-1){b.push(r[n.id]);if(g<30){var i=T(n.title,n.id);if(g===0){i.click()}g++}}})}else{c.empty();g=0;b=r;for(var n=0;n<30;n++){if(n<w.length){var i=T(w[n].title||"Untitled",n)}else{break}if(n===0){i.click()}g++}}}function T(e,t){var n=$(document.createElement("div")).addClass("mtHolder").attr("id",t).text(e).css({"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","font-size":"0.9em"});c.append(n);N(n);return n}function N(e){e.click(function(){$(".mtHolder").css("background","black");e.css("background","#999");var t=e.attr("id");v=r[t];if(v){$("#metadataPickerImport").attr("disabled",false);for(var n in d){if(n in v){d[n].input.val(v[n]);d[n].field.show().data("visible",true)}else{d[n].field.hide().data("visible",false)}}for(var i in v){if(!d[i]){var s=cr(v[i],"Metadata Field",null,false,true);var o=ur(i,s,null,"7px").addClass("metadataField").attr("title",i);o.css({margin:"0%",padding:"1%",width:"98%"});$(o).children(":first").css({color:"white","font-style":"normal","vertical-align":"middle"});d[i]={field:o,input:s};o.show().data("visible",true);p.append(o)}}}})}var o={};var u=$(TAG.Util.UI.blockInteractionOverlay()).addClass("metadataPickerOverlay");var a=$(document.createElement("div")).addClass("metadataPicker");var f=$(document.createElement("div")).addClass("metadataPickerHeader").text("No match found. Please select the metadata you would like to import for '"+e.Name+"'.");var l=$(document.createElement("input")).addClass("metadataPickerSearchbar").attr("type","text");var c=$(document.createElement("div")).addClass("metadataLists");var h=$(document.createElement("div")).addClass("metadataInfos");var p=$(document.createElement("div")).addClass("metadataHolder");var d={};var v;var m;var g=0;var y;var b=r;var w=[];var E="";S();u.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);u.append(a);f.css({"text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"});TAG.Util.multiLineEllipsis(f);a.append(f);l.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")',"background-size":"auto 50%","background-repeat":"no-repeat","background-position":"8px center"});l.on("click focus",function(){l.css({"background-image":"none"})});l.on("blur focusout",function(){!l.val()&&l.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})});l.on("keyup",function(e){if(!l.val()){c.empty();for(var t=0;t<30;t++){if(t<w.length){var n=T(w[t].title||"Untitled",t)}else{break}if(t===0){n.click()}g++}}if(e.which===13){x()}});a.append(l);a.append(c);c.bind("scroll",function(){if($(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight){if(g<b.length){var e=g+30<=b.length?30:b.length-g;for(var t=0;t<e;t++){if(g<b.length){T(o[g],g);g++}}}}});a.append(h);h.append(p);var C=$(document.createElement("div")).attr("id","metadataPickerButtons").css({height:"5%",bottom:"7%",width:"100%",position:"absolute"});var k=$(document.createElement("button")).attr("id","metadataPickerCancel").css({"float":"right",position:"absolute","margin-right":"12%"}).css("border-radius","3.5px");k.text("Cancel");k.click(function(){u.fadeOut();$(".metadataInfos").empty();k.disabled=true});C.append(k);var L=$(document.createElement("button")).attr("id","metadataPickerImport").css({"float":"right",position:"absolute","margin-right":"2%"}).css("border-radius","3.5px");L.attr("disabled",true);if(v)L.attr("disabled",false);L.text("Import");L.click(function(){Rn(e,t,v,n,s);$(".metadataInfos").empty();u.fadeOut()});C.append(L);a.append(C);i.append(u);$(".parsingOverlay").fadeOut();u.fadeIn()}function zn(e){if(!e){return}Cr("Loading Artwork...",1);U.clear();clearTimeout(Lt);z.clear();setTimeout(function(){TAG.Util.UI.slidePageLeft(TAG.Layout.ArtworkEditor(e).getRoot())},1)}function Wn(e){var t=TAG.Util.UI.PopUpConfirmation(function(){Yn(false);Zn();er(true);TAG.Worktop.Database.deleteDoq(e.Identifier,function(){if(q&&q!==J[M.art.text]){return}_n()},kr,kr)},"Are you sure you want to delete "+e.Name+"?","Delete",true,function(){$(t).hide()});i.append(t);$(t).show();TAG.Util.multiLineEllipsis($($($(t).children()[0]).children()[0]))}function Xn(e,t){var n=t.nameInput.val(),r=t.artistInput.val(),i=t.yearInput.val(),s=t.monthInput.val(),o=t.dayInput.val(),u=t.timelineYearInput.val(),a=t.timelineMonthInput.val(),f=t.timelineDayInput.val(),l=t.descInput.val(),c=t.locked;var h={};$.each(t.customInputs,function(e,t){h[e]=t.val()});Zn();er(true);Yn(false,null,null,"Saving...");TAG.Worktop.Database.changeArtwork(e,{Name:n,Artist:r,Year:i,Month:s,Day:o,TimelineYear:u,TimelineMonth:a,TimelineDay:f,Description:l,Locked:c,InfoFields:JSON.stringify(h)},function(){if(q&&q!==J[M.art.text]){LADS.Worktop.Database.getMain();return}if(q&&q===J[M.art.text]){_n(D);return}},kr,jn(e,"Update",_n),Fn(_n))}function Vn(e,t){function i(){$.each(n,function(t,n){if(r)return false;U.add(function(){if(r)return;if(q&&q!==J[M.feedback.text]){return}var i;var o=$.datepicker.formatDate("(m/dd/yy) ",new Date(n.Metadata.Date*1e3))+n.Metadata.Feedback;if(!R&&(e&&n.Identifier===e||!e&&t===0)){s.before(ir(i=Gn(o,null,function(){$n(n);ht=t},n.Identifier,true)));if(p.scrollTop()===0&&i.offset().top-p.height()>0){p.animate({scrollTop:i.offset().top-p.height()/2},1e3)}R=i;pt=R;$n(n)}else{s.before(i=Gn(o,null,function(){$n(n);ht=t},n.Identifier,true))}})});U.add(function(){s.hide()})}bt=false;wt=false;Et=false;St=false;xt=false;Tt=true;gt=false;var n;ht=0;Yn(true,"");er(false);Zn();var r=false;if(typeof t!=="undefined"){n=t;i()}else{TAG.Worktop.Database.getFeedback(function(e){if(r)return;br(e);ct=e;On();n=e;i()})}W=function(){r=true}}function $n(e){Zn();er(true,e.Metadata.Feedback);ft=Qn;lt=e;var t=lr("Loading...");var n=lr($.datepicker.formatDate("DD, MM d, yy ",new Date(e.Metadata.Date*1e3)));var r=ur("Submitted From",t);var i=ur("Date",n);o.append(r);var s=e.Metadata.SourceType==="Exhibition"?"Collection":e.Metadata.SourceType;if(e.Metadata.SourceID){Jn(e,function(n){t.text(n+" ("+s+")");var o=fr(n+" ("+s+")",function(){Kn(e)});var u=ur("Submitted From",o);r.remove();i.prepend(u)},function(e){t.text(e+" ("+s+", Deleted)")},function(){t.text("Deleted")})}else{t.text(s+" Page (No "+s+" Selected)")}o.append(i);var u=fr("Delete Feedback",function(){Qn(e)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});vt=u;m.append(u)}function Jn(e,t,n,r){TAG.Worktop.Database.getDoq(e.Metadata.SourceID,function(e){if(e.Metadata.Deleted){n(e.Name)}else{t(e.Name)}},function(){r()})}function Kn(e){switch(e.Metadata.SourceType){case"Exhibition":case"Exhibitions":It("Exhibitions",e.Metadata.SourceID);break;case"Tour":case"Tours":It("Tours",e.Metadata.SourceID);break;case"Art":case"Artwork":case"Artworks":It("Artworks",e.Metadata.SourceID);break}}function Qn(e){Yn(false);Zn();TAG.Worktop.Database.deleteDoq(e.Identifier,function(){if(q&&q!==J[M.feedback.text]){return}Vn()},kr,jn(e),Fn(Vn))}function Gn(e,t,n,r,i,s,o,u){var a=$(document.createElement("div"));e=TAG.Util.htmlEntityDecode(e);a.attr("class","middleLabel");if(r){a.attr("id",r)}if(o){if(u.match(/mp4/)||u.match(/ogv/)||u.match(/webm/)||u.match(/avi/)||u.match(/mov/)){a.data("isVideoArtwork",true)}else{a.data("isStaticArtwork",true)}}a.mousedown(function(){a.css({background:k})});a.mouseup(function(){a.css({background:"transparent"})});a.mouseleave(function(){a.css({background:"transparent"})});a.click(function(){TAG.Util.removeYoutubeVideo();rr(".middleLabel");ir(a,!i);if(n){n()}R=a;pt=a});if(s){a.dblclick(s)}var f;var l=$(document.createElement("span"));l.css({display:"inline-block",height:"100%","vertical-align":"middle"});a.append(l);if(t){var c=$(document.createElement("div")).css({display:"inline-block","vertical-align":"middle",height:"100%",width:"20%",position:"relative",margin:"auto 3% auto 1%"});a.append(c);var h=$(document.createElement("img"));h.attr("src",t);h.css({margin:"auto auto auto",height:"auto","max-width":"100%","max-height":"100%",display:"block",position:"absolute",width:"auto",left:"0",right:"0",top:"0",bottom:"0"});c.append(h);var p={position:"absolute",left:"5%","z-index":"50",height:"auto",width:"10%",top:"20%"};var d=TAG.Util.showProgressCircle(a,p,"0px","0px",false);h.load(function(){TAG.Util.removeProgressCircle(d)});f="70%"}else{f="90%"}var v=$(document.createElement("div"));v.attr("class","labelText");v.css({width:f,"vertical-align":"middle"});if(!t){v.css({"padding-left":"4%"})}else{v.css({"padding-left":"2%"})}v.text(e);a.append(v);return a}function Yn(e,t,n,r){TAG.Util.removeYoutubeVideo();clearInterval(Lt);U.clear();p.empty();p.append(s);s.show();c.css("display","none");if(Ct){Nt.click()}if(!St){Nt.hide();f.css({width:"53%"});l.text(t);l.unbind("click").click(n);if(!t)l.hide();else l.show()}else{l.hide();f.css({width:"40%"});Nt.show()}R=null;if(W)W();if(r){s.children("label").text(r)}else{s.children("label").text("Loading...")}if(e){u.show();u.css("display","inline-block");f.css({"background-image":'url("'+tagPath+'/images/icons/Lens.svg")'})}else{u.hide()}}function Zn(){o.empty();m.empty();z.clear();$(".leftLoading").remove()}function er(e,t,n){TAG.Util.removeYoutubeVideo();v.empty();v.css("background","black");if(e){v.show();m.show();m.css({top:$(window).width()*N/100*1/T+"px","margin-top":"0.35%"});g.css({height:or()+"px"});if(t){var r=$(document.createElement("textarea"));if(typeof t=="string")t=t.replace(/<br \/>/g,"\n").replace(/<br>/g,"\n").replace(/<br\/>/g,"\n");r.val(t);r.css({padding:".5%",width:"100%",height:"100%","box-sizing":"border-box",margin:"0px"});r.attr("readonly","true");v.append(r);v.css("background","transparent")}else{v.css("background","black")}}else{v.hide();g.css({height:$(window).height()*C/100-L*1+"px"})}if(n===false){m.hide()}}function tr(e,t,n){nr(e,function(e){e.click()},t,n)}function nr(e,t,n,r){n=n||100;r=r||0;if(r>n)return;if($.contains(document.documentElement,$(e)[0])){t($(e))}else{z.add(function(){nr(e,t,n,r+1)})}}function rr(e){$(e).css("background","transparent");$.each($(e),function(e,t){if($(t).attr("disabled")==="disabled"){return}$(t).mousedown(function(){$(t).css({background:k})});$(t).mouseup(function(){$(t).css({background:"transparent"})});$(t).mouseleave(function(){$(t).css({background:"transparent"})})})}function ir(e,t){e.css("background",k);e.unbind("mousedown").unbind("mouseleave").unbind("mouseup");if(t){e.css("height","");e.children("div").css("white-space","");if(R){R.children("div").css("white-space","nowrap")}}return e}function sr(e){e.css({color:"gray"});e.unbind("mousedown").unbind("mouseleave").unbind("mouseup").unbind("click").attr("disabled",true);return e}function or(){var e=$(window).height()*C/100-($(window).width()*N/100*1/T+L*1+$(window).width()*N/100*.0285);return e}function ur(e,t,n,r,i){var s=$(document.createElement("div"));var o="4%";if(i){o="0%"}s.css({width:"100%","margin-bottom":o});var u=$(document.createElement("div"));u.css({width:n?45-(n-50)+"%":"45%",overflow:"hidden","text-overflow":"ellipsis","font-style":"italic",display:"inline-block","margin-left":r});u.text(e);if(n){n=n+"%"}else{n="50%"}t.css({width:n,"float":"right","margin-right":"3%","box-sizing":"border-box"});var a=$(document.createElement("div"));a.css("clear","both");s.append(u);s.append(t);s.append(a);return s}function ar(e,t){function x(e){if(!N(e)){return[""]}else{return["","January","February","March","April","May","June","July","August","September","October","November","December"]}}function T(e){var t=TAG.Util.parseDateToYear({year:e.attr("value")});if(t){if(t<0){return-t+" BCE"}else{return t}}else{return""}}function N(e){e=e.replace(/bce?/gi,"").replace(/ce/gi,"").replace(/ad/gi,"").replace(/,/g,"").replace(/\s/gi,"");if(e.search(/[^0-9]/)>0||e.length===0||e[0].search(/[0-9||-]/)<0){return false}else{return true}}function C(e,t,n){var r=[""],i,s,o;if(e===""){return r}i=new Date(TAG.Util.parseDateToYear({year:t.attr("value")}),n.dropDownOptions.indexOf(e),0);s=i.getDate();for(o=1;o<s+1;o++){r.push(o)}return r}function k(e,t,n){var r,i;e.empty();e.dropDownOptions=t;for(i=0;i<t.length;i++){r=$(document.createElement("option"));r.text(t[i]);r.attr("value",t[i]);e.append(r);t[i].selected=true}e.attr("value",n)}function L(e,t){if(e.dropDownOptions.length===1||t==="false"){e.css({"background-color":"gray",opacity:"0.3"});return false}else{e.css({"background-color":"white",opacity:"1"});return true}}var n,r,i,s,o,u=false,a,f,l=$(document.createElement("div")).addClass("timelineYearDiv"),c=$(document.createElement("div")).addClass("yearDiv"),h,p,d,v,m,g,y=false,b=true,w=$(document.createElement("div")).addClass("yearMetadataDiv"),E;n=cr(TAG.Util.htmlEntityDecode(e.Metadata.Year),"Enter valid year",100);var S=$(document.createElement("div"));r=pr(x(n.attr("value")),e.Metadata.Month);r.css("margin-right","0%");i=pr(C(r.attr("value"),n,r),e.Metadata.Day);i.css("margin-right","0%");s=e.Metadata.TimelineYear||T(n);o=cr(s,"Enter valid year",100);a=pr(x(o.attr("value")),e.Metadata.TimelineMonth);a.css("margin-right","0%");f=pr(C(a.attr("value"),o,a),e.Metadata.TimelineDay);f.css("margin-right","0%");n.attr("id","yearInput");n.focus(function(){if(n.val()==="Year"){n.select()}});r.focus(function(){if(r.val()==="Month"){r.select()}});i.focus(function(){if(i.val()==="Day"){i.select()}});o.focus(function(){if(o.val()==="Date on Timeline"){o.select()}});a.focus(function(){if(a.val()==="Month"){a.select()}});f.focus(function(){if(f.val()==="Day"){f.select()}});c.css({width:"100%",height:"20px"});h=ur("Year",n,60,null,true);h.css({width:"32%",display:"inline-block",position:"relative","float":"left"});p=ur("Month",r,60,null,true);p.css({width:"32%","padding-left":"1%",position:"relative",display:"inline-block","float":"left"});L(r);d=ur("Day",i,70,null,true);d.css({width:"30%","padding-left":"2%",position:"relative",display:"inline-block","float":"left"});L(i);c.append(h).append(p).append(d);l.css({width:"100%",height:"20px","padding-top":"2%"});v=ur("Date on Timeline",o,40);v.css({width:"44%",display:"inline-block",position:"relative","float":"left"});m=ur("Month",a,50);m.css({width:"25%","padding-left":"1%",position:"relative",display:"inline-block","float":"left"});L(a);g=ur("Day",f,60);g.css({width:"25%","padding-left":"2%",position:"relative",display:"inline-block","float":"left"});L(f);l.append(v).append(m).append(g);S.css({width:"60%",height:"10%",position:"relative","font-size":"70%","font-style":"italic",top:"-10px","white-space":"nowrap",display:"inline-block"});S.text("Year Format Examples:  2013, 800 BC, 17th century, 1415-1450");n.on("keyup",function(e){t(e)});o.on("keyup",function(e){t(e)});n.on("input",function(e){t(e);k(r,x(n.attr("value")),"");L(r);k(i,C(r.attr("value"),n,r));L(i);if(!u||o.val()===""){o.val(T(n));u=false;k(a,x(o.attr("value")));L(a);k(f,C(a.attr("value"),o,a));L(f)}y=false});r.change(function(){t();k(i,C(r.attr("value"),n,r),i.attr("value"));L(i);if(a.attr("value")===""){a.attr("value",r.attr("value"));k(f,C(a.attr("value"),o,a));L(f)}});i.change(function(){t();if(f.attr("value")===""&&f.dropDownOptions.length>1){f.attr("value",i.attr("value"))}});o.on("input",function(e){t(e);if(o.attr("value").length===0&&!y){o.val(T(n));a.val(r.attr("value"));f.val(i.attr("value"));y=true}u=true;if(o.attr("value").length>0&&!N(o.attr("value"))){b=false;o.css({"border-color":"red","border-width":"medium",opacity:"0.7"})}else{b=true;o.css({"border-color":"#a7b4ae","border-width":"thin",opacity:"1"})}k(a,x(o.attr("value")),"");L(a,b);k(f,C(a.attr("value"),o,a),"");L(f,b)});a.change(function(){t();k(f,C(a.attr("value"),o,a),f.attr("value"));L(f,true)});w.css({width:"100%"});w.append(c).append(S).append(l);E={yearMetadataDiv:w,yearInput:n,monthInput:r,dayInput:i,timelineYearInput:o,timelineMonthInput:a,timelineDayInput:f};return E}function fr(e,t,n,r){var i=$(document.createElement("button")).text(e).css("border-radius","3.5px");i.attr("type","button");i.attr("class","button");if(n){i.css(n)}i.click(t);if(r){i.prop("disabled",true);i.css("opacity","0.4")}return i}function lr(e){var t=$(document.createElement("label")).text(e||"");return t}function cr(e,t,n,r,i,s){var o=$(document.createElement("input")).val(e);s=s||false;if(s){o.on("keypress",function(e){return e.charCode>=48&&e.charCode<=57})}if(t){o.attr("placeholder",t)}o.attr("autocomplete","off");o.attr("spellcheck","false");o.addClass("searchBar");o.attr({type:"text",maxlength:n,readonly:!!i});return o}function hr(e,t,n,r){if(typeof e==="string"){e=e.replace(/<br \/>/g,"\n").replace(/<br>/g,"\n").replace(/<br\/>/g,"\n")}e=e.substring(0,2001);var s=$(document.createElement("textarea")).val(e).attr({id:"settingsViewTextarea",maxlength:r});s.css({overflow:"hidden"});nr(s,function(e){if(s[0].scrollHeight<=i.find("#setViewSettingsContainer").height()*.5){var t=s[0].scrollHeight}else{var t=i.find("#setViewSettingsContainer").height()*.5}$(s).css("height",t+"px")});s.on("keyup",function(){if(s[0].scrollHeight<=i.find("#setViewSettingsContainer").height()*.5){var e=s[0].scrollHeight}else{var e=i.find("#setViewSettingsContainer").height()*.5}$(s).css("height",e+"px")});return s}function pr(e,t){var n=$(document.createElement("select")),r,i;n.css({overflow:"scroll"});n.dropDownOptions=e;for(i=0;i<e.length;i++){r=$(document.createElement("option"));r.text(e[i]);r.attr("value",e[i]);n.append(r);e[i].selected=true}n.change(function(){});n.attr("value",t);return n}function dr(e,t,n,r){if(e.indexOf("#")!==-1){e=e.substring(1,e.length)}var i=$(document.createElement("input"));i.attr("type","text");var s=new jscolor.color(i[0],{});var o=TAG.Util.UI.colorToHex(e);i.val(e);s.fromString(e);if(n===".secondaryFont"){x=s}else{S=s}s.onImmediateChange=function(){if(n){mr(n,i.val())}if(t){vr(t,i.val(),r())}if(n!=".secondaryFont"){$("#serverInput").css("border-color","#"+i.val());$("#passwordInput").css("border-color","#"+i.val());$("#serverSubmit").css("border-color","#"+i.val());$("#passwordSubmit").css("border-color","#"+i.val())}};return i}function vr(e,t,n){$(e).css("background-color",TAG.Util.UI.hexToRGB(t)+n/100+")")}function mr(e,t){$(e).css({color:"#"+t})}function gr(e){var t=document.createElement("div");$(t).css({height:"100%",width:"100%","float":"left",position:"absolute","background-color":"white",opacity:"0",top:"0px",right:"0px","z-index":"499"});$(t).bind("click",function(){return false});$(e).append(t)}function yr(e){if(e.sort){e.sort(function(e,t){var n=e.Name.toLowerCase();var r=t.Name.toLowerCase();return n<r?-1:1})}}function br(e){if(e.sort){e.sort(function(e,t){var n=parseInt(e.Metadata.Date,10);var r=parseInt(t.Metadata.Date,10);if(n<r){return 1}else if(n>r){return-1}else{return 0}})}}function wr(e,t,n){$.each($(t),function(t,r){if($(r).attr("id")==="middleLoading")return;if(TAG.Util.searchString($(r).children(n).text(),e)){$(r).show()}else{$(r).hide()}})}function Er(e,t){$.each($(t),function(t,n){var r=$(n).data();var i=false;$.each(r,function(t,n){if(TAG.Util.searchString(n,e)){i=true}});if(i){$(n).show()}else{$(n).hide()}})}function Sr(e,t,n){e.keyup(function(){if(e.val().length>n){e.val(e.val().substring(0,n))}$(t).html(e.val().replace(/\n\r?/g,"<br />"))});e.keydown(function(){if(e.val().length>n){e.val(e.val().substring(0,n))}$(t).html(e.val().replace(/\n\r?/g,"<br />"))});e.change(function(){if(e.val().length>n){e.val(e.val().substring(0,n))}$(t).html(e.val().replace(/\n\r?/g,"<br />"))});return e}function xr(e,t,n,r){e.keyup(function(){var i=e.val().replace(/[^0-9]/g,"");i=Math.constrain(parseInt(i,10),t,n);if(isNaN(i))i=0;if(e.val()!==i+""){e.val(i)}if(r)r(i)});e.keydown(function(){var i=e.val().replace(/[^0-9]/g,"");i=Math.constrain(parseInt(i,10),t,n);if(isNaN(i))i=0;if(e.val()!==i+""){e.val(i)}if(r)r(i)});e.change(function(){var i=e.val().replace(/[^0-9]/g,"");i=Math.constrain(parseInt(i,10),t,n);if(isNaN(i))i=0;if(e.val()!==i+""){e.val(i)}if(r)r(i)})}function Tr(e){return Object.prototype.toString.apply(e)==="[object Array]"}function Nr(e,t,n,r){var s=[],o=[],u=[],a,f;TAG.Authoring.FileUploader(i,e,function(e,t){a=e;for(f=0;f<e.length;f++){s.push(e[f].displayName);var n=e[f].fileType.toLowerCase();if(e[f].contentType.match(/image/)){u.push("Image")}else if(e[f].contentType.match(/video/)||n===".avi"||n===".wmv"||n===".mov"||n===".mp4"||n===".webm"||n===".ogv"){u.push("Video")}else if(e[f].contentType.match(/audio/)){u.push("Audio")}else if(e[f].name.match(".woff")){u.push("Font")}}},function(e){if(!Tr(e)){e=[e];s=[s]}for(f=0;f<e.length;f++){console.log("urls["+f+"] = "+e[f]+", names["+f+"] = "+s[f])}t(e,s,u,a)},r||[".jpg",".png",".gif",".tif",".tiff",".woff"],false,function(){i.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},!!n)}function Cr(e,t){e=e||"Loading...";var n=$(document.createElement("div"));var t=t||.5;n.css({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","background-color":"rgba(0,0,0,"+t+")","z-index":"1000"});i.append(n);var r=$(document.createElement("img"));r.attr("src",tagPath+"images/icons/progress-circle.gif");r.css({height:"auto",width:"10%",position:"absolute",left:"45%",top:($(window).height()-$(window).width()*.1)/2+"px"});n.append(r);var s=$(document.createElement("div"));s.css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","font-size":"200%"});s.text(e);i.append(s);var o=$(document.createElement("label"));o.css({position:"absolute",left:($(window).width()-s.width())/2+"px",top:($(window).height()-$(window).width()*.1)/2+$(window).width()*.1+"px","font-size":"200%",color:"white"});s.remove();o.text(e);n.append(o)}function kr(){var e=TAG.Util.UI.popUpMessage(function(){TAG.Auth.clearToken();z.clear();U.clear();TAG.Layout.StartPage(null,function(e){TAG.Util.UI.slidePageRight(e)})},"Could not authenticate, returning to the splash page.",null,true);i.append(e);$(e).show()}function Fn(e){return function(){var t=TAG.Util.UI.popUpMessage(null,"An unknown error occured.",null,true);i.append(t);$(t).show();e&&e()}}function jn(e,t,n){return function(r,s){var o=TAG.Util.UI.PopUpConfirmation(function(){s.force()},"Your version of "+e.Name+" is not up to date.  Are you sure you want to change "+e.Name+"?",t,true,n);i.append(o);$(o).show();TAG.Util.multiLineEllipsis($($($(o).children()[0]).children()[0]))}}function Lr(){var e=$(document.createElement("button")).attr("id","addMenuLabel").appendTo(u).css({color:"black","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex,"float":"right","font-size":"50%",height:"40%","margin-top":"2.8%","padding-bottom":"1%",width:"48%",border:"1px solid black","padding-top":"-10%",display:"block"}).css("border-radius","3.5px");var t=$(document.createElement("img")).attr("id","addMenuArrowIcon").attr("src",tagPath+"images/icons/RightB.png").css({width:"6%",height:"70%",display:"inline-block","margin-right":"5%","-webkit-transform":"rotate(90deg)","-moz-transform":"rotate(90deg)","-o-transform":"rotate(90deg)","-ms-transform":"rotate(90deg)",transform:"rotate(90deg)","padding-left":"7%","padding-right":"0%"});var n=$(document.createElement("div")).css({width:"80%",height:"100%","text-align":"center","vertical-align":"middle",padding:"0px 10% 0px 10%"}).append($(document.createElement("div")).text("Add").css({display:"inline-block","margin-right":"5%"})).append(t).appendTo(e);var r=$(document.createElement("div")).attr("id","dropDown").appendTo(u).css({left:"52%",display:"block",position:"relative",color:"rgb(256, 256, 256)",width:"48%","background-color":"rgba(0,0,0,0.95)","float":"left",clear:"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex,border:"1px solid white"});r.hide();e.click(function(){if(Ct){$("#setViewMiddleLabelContainer").css("overflow","auto");e.css({"background-color":"transparent"});t.css({"-webkit-transform":"rotate(90deg)","-moz-transform":"rotate(90deg)","-o-transform":"rotate(90deg)","-ms-transform":"rotate(90deg)",transform:"rotate(90deg)","padding-left":"7%","padding-right":"0%"});r.hide()}else{e.css({"background-color":"white"});$("#setViewMiddleLabelContainer").css("overflow","hidden");t.css({"-webkit-transform":"rotate(270deg)","-moz-transform":"rotate(270deg)","-o-transform":"rotate(270deg)","-ms-transform":"rotate(270deg)",transform:"rotate(270deg)","padding-left":"0%","padding-right":"7%"});r.show()}Ct=!Ct});var i=$(document.createElement("label")).attr("id","fromFile").text("From File").css({display:"block","border-color":"white",color:"white","background-color":"black","border-width":"thin","border-bottom-style":"none","padding-left":"15px","padding-right":"15px","font-size":"85%","font-weight":"600","padding-bottom":"5%","padding-top":"5%"}).on("mouseenter",function(){i.css({"background-color":"white",color:"black","border-color":"black"})}).on("mouseleave",function(e){i.css({"background-color":"black",color:"white","border-color":"white"})}).click(function(){e.click();Tn()});var s=$(document.createElement("label")).attr("id","Embed Video").text("Embed Video").css({display:"block","border-color":"white",color:"white","background-color":"black","border-width":"thin","padding-left":"15px","padding-right":"15px","font-size":"85%","font-weight":"600","padding-bottom":"5%","padding-top":"5%"}).on("mouseenter",function(){s.css({"background-color":"white",color:"black","border-color":"black"})}).on("mouseleave",function(e){s.css({"background-color":"black",color:"white","border-color":"white"})}).click(function(){e.click();xn()});r.append(i);r.append(s);e.on("mousedown",function(){if(!Ct){e.css({"background-color":"white"})}});e.on("mouseleave",function(){if(!Ct){e.css({"background-color":"transparent"})}});return e}var i=TAG.Util.getHtmlAjax("../tagcore/html/SettingsView.html"),s=i.find("#setViewLoadingCircle"),o=i.find("#setViewSettingsContainer"),u=i.find("#setViewSearchContainer"),a=i.find("#setViewNavBar"),f=i.find("#setViewSearchBar"),l=i.find("#setViewNewButton"),c=i.find("#setViewSecondaryButton"),h=i.find("#setViewMiddleBar"),p=i.find("#setViewMiddleLabelContainer"),d=i.find("#setViewRightBar"),v=i.find("#setViewViewer"),m=i.find("#setViewButtonContainer"),g=i.find("#setViewSettingsBar"),y=i.find("#setViewLoadingLabel"),b=i.find("#setViewLoadingCircle"),w=i.find("#setViewRoot"),E=i.find("#iframeAssetCreateButton"),S,x,T=$(window).width()/$(window).height(),N="54",C="92",k="white",L="40",A="",O="Search by Name, Artist, or Year...",M={general:{text:"General Settings",subtext:"Customize TAG experience"},exhib:{text:"Collections",subtext:"Create and edit collections"},art:{text:"Artworks",subtext:"Import and manage artworks"},media:{text:"Associated Media",subtext:"Manage associated media"},tour:{text:"Tours",subtext:"Build interactive tours"},feedback:{text:"Feedback",subtext:"View comments and reports"}},_={getRoot:qt},D,P,H,B,j=0,F={},I={13:Dt,46:Pt,40:Bt,38:Ht},q,R,U=TAG.Util.createQueue(),z=TAG.Util.createQueue(),W,X,V=false,J=[],K=[],Q,G=[],Y=0,Z=false,et=false,tt=[],nt=[],rt=[],it=[],st,ot,ut=[],at,ft,lt,ct,ht=0,pt,dt,vt,mt=false,gt=false,yt=false,bt=false,wt=false,Et=false,St=false,xt=false,Tt=false,Nt=Lr(),Ct=false;TAG.Util.UI.initKeyHandler();TAG.Util.UI.getStack()[0]=I;var kt;l.on("mousedown",function(){l.css({"background-color":"white"})});var Lt;var At=null;Ft();if(t){t(_)}var _t=[];return _};TAG.Util.makeNamespace("TAG.Authoring.FileUploader");TAG.Authoring.FileUploadTypes={Standard:0,DeepZoom:1,AssociatedMedia:2,VideoArtwork:3,Map:4};TAG.Authoring.FileUploader=function(e,t,n,r,i,s,o,u,a){"use strict";function H(e,t,n,r){if(e.fileType===".mp3"){e.properties.getMusicPropertiesAsync().done(function(e){if(e.duration/1e3>N){n()}else if(e.duration/1e3<C){r()}else{t()}},n)}else if(e.fileType.toLowerCase()===".mp4"){e.properties.getVideoPropertiesAsync().done(function(e){if(e.duration/1e3>N){n()}else if(e.duration/1e3<C){r()}else{t()}},n)}else{t()}}function B(e,t){function i(t){H(e[t],function(){r++;if(r===e.length)s();else i(t++)},function(){n.push(t);A.push(e[t]);r++;if(r===e.length)s();else i(t++)},function(){n.push(t);O.push(e[t]);r++;if(r===e.length)s();else i(t++)})}function s(){n.sort(function(e,t){return t-e});for(var r=0;r<n.length;r++){e.splice(n[r],1)}t()}var n=[];var r=0;if(e.length===0){t();return}i(0)}function j(e,t){return function(){t.start(e)}}function F(e,t,r){return function(){n(e,t,r)}}function I(e){if($("#uploadingOverlay").length===0){e.append(l)}}function q(){l.remove()}function R(){var t=null,n=null;this.start=function(r){var i,s;var o=m[r],u=g[r];try{I(e);l.show();i=new Windows.Foundation.Uri(o);s=new Windows.Networking.BackgroundTransfer.BackgroundUploader;s.setRequestHeader("Filename",u.name);s.setRequestHeader("Content-Type","multipart/form-data; boundary=----WebKitFormBoundaryqj1e7E6nvkEBR9N5");t=s.createUpload(i,u);var a=t.guid;E[a]=0;u.getBasicPropertiesAsync().then(function(e){k=e.size;n=t.startAsync().then(U(r),X,V);S.push(n)})}catch(f){q();console.log(f.message)}};this.load=function(e){try{t=e;n=t.attachAsync().then(z,X,V(t))}catch(r){q();if(o)o()}}}function U(e){return function(t){z(t,e)}}function z(e,t){var n=e.getResponseInformation(),r=e.getResultStreamAt(0),i=new Windows.Storage.Streams.DataReader(r),s=i.loadAsync(1e7);s.operation.completed=function(){var e=i.readString(i.unconsumedBufferLength);d.push($.trim(e));W()};if(t<p-1){j(t+1,y)()}}function W(){h+=1;if(h===p){q();r(d);var e="",t,n,i;var s=false;var o;if(L!==""){e="The following file(s) exceeded the 50MB file limit:"+L}if(A.length){s=true;n=Math.floor(N/60);i=N%60;if(i===0){i="00"}else if(i<=9){i="0"+i}t="The following file(s) exceeded the "+n+":"+i+" duration limit:<br />";for(o=0;o<A.length;o++){t=t+A[o].name+"<br />"}e=e+t}if(O.length){if(s){e=e+"<br />"}n=Math.floor(C/60);i=C%60;if(i===0){i="00"}else if(i<=9){i="0"+i}t="The following file(s) are shorter than the "+n+":"+i+" lower duration limit:<br />";for(o=0;o<O.length;o++){t=t+O[o].name+"<br />"}e=e+t}if(e){var u=G(null,e,null,false,true);$(u).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(u);$(u).fadeIn(500)}}}function X(e){var t=false,n;if(e.message.split(" ")[0]==="Unauthorized"){q();console.log("unauthorized");TAG.Auth.authenticate(function(){if(T){T(x)}},function(){t=true;n=TAG.Util.UI.popUpMessage(null,"File(s) not uploaded. You must login to upload files.");$("body").append(n);$(n).show()})}else{q();console.log("internal server error: possibly not enough RAM on the server VM to handle this upload");n=TAG.Util.UI.popUpMessage(null,"A server error occurred. This image may need to be uploaded into TAG directly through the server. Contact server administrator for more information.");$("body").append(n);$(n).show()}if(t){console.log("file upload error: "+e.message);console.log(e.message);q();if(o){o()}}}function V(e){var t=a||c;w[e.guid]=e.progress.totalBytesToSend;var n=e.progress.bytesSent;E[e.guid]=n;var r=0;for(var i in E){if(w[i]){r+=E[i]/(w[i]*p)}}t.width(r*90+"%")}function J(){var e;for(e=0;e<S.length;e++){S[e].cancel()}}function K(e){N=e}function Q(e){C=e}function G(e,t,n,r,i){function c(){if(r){$(s).hide();$(s).remove()}else{$(s).fadeOut(500,function(){$(s).remove()})}}var s=TAG.Util.UI.blockInteractionOverlay();var o=document.createElement("div");var u=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:true,center_v:true,width:.5,height:.35,max_width:560,max_height:200});$(o).css({position:"absolute",left:u.x+"px",top:u.y+"px",width:u.width+"px",height:u.height+"px",border:"3px double white","background-color":"black"});var a=document.createElement("div");$(a).css({color:"white",width:"90%",height:"57.5%",left:"5%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word","overflow-y":"auto"});if(i){$(a).html(t)}else{$(a).text(t)}var f=document.createElement("div");$(f).addClass("optionButtonDiv");$(f).css({height:"30%",width:"98%",position:"absolute",bottom:"0%",right:"2%"});var l=document.createElement("button");$(l).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%","margin-top":"0%"});n=!n||n===""?"OK":n;$(l).text(n);l.onclick=function(){if(e)e();c()};$(f).append(l);$(o).append(a);$(o).append(f);$(s).append(o);return s}var f={};i=i||["*"];u=u||false;var l=$(document.createElement("div")),c=$(document.createElement("div"));var h=0;var p=1e5;var d=[];var v=TAG.Util.createQueue();var m=[],g=[],y=null;var b=0;var w={};var E={};var S=[];var x;var T;var N=Infinity;var C=-1;var k;var L="";var A=[];var O=[];var M;var _=50*1024*1024;var D=80*1024*1024;var P=250*1024*1024;(function(){var n=$(document.createElement("label")),r=$(document.createElement("img")),i=$(document.createElement("div"));l.attr("id","uploadingOverlay");l.css({position:"absolute",left:"0%",top:"0%","background-color":"rgba(0, 0, 0, .5)",width:"100%",height:"100%","z-index":100000100});n.css({color:"white",width:"10%",height:"5%",top:"38%",left:"40%",position:"relative","font-size":"100%"});n.text("Uploading file(s). Please wait.");r.css({position:"relative",top:"50%",left:"14%"});r.attr("src","images/icons/progress-circle.gif");i.css({position:"relative",top:"42%",left:"45%","border-style":"solid","border-color":"white",width:"10%",height:"2%"});c.css({"background-color":"white",width:"0%",height:"100%"});i.append(c);l.append(n);l.append(i);l.hide();e.append(l)})();(function(){var r=Windows.UI.ViewManagement.ApplicationView.value;var f=new Windows.Storage.Pickers.FileOpenPicker;if(s){f.viewMode=Windows.Storage.Pickers.PickerViewMode.thumbnail}else{f.viewMode=Windows.Storage.Pickers.PickerViewMode.list}f.fileTypeFilter.replaceAll(i);f.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.desktop;try{if(u){f.pickMultipleFilesAsync().then(T=function(e){function d(o,a){o.getBasicPropertiesAsync().then(function(f){k=f.size;p=u.length;var l;switch(t){case TAG.Authoring.FileUploadTypes.VideoArtwork:case TAG.Authoring.FileUploadTypes.AssociatedMedia:case TAG.Authoring.FileUploadTypes.Standard:l=_;break;case TAG.Authoring.FileUploadTypes.DeepZoom:if(o.fileType===".mp4"||o.fileType===".ogv"||o.fileType===".webm"||o.fileType===".mov"||o.fileType===".avi"||o.fileType===".wmv"){l=D;break};case TAG.Authoring.FileUploadTypes.Map:l=P;break}if(k<l){u.push(o);s.push(window.URL.createObjectURL(o,{oneTimeOnly:true}));var c=o.fileType.toLowerCase();switch(t){case TAG.Authoring.FileUploadTypes.VideoArtwork:r.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+o.fileType.substr(1));break;case TAG.Authoring.FileUploadTypes.AssociatedMedia:r.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadAssociatedMedia&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+o.fileType.substr(1));break;case TAG.Authoring.FileUploadTypes.Standard:r.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUpload&Client=Windows&token="+TAG.Auth.getToken()+"&Extension="+o.fileType.substr(1));break;case TAG.Authoring.FileUploadTypes.DeepZoom:if(c===".mp4"||c===".webm"||c===".avi"||c===".mov"||c===".ogv"||c===".wmv"){r.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+o.fileType.substr(1))}else{r.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadDeepzoom&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+o.fileType.substr(1))}break;case TAG.Authoring.FileUploadTypes.Map:r.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadMap&Client=Windows&token="+TAG.Auth.getToken()+"&Extension="+o.fileType.substr(1));break}}else{L+="<br />"+o.name}if(a<e.length-1){d(e[a+1],a+1)}else if(a===e.length-1){B(u,function(){var e,t;q();F([],[])();if(u.length===0&&L!==""){M=G(null,"The selected file(s) could not be uploaded because they exceed the 50MB file limit.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500);return}else if(u.length===0&&A.length>0&&o.fileType!==".webm"&&o.fileType!==".ogv"){e=Math.floor(N/60);t=N%60;if(t===0)t="00";else if(t<=9)t="0"+t;M=G(null,"The selected file(s) could not uploaded because they exceed "+e+":"+t+" in length.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500);return}else if(u.length===0&&O.length>0&&o.fileType!==".webm"&&o.fileType!==".ogv"){e=Math.floor(C/60);t=C%60;if(t===0)t="00";else if(t<=9)t="0"+t;M=G(null,"The selected file(s) could not uploaded because they are shorter than "+e+":"+t+" in length.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500);return}else if(u.length===0&&o.fileType!==".webm"&&o.fileType!==".ogv"){e=Math.floor(N/60);t=N%60;if(t===0)t="00";else if(t<=9)t="0"+t;M=G(null,"The selected file(s) could not be uploaded because they exceed the 50MB file limit or exceed the "+e+":"+t+" duration limit.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500);return}g=u;p=u.length;m=r;y=i;var a=n(u,s,j(0,i),function(){M=G(null,"uploading canceled due to the unsupported format",null);$(M).css("z-index",LADS.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500)});if(a!=="uploading test!"){j(0,i)()}})}})}var r=[],i=new R,s=[],o,u=[],f,l;x=e;w={};E={};L="";A=[];O=[];var h=a||c;h.width("0%");if(e.length===0){q();F([],[])();return}d(e[0],0)})}else{f.pickSingleFileAsync().then(function(e){if(!e){q();F([],[],[])()}else{e.getBasicPropertiesAsync().then(function(r){k=r.size;var i;switch(t){case TAG.Authoring.FileUploadTypes.VideoArtwork:case TAG.Authoring.FileUploadTypes.AssociatedMedia:case TAG.Authoring.FileUploadTypes.Standard:i=_;break;case TAG.Authoring.FileUploadTypes.DeepZoom:case TAG.Authoring.FileUploadTypes.Map:i=P;break}if(k<i){H(e,function(){var r,i=new R,s;g=[e];p=1;s=window.URL.createObjectURL(e,{oneTimeOnly:true});var o=e.fileType.toLowerCase();switch(t){case TAG.Authoring.FileUploadTypes.VideoArtwork:r=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&Token="+TAG.Auth.getToken()+"&Extension="+e.fileType.substr(1);break;case TAG.Authoring.FileUploadTypes.AssociatedMedia:r=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadAssociatedMedia&Client=Windows&ReturnDoq=true&Token="+TAG.Auth.getToken()+"&Extension="+e.fileType.substr(1);break;case TAG.Authoring.FileUploadTypes.Standard:r=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUpload&Client=Windows&Token="+TAG.Auth.getToken()+"&Extension="+e.fileType.substr(1);break;case TAG.Authoring.FileUploadTypes.DeepZoom:if(o===".mp4"||o===".webm"||o===".avi"||o===".mov"||o===".ogv"||o===".wmv"){r=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&Token="+TAG.Auth.getToken()+"&Extension="+e.fileType.substr(1)}else{r=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadDeepzoom&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+e.fileType.substr(1)}break;case TAG.Authoring.FileUploadTypes.Map:r=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadMap&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+e.fileType.substr(1);break}m=[r];y=i;var u;if(typeof (u=n([e],[s],[r]))==="string"){M=G(null,u,null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500)}else{i.start(0)}},function(){var e=Math.floor(N/60);var t=N%60;if(t===0)t="00";else if(t<=9)t="0"+t;M=G(null,"The selected file exceeded the "+e+":"+t+" duration limit and could not be uploaded.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500)},function(){var e=Math.floor(C/60);var t=C%60;if(t===0)t="00";else if(t<=9)t="0"+t;M=G(null,"The selected file is shorter than the "+e+":"+t+" lower duration limit and could not be uploaded.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500)})}else{M=G(null,"The selected file exceeded the 50MB file limit and could not be uploaded.",null);$(M).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3);$("body").append(M);$(M).fadeIn(500)}})}})}}catch(l){console.log("file access failed: "+l.message);if(o)o()}})();f.cancelPromises=J;f.setMaxDuration=K;f.setMinDuration=Q;return f};var jscolor={dir:"",bindClass:"color",binding:true,preloading:true,install:function(){},init:function(){if(jscolor.binding){jscolor.bind()}if(jscolor.preloading){jscolor.preload()}},getDir:function(){if(!jscolor.dir){var e=jscolor.detectDir();jscolor.dir=e!==false?e:tagPath+"js/TAG/authoring/jscolor/"}return jscolor.dir},detectDir:function(){var e=location.href;var t=document.getElementsByTagName("base");for(var n=0;n<t.length;n+=1){if(t[n].href){e=t[n].href}}var t=document.getElementsByTagName("script");for(var n=0;n<t.length;n+=1){if(t[n].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(t[n].src)){var r=new jscolor.URI(t[n].src);var i=r.toAbsolute(e);i.path=i.path.replace(/[^\/]+$/,"");i.query=null;i.fragment=null;return i.toString()}}return false},bind:function(){var matchClass=new RegExp("(^|\\s)("+jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i");var e=document.getElementsByTagName("input");for(var i=0;i<e.length;i+=1){var m;if(!e[i].color&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3]){try{eval("prop="+m[3])}catch(eInvalidProp){}}e[i].color=new jscolor.color(e[i],prop)}}},preload:function(){for(var e in jscolor.imgRequire){if(jscolor.imgRequire.hasOwnProperty(e)){jscolor.loadImage(e)}}},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(e){jscolor.imgRequire[e]=true},loadImage:function(e){if(!jscolor.imgLoaded[e]){jscolor.imgLoaded[e]=new Image;jscolor.imgLoaded[e].src=jscolor.getDir()+e}},fetchElement:function(e){return typeof e==="string"?document.getElementById(e):e},addEvent:function(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}},fireEvent:function(e,t){if(!e){return}if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(t,true,true);e.dispatchEvent(n)}else if(document.createEventObject){var n=document.createEventObject();e.fireEvent("on"+t,n)}else if(e["on"+t]){e["on"+t]()}},getElementPos:function(e){var t=e,n=e;var r=0,i=0;if(t.offsetParent){do{r+=t.offsetLeft;i+=t.offsetTop}while(t=t.offsetParent)}while((n=n.parentNode)&&n.nodeName.toUpperCase()!=="BODY"){r-=n.scrollLeft;i-=n.scrollTop}return[r,i]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var t=0,n=0;if(!e){e=window.event}if(typeof e.offsetX==="number"){t=e.offsetX;n=e.offsetY}else if(typeof e.layerX==="number"){t=e.layerX;n=e.layerY}return{x:t,y:n}},getViewPos:function(){if(typeof window.pageYOffset==="number"){return[window.pageXOffset,window.pageYOffset]}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){return[document.body.scrollLeft,document.body.scrollTop]}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){return[document.documentElement.scrollLeft,document.documentElement.scrollTop]}else{return[0,0]}},getViewSize:function(){if(typeof window.innerWidth==="number"){return[window.innerWidth,window.innerHeight]}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){return[document.body.clientWidth,document.body.clientHeight]}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){return[document.documentElement.clientWidth,document.documentElement.clientHeight]}else{return[0,0]}},URI:function(e){function t(e){var t="";while(e){if(e.substr(0,3)==="../"||e.substr(0,2)==="./"){e=e.replace(/^\.+/,"").substr(1)}else if(e.substr(0,3)==="/./"||e==="/."){e="/"+e.substr(3)}else if(e.substr(0,4)==="/../"||e==="/.."){e="/"+e.substr(4);t=t.replace(/\/?[^\/]*$/,"")}else if(e==="."||e===".."){e=""}else{var n=e.match(/^\/?[^\/]*/)[0];e=e.substr(n.length);t=t+n}}return t}this.scheme=null;this.authority=null;this.path="";this.query=null;this.fragment=null;this.parse=function(e){var t=e.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);this.scheme=t[3]?t[2]:null;this.authority=t[5]?t[6]:null;this.path=t[7];this.query=t[9]?t[10]:null;this.fragment=t[12]?t[13]:null;return this};this.toString=function(){var e="";if(this.scheme!==null){e=e+this.scheme+":"}if(this.authority!==null){e=e+"//"+this.authority}if(this.path!==null){e=e+this.path}if(this.query!==null){e=e+"?"+this.query}if(this.fragment!==null){e=e+"#"+this.fragment}return e};this.toAbsolute=function(e){var e=new jscolor.URI(e);var n=this;var r=new jscolor.URI;if(e.scheme===null){return false}if(n.scheme!==null&&n.scheme.toLowerCase()===e.scheme.toLowerCase()){n.scheme=null}if(n.scheme!==null){r.scheme=n.scheme;r.authority=n.authority;r.path=t(n.path);r.query=n.query}else{if(n.authority!==null){r.authority=n.authority;r.path=t(n.path);r.query=n.query}else{if(n.path===""){r.path=e.path;if(n.query!==null){r.query=n.query}else{r.query=e.query}}else{if(n.path.substr(0,1)==="/"){r.path=t(n.path)}else{if(e.authority!==null&&e.path===""){r.path="/"+n.path}else{r.path=e.path.replace(/[^\/]+$/,"")+n.path}r.path=t(r.path)}r.query=n.query}r.authority=e.authority}r.scheme=e.scheme}r.fragment=n.fragment;return r};if(e){this.parse(e)}},color:function(target,prop){function RGB_HSV(e,t,n){var r=Math.min(Math.min(e,t),n);var i=Math.max(Math.max(e,t),n);var s=i-r;if(s===0){return[null,0,i]}var o=e===r?3+(n-t)/s:t===r?5+(e-n)/s:1+(t-e)/s;return[o===6?0:o,s/i,i]}function HSV_RGB(e,t,n){if(e===null){return[n,n,n]}var r=Math.floor(e);var i=r%2?e-r:1-(e-r);var s=n*(1-t);var o=n*(1-t*i);switch(r){case 6:case 0:return[n,o,s];case 1:return[o,n,s];case 2:return[s,n,o];case 3:return[s,o,n];case 4:return[o,s,n];case 5:return[n,s,o]}}function removePicker(){delete jscolor.picker.owner;document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function drawPicker(e,t){function a(){var e=THIS.pickerInsetColor.split(/\s+/);var t=e.length<2?e[0]:e[1]+" "+e[0]+" "+e[0]+" "+e[1];s.btn.style.borderColor=t}if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(THIS.pickerCloseText)};for(var n=0,r=4;n<jscolor.images.sld[1];n+=r){var i=document.createElement("div");i.style.height=r+"px";i.style.fontSize="1px";i.style.lineHeight="0";jscolor.picker.sld.appendChild(i)}jscolor.picker.sldB.appendChild(jscolor.picker.sld);jscolor.picker.box.appendChild(jscolor.picker.sldB);jscolor.picker.box.appendChild(jscolor.picker.sldM);jscolor.picker.padB.appendChild(jscolor.picker.pad);jscolor.picker.box.appendChild(jscolor.picker.padB);jscolor.picker.box.appendChild(jscolor.picker.padM);jscolor.picker.btnS.appendChild(jscolor.picker.btnT);jscolor.picker.btn.appendChild(jscolor.picker.btnS);jscolor.picker.box.appendChild(jscolor.picker.btn);jscolor.picker.boxB.appendChild(jscolor.picker.box)}var s=jscolor.picker;s.box.onmouseup=s.box.onmouseout=function(){target.focus()};s.box.onmousedown=function(){abortBlur=true};s.box.onmousemove=function(e){if(holdPad||holdSld){holdPad&&setPad(e);holdSld&&setSld(e);if(document.selection){document.selection.empty()}else if(window.getSelection){window.getSelection().removeAllRanges()}dispatchImmediateChange()}};s.padM.onmouseup=s.padM.onmouseout=function(){if(holdPad){holdPad=false;jscolor.fireEvent(valueElement,"change")}};s.padM.onmousedown=function(e){switch(modeID){case 0:if(THIS.hsv[2]===0){THIS.fromHSV(null,null,1)}break;case 1:if(THIS.hsv[1]===0){THIS.fromHSV(null,1,null)}break}holdPad=true;setPad(e);dispatchImmediateChange()};s.sldM.onmouseup=s.sldM.onmouseout=function(){if(holdSld){holdSld=false;jscolor.fireEvent(valueElement,"change")}};s.sldM.onmousedown=function(e){holdSld=true;setSld(e);dispatchImmediateChange()};var o=getPickerDims(THIS);s.box.style.width=o[0]+"px";s.box.style.height=o[1]+"px";s.boxB.style.position="absolute";s.boxB.style.clear="both";s.boxB.style.left=e+"px";s.boxB.style.top=t+"px";s.boxB.style.zIndex=THIS.pickerZIndex;s.boxB.style.border=THIS.pickerBorder+"px solid";s.boxB.style.borderColor=THIS.pickerBorderColor;s.boxB.style.background=THIS.pickerFaceColor;s.pad.style.width=jscolor.images.pad[0]+"px";s.pad.style.height=jscolor.images.pad[1]+"px";s.padB.style.position="absolute";s.padB.style.left=THIS.pickerFace+"px";s.padB.style.top=THIS.pickerFace+"px";s.padB.style.border=THIS.pickerInset+"px solid";s.padB.style.borderColor=THIS.pickerInsetColor;s.padM.style.position="absolute";s.padM.style.left="0";s.padM.style.top="0";s.padM.style.width=THIS.pickerFace+2*THIS.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px";s.padM.style.height=s.box.style.height;s.padM.style.cursor="crosshair";s.sld.style.overflow="hidden";s.sld.style.width=jscolor.images.sld[0]+"px";s.sld.style.height=jscolor.images.sld[1]+"px";s.sldB.style.display=THIS.slider?"block":"none";s.sldB.style.position="absolute";s.sldB.style.right=THIS.pickerFace+"px";s.sldB.style.top=THIS.pickerFace+"px";s.sldB.style.border=THIS.pickerInset+"px solid";s.sldB.style.borderColor=THIS.pickerInsetColor;s.sldM.style.display=THIS.slider?"block":"none";s.sldM.style.position="absolute";s.sldM.style.right="0";s.sldM.style.top="0";s.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+THIS.pickerFace+2*THIS.pickerInset+"px";s.sldM.style.height=s.box.style.height;try{s.sldM.style.cursor="pointer"}catch(u){s.sldM.style.cursor="hand"}s.btn.style.display=THIS.pickerClosable?"block":"none";s.btn.style.position="absolute";s.btn.style.left=THIS.pickerFace+"px";s.btn.style.bottom=THIS.pickerFace+"px";s.btn.style.padding="0 15px";s.btn.style.height="18px";s.btn.style.border=THIS.pickerInset+"px solid";a();s.btn.style.color=THIS.pickerButtonColor;s.btn.style.font="12px sans-serif";s.btn.style.textAlign="center";try{s.btn.style.cursor="pointer"}catch(u){s.btn.style.cursor="hand"}s.btn.onmousedown=function(){THIS.hidePicker()};s.btnS.style.lineHeight=s.btn.style.height;switch(modeID){case 0:var f="hs.png";break;case 1:var f="hv.png";break}s.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')";s.padM.style.backgroundRepeat="no-repeat";s.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')";s.sldM.style.backgroundRepeat="no-repeat";s.pad.style.backgroundImage="url('"+jscolor.getDir()+f+"')";s.pad.style.backgroundRepeat="no-repeat";s.pad.style.backgroundPosition="0 0";redrawPad();redrawSld();jscolor.picker.owner=THIS;document.getElementsByTagName("body")[0].appendChild(s.boxB)}function getPickerDims(e){var t=[2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[0]+(e.slider?2*e.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),e.pickerClosable?4*e.pickerInset+3*e.pickerFace+jscolor.images.pad[1]+e.pickerButtonHeight:2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[1]];return t}function redrawPad(){switch(modeID){case 0:var e=1;break;case 1:var e=2;break}var t=Math.round(THIS.hsv[0]/6*(jscolor.images.pad[0]-1));var n=Math.round((1-THIS.hsv[e])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.cross[0]/2)+"px "+(THIS.pickerFace+THIS.pickerInset+n-Math.floor(jscolor.images.cross[1]/2))+"px";var r=jscolor.picker.sld.childNodes;switch(modeID){case 0:var i=HSV_RGB(THIS.hsv[0],THIS.hsv[1],1);for(var s=0;s<r.length;s+=1){r[s].style.backgroundColor="rgb("+i[0]*(1-s/r.length)*100+"%,"+i[1]*(1-s/r.length)*100+"%,"+i[2]*(1-s/r.length)*100+"%)"}break;case 1:var i,o,u=[THIS.hsv[2],0,0];var s=Math.floor(THIS.hsv[0]);var a=s%2?THIS.hsv[0]-s:1-(THIS.hsv[0]-s);switch(s){case 6:case 0:i=[0,1,2];break;case 1:i=[1,0,2];break;case 2:i=[2,0,1];break;case 3:i=[2,1,0];break;case 4:i=[1,2,0];break;case 5:i=[0,2,1];break}for(var s=0;s<r.length;s+=1){o=1-1/(r.length-1)*s;u[1]=u[0]*(1-o*a);u[2]=u[0]*(1-o);r[s].style.backgroundColor="rgb("+u[i[0]]*100+"%,"+u[i[1]]*100+"%,"+u[i[2]]*100+"%)"}break}}function redrawSld(){switch(modeID){case 0:var e=2;break;case 1:var e=1;break}var t=Math.round((1-THIS.hsv[e])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.arrow[1]/2))+"px"}function isPickerOwner(){return jscolor.picker&&jscolor.picker.owner===THIS}function blurTarget(){if(valueElement===target){THIS.importColor()}if(THIS.pickerOnfocus){THIS.hidePicker()}}function blurValue(){if(valueElement!==target){THIS.importColor()}}function setPad(e){var t=jscolor.getRelMousePos(e);var n=t.x-THIS.pickerFace-THIS.pickerInset;var r=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(n*(6/(jscolor.images.pad[0]-1)),1-r/(jscolor.images.pad[1]-1),null,leaveSld);break;case 1:THIS.fromHSV(n*(6/(jscolor.images.pad[0]-1)),null,1-r/(jscolor.images.pad[1]-1),leaveSld);break}}function setSld(e){var t=jscolor.getRelMousePos(e);var n=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(null,null,1-n/(jscolor.images.sld[1]-1),leavePad);break;case 1:THIS.fromHSV(null,1-n/(jscolor.images.sld[1]-1),null,leavePad);break}}function dispatchImmediateChange(){if(THIS.onImmediateChange){if(typeof THIS.onImmediateChange==="string"){eval(THIS.onImmediateChange)}else{THIS.onImmediateChange(THIS)}}}this.required=true;this.adjust=true;this.hash=false;this.caps=true;this.slider=true;this.valueElement=target;this.styleElement=target;this.onImmediateChange=null;this.hsv=[0,0,1];this.rgb=[1,1,1];this.pickerOnfocus=true;this.pickerMode="HSV";this.pickerPosition="bottom";this.pickerSmartPosition=true;this.pickerButtonHeight=20;this.pickerClosable=false;this.pickerCloseText="Close";this.pickerButtonColor="ButtonText";this.pickerFace=10;this.pickerFaceColor="ThreeDFace";this.pickerBorder=1;this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight";this.pickerInset=1;this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow";this.pickerZIndex=1e4;for(var p in prop){if(prop.hasOwnProperty(p)){this[p]=prop[p]}}this.hidePicker=function(){if(isPickerOwner()){removePicker()}};this.showPicker=function(){if(!isPickerOwner()){var e=jscolor.getElementPos(target);var t=jscolor.getElementSize(target);var n=jscolor.getViewPos();var r=jscolor.getViewSize();var i=getPickerDims(this);var s,o,u;switch(this.pickerPosition.toLowerCase()){case"left":s=1;o=0;u=-1;break;case"right":s=1;o=0;u=1;break;case"top":s=0;o=1;u=-1;break;default:s=0;o=1;u=1;break}var a=(t[o]+i[o])/2;if(!this.pickerSmartPosition){var f=[e[s],e[o]+t[o]-a+a*u]}else{var f=[-n[s]+e[s]+i[s]>r[s]?-n[s]+e[s]+t[s]/2>r[s]/2&&e[s]+t[s]-i[s]>=0?e[s]+t[s]-i[s]:e[s]:e[s],-n[o]+e[o]+t[o]+i[o]-a+a*u>r[o]?-n[o]+e[o]+t[o]/2>r[o]/2&&e[o]+t[o]-a-a*u>=0?e[o]+t[o]-a-a*u:e[o]+t[o]-a+a*u:e[o]+t[o]-a+a*u>=0?e[o]+t[o]-a+a*u:e[o]+t[o]-a-a*u]}drawPicker(f[s],f[o])}};this.importColor=function(){if(!valueElement){this.exportColor()}else{if(!this.adjust){if(!this.fromString(valueElement.value,leaveValue)){styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage;styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor;styleElement.style.color=styleElement.jscStyle.color;this.exportColor(leaveValue|leaveStyle)}}else if(!this.required&&/^\s*$/.test(valueElement.value)){valueElement.value="";styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage;styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor;styleElement.style.color=styleElement.jscStyle.color;this.exportColor(leaveValue|leaveStyle)}else if(this.fromString(valueElement.value)){}else{this.exportColor()}}};this.exportColor=function(e){if(!(e&leaveValue)&&valueElement){var t=this.toString();if(this.caps){t=t.toUpperCase()}if(this.hash){t="#"+t}valueElement.value=t}if(!(e&leaveStyle)&&styleElement){styleElement.style.backgroundImage="none";styleElement.style.backgroundColor="#"+this.toString();styleElement.style.color=.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]<.5?"#FFF":"#000"}if(!(e&leavePad)&&isPickerOwner()){redrawPad()}if(!(e&leaveSld)&&isPickerOwner()){redrawSld()}};this.fromHSV=function(e,t,n,r){e<0&&(e=0)||e>6&&(e=6);t<0&&(t=0)||t>1&&(t=1);n<0&&(n=0)||n>1&&(n=1);this.rgb=HSV_RGB(e===null?this.hsv[0]:this.hsv[0]=e,t===null?this.hsv[1]:this.hsv[1]=t,n===null?this.hsv[2]:this.hsv[2]=n);this.exportColor(r)};this.fromRGB=function(e,t,n,r){e<0&&(e=0)||e>1&&(e=1);t<0&&(t=0)||t>1&&(t=1);n<0&&(n=0)||n>1&&(n=1);var i=RGB_HSV(e===null?this.rgb[0]:this.rgb[0]=e,t===null?this.rgb[1]:this.rgb[1]=t,n===null?this.rgb[2]:this.rgb[2]=n);if(i[0]!==null){this.hsv[0]=i[0]}if(i[2]!==0){this.hsv[1]=i[1]}this.hsv[2]=i[2];this.exportColor(r)};this.fromString=function(e,t){var n=e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);if(!n){return false}else{if(n[1].length===6){this.fromRGB(parseInt(n[1].substr(0,2),16)/255,parseInt(n[1].substr(2,2),16)/255,parseInt(n[1].substr(4,2),16)/255,t)}else{this.fromRGB(parseInt(n[1].charAt(0)+n[1].charAt(0),16)/255,parseInt(n[1].charAt(1)+n[1].charAt(1),16)/255,parseInt(n[1].charAt(2)+n[1].charAt(2),16)/255,t)}return true}};this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var THIS=this;var modeID=this.pickerMode.toLowerCase()==="hvs"?1:0;var abortBlur=false;var valueElement=jscolor.fetchElement(this.valueElement),styleElement=jscolor.fetchElement(this.styleElement);var holdPad=false,holdSld=false;var leaveValue=1<<0,leaveStyle=1<<1,leavePad=1<<2,leaveSld=1<<3;jscolor.addEvent(target,"focus",function(){if(THIS.pickerOnfocus){THIS.showPicker()}});jscolor.addEvent(target,"blur",function(){if(!abortBlur){window.setTimeout(function(){abortBlur||blurTarget();abortBlur=false},0)}else{abortBlur=false}});if(valueElement){var updateField=function(){THIS.fromString(valueElement.value,leaveValue);dispatchImmediateChange()};jscolor.addEvent(valueElement,"keyup",updateField);jscolor.addEvent(valueElement,"input",updateField);jscolor.addEvent(valueElement,"blur",blurValue);valueElement.setAttribute("autocomplete","off")}if(styleElement){styleElement.jscStyle={backgroundImage:styleElement.style.backgroundImage,backgroundColor:styleElement.style.backgroundColor,color:styleElement.style.color}}switch(modeID){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png");break}jscolor.requireImage("cross.gif");jscolor.requireImage("arrow.gif");this.importColor()}};jscolor.install();(function(e,t){function g(e,t){return function(){if(m.plugin.debug){return e.apply(this,arguments)}try{return e.apply(this,arguments)}catch(n){m.plugin.errors.push({plugin:t,thrown:n,source:e.toString()});this.emit("pluginerror",m.plugin.errors)}}}if(!t.addEventListener){e.Popcorn={isSupported:false};var n=("byId forEach extend effects error guid sizeOf isArray nop position disable enable destroy"+"addTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId "+"timeUpdate plugin removePlugin compose effect xhr getJSONP getScript").split(/\s+/);while(n.length){e.Popcorn[n.shift()]=function(){}}return}var r=Array.prototype,i=Object.prototype,s=r.forEach,o=r.slice,u=i.hasOwnProperty,a=i.toString,f=e.Popcorn,l=[],c=false,h=false,p={events:{hash:{},apis:{}}},d=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t,n){e.setTimeout(t,16)}}(),v=function(e){return Object.keys?Object.keys(e):function(e){var t,n=[];for(t in e){if(u.call(e,t)){n.push(t)}}return n}(e)},m=function(e,t){return new m.p.init(e,t||null)};m.version="1.3";m.isSupported=true;m.instances=[];m.p=m.prototype={init:function(e,n){var r,i,s=this;if(typeof e==="function"){if(t.readyState==="complete"){e(t,m);return}l.push(e);if(!c){c=true;var o=function(){h=true;t.removeEventListener("DOMContentLoaded",o,false);for(var e=0,n=l.length;e<n;e++){l[e].call(t,m)}l=null};t.addEventListener("DOMContentLoaded",o,false)}return}if(typeof e==="string"){try{r=t.querySelector(e)}catch(u){throw new Error("Popcorn.js Error: Invalid media element selector: "+e)}}this.media=r||e;i=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video";this[i]=this.media;this.options=n||{};this.id=this.options.id||m.guid(i);if(m.byId(this.id)){throw new Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")")}this.isDestroyed=false;this.data={running:{cue:[]},timeUpdate:m.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:{byStart:[{start:-1,end:-1}],byEnd:[{start:-1,end:-1}],animating:[],startIndex:0,endIndex:0,previousUpdateTime:-1}};m.instances.push(this);var a=function(){if(s.media.currentTime<0){s.media.currentTime=0}s.media.removeEventListener("loadeddata",a,false);var e,t,n,r,i,o;e=s.media.duration;t=e!=e?Number.MAX_VALUE:e+1;m.addTrackEvent(s,{start:t,end:t});if(s.options.frameAnimation){s.data.timeUpdate=function(){m.timeUpdate(s,{});m.forEach(m.manifest,function(e,t){n=s.data.running[t];if(n){i=n.length;for(var u=0;u<i;u++){r=n[u];o=r._natives;o&&o.frame&&o.frame.call(s,{},r,s.currentTime())}}});s.emit("timeupdate");!s.isDestroyed&&d(s.data.timeUpdate)};!s.isDestroyed&&d(s.data.timeUpdate)}else{s.data.timeUpdate=function(e){m.timeUpdate(s,e)};if(!s.isDestroyed){s.media.addEventListener("timeupdate",s.data.timeUpdate,false)}}};Object.defineProperty(this,"error",{get:function(){return s.media.error}});if(s.media.readyState>=2){a()}else{s.media.addEventListener("loadeddata",a,false)}return this}};m.p.init.prototype=m.p;m.byId=function(e){var t=m.instances,n=t.length,r=0;for(;r<n;r++){if(t[r].id===e){return t[r]}}return null};m.forEach=function(e,t,n){if(!e||!t){return{}}n=n||this;var r,i;if(s&&e.forEach===s){return e.forEach(t,n)}if(a.call(e)==="[object NodeList]"){for(r=0,i=e.length;r<i;r++){t.call(n,e[r],r,e)}return e}for(r in e){if(u.call(e,r)){t.call(n,e[r],r,e)}}return e};m.extend=function(e){var t=e,n=o.call(arguments,1);m.forEach(n,function(e){for(var n in e){t[n]=e[n]}});return t};m.extend(m,{noConflict:function(t){if(t){e.Popcorn=f}return m},error:function(e){throw new Error(e)},guid:function(e){m.guid.counter++;return(e?e:"")+(+(new Date)+m.guid.counter)},sizeOf:function(e){var t=0;for(var n in e){t++}return t},isArray:Array.isArray||function(e){return a.call(e)==="[object Array]"},nop:function(){},position:function(n){var r=n.getBoundingClientRect(),i={},s=n.ownerDocument,o=t.documentElement,u=t.body,a,f,l,c,h,p;a=o.clientTop||u.clientTop||0;f=o.clientLeft||u.clientLeft||0;l=e.pageYOffset&&o.scrollTop||u.scrollTop;c=e.pageXOffset&&o.scrollLeft||u.scrollLeft;h=Math.ceil(r.top+l-a);p=Math.ceil(r.left+c-f);for(var d in r){i[d]=Math.round(r[d])}return m.extend({},i,{top:h,left:p})},disable:function(e,t){if(!e.data.disabled[t]){e.data.disabled[t]=true;for(var n=e.data.running[t].length-1,r;n>=0;n--){r=e.data.running[t][n];r._natives.end.call(e,null,r)}}return e},enable:function(e,t){if(e.data.disabled[t]){e.data.disabled[t]=false;for(var n=e.data.running[t].length-1,r;n>=0;n--){r=e.data.running[t][n];r._natives.start.call(e,null,r)}}return e},destroy:function(e){var t=e.data.events,n=e.data.trackEvents,r,i,s,o;for(i in t){r=t[i];for(s in r){delete r[s]}t[i]=null}for(o in m.registryByName){m.removePlugin(e,o)}n.byStart.length=0;n.byEnd.length=0;if(!e.isDestroyed){e.data.timeUpdate&&e.media.removeEventListener("timeupdate",e.data.timeUpdate,false);e.isDestroyed=true}}});m.guid.counter=1;m.extend(m.p,function(){var e="load play pause currentTime playbackRate volume duration preload playbackRate "+"autoplay loop controls muted buffered readyState seeking paused played seekable ended",t={};m.forEach(e.split(/\s+/g),function(e){t[e]=function(t){var n;if(typeof this.media[e]==="function"){if(t!=null&&/play|pause/.test(e)){this.media.currentTime=m.util.toSeconds(t)}this.media[e]();return this}if(t!=null){n=this.media[e];this.media[e]=t;if(n!==t){this.emit("attrchange",{attribute:e,previousValue:n,currentValue:t})}return this}return this.media[e]}});return t}());m.forEach("enable disable".split(" "),function(e){m.p[e]=function(t){return m[e](this,t)}});m.extend(m.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(e,t,n){var r=arguments.length,i,s;try{s=m.util.toSeconds(e)}catch(o){}if(typeof s==="number"){e=s}if(typeof e==="number"&&r===2){n=t;t=e;e=m.guid("cue")}else{if(r===1){t=-1}else{i=this.getTrackEvent(e);if(i){if(typeof e==="string"&&r===2){if(typeof t==="number"){n=i._natives.start}if(typeof t==="function"){n=t;t=i.start}}}else{if(r>=2){if(typeof t==="string"){try{s=m.util.toSeconds(t)}catch(o){}t=s}if(typeof t==="number"){n=m.nop()}if(typeof t==="function"){n=t;t=-1}}}}}m.addTrackEvent(this,{id:e,start:t,end:t+1,_running:false,_natives:{start:n||m.nop,end:m.nop,type:"cue"}});return this},mute:function(e){var t=e==null||e===true?"muted":"unmuted";if(t==="unmuted"){this.media.muted=false;this.media.volume=this.data.state.volume}if(t==="muted"){this.data.state.volume=this.media.volume;this.media.muted=true}this.emit(t);return this},unmute:function(e){return this.mute(e==null?false:!e)},position:function(){return m.position(this.media)},toggle:function(e){return m[this.data.disabled[e]?"enable":"disable"](this,e)},defaults:function(e,t){if(m.isArray(e)){m.forEach(e,function(e){for(var t in e){this.defaults(t,e[t])}},this);return this}if(!this.options.defaults){this.options.defaults={}}if(!this.options.defaults[e]){this.options.defaults[e]={}}m.extend(this.options.defaults[e],t);return this}});m.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error "+"loadedmetadata loadeddata waiting playing canplay canplaythrough "+"seeking seeked timeupdate ended ratechange durationchange volumechange"};m.Events.Natives=m.Events.UIEvents+" "+m.Events.MouseEvents+" "+m.Events.Events;p.events.apiTypes=["UIEvents","MouseEvents","Events"];(function(e,t){var n=p.events.apiTypes,r=e.Natives.split(/\s+/g),i=0,s=r.length,o;for(;i<s;i++){t.hash[r[i]]=true}n.forEach(function(n,r){t.apis[n]={};var i=e[n].split(/\s+/g),s=i.length,o=0;for(;o<s;o++){t.apis[n][i[o]]=true}})})(m.Events,p.events);m.events={isNative:function(e){return!!p.events.hash[e]},getInterface:function(e){if(!m.events.isNative(e)){return false}var t=p.events,n=t.apiTypes,r=t.apis,i=0,s=n.length,o,u;for(;i<s;i++){u=n[i];if(r[u][e]){o=u;break}}return o},all:m.Events.Natives.split(/\s+/g),fn:{trigger:function(n,r){var i,s;if(this.data.events[n]&&m.sizeOf(this.data.events[n])){i=m.events.getInterface(n);if(i){s=t.createEvent(i);s.initEvent(n,true,true,e,1);this.media.dispatchEvent(s);return this}m.forEach(this.data.events[n],function(e,t){e.call(this,r)},this)}return this},listen:function(e,t){var n=this,r=true,i=m.events.hooks[e],s=e,o;if(!this.data.events[e]){this.data.events[e]={};r=false}if(i){if(i.add){i.add.call(this,{},t)}if(i.bind){e=i.bind}if(i.handler){o=t;t=function(t){i.handler.call(n,t,o)}}r=true;if(!this.data.events[e]){this.data.events[e]={};r=false}}this.data.events[e][t.name||t.toString()+m.guid()]=t;if(!r&&m.events.all.indexOf(e)>-1){this.media.addEventListener(e,function(t){m.forEach(n.data.events[e],function(e,r){if(typeof e==="function"){e.call(n,t)}})},false)}return this},unlisten:function(e,t){if(this.data.events[e]&&this.data.events[e][t]){delete this.data.events[e][t];return this}this.data.events[e]=null;return this}},hooks:{canplayall:{bind:"canplaythrough",add:function(e,t){var n=false;if(this.media.readyState){t.call(this,e);n=true}this.data.hooks.canplayall={fired:n}},handler:function(t,n){if(!this.data.hooks.canplayall.fired){n.call(this,t);this.data.hooks.canplayall.fired=true}}}}};m.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(e){m.p[e[0]]=m.p[e[1]]=m.events.fn[e[0]]});m.addTrackEvent=function(e,t){var n,r,i;if(t.id){n=e.getTrackEvent(t.id)}if(n){r=true;t=m.extend({},n,t);e.removeTrackEvent(t.id)}if(t&&t._natives&&t._natives.type&&e.options.defaults&&e.options.defaults[t._natives.type]){t=m.extend({},e.options.defaults[t._natives.type],t)}if(t._natives){t._id=t.id||t._id||m.guid(t._natives.type);e.data.history.push(t._id)}t.start=m.util.toSeconds(t.start,e.options.framerate);t.end=m.util.toSeconds(t.end,e.options.framerate);var s=e.data.trackEvents.byStart,o=e.data.trackEvents.byEnd,u,a;for(u=s.length-1;u>=0;u--){if(t.start>=s[u].start){s.splice(u+1,0,t);break}}for(a=o.length-1;a>=0;a--){if(t.end>o[a].end){o.splice(a+1,0,t);break}}if(t.end>e.media.currentTime&&t.start<=e.media.currentTime){t._running=true;e.data.running[t._natives.type].push(t);if(!e.data.disabled[t._natives.type]){t._natives.start.call(e,null,t)}}if(u<=e.data.trackEvents.startIndex&&t.start<=e.data.trackEvents.previousUpdateTime){e.data.trackEvents.startIndex++}if(a<=e.data.trackEvents.endIndex&&t.end<e.data.trackEvents.previousUpdateTime){e.data.trackEvents.endIndex++}this.timeUpdate(e,null,true);if(t._id){m.addTrackEvent.ref(e,t)}if(r){if(t._natives.type==="cue"){i="cuechange"}else{i="trackchange"}e.emit(i,{id:t.id,previousValue:{time:n.start,fn:n._natives.start},currentValue:{time:t.start,fn:t._natives.start}})}};m.addTrackEvent.ref=function(e,t){e.data.trackRefs[t._id]=t;return e};m.removeTrackEvent=function(e,t){var n,r,i,s=e.data.history.length,o=e.data.trackEvents.byStart.length,u=0,a=0,f=[],l=[],c=[],h=[];while(--o>-1){n=e.data.trackEvents.byStart[u];r=e.data.trackEvents.byEnd[u];if(!n._id){f.push(n);l.push(r)}if(n._id){if(n._id!==t){f.push(n)}if(r._id!==t){l.push(r)}if(n._id===t){a=u;if(n._natives._teardown){n._natives._teardown.call(e,n)}}}u++}o=e.data.trackEvents.animating.length;u=0;if(o){while(--o>-1){i=e.data.trackEvents.animating[u];if(!i._id){c.push(i)}if(i._id&&i._id!==t){c.push(i)}u++}}if(a<=e.data.trackEvents.startIndex){e.data.trackEvents.startIndex--}if(a<=e.data.trackEvents.endIndex){e.data.trackEvents.endIndex--}e.data.trackEvents.byStart=f;e.data.trackEvents.byEnd=l;e.data.trackEvents.animating=c;for(var p=0;p<s;p++){if(e.data.history[p]!==t){h.push(e.data.history[p])}}e.data.history=h;m.removeTrackEvent.ref(e,t)};m.removeTrackEvent.ref=function(e,t){delete e.data.trackRefs[t];return e};m.getTrackEvents=function(e){var t=[],n=e.data.trackEvents.byStart,r=n.length,i=0,s;for(;i<r;i++){s=n[i];if(s._id){t.push(s)}}return t};m.getTrackEvents.ref=function(e){return e.data.trackRefs};m.getTrackEvent=function(e,t){return e.data.trackRefs[t]};m.getTrackEvent.ref=function(e,t){return e.data.trackRefs[t]};m.getLastTrackEventId=function(e){return e.data.history[e.data.history.length-1]};m.timeUpdate=function(e,t){var n=e.media.currentTime,r=e.data.trackEvents.previousUpdateTime,i=e.data.trackEvents,s=i.endIndex,o=i.startIndex,u=i.byStart.length,a=i.byEnd.length,f=m.registryByName,l="trackstart",c="trackend",h,p,d,v,g,y;if(r<=n){while(i.byEnd[s]&&i.byEnd[s].end<=n){h=i.byEnd[s];v=h._natives;g=v&&v.type;if(!v||!!f[g]||!!e[g]){if(h._running===true){h._running=false;y=e.data.running[g];y.splice(y.indexOf(h),1);if(!e.data.disabled[g]){v.end.call(e,t,h);e.emit(c,m.extend({},h,{plugin:g,type:c}))}}s++}else{m.removeTrackEvent(e,h._id);return}}while(i.byStart[o]&&i.byStart[o].start<=n){p=i.byStart[o];v=p._natives;g=v&&v.type;if(!v||!!f[g]||!!e[g]){if(p.end>n&&p._running===false){p._running=true;e.data.running[g].push(p);if(!e.data.disabled[g]){v.start.call(e,t,p);e.emit(l,m.extend({},p,{plugin:g,type:l}))}}o++}else{m.removeTrackEvent(e,p._id);return}}}else if(r>n){while(i.byStart[o]&&i.byStart[o].start>n){p=i.byStart[o];v=p._natives;g=v&&v.type;if(!v||!!f[g]||!!e[g]){if(p._running===true){p._running=false;y=e.data.running[g];y.splice(y.indexOf(p),1);if(!e.data.disabled[g]){v.end.call(e,t,p);e.emit(c,m.extend({},p,{plugin:g,type:c}))}}o--}else{m.removeTrackEvent(e,p._id);return}}while(i.byEnd[s]&&i.byEnd[s].end>n){h=i.byEnd[s];v=h._natives;g=v&&v.type;if(!v||!!f[g]||!!e[g]){if(h.start<=n&&h._running===false){h._running=true;e.data.running[g].push(h);if(!e.data.disabled[g]){v.start.call(e,t,h);e.emit(l,m.extend({},h,{plugin:g,type:l}))}}s--}else{m.removeTrackEvent(e,h._id);return}}}i.endIndex=s;i.startIndex=o;i.previousUpdateTime=n;i.byStart.length<u&&i.startIndex--;i.byEnd.length<a&&i.endIndex--};m.extend(m.p,{getTrackEvents:function(){return m.getTrackEvents.call(null,this)},getTrackEvent:function(e){return m.getTrackEvent.call(null,this,e)},getLastTrackEventId:function(){return m.getLastTrackEventId.call(null,this)},removeTrackEvent:function(e){m.removeTrackEvent.call(null,this,e);return this},removePlugin:function(e){m.removePlugin.call(null,this,e);return this},timeUpdate:function(e){m.timeUpdate.call(null,this,e);return this},destroy:function(){m.destroy.call(null,this);return this}});m.manifest={};m.registry=[];m.registryByName={};m.plugin=function(e,t,n){if(m.protect.natives.indexOf(e.toLowerCase())>=0){m.error("'"+e+"' is a protected function name");return}var r=["start","end"],i={},s,a=typeof t==="function",f=["_setup","_teardown","start","end","frame"];var l=function(e,t){e=e||m.nop;t=t||m.nop;return function(){e.apply(this,arguments);t.apply(this,arguments)}};m.manifest[e]=n=n||t.manifest||{};f.forEach(function(n){t[n]=g(t[n]||m.nop,e)});var c=function(t,i){if(!i){return this}if(i.ranges&&m.isArray(i.ranges)){m.forEach(i.ranges,function(t){var n=m.extend({},i,t);delete n.ranges;this[e](n)},this);return this}var s=i._natives={},a="",c,h;m.extend(s,t);i._natives.type=e;i._running=false;s.start=s.start||s["in"];s.end=s.end||s["out"];if(i.once){s.end=l(s.end,function(){this.removeTrackEvent(i._id)})}s._teardown=l(function(){var e=o.call(arguments),t=this.data.running[s.type];e.unshift(null);e[1]._running&&t.splice(t.indexOf(i),1)&&s.end.apply(this,e)},s._teardown);i.compose=i.compose&&i.compose.split(" ")||[];i.effect=i.effect&&i.effect.split(" ")||[];i.compose=i.compose.concat(i.effect);i.compose.forEach(function(e){a=m.compositions[e]||{};f.forEach(function(e){s[e]=l(s[e],a[e])})});i._natives.manifest=n;if(!("start"in i)){i.start=i["in"]||0}if(!i.end&&i.end!==0){i.end=i["out"]||Number.MAX_VALUE}if(!u.call(i,"toString")){i.toString=function(){var t=["start: "+i.start,"end: "+i.end,"id: "+(i.id||i._id)];if(i.target!=null){t.push("target: "+i.target)}return e+" ( "+t.join(", ")+" )"}}if(!i.target){h="options"in n&&n.options;i.target=h&&"target"in h&&h.target}if(i._natives){i._id=m.guid(i._natives.type)}i._natives._setup&&i._natives._setup.call(this,i);m.addTrackEvent(this,i);m.forEach(t,function(e,t){if(t!=="type"){if(r.indexOf(t)===-1){this.on(t,e)}}},this);return this};m.p[e]=i[e]=function(n,r){var i=arguments.length,s,o,u;if(n&&!r){r=n;n=null}else{s=this.getTrackEvent(n);if(!s){r.id=n}else{r=m.extend({},s,r);m.addTrackEvent(this,r);return this}}this.data.running[e]=this.data.running[e]||[];o=this.options.defaults&&this.options.defaults[e]||{};u=m.extend({},o,r);return c.call(this,a?t.call(this,u):t,u)};if(n){m.extend(t,{manifest:n})}var h={fn:i[e],definition:t,base:t,parents:[],name:e};m.registry.push(m.extend(i,h,{type:e}));m.registryByName[e]=h;return i};m.plugin.errors=[];m.plugin.debug=m.version==="@"+"VERSION";m.removePlugin=function(e,t){if(!t){t=e;e=m.p;if(m.protect.natives.indexOf(t.toLowerCase())>=0){m.error("'"+t+"' is a protected function name");return}var n=m.registry.length,r;for(r=0;r<n;r++){if(m.registry[r].name===t){m.registry.splice(r,1);delete m.registryByName[t];delete m.manifest[t];delete e[t];return}}}var i=e.data.trackEvents.byStart,s=e.data.trackEvents.byEnd,o=e.data.trackEvents.animating,u,a;for(u=0,a=i.length;u<a;u++){if(i[u]&&i[u]._natives&&i[u]._natives.type===t){i[u]._natives._teardown&&i[u]._natives._teardown.call(e,i[u]);i.splice(u,1);u--;a--;if(e.data.trackEvents.startIndex<=u){e.data.trackEvents.startIndex--;e.data.trackEvents.endIndex--}}if(s[u]&&s[u]._natives&&s[u]._natives.type===t){s.splice(u,1)}}for(u=0,a=o.length;u<a;u++){if(o[u]&&o[u]._natives&&o[u]._natives.type===t){o.splice(u,1);u--;a--}}};m.compositions={};m.compose=function(e,t,n){m.manifest[e]=n=n||t.manifest||{};m.compositions[e]=t};m.plugin.effect=m.effect=m.compose;var y=/^(?:\.|#|\[)/;m.dom={debug:false,find:function(e,n){var r=null;e=e.trim();n=n||t;if(e){if(!y.test(e)){r=t.getElementById(e);if(r!==null){return r}}try{r=n.querySelector(e)}catch(i){if(m.dom.debug){throw new Error(i)}}}return r}};var b=/\?/,w={url:"",data:"",dataType:"",success:m.nop,type:"GET",async:true,xhr:function(){return new e.XMLHttpRequest}};m.xhr=function(e){e.dataType=e.dataType&&e.dataType.toLowerCase()||null;if(e.dataType&&(e.dataType==="jsonp"||e.dataType==="script")){m.xhr.getJSONP(e.url,e.success,e.dataType==="script");return}var t=m.extend({},w,e);t.ajax=t.xhr();if(t.ajax){if(t.type==="GET"&&t.data){t.url+=(b.test(t.url)?"&":"?")+t.data;t.data=null}t.ajax.open(t.type,t.url,t.async);t.ajax.send(t.data||null);return m.xhr.httpData(t)}};m.xhr.httpData=function(e){var t,n=null,r,i=null;e.ajax.onreadystatechange=function(){if(e.ajax.readyState===4){try{n=JSON.parse(e.ajax.responseText)}catch(s){}t={xml:e.ajax.responseXML,text:e.ajax.responseText,json:n};if(!t.xml||!t.xml.documentElement){t.xml=null;try{r=new DOMParser;i=r.parseFromString(e.ajax.responseText,"text/xml");if(!i.getElementsByTagName("parsererror").length){t.xml=i}}catch(s){}}if(e.dataType){t=t[e.dataType]}e.success.call(e.ajax,t)}};return t};m.xhr.getJSONP=function(e,n,r){var i=t.head||t.getElementsByTagName("head")[0]||t.documentElement,s=t.createElement("script"),o=false,u=[],a=/(=)\?(?=&|$)|\?\?/,f,l,c,h,p;if(!r){p=e.match(/(callback=[^&]*)/);if(p!==null&&p.length){l=p[1].split("=")[1];if(l==="?"){l="jsonp"}h=m.guid(l);e=e.replace(/(callback=[^&]*)/,"callback="+h)}else{h=m.guid("jsonp");if(a.test(e)){e=e.replace(a,"$1"+h)}u=e.split(/\?(.+)?/);e=u[0]+"?";if(u[1]){e+=u[1]+"&"}e+="callback="+h}window[h]=function(e){n&&n(e);o=true}}s.addEventListener("load",function(){if(r){n&&n()}if(o){delete window[h]}i.removeChild(s)},false);s.src=e;i.insertBefore(s,i.firstChild);return};m.getJSONP=m.xhr.getJSONP;m.getScript=m.xhr.getScript=function(e,t){return m.xhr.getJSONP(e,t,true)};m.util={toSeconds:function(e,t){var n=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,r="Invalid time format",i,s,o,u,a,f;if(typeof e==="number"){return e}if(typeof e==="string"&&!n.test(e)){m.error(r)}i=e.split(":");s=i.length-1;o=i[s];if(o.indexOf(";")>-1){a=o.split(";");f=0;if(t&&typeof t==="number"){f=parseFloat(a[1],10)/t}i[s]=parseInt(a[0],10)+f}u=i[0];return{1:parseFloat(u,10),2:parseInt(u,10)*60+parseFloat(i[1],10),3:parseInt(u,10)*3600+parseInt(i[1],10)*60+parseFloat(i[2],10)}[i.length||1]}};m.p.cue=m.p.exec;m.protect={natives:v(m.p).map(function(e){return e.toLowerCase()})};m.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(e,t){var n=m.p[t];m.p[t]=function(){if(typeof console!=="undefined"&&console.warn){console.warn("Deprecated method '"+t+"', "+(e==null?"do not use.":"use '"+e+"' instead."));m.p[t]=n}return m.p[e].apply(this,[].slice.call(arguments))}});e.Popcorn=m})(window,window.document);(function(e,t,n){var r=n,i={type:"png",set:true,at:null,target:null,reload:true};t.prototype.capture=function(e){var n,s,o,u,a,f=t.extend({},i,e),l=this.position(),c="popcorn-canvas-"+this.media.id,h=r.getElementById(c);if(f.at){f.at=t.util.toSeconds(f.at);a=this.currentTime();this.currentTime(f.at)}if(!h){h=r.createElement("canvas");h.id=c;h.width=l.width;h.height=l.height;h.style.display="none";this.media.parentNode.appendChild(h)}n=h.getContext("2d");o=function(){n.drawImage(this.media,0,0,l.width,l.height);s=h.toDataURL("image/"+f.type);if(f.target){u=r.querySelectorAll(f.target);if(u.length){t.forEach(u,function(e){if(e.nodeName==="IMG"){e.src=s}})}}if(f.set){this.media.setAttribute("poster",s)}if(f.at){this.listen("loaded",function(){this.currentTime(a)})}if(f.reload){this.media.load()}this.unlisten("seeked",o);this.trigger("captured");return s};this.listen("seeked",o);if(!f.at){var p=o.call(this);return p}return this}})(this,this.Popcorn,this.document);TAG.Telemetry=function(){function i(){var e=navigator.userAgent,t,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(n[1])){t=/\brv[ :]+(\d+(\.\d+)?)/g.exec(e)||[];return"IE "+(t[1]||"")}n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"];if((t=e.match(/version\/([\.\d]+)/i))!=null)n[2]=t[1];return n.join(" ")}function s(i,s,u,a){$(i).on(s+".tag_telemetry",function(i){var s=new Date,f={ttype:u,tagserver:localStorage.ip||"",browser:n,platform:r,time_stamp:s.getTime(),time_human:s.toString(),machine_id:localStorage.machId,session_id:TELEMETRY_SESSION_ID,mode:null,custom_1:null,custom_2:null,custom_3:null,custom_4:null,custom_5:null},l=true;if(a&&a(f,i)||TELEMETRY_SWITCH==="off"){return}e.push(f);if(e.length>=t-1){o()}})}function o(){var t=JSON.stringify(e);e.length=0;$.ajax({type:"POST",url:"http://browntagserver.com:12043/",data:t,async:true,success:function(){console.log("POST request to server worked")},error:function(e){console.log("telemetry error! look at node output...")}})}var e=[],t=1,n=i(),r=navigator.platform;return{register:s}}();TAG.Util.makeNamespace("TAG.TESTS");TAG.TESTS=function(){function i(){m(y([d,a,f,{tests:2,intervals:2}]))}function s(){m(y([v,l,{tests:1,intervals:10}]))}function o(){m(y([v,l,l,c,{tests:1,intervals:10}]))}function u(){m(y([p,h,{tests:4,intervals:2}]))}function a(){return{tests:[function(){b($("#overlay"))}],intervals:[2e3]}}function f(){return{tests:[function(){b($("#catalogBackButton"))}],intervals:[2e3]}}function l(){return{tests:[function(){var e=$(".collectionClickable"),t=C(e);if(t){b($(t))}}],intervals:[2e3]}}function c(){return{tests:[function(){var e=$(".tile"),t=C(e),n;if(!t){console.log("RETURNING: no artwork tiles yet");return}n=$(".already_selected_in_test");while(e.length>1&&$(t).hasClass("already_selected_in_test")){t=C(e)}n.removeClass("already_selected_in_test");$(t).addClass("already_selected_in_test");b($(t))}],intervals:[1e3]}}function h(){var e=$("#tagRoot").width(),t=$("#tagRoot").height();return{tests:[function(){E($(".artworkCanvasTesting")[0],{startX:e/2,endX:2*e/3,startY:t/2,endY:4*t/5})},function(){E($(".artworkCanvasTesting")[0],{startX:e/2,endX:e-10,startY:t/2,endY:t-10})},function(){E($(".artworkCanvasTesting")[0],{startX:e/2,endX:10,startY:t/2,endY:t/2})},function(){E($(".artworkCanvasTesting")[0],{startX:e/2,endX:e/2,startY:t/2,endY:10})}],intervals:[1500,1500,1500,1500]}}function p(){return{tests:[function(){var e="48880741-040a-4657-a3ef-0a2f9bbe27cd";TAG.Worktop.Database.getDoq(e,function(e){var t={prevPage:"catalog",prevScroll:0},n={catalogState:{},doq:e,split:"L"},r=new TAG.Layout.ArtworkViewer(t,n,null);TAG.Util.UI.slidePageLeft(r.getRoot())},k("navigate_to_garibaldi"),k("navigate_to_garibaldi"))}],intervals:[1e3]}}function d(){return{tests:[function(){TAG.Layout.StartPage(null,function(e){TAG.Util.UI.slidePageRight(e)},true)}],intervals:[1e3]}}function v(){return{tests:[function(){var e=new TAG.Layout.CollectionsPage;$("#overlay").on("click",function(){});TAG.Util.UI.slidePageLeft(e.getRoot())}],intervals:[1e3]}}function m(e){var t=e.tests,n=e.intervals;try{L();g(0,t,n)}catch(r){console.log("error in runTests: "+r.message);return-1}}function g(e,t,n,i){i=i||1;var s;if(e<t.length){s=typeof t[e];r=setTimeout(function(){if(s==="function"){console.log("RUNNING TEST #"+i);t[e]();g(e+1,t,n,i+1)}else if(s==="number"&&n[e]>0){n[e]--;g(Math.max(0,e-t[e]),t,n,i+1)}},s==="function"?n[e]:0)}}function y(e){if(e.length===0){return{tests:[],intervals:[]}}var t=[],n=[],r,i;for(r=0;r<e.length;r++){i=typeof e[r]==="function"?e[r]():e[r];t=t.concat(i.tests);n=n.concat(i.intervals)}return{tests:t,intervals:n}}function b(e){var t=$(e);T(t);t.trigger("click")}function w(e,t){}function E(e,t){var n=$(e),r,i=t.startX+$("#tagRoot").offset().left,s=t.startY+$("#tagRoot").offset().top,o=i,u=s,a=i+(t.endX-t.startX),f=s+(t.endY-t.startY),l=a-i,c=f-s,h=Math.sqrt(l*l+c*c),p=20,d=h/p,v;r=document.createEvent("MouseEvent");r.initMouseEvent("mousedown",true,true,window,1,o,u,i,s,false,false,false,false,0,null);T(n,t.startX,t.startY,true);n[0].dispatchEvent(r);S(0,d,{target:n,startClientX:i,startClientY:s,startScreenX:o,startScreenY:u,endClientX:a,endClientY:f,endScreenX:a,endScreenY:f},function(){r=document.createEvent("MouseEvent");r.initMouseEvent("mouseup",true,true,window,1,a,f,a,f,false,false,false,false,0,null);n[0].dispatchEvent(r)})}function S(e,t,n,r){var i,s=(e+1)/t,o=n.startClientX,u=n.startClientY,a=n.endClientX,f=n.endClientY,l=n.target,c=x(o,a,s),h=x(u,f,s);if(e<t){i=document.createEvent("MouseEvent");i.initMouseEvent("mousemove",true,true,window,1,c,h,c,h,false,false,false,false,0,null);T(l,c-$("#tagRoot").offset().left,h-$("#tagRoot").offset().top,true);$(l)[0].dispatchEvent(i);setTimeout(function(){S(e+1,t,n,r)},0)}else{r&&r()}}function x(e,t,n){return(1-n)*e+n*t}function T(e,t,r,i,s){var o=$(e),u=o.prop("tagName").toLowerCase(),a=$(document.createElement("div")),s=s||30,f=o.css("position")==="absolute"||o.css("position")==="relative",l,c=t?o.width()-t:o.width()/2,h=r?o.height()-r:o.height()/2,p=t?t:o.width()/2,d=r?r:o.height()/2;if(u==="img"||u==="video"){l=o.css("background-color");o.css("background-color","rgba(255,100,0,0.8)");setTimeout(function(){o.css("background-color",l)},1e3)}else{a.css({"border-radius":"100px","background-color":C(n),position:"absolute","margin-top":f?"":"-"+(h+s/2)+"px","margin-left":f?"":c-s/2+"px",top:f?d-s/2+"px":"",left:f?p-s/2+"px":"",opacity:0,width:s+"px",height:s+"px"});o.append(a);a.animate({opacity:1},20,function(){var e={opacity:0};if(i){e.width=s/2;e.height=s/2;if(f){e.left=p-s/2+s/4;e.top=d-s/2+s/4}else{e.marginLeft=c-s/2+s/4;e.marginTop=-(h+s/2-s/4)}}a.animate(e,1200,function(){a.remove()})})}}function N(e){if(e.length===0){return-1}else{return Math.floor(Math.random()*e.length)}}function C(e){var t;console.log("arr.length = "+e.length);if(e.length===0){return null}else{t=N(e);console.log("index = "+t);return e[t]}}function k(t){var n=t?"error in "+t:"error";return function(t){console.log(n+": "+e.message)}}function L(){var e=$("#tagContainer"),t=$(document.createElement("div")),n=$(document.createElement("div"));t.css({"background-color":"rgba(0,0,0,0.9)",height:"100%",opacity:0,position:"absolute",width:"100%","z-index":1e17});n.css({color:"#ffdd00",position:"absolute","font-family":"sourceSans","font-size":"60px","text-align":"center",top:"40%",width:"100%"});n.text("starting test...");t.append(n);e.append(t);t.animate({opacity:1},100,function(){setTimeout(function(){t.animate({opacity:0},100,function(){t.remove()})},1e3)})}function A(){clearTimeout(r)}var t={tests:[],intervals:[]};var n=["rgba(255,100,0,0.9)","rgba(255,0,100,0.9)","rgba(100,255,0,0.9)","rgba(100,0,255,0.9)","rgba(0,255,100,0.9)","rgba(0,100,255,0.9)"];var r;return{testEnterCollections:i,testSelectCollections:s,testSelectArtworks:o,testDragArtwork:u,cancelTest:A,runTests:m}}();(function(){"use strict";function t(){var t,i,s,o,u,a,f,l;TELEMETRY_SESSION_ID=TAG.Util.IdCreator();if(!localStorage.tagTelemetry){e=true}if(!localStorage.machId){localStorage.machId=TAG.Util.IdCreator()}if(containerId&&$("#"+containerId).length>0){t=$("#"+containerId)}else{console.log("no containerId specified, or the containerId does not match an element");return}if(urlToParse||urlToLoad){pageToLoad=n()}localStorage.ip=(IS_WINDOWS?localStorage.ip||ip:pageToLoad.tagserver||ip||localStorage.ip)||"browntagserver.com";i=t.css("position");if(i!=="relative"&&i!=="absolute"){t.css("position","relative")}s=$(document.createElement("div")).attr("id","tagRootContainer");t.append(s);o=$(document.createElement("div")).attr("id","tagRootInnerContainer");s.append(o);u=$(document.createElement("div")).attr("id","tagRoot");o.append(u);a=t.width();f=t.height();l=0;if(IS_WEBAPP){if(a/f>16/9){l=(a-16/9*f)/2;a=16/9*f}else{f=9/16*a}}u.css({"font-size":a/9.6+"%",height:f+"px",left:l+"px","max-width":a+"px","max-height":f+"px",width:a+"px"});r()}function n(){var e=urlToParse,t,r={};t=e.match(/tagserver=[^\&]*/);if(t&&t.length>0){r.tagserver=t[0].split(/=/)[1]}t=e.match(/tagpagename=[a-zA-Z]+/);if(t&&t.length>0){r.pagename=t[0].split(/=/)[1];switch(r.pagename){case"collections":t=e.match(/tagcollectionid=[a-f0-9\-]+/);if(t&&t.length>0){r.collectionid=t[0].split(/=/)[1];t=e.match(/tagartworkid=[a-f0-9\-]+/);if(t&&t.length>0){r.artworkid=t[0].split(/=/)[1]}return r}break;case"artwork":case"video":t=e.match(/tagguid=[a-f0-9\-]+/);var i=e.match(/prevpage=[a-f0-9\-]+/);if(t&&t.length>0){r.guid=t[0].split(/=/)[1];if(i&&i.length>0){r.prevpage=i[0].split(/=/)[1]}return r}break;case"tour":t=e.match(/tagguid=[a-f0-9\-]+/);if(t&&t.length>0){r.guid=t[0].split(/=/)[1];var i=e.match(/prevpage=[a-f0-9\-]+/);r.onlytour=e.match(/tagonlytour=true/)?true:false;if(i&&i.length>0){r.prevpage=i[0].split(/=/)[1]}return r}break}}else if(urlToLoad){urlToParse=urlToLoad;urlToLoad="";return n()}return r}function r(){var t=["js/raphael.js","js/tagInk.js","js/RIN/web/lib/rin-core-1.0.js"],n,r,i,s,o;t.push(IS_WINDOWS?"js/WIN8_RIN/web/lib/rin-core-1.0.js":"js/RIN/web/lib/rin-core-1.0.js",IS_WINDOWS?"js/WIN8_RIN/web/lib/knockout-2.1.0.js":"js/RIN/web/lib/knockout-2.2.1.js");tagPath=tagPath||"";if(tagPath.length>0&&tagPath[tagPath.length-1]!=="/"){tagPath+="/"}r=document.getElementsByTagName("head").item(0);for(n=0;n<t.length;n++){i=document.createElement("script");i.type="text/javascript";i.src=tagPath+t[n];r.appendChild(i)}s=document.createElement("link");s.rel="stylesheet";s.href=tagPath+"css/TAG.css";r.appendChild(s);o=$("#tagRoot");$("body").css("-ms-touch-action","none");$("body").on("click.idleTimer",function(){TAG.Util.IdleTimer.restartTimer()});if(pageToLoad&&pageToLoad.pagename==="tour"){currentPage.name=TAG.Util.Constants.pages.START_PAGE;currentPage.obj=null;TAG.Layout.StartPage({newUser:e},function(e){TAG.Worktop.Database.getDoq(pageToLoad.guid,function(e){if(pageToLoad.prevpage){TAG.Worktop.Database.getDoq(pageToLoad.prevpage,function(t){var n=JSON.parse(unescape(e.Metadata.Content)),r=TAG.Layout.TourPlayer(n,t,{},null,e);o.css("overflow","hidden");o.append(r.getRoot());r.startPlayback();currentPage.name=TAG.Util.Constants.pages.TOUR_PLAYER;currentPage.obj=r})}else{var t=JSON.parse(unescape(e.Metadata.Content)),n=TAG.Layout.TourPlayer(t,null,{},null,e);o.css("overflow","hidden");o.append(n.getRoot());n.startPlayback();currentPage.name=TAG.Util.Constants.pages.TOUR_PLAYER;currentPage.obj=n}},function(){},function(){})})}else if(pageToLoad&&pageToLoad.pagename==="collections"){currentPage.name=TAG.Util.Constants.pages.START_PAGE;currentPage.obj=null;TAG.Layout.StartPage({newUser:e},function(e){var t;if(pageToLoad.collectionid){TAG.Worktop.Database.getDoq(pageToLoad.collectionid,function(e){if(pageToLoad.artworkid){TAG.Worktop.Database.getDoq(pageToLoad.artworkid,function(n){t=new TAG.Layout.CollectionsPage({backScroll:0,backArtwork:n,backCollection:e});o.append(t.getRoot())})}else{t=new TAG.Layout.CollectionsPage({backScroll:0,backArtwork:null,backCollection:e});o.append(t.getRoot())}})}else{t=TAG.Layout.CollectionsPage();o.append(t.getRoot())}currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE;currentPage.obj=t},function(){},function(){})}else if(pageToLoad&&pageToLoad.pagename==="artwork"){currentPage.name=TAG.Util.Constants.pages.START_PAGE;currentPage.obj=null;TAG.Layout.StartPage({newUser:e},function(e){TAG.Worktop.Database.getDoq(pageToLoad.guid,function(e){if(pageToLoad.prevpage){TAG.Worktop.Database.getDoq(pageToLoad.prevpage,function(t){var n=TAG.Layout.ArtworkViewer({doq:e,prevScroll:0,prevCollection:t,prevPage:"catalog"});o.append(n.getRoot());currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER;currentPage.obj=n})}else{var t=TAG.Layout.ArtworkViewer({doq:e,prevScroll:0,prevCollection:null,prevPage:"catalog"});o.append(t.getRoot());currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER;currentPage.obj=t}})},function(){},function(){})}else if(pageToLoad&&pageToLoad.pagename==="video"){currentPage.name=TAG.Util.Constants.pages.START_PAGE;currentPage.obj=null;TAG.Layout.StartPage({newUser:e},function(e){TAG.Worktop.Database.getDoq(pageToLoad.guid,function(e){if(pageToLoad.prevpage){TAG.Worktop.Database.getDoq(pageToLoad.prevpage,function(t){var n=TAG.Layout.VideoPlayer(e,t,null);o.append(n.getRoot());currentPage.name=TAG.Util.Constants.pages.VIDEO_PLAYER;currentPage.obj=n})}else{var t=TAG.Layout.VideoPlayer(e,null,null);o.append(t.getRoot());currentPage.name=TAG.Util.Constants.pages.VIDEO_PLAYER;currentPage.obj=t}})},function(){},function(){})}else{currentPage.name=TAG.Util.Constants.pages.START_PAGE;currentPage.obj=null;TAG.Layout.StartPage({newUser:e},function(e){o.append(e)})}}function i(){var e=$.ajax({url:"http://137.135.69.3:8080",dataType:"text",async:false,error:function(e){$("body").append((new TAG.Layout.InternetFailurePage("Server Down")).getRoot());return false}});return true}function o(e){var t=Windows.UI.ViewManagement.ApplicationViewState;var n=Windows.UI.ViewManagement.ApplicationView.value;switch(n){case t.snapped:case t.filled:if(!s)$("body").append(s=(new LADS.Layout.MetroSplitscreenMessage).getRoot());break;case t.fullScreenLandscape:if(s){s.detach();s=null}break}}var e=false;if(IS_WINDOWS){$(document).on("ready",t)}else{t()}var s;if(IS_WINDOWS){WinJS.Application.start();WinJS.Application.onsettings=function(e){e.detail.applicationcommands={priv:{title:"Privacy Policy",href:"settings/privacy.html"}};WinJS.UI.SettingsFlyout.populateSettings(e)};var u=Windows.Networking.Connectivity.NetworkInformation;var a;var f=false;Windows.Networking.Connectivity.NetworkInformation.addEventListener("networkstatuschanged",function(e){if(localStorage.ip!=="127.0.0.1"&&localStorage.ip!=="localhost"){if(!u.getInternetConnectionProfile()){if(a)a.getRoot().detach();$("body").append((a=new LADS.Layout.InternetFailurePage("Internet Lost",true)).getRoot())}else{switch(u.getInternetConnectionProfile().getNetworkConnectivityLevel()){case Windows.Networking.Connectivity.NetworkConnectivityLevel.none:case Windows.Networking.Connectivity.NetworkConnectivityLevel.localAccess:case Windows.Networking.Connectivity.NetworkConnectivityLevel.constrainedInternetAccess:if(a)a.getRoot().detach();$("body").append((a=new LADS.Layout.InternetFailurePage("Internet Lost",true)).getRoot());break;case Windows.Networking.Connectivity.NetworkConnectivityLevel.internetAccess:if(a)a.getRoot().detach();break}}}if(!f&&!localStorage.acceptDataUsage&&u.getInternetConnectionProfile()&&u.getInternetConnectionProfile().getDataPlanStatus().dataLimitInMegabytes){f=true;$("body").append((new LADS.Layout.InternetFailurePage("Data Limit",true)).getRoot())}});window.addEventListener("resize",o)}else{setInterval(function(){if(!navigator.onLine){if(!$("#InternetFailureroot")[0]&&localStorage.ip!=="127.0.0.1"&&localStorage.ip!=="localhost"){$(".rootPage").append((a=new LADS.Layout.InternetFailurePage("Internet Lost",true)).getRoot())}}},250);var l=document.body;if(l.addEventListener){l.addEventListener("offline",function(){if(!$("#InternetFailureroot")[0]&&localStorage.ip!=="127.0.0.1"&&localStorage.ip!=="localhost"){$(".rootPage").append((a=new LADS.Layout.InternetFailurePage("Internet Lost",true)).getRoot())}},true)}else if(l.attachEvent){l.attachEvent("onoffline",function(){if(!$("#InternetFailureroot")[0]&&localStorage.ip!=="127.0.0.1"&&localStorage.ip!=="localhost"){$(".rootPage").append((a=new LADS.Layout.InternetFailurePage("Internet Lost",true)).getRoot())}})}else{l.onoffline=function(){if(!$("#InternetFailureroot")[0]&&localStorage.ip!=="127.0.0.1"&&localStorage.ip!=="localhost"){$(".rootPage").append((a=new LADS.Layout.InternetFailurePage("Internet Lost",true)).getRoot())}}}}})()}